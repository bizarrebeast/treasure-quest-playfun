<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Treasure Quest</title>

    
    <meta name="x-ogp-key" content="5532b232-6595-4d58-abc6-80f31529ec1b" id="ogp-key-meta">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet">

    
    <script src="https://sdk.play.fun/latest"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.88.2/dist/phaser.min.js"></script>

    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #2e2348;
        font-family: "Press Start 2P", system-ui;
      }
      canvas { display: block; }
      canvas:focus { outline: none; }

      /* Font preload */
      .font-preload {
        position: absolute;
        left: -9999px;
        top: -9999px;
        font-size: 1px;
        visibility: hidden;
      }
      .font-preload-press-start { font-family: "Press Start 2P"; }
    </style>
  </head>
  <body>
    
    <div class="font-preload font-preload-press-start">.</div>

    
    
  

<script>"use strict";var Game=(()=>{var de=class extends Phaser.Scene{constructor(){super({key:"LoadingScene"})}preload(){}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}this.scene.start("SplashScene")}};var Le={debug:!1,canvas:{width:480,height:720},game:{tileSize:32,floorHeight:12,floorWidth:24,gravity:800,playerSpeed:160,climbSpeed:120,jumpVelocity:-350},scoring:{enemyDefeat:100,coinCollect:50,floorBonus:500}},p=Le;var pe=class extends Phaser.Scene{constructor(){super({key:"SplashScene"});this.transitionComplete=!1}preload(){this.load.image("titleBackground","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/TREASURE%20QUEST%20Bizarre%20Beasts%20BIZarcade%20splash%20page-ydgNu2S0haL0dzmlz4oZLjqZMXaiQo.png?j2A1"),this.load.audio("splash-sound","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/splash%20page%20sfx-2Un9YwdWUGtqQ3ynYGocaBKgQmQTmD.wav?X7j7"),this.load.on("loaderror",e=>{console.error("\u274C Failed to load:",e.key,"- CORS or network issue"),e.key==="splash-sound"&&this.registry.set("audioLoadFailed",!0)}),console.log("\u{1F3AE} SplashScene: Loading title background and sound")}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}if(this.setupAudioUnlock(),this.registry.get("sfxEnabled")!==!1)try{this.sound.play("splash-sound",{volume:.5})}catch{console.log("\u{1F507} Splash sound blocked - will play after user interaction")}this.setupTitleBackground(),this.startTimer()}setupAudioUnlock(){let e=!1,t=()=>{if(!e&&(e=!0,console.log("\u{1F50A} Attempting to unlock audio context..."),this.sound.context)){if(console.log("\u{1F50A} Audio context state:",this.sound.context.state),this.sound.context.state==="suspended")this.sound.context.resume().then(()=>{console.log("\u2705 Audio context successfully resumed!");let o=this.sound.context,n=o.createBuffer(1,1,22050),l=o.createBufferSource();l.buffer=n,l.connect(o.destination),l.start(0),console.log("\u2705 Played empty buffer to unlock iOS audio");try{let h=this.sound.add("splash-sound",{volume:.001});h.play(),h.once("complete",()=>{h.destroy(),console.log("\u2705 Audio fully unlocked with silent sound")})}catch(h){console.log("\u26A0\uFE0F Could not play silent sound:",h)}this.registry.get("sfxEnabled")!==!1&&!this.registry.get("splashSoundPlayed")&&setTimeout(()=>{try{this.sound.play("splash-sound",{volume:.5}),this.registry.set("splashSoundPlayed",!0),console.log("\u2705 Splash sound played after unlock")}catch(h){console.log("\u26A0\uFE0F Could not play splash sound:",h)}},100)}).catch(o=>{console.error("\u274C Failed to resume audio context:",o)});else if(this.sound.context.state==="running"){console.log("\u2705 Audio context already running");try{let o=this.sound.context,n=o.createBuffer(1,1,22050),l=o.createBufferSource();l.buffer=n,l.connect(o.destination),l.start(0),console.log("\u2705 Played empty buffer for iOS compatibility")}catch(o){console.log("\u26A0\uFE0F Could not play empty buffer:",o)}}}};this.input.on("pointerdown",t),this.input.on("pointerup",t);let i=this.add.zone(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height);i.setInteractive(),i.on("pointerdown",t),i.on("pointerup",t);let s=this.sys.canvas,a=o=>{t(),s.removeEventListener("touchstart",a),s.removeEventListener("touchend",a),s.removeEventListener("mousedown",a)};s.addEventListener("touchstart",a,{passive:!0}),s.addEventListener("touchend",a,{passive:!0}),s.addEventListener("mousedown",a,{passive:!0}),this.sys.game.device.input.touch&&this.input.addPointer(2)}setupTitleBackground(){let e=p.canvas.width,t=p.canvas.height;this.titleImage=this.add.image(e/2,t/2,"titleBackground"),this.titleImage.setDepth(0);let i=e/this.titleImage.width,s=t/this.titleImage.height,a=Math.max(i,s);this.titleImage.setScale(a),console.log("\u{1F3AE} SplashScene: Title background positioned and scaled")}startTimer(){console.log("\u{1F3AE} SplashScene: Starting 2-second timer"),this.time.delayedCall(2e3,()=>{this.transitionToGame()})}transitionToGame(){this.transitionComplete||(this.transitionComplete=!0,console.log("\u{1F3AE} SplashScene: Auto-transitioning to instructions after 2 seconds"),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("InstructionsScene")}))}update(){}};var X=class{static markAsPreloaded(r){this.preloadedAssets.add(r),this.loadingAssets.delete(r),console.log(`\u2705 Asset preloaded: ${r}`)}static markAsLoading(r){this.loadingAssets.add(r)}static isPreloaded(r){return this.preloadedAssets.has(r)}static isLoading(r){return this.loadingAssets.has(r)}static getPreloadedCount(){return this.preloadedAssets.size}static clear(){this.preloadedAssets.clear(),this.loadingAssets.clear()}static getCriticalAssets(){return[{key:"visibilityOverlay",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO",type:"image"},{key:"background-treasure-quest-5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1",type:"image"},{key:"playerIdleEye1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%201-p01pa3z9fL9AyLQolMuYyBO3DIqgvB.png?FaaG",type:"image"},{key:"playerIdleEye2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%202-ngx0e1EF33iY14vRpcSvy8QOUjMKnl.png?lsFE",type:"image"},{key:"floor-tile-1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt",type:"image"},{key:"floor-tile-2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%202-EuITFMsdSDebMUmfcikeKCDLqDupml.png?C2mi",type:"image"},{key:"floor-tile-3",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%203-EBjnmTXXufdUFEuzmfnGnaZX4zdI2C.png?69bT",type:"image"},{key:"doorClosed",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U",type:"image"},{key:"tealLadder",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/new%20ladder-ULDbdT9I4h8apxhpJI6WT1PzmaMzLo.png?okOd",type:"image"},{key:"gem-collect",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/regular%20gem%20collect%20sfx-OXLLrrAXWUz21oDTEuQPFb2fxRWxXh.wav?pH1V",type:"audio"},{key:"jump-1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%201%20sfx-Cfx219m2NwhVClkP67iebiwcV0HiF5.wav?GDjY",type:"audio"}]}static getSecondaryAssets(){return[{key:"playerRunLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/running%20body%20eyes%20looking%20left%20foot%20forward-5O5kkQBPD5v2vMJvsBZrCmvWqE5PkV.png?z5EH",type:"image"},{key:"playerRunRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/running%20body%20eyes%20looking%20right%20foot%20forward-7xJdHJFy5Q9V4EhFXVqXRZo1hxKA1z.png?jd5P",type:"image"},{key:"blueCat",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed-HUXqx9HBdotEhJE2LBgzK8Z4kA7e2H.png?AVKZ",type:"image"},{key:"floor-tile-4",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%204-ecTwalLp4rzl9hegwIwVMuDBeN1YVJ.png?nxJJ",type:"image"}]}};X.preloadedAssets=new Set,X.loadingAssets=new Set;var $=class{static generateLoadingScreen(r,e){let t=`loading-screen-${e}`;if(r.textures.exists(t))return t;let i=r.cameras.main.width,s=r.cameras.main.height,a=r.add.renderTexture(0,0,i,s);a.setOrigin(0,0),a.fill(3023688);let o=i/2,n=s/2,l=r.add.text(o,n,"LOADING...",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"});return l.setOrigin(.5),a.draw(l),a.saveTexture(t),l.destroy(),a.destroy(),this.generatedScreens.set(t,"LOADING..."),console.log(`\u2728 Generated loading screen: ${t}`),t}static preGenerateAll(r){[1,11,21,31,41,51].forEach(t=>{this.generateLoadingScreen(r,t)})}static getLoadingScreenKey(r){return r>=51?"loading-screen-51":r>=41?"loading-screen-41":r>=31?"loading-screen-31":r>=21?"loading-screen-21":r>=11?"loading-screen-11":"loading-screen-1"}static showInstantLoadingScreen(r,e){let t=this.getLoadingScreenKey(e),i=r.add.image(r.cameras.main.centerX,r.cameras.main.centerY,t);return i.setOrigin(.5),i.setDepth(1e5),i.setScrollFactor(0),console.log(`\u26A1 Instant loading screen displayed: ${t}`),i}};$.generatedScreens=new Map;var ue=class extends Phaser.Scene{constructor(){super({key:"InstructionsScene"});this.scrollY=0;this.maxScrollY=0;this.contentHeight=0;this.isDragging=!1;this.dragStartY=0;this.scrollStartY=0;this.fromMenu=!1;this.reopenMenu=!1}init(e){this.fromMenu=e?.fromMenu||!1,this.reopenMenu=e?.reopenMenu||!1}preload(){this.load.image("instructionsBg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1"),this.loadGameSprites()}loadGameSprites(){this.load.image("playerIdleEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%201-aD6V48lNdWK5R1x5CPNs4XLX869cmI.png?0XJy"),this.load.image("playerJumpRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20right%20foot%20forward-3clf2KnwfbN3O6BsrtaeHSTAviNbnF.png?xx8e"),this.load.image("playerClimbInstructions","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20instructions%20sprite-1DYkU3H7zBfBhzSDEkjgUSCrDXYBRW.png?v0Zt"),this.load.image("playerThrowingGem","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%20throwing%20gem-7trW3lxLa5cH2ASj5SX3nkwO6dDh6z.png?uNG0"),this.load.image("playerBothFeetDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/both%20feet%20down-Df4cKPxtG04wJmnzY3QzaUeW22F1BN.png?Iekl"),this.load.image("crystal-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20hud%20icon-6cCEP7jp90eqI7W9LeBp7v4s3OgCPX.png?nMJm"),this.load.image("blueCoin","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem-GzKKZKUsDMh3CXMEIV4OmMl4ksrqqm.png?sill"),this.load.image("diamond","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond-LB22Ijoji8erIrMFMvtSwd5Y9rDDwS.png?LlEv"),this.load.image("crystalBallCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("cursedOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb-rHogWhnYUk2xThrTWajfHqMSfxeyfd.png?0wr6"),this.load.image("tealOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb-wupZvLrfiaRIZZyP4TbIOq5HLiVsXz.png?i2qV"),this.load.image("pendant","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pendant-cJISby3d7EEREasbi0gRZkn2u3rNrG.png?xf9m"),this.load.image("heart-crystal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/free%20life%20heart%20crystal-2EJMsIvSQKzdgrqytakBZcDbGf7Jpf.png?E1JG"),this.load.image("yellow-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20chest-QMRMmVk9i7S0qkLteaXfhjqQBI351B.png?sE5u"),this.load.image("blueEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20mid%20mouth-OvzgXzA7k4tlCopnJB6tiD0RqjATsS.png"),this.load.image("yellowEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillars%20for%20instructions-kZxgRN7GYjkDNz2YNyG01YlnoFmwHl.png"),this.load.image("redEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%201-RKF3p3F7fxdBSfen8UD9UGqIzf8zlv.png?xRpM"),this.load.image("greenEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20for%20instructions-id5JdSwy2HEqrh3atcd89xIimkk8fI.png"),this.load.image("stalkerEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%201-Xt3Vtu2FiWWLT9l2wfeakBAqVSZet8.png?gS6O"),this.load.image("beetle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2070-gToASj29g9XTDxUDHBKXDOfpYOKudu.png?uZh3"),this.load.image("rexEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20for%20instructions-nQEFZF5vjHMbWTsA9J6aVk3eAFyBDt.png"),this.load.image("baseblue-eyes-center","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20center-BWjYc09iCwYsTuEB3TEsa7GdmDc4Nj.png?NZtQ"),this.load.image("ladderInstructions","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/ladder%20for%20instructions-G7U9VNDZ8e7krygwL64remh9sNOppw.png?i8q2"),this.load.image("floor-tile-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt"),this.load.image("pink-floor-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20spikes%20floor%20tile-ncAVgIHazwYlznCBP4H6LWLiIhN7OF.png?n27v"),this.load.image("yellow-ceiling-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20spikes%20ceiling%20tile-8vq9W1Y2e1RSpgUfMl9sTp0ZILFHL3.png?mUEb"),this.load.image("doorClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U")}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}this.setupBackground(),this.createTitle(),this.createScrollableContainer(),this.createInstructionCategories(),this.createSkipButton(),this.createScrollIndicator(),this.setupScrolling(),this.generateLoadingScreens(),this.startBackgroundPreload()}setupBackground(){let e=p.canvas.width,t=p.canvas.height;this.bgImage=this.add.image(e/2,t/2,"instructionsBg"),this.bgImage.setDepth(0);let i=e/this.bgImage.width,s=t/this.bgImage.height,a=Math.max(i,s);this.bgImage.setScale(a)}createTitle(){let e=p.canvas.width;this.titleText=this.add.text(e/2,60,"HOW TO PLAY",{fontSize:"28px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",stroke:"#000000",strokeThickness:3}),this.titleText.setOrigin(.5,.5),this.titleText.setDepth(100);let t=this.add.graphics();t.fillStyle(4915330,.6),t.lineStyle(2,16711935);let i=this.titleText.getBounds();t.fillRoundedRect(i.x-20,i.y-10,i.width+40,i.height+20,10),t.strokeRoundedRect(i.x-20,i.y-10,i.width+40,i.height+20,10),t.setDepth(99)}createScrollableContainer(){let e=p.canvas.width,t=p.canvas.height,i=this.add.graphics();i.fillStyle(4915330,.6),i.lineStyle(2,16711935),i.fillRoundedRect(20,100,e-40,t-200,15),i.strokeRoundedRect(20,100,e-40,t-200,15),i.setDepth(5),this.scrollContainer=this.add.container(0,0),this.scrollContainer.setDepth(10),this.maskGraphics=this.add.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(20,100,e-40,t-200),this.maskGraphics.setVisible(!1);let s=this.maskGraphics.createGeometryMask();this.scrollContainer.setMask(s)}createInstructionCategories(){let e=120;[{title:"MOVEMENT & CONTROLS",items:[{sprite:"playerIdleEye1",title:"Move",description:"Use WASD/arrow keys or pink crystal D-pad to move",spriteSize:{width:38,height:58}},{sprite:"playerJumpRightFoot",title:"Jump",description:"Press SPACE or E to jump (or use pink crystal button)",spriteSize:{width:38,height:58}},{sprite:"playerClimbInstructions",title:"Climb",description:"Use UP/DOWN arrows or D-pad to climb ladders",spriteSize:{width:38,height:58}},{sprite:"playerThrow",title:"Throw",description:"Press Q, V, or M to throw crystal balls (use yellow crystal button)",spriteSize:{width:38,height:58}}]},{title:"COLLECTIBLES",items:[{sprite:"crystal-hud-icon",title:"Gems",description:"Collect for 50 points each. 150 gems = free life",spriteSize:{width:45,height:45}},{sprite:"blueCoin",title:"Blue Gems",description:"Rare gems worth 500 points each",spriteSize:{width:40,height:40}},{sprite:"diamond",title:"Diamonds",description:"Valuable gems worth 1000 points each",spriteSize:{width:35,height:35}},{sprite:"heart-crystal",title:"Heart Crystal",description:"Gain an extra life worth 2000 points",spriteSize:{width:35,height:35}},{sprite:"yellow-chest",title:"Treasure Chest",description:"Contains random rewards (2500 points + items)",spriteSize:{width:48,height:48}}]},{title:"POWER-UPS & CURSES",items:[{sprite:"pendant",title:"Pendant",description:"Power-up: Invincibility for 10 seconds",spriteSize:{width:40,height:40}},{sprite:"crystalBallCollectible",title:"Crystal Ball",description:"Power-up: Throw crystal balls for 20 seconds",spriteSize:{width:40,height:40}},{sprite:"cursedOrbCollectible",title:"Cursed Orb",description:"Curse: Darkness effect for 10 seconds",spriteSize:{width:40,height:40}},{sprite:"tealOrbCollectible",title:"Teal Orb",description:"Curse: Controls reversed for 10 seconds",spriteSize:{width:40,height:40}}]},{title:"ENEMIES",items:[{sprite:"yellowEnemy",title:"Caterpillar",description:"Slow random movement (50 points)",spriteSize:{width:58,height:58}},{sprite:"beetle",title:"Rollz",description:"Simple patrol enemy (75 points)",spriteSize:{width:54,height:54}},{sprite:"blueEnemy",title:"Chomper",description:"Standard patrol enemy (100 points)",spriteSize:{width:58,height:58}},{sprite:"redEnemy",title:"Snail",description:"Faster patrol movement (150 points)",spriteSize:{width:58,height:58}},{sprite:"greenEnemy",title:"Bouncer",description:"Fast bouncing movement (200 points)",spriteSize:{width:58,height:58}},{sprite:"stalkerEnemy",title:"Stalker",description:"Activates and chases you (300 points)",spriteSize:{width:58,height:58}},{sprite:"rexEnemy",title:"Rex",description:"Slow moving, nervous flipping jumper (500 points)",spriteSize:{width:58,height:58}},{sprite:"baseblue-eyes-center",title:"Blu",description:"Immovable blocker (1000 points when invincible)",spriteSize:{width:58,height:58}}]},{title:"ENVIRONMENT & HAZARDS",items:[{sprite:"ladderInstructions",title:"Ladders",description:"Climb up and down between floors",spriteSize:{width:48,height:72}},{sprite:"floor-tile-1",title:"Platforms",description:"Solid ground you can walk and jump on",spriteSize:{width:38,height:38}},{sprite:"pink-floor-spike-tile",title:"Floor Spikes",description:"Sharp floor hazards that damage you",spriteSize:{width:38,height:38}},{sprite:"yellow-ceiling-spike-tile",title:"Ceiling Spikes",description:"Sharp ceiling hazards that damage you",spriteSize:{width:38,height:38}},{sprite:"doorClosed",title:"Exit Door",description:"Press UP at the door to complete the level",spriteSize:{width:36,height:48}}]}].forEach(i=>{e=this.createCategory(i.title,i.items,e),e+=40}),this.contentHeight=e,this.maxScrollY=Math.max(0,this.contentHeight-(p.canvas.height-200))}createCategory(e,t,i){let s=p.canvas.width,a=i,o=this.add.text(s/2,a+20,e,{fontSize:"15px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFF00",fontStyle:"bold"});return o.setOrigin(.5,.5),this.scrollContainer.add(o),a+=60,t.forEach(n=>{a=this.createInstructionItem(n,a),a+=10}),a}createInstructionItem(e,t){let i=p.canvas.width,s=this.add.graphics();s.fillStyle(32896,.7),s.lineStyle(2,2142890);let a=e.sprite==="playerThrow"?130:110;if(s.fillRoundedRect(60,t,i-120,a,10),s.strokeRoundedRect(60,t,i-120,a,10),this.scrollContainer.add(s),e.sprite==="playerThrow"){if(this.textures.exists("playerThrowingGem")&&this.textures.exists("playerBothFeetDown")){let d=this.add.container(100,t+60),b=this.add.image(0,0,"playerBothFeetDown");b.setDisplaySize(e.spriteSize.width,e.spriteSize.height),d.add(b);let u=this.add.image(0,0,"playerThrowingGem");u.setDisplaySize(e.spriteSize.width,e.spriteSize.height),d.add(u),this.scrollContainer.add(d)}}else if(this.textures.exists(e.sprite)){let d=this.add.image(100,t+55,e.sprite);e.sprite==="pink-floor-spike-tile"?(d.setCrop(0,1,d.width,d.height-1),d.setDisplaySize(e.spriteSize.width,e.spriteSize.height-1)):e.sprite==="yellow-ceiling-spike-tile"?(d.setCrop(0,0,d.width,d.height-1),d.setDisplaySize(e.spriteSize.width,e.spriteSize.height-1)):d.setDisplaySize(e.spriteSize.width,e.spriteSize.height),this.scrollContainer.add(d)}let o=e.sprite==="playerThrow"?t+25:t+20,n=this.add.text(140,o,e.title,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",fontStyle:"bold"});n.setOrigin(0,.5),this.scrollContainer.add(n);let l=e.sprite==="playerThrow"?t+75:t+65,c=this.add.text(140,l,e.description,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFFFF",wordWrap:{width:i-200},lineSpacing:4});return c.setOrigin(0,.5),this.scrollContainer.add(c),e.sprite==="playerThrow"?t+140:t+120}createSkipButton(){let e=p.canvas.width,t=p.canvas.height;this.skipButton=this.add.container(e-80,t-50),this.skipButton.setDepth(101);let i=this.add.graphics();i.fillStyle(3329330,.9),i.lineStyle(2,16766720),i.fillRoundedRect(-60,-20,120,40,8),i.strokeRoundedRect(-60,-20,120,40,8),this.skipButton.add(i);let s=this.fromMenu?"CLOSE":"SKIP ALL",a=this.add.text(0,0,s,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#000000",fontStyle:"bold"});a.setOrigin(.5,.5),this.skipButton.add(a),this.skipButton.setSize(120,40),this.skipButton.setInteractive(),this.skipButton.on("pointerdown",()=>{console.log("\u{1F3AE} InstructionsScene: Skip requested"),this.transitionToGame()}),this.skipButton.on("pointerover",()=>{i.clear(),i.fillStyle(3329330,1),i.lineStyle(3,16766720),i.fillRoundedRect(-60,-20,120,40,8),i.strokeRoundedRect(-60,-20,120,40,8)}),this.skipButton.on("pointerout",()=>{i.clear(),i.fillStyle(3329330,.9),i.lineStyle(2,16766720),i.fillRoundedRect(-60,-20,120,40,8),i.strokeRoundedRect(-60,-20,120,40,8)})}createScrollIndicator(){let e=p.canvas.height;this.scrollIndicator=this.add.container(p.canvas.width-20,e/2),this.scrollIndicator.setDepth(101);let t=this.add.graphics();t.fillStyle(0,.7),t.fillRoundedRect(-8,-155,16,310,8),this.scrollIndicator.add(t);let i=this.add.graphics();i.lineStyle(2,16766720,1),i.fillStyle(4915330,.8),i.fillRoundedRect(-7,-153,14,306,7),i.strokeRoundedRect(-7,-153,14,306,7),this.scrollIndicator.add(i);let s=this.add.graphics();s.fillStyle(16766720,.3),s.fillRoundedRect(-8,-25,16,50,8),this.scrollIndicator.add(s);let a=this.add.graphics();a.lineStyle(2,16777215,1),a.fillStyle(16766720,1),a.fillRoundedRect(-6,-22,12,44,6),a.strokeRoundedRect(-6,-22,12,44,6),this.scrollIndicator.add(a);let o=this.add.text(0,-165,"\u25B2",{fontSize:"12px",color:"#FFD700"}).setOrigin(.5);this.scrollIndicator.add(o);let n=this.add.text(0,165,"\u25BC",{fontSize:"12px",color:"#FFD700"}).setOrigin(.5);this.scrollIndicator.add(n),this.tweens.add({targets:[s,a],scaleX:1.2,scaleY:1.1,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.updateScrollIndicator()}setupScrolling(){this.input.on("wheel",(e,t,i,s)=>{this.scrollY+=s*.5,this.scrollY=Phaser.Math.Clamp(this.scrollY,0,this.maxScrollY),this.updateScrollPosition()}),this.input.on("pointerdown",e=>{this.isDragging=!0,this.dragStartY=e.y,this.scrollStartY=this.scrollY}),this.input.on("pointermove",e=>{if(this.isDragging){let t=this.dragStartY-e.y;this.scrollY=this.scrollStartY+t,this.scrollY=Phaser.Math.Clamp(this.scrollY,0,this.maxScrollY),this.updateScrollPosition()}}),this.input.on("pointerup",()=>{this.isDragging=!1})}updateScrollPosition(){this.scrollContainer.y=-this.scrollY,this.updateScrollIndicator()}updateScrollIndicator(){if(this.maxScrollY>0){let e=this.scrollY/this.maxScrollY,t=(e-.5)*260,i=this.scrollIndicator.list[2],s=this.scrollIndicator.list[3];i.y=t,s.y=t;let a=this.scrollIndicator.list[4],o=this.scrollIndicator.list[5];a.setAlpha(e>0?.5:1),o.setAlpha(e<1?1:.5),this.scrollIndicator.setVisible(!0)}else this.scrollIndicator.setVisible(!1)}transitionToGame(){let e=this.registry.get("currentLevel")||1,t=$.showInstantLoadingScreen(this,e);this.cameras.main.fadeOut(100,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{if(this.fromMenu&&this.reopenMenu){this.scene.stop("InstructionsScene"),this.scene.wake("GameScene");let i=this.scene.get("GameScene");i&&i.menuOverlay&&i.menuOverlay.container.setVisible(!0)}else this.scene.start("GameScene")})}generateLoadingScreens(){console.log("\u{1F3A8} Pre-generating loading screens for instant display");let e=this.registry.get("currentLevel")||1;$.generateLoadingScreen(this,e),e%10>=8&&$.generateLoadingScreen(this,e+10)}startBackgroundPreload(){console.log("\u{1F504} Starting background preload of GameScene assets");let e=X.getCriticalAssets(),t=X.getSecondaryAssets(),i=[...e,...t],s=0;if(i.forEach(a=>{a.type==="image"&&!this.textures.exists(a.key)?(this.load.image(a.key,a.url),X.markAsLoading(a.key),s++):a.type==="audio"&&!this.cache.audio.exists(a.key)&&(this.load.audio(a.key,a.url),X.markAsLoading(a.key),s++)}),s===0){console.log("\u2705 All assets already loaded");return}console.log(`\u{1F4E6} Queued ${s} assets for background loading`),this.load.on("progress",a=>{let o=Math.round(a*100);console.log(`\u23F3 Background preload progress: ${o}%`)}),this.load.on("filecomplete",a=>{X.markAsPreloaded(a)}),this.load.on("complete",()=>{let a=X.getPreloadedCount();console.log(`\u2705 Background preload complete! ${a} assets ready for GameScene`)}),this.load.on("loaderror",a=>{console.warn(`\u26A0\uFE0F Failed to preload: ${a.key} - will retry in GameScene`)}),this.load.start()}update(){}};var Z=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i){let s=e.textures.exists("playerIdleEye1")?"playerIdleEye1":"player";if(!e.textures.exists("playerIdleEye1")){let a=e.add.graphics();a.fillStyle(65280,1),a.fillRect(0,0,24,32),a.generateTexture("player",24,32),a.destroy()}super(e,t,i,s);this.isClimbing=!1;this.currentLadder=null;this.nearbyLadder=null;this.currentJumpSound=1;this.touchControls=null;this.walkAnimationTimer=0;this.climbAnimationTimer=0;this.footstepTimer=0;this.FOOTSTEP_INTERVAL=300;this.idleAnimationTimer=0;this.currentFrame="idle";this.currentIdleState="eye1";this.currentClimbFoot="left";this.isMoving=!1;this.isJumping=!1;this.runningTiltTimer=0;this.lastFrameWasJump=!1;this.jumpButtonDown=!1;this.jumpHoldTime=0;this.isAirborne=!1;this.jumpReleased=!1;this.MIN_JUMP_VELOCITY=-120;this.MAX_JUMP_VELOCITY=p.game.jumpVelocity;this.MAX_JUMP_HOLD_TIME=300;this.speedMultiplier=1;this.crystalBallActive=!1;this.crystalBallTimer=0;this.CRYSTAL_BALL_DURATION=2e4;this.crystalBallParticles=[];this.crystalBallWarningPlayed=!1;this.cursedOrbActive=!1;this.cursedOrbTimer=0;this.CURSED_ORB_DURATION=1e4;this.cursedOrbParticles=[];this.cursedOrbWarningPlayed=!1;this.cursedTealOrbActive=!1;this.cursedTealOrbTimer=0;this.CURSED_TEAL_ORB_DURATION=1e4;this.cursedTealOrbParticles=[];this.cursedTealOrbWarningPlayed=!1;this.idleTimer=0;this.IDLE_THRESHOLD=5e3;this.bubbleActive=!1;this.onBubbleTrigger=null;this.onMovementStart=null;this.longIdleTimer=0;this.LONG_IDLE_THRESHOLD=3e4;this.isPlayingLongIdle=!1;this.longIdleFrame="left";this.longIdleAnimationTimer=0;this.runBodySprite=null;this.runLegsSprite=null;this.useTwoLayerRunning=!0;this.currentLegFrame="bothDown";this.legAnimationStep=0;this.bodyAnimationTimer=0;this.legAnimationTimer=0;this.runningEyeTimer=0;this.currentRunningEye="playerRunBody";this.isFiringProjectile=!1;e.add.existing(this),e.physics.add.existing(this),(s==="playerIdleEye1"||s.startsWith("player"))&&this.setDisplaySize(48,64),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(18,49),this.setOffset(15,12),this.setDepth(20),this.initializeTwoLayerRunning(e,t,i),this.cursors=e.input.keyboard.createCursorKeys(),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE)}setTouchControls(e){this.touchControls=e}setBubbleTriggerCallback(e){this.onBubbleTrigger=e}setMovementStartCallback(e){this.onMovementStart=e}initializeTwoLayerRunning(e,t,i){if(e.textures.exists("playerRunBody")&&e.textures.exists("playerRunLegsBothDown")&&this.useTwoLayerRunning){let a=t,o=i;this.runBodySprite=e.add.image(a,o,"playerRunBody"),this.runBodySprite.setDisplaySize(48,64),this.runBodySprite.setDepth(21),this.runBodySprite.setVisible(!1),this.runLegsSprite=e.add.image(a,o,"playerRunLegsBothDown"),this.runLegsSprite.setDisplaySize(48,64),this.runLegsSprite.setDepth(19),this.runLegsSprite.setVisible(!1),this.currentLegFrame="bothDown",this.legAnimationStep=0}else this.useTwoLayerRunning=!1}updateTwoLayerPosition(){this.runBodySprite&&this.runLegsSprite&&this.runBodySprite.visible&&((this.runBodySprite.x!==this.x||this.runBodySprite.y!==this.y)&&(this.runBodySprite.x=this.x,this.runBodySprite.y=this.y,this.runLegsSprite.x=this.x,this.runLegsSprite.y=this.y),this.runBodySprite.flipX!==this.flipX&&(this.runBodySprite.setFlipX(this.flipX),this.runLegsSprite.setFlipX(this.flipX)))}showTwoLayerRunning(e){this.useTwoLayerRunning&&this.runBodySprite&&this.runLegsSprite&&(this.runBodySprite.setVisible(e),this.runLegsSprite.setVisible(e),this.setVisible(!e))}updateLegAnimation(){if(!this.runLegsSprite||!this.useTwoLayerRunning)return;let t=["bothDown","leftMid","leftHigh","leftMid","bothDown","rightMid","rightHigh","rightMid"][this.legAnimationStep];this.currentLegFrame=t;let i={bothDown:"playerRunLegsBothDown",leftMid:"playerRunLegsLeftMid",leftHigh:"playerRunLegsLeftHigh",rightMid:"playerRunLegsRightMid",rightHigh:"playerRunLegsRightHigh"};this.runLegsSprite.setTexture(i[t]),this.legAnimationStep=(this.legAnimationStep+1)%8}updateBodyExpression(){if(!this.runBodySprite||!this.useTwoLayerRunning)return;if(this.isFiringProjectile){this.runBodySprite.setTexture("playerRunBodyEyes7");return}let e=Math.random();if(e<.05)this.runBodySprite.setTexture("playerRunBodyBlink"),this.scene.time.delayedCall(100,()=>{this.runBodySprite&&!this.isFiringProjectile&&this.runBodySprite.setTexture(this.currentRunningEye)});else if(e<.8){let t=["playerRunBody","playerRunBodyEyes2","playerRunBodyEyes3","playerRunBodyEyes4","playerRunBodyEyes5","playerRunBodyEyes6"],i=Phaser.Utils.Array.GetRandom(t);this.currentRunningEye=i,this.runBodySprite.setTexture(i)}}notifyBubbleActive(e){this.bubbleActive=e,e&&(this.idleTimer=0)}update(e,t){if(!this.body)return;let i=this.scene;if(i.isGameOver)return;let s=600;this.body.velocity.y>s&&this.setVelocityY(s);let a=i.isLevelStarting||!1,o=p.canvas.height-p.game.tileSize-10;if(this.y>o&&!this.isClimbing&&!a&&(this.y=o,this.setVelocityY(0),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.blocked.down=!0)),this.body.velocity.y>0&&!this.isClimbing&&!a&&this.y+this.body.velocity.y*t/1e3>o){let F=(o-this.y)*1e3/t;this.setVelocityY(Math.max(0,F))}let n=this.body.blocked.down,l=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),c=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),h=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),d=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),b=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),u=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),m=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),y=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.V),f=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M),g=this.cursedTealOrbActive,v=this.cursors.left.isDown||h.isDown||this.touchControls?.leftPressed||!1,S=this.cursors.right.isDown||b.isDown||this.touchControls?.rightPressed||!1,x=this.cursors.up.isDown||c.isDown||this.touchControls?.upPressed||!1,C=this.cursors.down.isDown||d.isDown||this.touchControls?.downPressed||!1,T=g?S:v,P=g?v:S,k=g?C:x,B=g?x:C,M=Phaser.Input.Keyboard.JustDown(l)||Phaser.Input.Keyboard.JustDown(u)||this.touchControls?.isJumpJustPressed()||!1,L=l.isDown||u.isDown||this.touchControls?.jumpPressed||!1,E=Phaser.Input.Keyboard.JustDown(m)||Phaser.Input.Keyboard.JustDown(y)||Phaser.Input.Keyboard.JustDown(f)||this.touchControls?.isActionJustPressed()||!1;this.isMoving=(T||P)&&!this.isClimbing;let O=this.isJumping;if(this.isJumping=!n&&Math.abs(this.body.velocity.y)>10&&!this.isClimbing,O&&(n||this.isClimbing)&&(this.isJumping=!1),!this.isClimbing){let Y=p.game.playerSpeed*this.speedMultiplier;T?(this.setVelocityX(-Y),this.setFlipX(!0)):P?(this.setVelocityX(Y),this.setFlipX(!1)):this.setVelocityX(0);let F=(this.nearbyLadder!==null||this.currentLadder!==null)&&k;this.isClimbing&&(F=!0);let U=!this.body.velocity.y||this.body.velocity.y>-100;if(M&&n&&!this.isAirborne&&!F&&!this.isClimbing&&U){this.jumpButtonDown=!0,this.jumpHoldTime=0,this.isAirborne=!0,this.jumpReleased=!1;let z=this.touchControls?.jumpPressed||!1,q=-150;this.setVelocityY(q),this.playJumpSound(),console.log(`[${z?"TOUCH":"KEYBOARD"}] Jump started - Initial velocity: ${q}, Target max: ${this.MAX_JUMP_VELOCITY}`),this.triggerHapticFeedback()}if(this.isAirborne&&this.jumpButtonDown&&!this.jumpReleased){if(L){if(this.jumpHoldTime+=t,this.jumpHoldTime<this.MAX_JUMP_HOLD_TIME&&this.body?.velocity.y<0){let q=1-Math.min(this.jumpHoldTime/this.MAX_JUMP_HOLD_TIME,1),j=this.touchControls?.jumpPressed||!1,Ce=t/1e3,N=-1600*q*Ce,ce=this.body.velocity.y,he=Math.max(ce+N,this.MAX_JUMP_VELOCITY);this.setVelocityY(he)}}else if(this.jumpButtonDown=!1,this.jumpReleased=!0,this.body.velocity.y<0){let z=this.body.velocity.y<-250?.85:.92;this.setVelocityY(this.body.velocity.y*z)}}if(n&&this.isAirborne&&this.body?.velocity.y>=0){let z=this.touchControls?.jumpPressed?"TOUCH":"KEYBOARD",q=this.jumpHoldTime;console.log(`[${z}] Jump completed - Total hold time: ${q.toFixed(0)}ms`),this.isAirborne=!1,this.jumpButtonDown=!1,this.jumpReleased=!1,this.jumpHoldTime=0,this.triggerHapticFeedback()}}if(this.isClimbing&&this.currentLadder){this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setAllowGravity(!1),this.setVelocityX(0);let Y=this.currentLadder,D=Y.y+Y.height/2,F=this.y>=D-10;this.y>D-10&&(this.y=D-10,this.setVelocityY(0));let U=!1;if(k){let j=p.game.climbSpeed*this.speedMultiplier;this.setVelocityY(-j),U=!0}else if(B&&!F){let j=p.game.climbSpeed*this.speedMultiplier;this.setVelocityY(j),U=!0}else this.setVelocityY(0);this.isMoving=U;let z=F&&B;if((T||P)&&!k&&!B&&!F&&!z){this.exitClimbing();let j=p.game.playerSpeed*this.speedMultiplier;T?this.setVelocityX(-j):P&&this.setVelocityX(j)}let q=D>=p.canvas.height-p.game.tileSize*3;M&&!k&&(q||!F)&&!z&&(this.exitClimbing(),this.setVelocityY(this.MAX_JUMP_VELOCITY),this.playJumpSound())}E&&this.fireCrystalBall(),this.updateBubbleSystem(),this.updateCrystalBallTimer(t),this.updateCursedOrbTimer(t),this.updateCursedTealOrbTimer(t),this.updateSmartAnimations(),this.runBodySprite&&this.runBodySprite.visible&&(this.body.velocity.x!==0||this.body.velocity.y!==0)&&this.updateTwoLayerPosition()}startClimbing(e){this.isClimbing=!0,this.currentLadder=e,this.isAirborne=!1,this.isJumping=!1,this.jumpButtonDown=!1,this.jumpReleased=!1,this.jumpHoldTime=0,this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setAllowGravity(!1),this.body.setVelocityY(0));let t=e;this.x=t.x,this.currentClimbFoot="left",this.changePlayerTexture("playerClimbLeftFoot"),this.climbAnimationTimer=0,this.resetAnimationTimers(),this.resetRunningTilt()}exitClimbing(){this.isClimbing=!1,this.currentLadder=null,this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setAllowGravity(!0),this.currentFrame="idle",this.changePlayerTexture("playerIdleEye1"),this.resetAnimationTimers()}checkLadderProximity(e){this.nearbyLadder=e;let t=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),i=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),s=this.cursors.up.isDown||t.isDown||this.touchControls?.upPressed||!1,a=this.cursors.down.isDown||i.isDown||this.touchControls?.downPressed||!1;if(s||a){let o=e;return Math.abs(this.x-o.x)<20}return!1}clearNearbyLadder(){this.isClimbing||(this.nearbyLadder=null)}getIsClimbing(){return this.isClimbing}setSpeedMultiplier(e){this.speedMultiplier=e}updateBubbleSystem(){if(!this.body)return;let e=this.scene.game.loop.delta,t=this.body.blocked.down,i=!this.isMoving&&!this.isClimbing&&!this.isJumping&&t;i&&!this.bubbleActive?(this.idleTimer+=e,this.idleTimer>=this.IDLE_THRESHOLD&&(this.onBubbleTrigger&&this.onBubbleTrigger(),this.idleTimer=0)):((this.isMoving||this.isClimbing||this.isJumping)&&this.bubbleActive&&this.onMovementStart&&this.onMovementStart(),this.idleTimer=0),i?(this.longIdleTimer+=e,this.longIdleTimer>=this.LONG_IDLE_THRESHOLD&&!this.isPlayingLongIdle&&(this.isPlayingLongIdle=!0,this.longIdleFrame="left",this.longIdleAnimationTimer=0)):(this.isPlayingLongIdle&&(this.isPlayingLongIdle=!1,this.currentFrame="idle",this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")),this.longIdleTimer=0,this.longIdleAnimationTimer=0)}updateSmartAnimations(){if(!this.body)return;let e=this.scene.game.loop.delta,t=this.body.blocked.down;if(this.isClimbing){this.isJumping=!1,this.isMoving?this.handleClimbingAnimation(e):(this.changePlayerTexture("playerClimbLeftFoot"),this.resetAnimationTimers()),this.showTwoLayerRunning(!1);return}else!t&&this.isJumping&&!this.isClimbing?this.handleJumpingAnimation():this.isMoving&&t?this.handleRunningAnimation(e):t&&this.handleIdleAnimation(e)}handleJumpingAnimation(){let e=this.flipX?"playerJumpLeftFoot":"playerJumpRightFoot";this.changePlayerTexture(e),this.currentFrame="idle",this.showTwoLayerRunning(!1),this.resetRunningTilt()}handleClimbingAnimation(e){this.showTwoLayerRunning(!1),this.climbAnimationTimer+=e,this.climbAnimationTimer>=120&&this.isMoving?(this.currentClimbFoot==="left"?(this.currentClimbFoot="right",this.changePlayerTexture("playerClimbRightFoot")):(this.currentClimbFoot="left",this.changePlayerTexture("playerClimbLeftFoot")),this.climbAnimationTimer=0):this.isMoving||(this.changePlayerTexture("playerClimbLeftFoot"),this.resetAnimationTimers())}handleRunningAnimation(e){if(this.footstepTimer+=e,this.footstepTimer>=this.FOOTSTEP_INTERVAL&&(this.footstepTimer=0),this.useTwoLayerRunning&&this.runBodySprite&&this.runLegsSprite){if(this.currentFrame==="idle"){this.currentFrame="leftStep",this.showTwoLayerRunning(!0),this.legAnimationTimer=0,this.bodyAnimationTimer=0,this.runningTiltTimer=0,this.lastFrameWasJump=!1,this.legAnimationStep=0,this.footstepTimer=0;return}this.legAnimationTimer+=e,this.bodyAnimationTimer+=e,this.showTwoLayerRunning(!0),this.legAnimationTimer>=28&&(this.updateLegAnimation(),this.legAnimationTimer=0),this.bodyAnimationTimer>=300&&(this.updateBodyExpression(),this.bodyAnimationTimer=0)}else{if(this.currentFrame==="idle"){this.currentFrame="leftStep",this.changePlayerTexture("playerRunLeftFoot"),this.walkAnimationTimer=0,this.runningTiltTimer=0,this.lastFrameWasJump=!1;return}this.walkAnimationTimer+=e,this.runningTiltTimer+=e,this.applyRunningTilt(),this.walkAnimationTimer>=120&&(this.currentFrame==="rightStep"?(this.currentFrame="leftStep",this.changePlayerTexture("playerRunLeftFoot")):(this.currentFrame="rightStep",this.changePlayerTexture("playerRunRightFoot")),this.walkAnimationTimer=0)}}handleIdleAnimation(e){if(this.footstepTimer=0,this.isPlayingLongIdle){this.handleLongIdleAnimation(e);return}if(this.idleAnimationTimer+=e,this.currentFrame!=="idle"){this.currentFrame="idle",this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1"),this.idleAnimationTimer=0,this.walkAnimationTimer=0,this.climbAnimationTimer=0,this.legAnimationTimer=0,this.bodyAnimationTimer=0,this.showTwoLayerRunning(!1),this.resetRunningTilt();return}let t;if(this.currentIdleState==="blink"?t=100+Math.random()*80:t=({eye1:1200,eye2:1100,eye3:1400,eye4:1600,eye5:1800}[this.currentIdleState]||1200)+(Math.random()-.5)*800,this.idleAnimationTimer>=t){let i=Math.random(),s=["eye1","eye2","eye3","eye4","eye5"];switch(this.currentIdleState){case"eye1":i<.25?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.55?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.75?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):i<.9?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye2":i<.3?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.6?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.8?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):i<.95?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye3":i<.2?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.45?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.7?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.9?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye4":i<.15?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.4?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.65?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.85?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye5":i<.1?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.45?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.75?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.9?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4"));break;case"blink":i<.35?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.65?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.8?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):i<.95?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break}this.idleAnimationTimer=0}}handleLongIdleAnimation(e){this.longIdleAnimationTimer+=e;let t=400;this.showTwoLayerRunning(!1),this.longIdleAnimationTimer>=t&&(this.longIdleFrame==="left"?(this.longIdleFrame="right",this.changePlayerTexture("playerIdleBootyRight")):(this.longIdleFrame="left",this.changePlayerTexture("playerIdleBootyLeft")),this.longIdleAnimationTimer=0)}resetAnimationTimers(){this.walkAnimationTimer=0,this.climbAnimationTimer=0,this.idleAnimationTimer=0}changePlayerTexture(e){this.scene.textures.exists(e)&&(this.setTexture(e),this.setDisplaySize(48,64))}applyRunningTilt(){let i=Math.sin(this.runningTiltTimer*.02)*.08;this.setRotation(i)}resetRunningTilt(){this.setRotation(0),this.runningTiltTimer=0}addRoundedHitboxVisualization(){if(!p.debug)return;let e=this.scene.add.graphics(),t=this.body;e.lineStyle(2,65416,.8),e.strokeRoundedRect(t.x-this.x,t.y-this.y,t.width,t.height,6),e.setDepth(25),this.scene.add.existing(e),this.scene.events.on("postupdate",()=>{e&&e.active&&(e.x=this.x,e.y=this.y)})}triggerHapticFeedback(){let e=this.scene;e&&e.triggerFarcadeHapticFeedback&&e.triggerFarcadeHapticFeedback()}activateCrystalBall(){console.log("\u{1F52E} ACTIVATING Crystal Ball power-up for 10 seconds!"),this.crystalBallActive=!0,this.crystalBallTimer=this.CRYSTAL_BALL_DURATION,this.crystalBallWarningPlayed=!1,this.startCrystalBallParticles();let e=this.scene;e&&e.updateCrystalBallTimer?(console.log("\u{1F52E} Updating HUD timer with",this.crystalBallTimer,"ms"),e.updateCrystalBallTimer(this.crystalBallTimer,this.CRYSTAL_BALL_DURATION)):console.log("\u274C Could not update HUD timer - scene method not found")}updateCrystalBallTimer(e){if(this.crystalBallActive){this.crystalBallTimer-=e,!this.crystalBallWarningPlayed&&this.crystalBallTimer<=2e3&&this.crystalBallTimer>0&&(this.crystalBallWarningPlayed=!0,console.log("\u23F0 Timer warning for crystal ball")),this.crystalBallGlow&&(this.crystalBallGlow.x=this.x,this.crystalBallGlow.y=this.y),this.crystalBallTimer<=0&&(this.crystalBallActive=!1,this.crystalBallTimer=0,this.stopCrystalBallParticles());let t=this.scene;t&&t.updateCrystalBallTimer&&t.updateCrystalBallTimer(this.crystalBallTimer,this.CRYSTAL_BALL_DURATION)}}getCrystalBallActive(){return this.crystalBallActive}getCrystalBallTimeRemaining(){return this.crystalBallTimer}fireCrystalBall(){if(console.log("\u{1F52B} Fire button pressed! Active:",this.crystalBallActive,"Climbing:",this.isClimbing),!this.crystalBallActive){console.log("\u274C Cannot fire - Crystal Ball power-up not active");return}if(this.isClimbing){console.log("\u274C Cannot fire - Player is climbing");return}this.isFiringProjectile=!0,this.scene.time.delayedCall(400,()=>{this.isFiringProjectile=!1,this.runBodySprite&&this.useTwoLayerRunning&&this.isRunning&&this.runBodySprite.setTexture(this.currentRunningEye)});let e=this.scene;if(e&&e.createCrystalBallProjectile){let t=this.flipX?-1:1,i=this.body?this.body.velocity.x:0;console.log("\u{1F52B} FIRING Crystal Ball projectile! Direction:",t,"Player velocity:",i),e.createCrystalBallProjectile(this.x,this.y,t,i)}else console.log("\u274C Could not fire - scene method not found")}startCrystalBallParticles(){this.stopCrystalBallParticles(),this.crystalBallParticleTimer=this.scene.time.addEvent({delay:150,callback:()=>this.createCrystalBallParticle(),loop:!0})}createCrystalBallParticle(){if(!this.crystalBallActive||!this.scene)return;let e=this.scene.add.graphics();e.fillStyle(4509863,.3),e.fillCircle(0,0,4),e.fillStyle(4509863,.6),e.fillCircle(0,0,2),e.fillStyle(4509863,1),e.fillRect(-1,-1,2,2);let t=Math.random()*Math.PI*2,i=25+Math.random()*15,s=this.x+Math.cos(t)*i,a=this.y+Math.sin(t)*i;e.x=s,e.y=a,e.setDepth(19),this.crystalBallParticles.push(e),this.scene.tweens.add({targets:e,x:this.x+Math.cos(t+1)*(i+10),y:a-20,alpha:0,duration:1200,ease:"Power2.easeOut",onComplete:()=>{let o=this.crystalBallParticles.indexOf(e);o>-1&&this.crystalBallParticles.splice(o,1),e.destroy()}})}stopCrystalBallParticles(){this.crystalBallParticleTimer&&(this.crystalBallParticleTimer.destroy(),this.crystalBallParticleTimer=void 0),this.crystalBallParticles.forEach(e=>e.destroy()),this.crystalBallParticles=[],this.crystalBallGlow&&(this.crystalBallGlow.destroy(),this.crystalBallGlow=void 0)}createPlayerGlow(){if(!this.crystalBallGlow||!this.crystalBallActive)return;this.crystalBallGlow.clear();let e=4509863;this.crystalBallGlow.x=this.x,this.crystalBallGlow.y=this.y,this.crystalBallGlow.fillStyle(e,.1),this.crystalBallGlow.fillCircle(0,0,35),this.crystalBallGlow.fillStyle(e,.2),this.crystalBallGlow.fillCircle(0,0,25),this.crystalBallGlow.fillStyle(e,.3),this.crystalBallGlow.fillCircle(0,0,15),this.scene.tweens.add({targets:this.crystalBallGlow,scaleX:1.2,scaleY:1.2,alpha:.7,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}activateCursedOrb(){this.cursedOrbActive=!0,this.cursedOrbTimer=this.CURSED_ORB_DURATION,this.cursedOrbWarningPlayed=!1,this.startCursedOrbParticles();let e=this.scene;e&&e.updateCursedOrbTimer&&e.updateCursedOrbTimer(this.cursedOrbTimer,this.CURSED_ORB_DURATION),e&&e.activateDarknessEffect&&e.activateDarknessEffect()}activateCursedTealOrb(){this.cursedTealOrbActive=!0,this.cursedTealOrbTimer=this.CURSED_TEAL_ORB_DURATION,this.cursedTealOrbWarningPlayed=!1,this.startCursedTealOrbParticles();let e=this.scene;e&&e.updateCursedTealOrbTimer&&e.updateCursedTealOrbTimer(this.cursedTealOrbTimer,this.CURSED_TEAL_ORB_DURATION)}getCursedOrbActive(){return this.cursedOrbActive}getCursedTealOrbActive(){return this.cursedTealOrbActive}updateCursedOrbTimer(e){if(this.cursedOrbActive){if(this.cursedOrbTimer-=e,!this.cursedOrbWarningPlayed&&this.cursedOrbTimer<=2e3&&this.cursedOrbTimer>0&&(this.cursedOrbWarningPlayed=!0,console.log("\u23F0 Timer warning for cursed orb")),this.cursedOrbGlow&&(this.cursedOrbGlow.x=this.x,this.cursedOrbGlow.y=this.y),this.cursedOrbTimer<=0){this.cursedOrbActive=!1,this.cursedOrbTimer=0,this.stopCursedOrbParticles();let i=this.scene;i&&i.deactivateDarknessEffect&&i.deactivateDarknessEffect()}let t=this.scene;t&&t.updateCursedOrbTimer&&t.updateCursedOrbTimer(this.cursedOrbTimer,this.CURSED_ORB_DURATION)}}updateCursedTealOrbTimer(e){if(this.cursedTealOrbActive){this.cursedTealOrbTimer-=e,!this.cursedTealOrbWarningPlayed&&this.cursedTealOrbTimer<=2e3&&this.cursedTealOrbTimer>0&&(this.cursedTealOrbWarningPlayed=!0,console.log("\u23F0 Timer warning for cursed teal orb")),this.cursedTealOrbGlow&&(this.cursedTealOrbGlow.x=this.x,this.cursedTealOrbGlow.y=this.y),this.cursedTealOrbTimer<=0&&(this.cursedTealOrbActive=!1,this.cursedTealOrbTimer=0,this.stopCursedTealOrbParticles());let t=this.scene;t&&t.updateCursedTealOrbTimer&&t.updateCursedTealOrbTimer(this.cursedTealOrbTimer,this.CURSED_TEAL_ORB_DURATION)}}startCursedOrbParticles(){this.stopCursedOrbParticles(),this.cursedOrbGlow=this.scene.add.graphics(),this.cursedOrbGlow.setDepth(18),this.createCursedOrbPlayerGlow(),this.cursedOrbParticleTimer=this.scene.time.addEvent({delay:200,callback:()=>this.createCursedOrbParticle(),loop:!0})}startCursedTealOrbParticles(){this.stopCursedTealOrbParticles(),this.cursedTealOrbGlow=this.scene.add.graphics(),this.cursedTealOrbGlow.setDepth(18),this.createCursedTealOrbPlayerGlow(),this.cursedTealOrbParticleTimer=this.scene.time.addEvent({delay:180,callback:()=>this.createCursedTealOrbParticle(),loop:!0})}createCursedOrbParticle(){if(!this.cursedOrbActive||!this.scene)return;let e=this.scene.add.graphics();e.fillStyle(5768769,.4),e.fillCircle(0,0,3),e.fillStyle(5768769,.8),e.fillCircle(0,0,1);let t=Math.random()*Math.PI*2,i=30+Math.random()*15,s=this.x+Math.cos(t)*i,a=this.y+Math.sin(t)*i;e.x=s,e.y=a,e.setDepth(19),this.cursedOrbParticles.push(e),this.scene.tweens.add({targets:e,y:a+25,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{let o=this.cursedOrbParticles.indexOf(e);o>-1&&this.cursedOrbParticles.splice(o,1),e.destroy()}})}createCursedTealOrbParticle(){if(!this.cursedTealOrbActive||!this.scene)return;let e=this.scene.add.graphics();e.fillStyle(4827036,.4),e.fillCircle(0,0,3),e.fillStyle(4827036,.8),e.fillCircle(0,0,1);let t=Math.random()*Math.PI*2,i=25+Math.random()*20,s=this.x+Math.cos(t)*i,a=this.y+Math.sin(t)*i;e.x=s,e.y=a,e.setDepth(19),this.cursedTealOrbParticles.push(e),this.scene.tweens.add({targets:e,x:s+Math.sin(t)*30,y:a-20,alpha:0,duration:1300,ease:"Power2.easeOut",onComplete:()=>{let o=this.cursedTealOrbParticles.indexOf(e);o>-1&&this.cursedTealOrbParticles.splice(o,1),e.destroy()}})}createCursedOrbPlayerGlow(){if(!this.cursedOrbGlow||!this.cursedOrbActive)return;this.cursedOrbGlow.clear();let e=5768769;this.cursedOrbGlow.x=this.x,this.cursedOrbGlow.y=this.y,this.cursedOrbGlow.fillStyle(e,.15),this.cursedOrbGlow.fillCircle(0,0,40),this.cursedOrbGlow.fillStyle(e,.25),this.cursedOrbGlow.fillCircle(0,0,25),this.scene.tweens.add({targets:this.cursedOrbGlow,scaleX:1.3,scaleY:1.3,alpha:.6,duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createCursedTealOrbPlayerGlow(){if(!this.cursedTealOrbGlow||!this.cursedTealOrbActive)return;this.cursedTealOrbGlow.clear();let e=4827036;this.cursedTealOrbGlow.x=this.x,this.cursedTealOrbGlow.y=this.y,this.cursedTealOrbGlow.fillStyle(e,.12),this.cursedTealOrbGlow.fillCircle(0,0,38),this.cursedTealOrbGlow.fillStyle(e,.22),this.cursedTealOrbGlow.fillCircle(0,0,22),this.scene.tweens.add({targets:this.cursedTealOrbGlow,rotation:Math.PI*2,scaleX:1.4,scaleY:1.4,alpha:.7,duration:900,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}stopCursedOrbParticles(){this.cursedOrbParticleTimer&&(this.cursedOrbParticleTimer.destroy(),this.cursedOrbParticleTimer=void 0),this.cursedOrbParticles.forEach(e=>e.destroy()),this.cursedOrbParticles=[],this.cursedOrbGlow&&(this.cursedOrbGlow.destroy(),this.cursedOrbGlow=void 0)}stopCursedTealOrbParticles(){this.cursedTealOrbParticleTimer&&(this.cursedTealOrbParticleTimer.destroy(),this.cursedTealOrbParticleTimer=void 0),this.cursedTealOrbParticles.forEach(e=>e.destroy()),this.cursedTealOrbParticles=[],this.cursedTealOrbGlow&&(this.cursedTealOrbGlow.destroy(),this.cursedTealOrbGlow=void 0)}stopAllCursedOrbParticles(){this.stopCursedOrbParticles()}stopAllCursedTealOrbParticles(){this.stopCursedTealOrbParticles()}playJumpSound(){if(this.scene.registry.get("sfxEnabled")!==!1){let t=`jump-${this.currentJumpSound}`;this.scene.sound.play(t,{volume:.4})}this.currentJumpSound=this.currentJumpSound>=3?1:this.currentJumpSound+1}};var G=class w extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,a,o,n=!1){let l=["blue","yellow","green","red","blue_caterpillar"],c;o?c=o:c=l[Math.floor(Math.random()*l.length)];let h;c==="blue"?h="blueEnemyMouthClosed":c==="purple"?h="purpleEnemyMouthClosed":c==="yellow"?h="yellowEnemyMouthClosedEyeOpen":c==="green"?h="greenEnemy":c==="red"?h="redEnemyMouthClosedEyes1":c==="blue_caterpillar"?h="blueCaterpillarEyesDown":h="blueEnemyMouthClosed";super(e,t,i,h);this.baseSpeed=80;this.bounceTimer=0;this.randomMoveTimer=0;this.isSquished=!1;this.gapDetectionCooldown=0;this.collisionCooldown=0;this.debugGraphics=null;this.debugUpdateHandler=null;this.yellowEnemyAnimationState="mouthClosed";this.blueEnemyAnimationState="idle";this.biteTimer=0;this.blinkTimer=0;this.biteAnimationTimer=0;this.blinkAnimationTimer=0;this.nextExpressionTime=0;this.nextBiteTime=0;this.nextBlinkTime=0;this.blueTextureFixed=!1;this.stuckTimer=0;this.lastPositionX=0;this.stuckThreshold=1500;this.positionCheckInterval=250;this.positionCheckTimer=0;this.positionHistory=[];this.velocityStuckTimer=0;this.individualSpeedMultiplier=1;this.turnDelayTimer=0;this.redEnemyAnimationState="patrol";this.redBiteTimer=0;this.redBlinkTimer=0;this.redBiteSequenceTimer=0;this.redEyeState=1;this.nextRedBiteTime=0;this.nextRedBlinkTime=0;this.redBiteFrameIndex=0;this.greenEnemyAnimationState="eyeRight";this.greenEyeTimer=0;this.greenBlinkTimer=0;this.nextGreenEyeTime=0;this.nextGreenBlinkTime=0;this.blueCaterpillarAnimationState="eyesDown";this.blueCaterpillarEyeTimer=0;this.blueCaterpillarBlinkTimer=0;this.nextBlueCaterpillarEyeTime=0;this.nextBlueCaterpillarBlinkTime=0;this.blueCaterpillarAnimationDelay=0;this.blueCaterpillarAnimationsEnabled=!0;this.blueCaterpillarVelocityLogTimer=0;this.blueCaterpillarVelocityCheckTimer=0;this.blueCaterpillarLastX=0;this.blueCaterpillarStuckFrames=0;this.isStalker=!1;this.stalkerState="hidden";this.stalkerTriggerDistance=64;this.stalkerPlayerRef=null;this.stalkerOriginalY=0;this.stalkerHasPlayerPassed=!1;this.stalkerMineTimer=0;this.stalkerMineDelayDuration=3e3;this.stalkerCurrentSpeed=80*1.5;this.stalkerSpeedIncrement=5;this.stalkerChasePersistenceTimer=0;this.stalkerChasePersistenceDuration=4e3;this.stalkerIsInPersistentChase=!1;this.stalkerEyeState="eye1";this.stalkerEyeAnimationTimer=0;if(this.catColor=c,this.isStalker=n,c==="green"&&this.setDisplaySize(36,36),this.isStalker&&(this.stalkerOriginalY=i,e.textures.exists("stalkerEnemyEye1")&&this.setTexture("stalkerEnemyEye1"),this.stalkerEyeState="eye1"),e.add.existing(this),e.physics.add.existing(this),(c==="blue"||c==="purple")&&this.body instanceof Phaser.Physics.Arcade.Body){this.body.setSize(63.5,45);let b=(c==="blue"?this.isBlueEnemyAnimationSprite(h):this.isPurpleEnemyAnimationSprite(h))?32:19;this.body.setOffset(-15.75+2,b-4.5)}else if(c==="yellow"&&this.body instanceof Phaser.Physics.Arcade.Body){let d=this.body.width,b=this.body.height;this.body.setSize(d*.7,b*.7);let u=(d-this.body.width)/2,m=(b-this.body.height)/2;this.body.setOffset(u,m)}else if(c==="blue_caterpillar"&&this.body instanceof Phaser.Physics.Arcade.Body){let d=this.body.width,b=this.body.height;this.body.setSize(54,20)}else if(c==="red"&&this.body instanceof Phaser.Physics.Arcade.Body)if(this.isStalker){let b=this.texture.get().width,u=42,m=u/b,y=12/m;this.body.setCircle(y);let f=y*2,g=(b-f)/2,v=(b-f)/2+14/m;this.body.setOffset(g,v),console.log("  Circle radius:",y,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",u,"x",u)}else{let b=this.texture.get().width,u=this.isStalker?42:52,m=u/b,y=15/m;this.body.setCircle(y);let f=y*2,g=(b-f)/2,v=(b-f)/2+14/m;this.body.setOffset(g,v),console.log("  Circle radius:",y,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",u,"x",u)}else if(c==="green"&&this.body instanceof Phaser.Physics.Arcade.Body){let d=this.texture.get().width,b=this.texture.get().height,u=this.displayWidth/d,m=this.displayHeight/b,y=12,f=(u+m)/2,g=y/f;this.body.setCircle(g),console.log("  Circle radius requested:",y,"px (screen space)"),console.log("  Circle radius actual:",g,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Current sprite display size:",this.displayWidth,"x",this.displayHeight),console.log("  Texture frame size:",d,"x",b);let v=g*2,S=(d-v)/2,x=(b-v)/2,C=5/f;this.body.setOffset(S,x+C),console.log("  Circle offset applied:",this.body.offset.x,",",this.body.offset.y),console.log("  Average scale:",f),console.log("  Visual offset in texture space:",0,C)}if(this.setCollideWorldBounds(!0),this.setBounce(0),this.body instanceof Phaser.Physics.Arcade.Body&&c!=="green"&&this.body.setAllowGravity(!1),c==="yellow"&&this.isYellowEnemyAnimationSprite(h))this.setDisplaySize(54,21.6),console.log("  Visual sprite size:",this.displayWidth,"x",this.displayHeight),console.log("  Original texture size:",this.texture.get().width,"x",this.texture.get().height),console.log("  Texture key:",h),this.setOffset(15,5),console.log("  Offset applied:",15,",",5),this.setFlipX(!1),this.initializeYellowEnemyAnimations();else if(c==="blue_caterpillar"&&this.isBlueCaterpillarAnimationSprite(h)){this.setDisplaySize(64,25.6),console.log("  Visual sprite size:",this.displayWidth,"x",this.displayHeight),console.log("  Physics body size: 54 x 20 (set earlier)"),console.log("  Original texture size:",this.texture.get().width,"x",this.texture.get().height),console.log("  Texture key:",h);let d=this.texture.get().width,b=this.texture.get().height,u=(d-54)/2,m=(b-20)/2,y=23,f=15;this.setOffset(y,f),console.log("  Calculated center offset:",u,",",m),console.log("  Final offset applied:",y,",",f),console.log("  Sprite position:",this.x,",",this.y),this.setFlipX(!1),this.initializeBlueCaterpillarAnimations(),this.blueCaterpillarAnimationsEnabled=!1,this.blueCaterpillarAnimationDelay=1500,this.body instanceof Phaser.Physics.Arcade.Body&&(console.log("  Final physics body offset:",this.body.offset.x,",",this.body.offset.y),console.log("  Physics body position:",this.body.x,",",this.body.y))}else if(c==="blue"&&this.isBlueEnemyAnimationSprite(h))this.setDisplaySize(36,36),this.setOffset(5,32),this.setFlipX(!1),this.initializeBlueEnemyAnimations();else if(c==="purple"&&this.isPurpleEnemyAnimationSprite(h))this.setDisplaySize(36,36),this.setOffset(5,32),this.setFlipX(!1),this.initializeBlueEnemyAnimations();else if(c==="red"&&this.isRedEnemyAnimationSprite(h)){let d=this.isStalker?42:52;this.setDisplaySize(d,d);let b=this.isStalker?24:26;this.setOffset(18,b),this.setFlipX(!1),this.initializeRedEnemyAnimations(),this.isStalker}else c==="green"&&h==="greenEnemy"&&(this.setFlipX(!1),console.log("  Display size remains:",this.displayWidth,"x",this.displayHeight),console.log("  Physics body handles visual offset"));this.body instanceof Phaser.Physics.Arcade.Body,this.setDepth(15),this.platformBounds={left:s,right:a},this.setupBehavior(),c==="blue"&&e.textures.exists("blueEnemy")&&this.setFlipX(this.direction>0),this.isStalker?(this.setVisible(!1),this.setVelocity(0,0),this.body.setGravityY(0),this.body.setImmovable(!0)):(this.setVelocityX(this.moveSpeed*this.direction),this.catColor==="blue_caterpillar"&&this.body&&(this.body.setImmovable(!1),this.body.moves=!0))}getCatColor(){return this.catColor}getIsStalker(){return this.isStalker}setupBehavior(){this.individualSpeedMultiplier=.85+Math.random()*.3;let i=(this.scene.levelManager?.getCurrentLevel()||1)<=10;switch(this.catColor){case"blue":case"purple":this.moveSpeed=this.baseSpeed*this.individualSpeedMultiplier;break;case"yellow":let s=i?.4:.6;this.moveSpeed=this.baseSpeed*s*this.individualSpeedMultiplier;break;case"blue_caterpillar":let a=i?.65:.8;this.moveSpeed=this.baseSpeed*a*this.individualSpeedMultiplier;break;case"green":this.moveSpeed=this.baseSpeed*1*this.individualSpeedMultiplier;break;case"red":this.moveSpeed=this.baseSpeed*1.2*this.individualSpeedMultiplier;break}if(this.catColor==="yellow"&&i){let s=(this.platformBounds.left+this.platformBounds.right)/2;this.direction=this.x<s?-1:1}else this.catColor==="green"?(this.direction=Math.random()<.5?-1:1,this.bounceTimer=Math.random()*1500):this.direction=Math.random()<.5?-1:1}update(e,t){if(!this.isSquished){if(this.collisionCooldown-=t,this.isStalker){this.updateStalker(t);return}if(this.body)switch(this.catColor){case"blue":case"purple":this.updateBluePatrol(),this.updateBlueEnemyAnimations(t),this.checkIfChomperStuck(t);break;case"yellow":this.updateYellowPatrol(t),this.updateYellowEnemyAnimations(t),this.checkIfCaterpillarStuck(t);break;case"blue_caterpillar":this.updateBlueCaterpillarPatrol(t),this.updateBlueCaterpillarAnimations(t),this.checkIfCaterpillarStuck(t);break;case"green":this.updateGreenBounce(t),this.updateGreenEnemyAnimations(t);break;case"red":this.updateRedPatrol(),this.updateRedEnemyAnimations(t);break}}}updateBluePatrol(){(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&this.setVelocityX(0),this.turnDelayTimer>0&&(this.turnDelayTimer-=Phaser.Math.Clamp(16,0,100));let e=40;this.x<=this.platformBounds.left+e?this.turnDelayTimer<=0&&(this.direction=1,this.x<this.platformBounds.left+20&&(this.x=this.platformBounds.left+20),this.turnDelayTimer=50+Math.random()*150,(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+1e3,this.setVelocityX(this.moveSpeed*this.direction))):this.x>=this.platformBounds.right-e&&this.turnDelayTimer<=0&&(this.direction=-1,this.x>this.platformBounds.right-20&&(this.x=this.platformBounds.right-20),this.turnDelayTimer=50+Math.random()*150,(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+1e3,this.setVelocityX(this.moveSpeed*this.direction))),this.blueEnemyAnimationState==="idle"&&this.setVelocityX(this.moveSpeed*this.direction),(this.catColor==="blue"||this.catColor==="purple")&&this.setFlipX(this.direction>0)}updateYellowPatrol(e){let s=(this.scene.levelManager?.getCurrentLevel()||1)<=10;if(this.randomMoveTimer-=e,this.randomMoveTimer<=0){let n=s?.05:.3;Math.random()<n&&(this.direction=Math.random()<.5?-1:1),s?this.randomMoveTimer=2e3+Math.random()*1e3:this.randomMoveTimer=500+Math.random()*1e3}this.turnDelayTimer>0&&(this.turnDelayTimer-=e);let a=Math.abs(this.body.velocity.x)<5&&Math.abs(this.moveSpeed)>0,o=35;this.x<=this.platformBounds.left+o||a&&this.direction===-1?this.turnDelayTimer<=0&&(this.direction=1,this.turnDelayTimer=100+Math.random()*400):(this.x>=this.platformBounds.right-o||a&&this.direction===1)&&this.turnDelayTimer<=0&&(this.direction=-1,this.turnDelayTimer=100+Math.random()*400),this.setVelocityX(this.moveSpeed*this.direction),this.isYellowEnemyAnimationSprite(this.texture.key)&&this.setFlipX(this.direction===1)}updateGreenBounce(e){if(this.bounceTimer-=e,this.bounceTimer<=0&&this.body?.touching.down&&(this.setVelocityY(-200),this.bounceTimer=1e3+Math.random()*1e3),this.x<=this.platformBounds.left+20){this.direction=1;let t=.9+Math.random()*.2;this.setVelocityX(this.moveSpeed*this.direction*t)}else if(this.x>=this.platformBounds.right-20){this.direction=-1;let t=.9+Math.random()*.2;this.setVelocityX(this.moveSpeed*this.direction*t)}else this.setVelocityX(this.moveSpeed*this.direction)}updateRedPatrol(){if(this.x<=this.platformBounds.left+25?(this.direction=1,this.x<=this.platformBounds.left+5&&this.setX(this.platformBounds.left+5)):this.x>=this.platformBounds.right-25&&(this.direction=-1,this.x>=this.platformBounds.right-5&&this.setX(this.platformBounds.right-5)),Math.random()<5e-4&&this.x>this.platformBounds.left+25&&this.x<this.platformBounds.right-25&&(this.direction*=-1),this.x<this.platformBounds.left+5||this.x>this.platformBounds.right-5){let t=Math.max(this.platformBounds.left+5,Math.min(this.platformBounds.right-5,this.x));this.setX(t),this.direction*=-1}this.setVelocityX(this.moveSpeed*this.direction)}reverseDirection(){this.isSquished||this.collisionCooldown<=0&&(this.direction*=-1,this.setVelocityX(this.moveSpeed*this.direction),this.collisionCooldown=200,this.catColor==="blue"&&this.setFlipX(this.direction>0))}getDirection(){return this.direction}squish(){this.isSquished||(this.isSquished=!0,this.setVelocity(0,0),this.body&&(this.body.enable=!1),this.cleanupDebugVisualization(),this.scene.tweens.add({targets:this,scaleY:.2,scaleX:1.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.cats&&this.scene.cats.remove(this),this.destroy()}}))}addDebugVisualization(){p.debug&&(this.debugGraphics=this.scene.add.graphics(),this.debugUpdateHandler=()=>{if(this.debugGraphics&&this.debugGraphics.active&&this.active){this.debugGraphics.clear(),this.debugGraphics.lineStyle(2,255,.8);let e=this.displayWidth,t=this.displayHeight;this.debugGraphics.strokeRect(this.x-e/2,this.y-t/2,e,t),this.debugGraphics.lineStyle(1,16777215,.8),this.debugGraphics.lineBetween(this.x-5,this.y,this.x+5,this.y),this.debugGraphics.lineBetween(this.x,this.y-5,this.x,this.y+5);let i=this.body;i&&(this.debugGraphics.lineStyle(2,16711680,.8),this.debugGraphics.strokeRect(i.x,i.y,i.width,i.height))}},this.scene.events.on("postupdate",this.debugUpdateHandler),this.debugGraphics.setDepth(25),this.scene.add.existing(this.debugGraphics))}cleanupDebugVisualization(){this.debugUpdateHandler&&(this.scene.events.off("postupdate",this.debugUpdateHandler),this.debugUpdateHandler=null),this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=null)}addRoundedHitboxVisualization(){}isYellowEnemyAnimationSprite(e){return["yellowEnemyMouthOpenEyeOpen","yellowEnemyMouthOpenBlinking","yellowEnemyMouthClosedEyeOpen","yellowEnemyMouthClosedBlinking"].includes(e)}isBlueEnemyAnimationSprite(e){return["blueEnemyMouthClosed","blueEnemyMouthClosedBlinking","blueEnemyMouthPartialOpen","blueEnemyMouthPartialOpenBlinking","blueEnemyMouthOpen","blueEnemyMouthOpenBlinking"].includes(e)}isPurpleEnemyAnimationSprite(e){return["purpleEnemyMouthClosed","purpleEnemyMouthPartialOpen","purpleEnemyMouthOpen"].includes(e)}initializeYellowEnemyAnimations(){this.nextBlinkTime=Math.random()*1e3+1e3,this.nextExpressionTime=Math.random()*3e3+3e3,this.yellowEnemyAnimationState="mouthClosed"}initializeBlueEnemyAnimations(){this.nextBiteTime=Math.random()*2e3+2e3,this.nextBlinkTime=Number.MAX_SAFE_INTEGER,this.blueEnemyAnimationState="idle"}updateBlueEnemyAnimations(e){if(!this.isBlueEnemyAnimationSprite(this.texture.key)&&!this.isPurpleEnemyAnimationSprite(this.texture.key)){this.catColor==="blue"&&!this.blueTextureFixed&&this.scene.textures.exists("blueEnemyMouthClosed")?(this.setTexture("blueEnemyMouthClosed"),this.setDisplaySize(36,36),this.blueTextureFixed=!0,this.initializeBlueEnemyAnimations()):this.catColor==="purple"&&!this.blueTextureFixed&&this.scene.textures.exists("purpleEnemyMouthClosed")&&(this.setTexture("purpleEnemyMouthClosed"),this.setDisplaySize(36,36),this.blueTextureFixed=!0,this.initializeBlueEnemyAnimations());return}switch(this.blueTextureFixed=!1,this.biteTimer+=e,this.biteAnimationTimer+=e,this.blueEnemyAnimationState){case"idle":this.handleIdleState();break;case"bite_partial":this.handleBitePartialState();break;case"bite_full":this.handleBiteFullState();break;case"blinking":this.blueEnemyAnimationState="idle";break}this.checkForNewAnimations()}handleIdleState(){this.changeBlueEnemyTexture("blueEnemyMouthClosed")}handleBitePartialState(){this.biteAnimationTimer<150?this.changeBlueEnemyTexture("blueEnemyMouthPartialOpen"):this.biteAnimationTimer>300?(console.warn("Bite partial state exceeded max duration - forcing transition"),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+3e3,this.setVelocityX(this.moveSpeed*this.direction)):(this.blueEnemyAnimationState="bite_full",this.biteAnimationTimer=0)}handleBiteFullState(){this.biteAnimationTimer<200?this.changeBlueEnemyTexture("blueEnemyMouthOpen"):this.biteAnimationTimer>350?(console.warn("Bite full state exceeded max duration - forcing idle"),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+3e3,this.setVelocityX(this.moveSpeed*this.direction)):(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+Math.random()*2e3+2e3,this.setVelocityX(this.moveSpeed*this.direction))}handleBlinkingState(){this.blueEnemyAnimationState="idle",this.blinkAnimationTimer=0,this.nextBlinkTime=Number.MAX_SAFE_INTEGER}checkForNewAnimations(){this.biteTimer>=this.nextBiteTime&&this.blueEnemyAnimationState==="idle"&&(this.blueEnemyAnimationState="bite_partial",this.biteAnimationTimer=0)}changeBlueEnemyTexture(e){if(!this.scene)return;let t=e;if(this.catColor==="purple"&&(e==="blueEnemyMouthClosed"?t="purpleEnemyMouthClosed":e==="blueEnemyMouthPartialOpen"?t="purpleEnemyMouthPartialOpen":e==="blueEnemyMouthOpen"&&(t="purpleEnemyMouthOpen")),this.scene.textures.exists(t))this.setTexture(t),this.setDisplaySize(36,36);else{let i=this.catColor==="purple"?"purpleEnemyMouthClosed":"blueEnemyMouthClosed";this.scene.textures.exists(i)&&(this.setTexture(i),this.setDisplaySize(36,36))}}checkIfChomperStuck(e){if(this.positionCheckTimer+=e,this.positionCheckTimer>=this.positionCheckInterval&&(this.positionHistory.push(this.x),this.positionHistory.length>8&&this.positionHistory.shift(),this.positionCheckTimer=0),Math.abs(this.body.velocity.x)<1){if(this.velocityStuckTimer+=e,this.velocityStuckTimer>1e3&&this.x>this.platformBounds.left+40&&this.x<this.platformBounds.right-40){console.warn("Chomper velocity stuck - forcing reset"),this.forceResetChomper();return}}else this.velocityStuckTimer=0;if(this.positionHistory.length>=4&&this.positionHistory.every(i=>Math.abs(i-this.positionHistory[0])<2)&&this.x>this.platformBounds.left+40&&this.x<this.platformBounds.right-40){console.warn("Chomper position stuck (not at edge) - forcing reset"),this.forceResetChomper();return}if(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full"){if(this.biteAnimationTimer>400){console.warn("Bite animation taking too long - forcing reset"),this.forceResetChomper();return}let t=this.x;if(Math.abs(t-this.lastPositionX)>1)this.stuckTimer=0;else if(this.stuckTimer+=e,this.stuckTimer>=this.stuckThreshold){console.error("Chomper stuck during bite - forcing recovery!"),this.forceResetChomper();return}this.lastPositionX=t}else this.stuckTimer=0,this.lastPositionX=this.x}forceResetChomper(){console.warn("=== FORCE RESETTING STUCK CHOMPER ==="),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.blinkAnimationTimer=0,this.biteTimer=0,this.blinkTimer=0,this.nextBiteTime=5e3,this.nextBlinkTime=Number.MAX_SAFE_INTEGER,this.stuckTimer=0,this.positionCheckTimer=0,this.velocityStuckTimer=0,this.positionHistory=[],this.changeBlueEnemyTexture("blueEnemyMouthClosed"),this.x<=this.platformBounds.left+50?(this.direction=1,this.x=this.platformBounds.left+51):this.x>=this.platformBounds.right-50?(this.direction=-1,this.x=this.platformBounds.right-51):this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction*1.2),this.scene.time.delayedCall(500,()=>{this.active&&this.setVelocityX(this.moveSpeed*this.direction)}),this.setData("recoveredFromStuck",!0),this.setData("stuckRecoveryCount",(this.getData("stuckRecoveryCount")||0)+1),this.getData("stuckRecoveryCount")>=2&&(console.error("Chomper stuck 2+ times - marking for replacement"),this.setData("needsReplacement",!0))}checkIfCaterpillarStuck(e){if(!this.body)return;let t=this.catColor==="blue_caterpillar"?"Blue Caterpillar":"Yellow Caterpillar";if(this.positionCheckTimer+=e,this.positionCheckTimer>=this.positionCheckInterval&&(this.positionHistory.push(this.x),this.positionHistory.length>6&&this.positionHistory.shift(),this.positionCheckTimer=0,this.catColor==="blue_caterpillar"&&this.positionHistory.length>2)){let i=Math.abs(this.positionHistory[this.positionHistory.length-1]-this.positionHistory[0])}if(this.body){if(Math.abs(this.body.velocity.x)<1){if(this.velocityStuckTimer+=e,this.velocityStuckTimer>400&&this.x>this.platformBounds.left+30&&this.x<this.platformBounds.right-30){console.warn(`\u{1F41B} ${t} velocity stuck at X:${Math.round(this.x)} - forcing reset`),this.forceResetCaterpillar();return}}else this.velocityStuckTimer=0;if(this.positionHistory.length>=4&&this.positionHistory.every(s=>Math.abs(s-this.positionHistory[0])<3)&&this.x>this.platformBounds.left+30&&this.x<this.platformBounds.right-30){console.warn(`\u{1F41B} ${t} position stuck at X:${Math.round(this.x)} (not at edge) - forcing reset`),this.forceResetCaterpillar();return}(this.x<this.platformBounds.left-10||this.x>this.platformBounds.right+10)&&(console.error(`\u{1F41B} ${t} escaped platform bounds at X:${Math.round(this.x)} - forcing reset`),this.forceResetCaterpillar())}}replaceSelfWithYellowCaterpillar(){let e=new w(this.scene,this.x,this.y,this.platformBounds.left,this.platformBounds.right,"yellow",!1);this.speedMultiplier&&e.setSpeedMultiplier(this.speedMultiplier);let t=this.scene;t.yellowEnemies&&t.yellowEnemies.add(e),t.cats&&t.cats.add(e),t.blueCaterpillars&&t.blueCaterpillars.remove(this),t.cats&&t.cats.remove(this),this.destroy()}forceResetCaterpillar(){let e=this.catColor==="blue_caterpillar"?"Blue Caterpillar":"Yellow Caterpillar";console.warn(`\u{1F41B} === RESETTING STUCK ${e.toUpperCase()} at X:${Math.round(this.x)} ===`),this.catColor==="blue_caterpillar"?(this.blueCaterpillarAnimationState="eyesDown",this.blueCaterpillarBlinkTimer=0,this.blueCaterpillarEyeTimer=0,this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500,this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.scene&&this.scene.textures.exists("blueCaterpillarEyesDown")&&this.setTexture("blueCaterpillarEyesDown")):(this.yellowAnimationState="mouth_closed",this.yellowBlinkTimer=0,this.yellowMouthTimer=0),this.stuckTimer=0,this.positionCheckTimer=0,this.velocityStuckTimer=0,this.positionHistory=[],this.randomMoveTimer=200,this.turnDelayTimer=0;let t=(this.platformBounds.left+this.platformBounds.right)/2;if(this.x<t?this.direction=1:this.direction=-1,this.x<=this.platformBounds.left+20||this.x>=this.platformBounds.right-20){let i=this.platformBounds.left+50+Math.random()*(this.platformBounds.right-this.platformBounds.left-100);this.setX(i)}this.setVelocityX(this.moveSpeed*this.direction*1.5),this.scene.time.delayedCall(500,()=>{this.active&&this.setVelocityX(this.moveSpeed*this.direction)}),this.setData("recoveredFromStuck",!0),this.setData("stuckRecoveryCount",(this.getData("stuckRecoveryCount")||0)+1),this.getData("stuckRecoveryCount")>=3&&(console.error(`${e} stuck 3+ times - may need manual intervention`),this.setData("needsReplacement",!0))}isRedEnemyAnimationSprite(e){return["redEnemyMouthClosedEyes1","redEnemyMouthClosedEyes2","redEnemyMouthClosedBlinking","redEnemyMouthPartialOpenEyes1Wink","redEnemyMouthPartialOpenEyes2","redEnemyMouthWideOpenEyes1Wink","redEnemyMouthWideOpenEyes2","redEnemyMouthWideOpenEyes3"].includes(e)}initializeRedEnemyAnimations(){this.nextRedBiteTime=Math.random()*2e3+3e3,this.nextRedBlinkTime=Math.random()*500+1e3,this.redEnemyAnimationState="patrol",this.redEyeState=Math.random()<.5?1:2}updateYellowEnemyAnimations(e){if(!this.isYellowEnemyAnimationSprite(this.texture.key))return;this.biteTimer+=e,this.biteTimer>=this.nextExpressionTime&&(this.yellowEnemyAnimationState=this.yellowEnemyAnimationState==="mouthClosed"?"mouthOpen":"mouthClosed",this.nextExpressionTime=this.biteTimer+Math.random()*3e3+3e3);let t="yellowEnemyMouthClosedEyeOpen";this.yellowEnemyAnimationState==="mouthOpen"&&(t="yellowEnemyMouthOpenEyeOpen"),this.texture.key!==t&&this.setTexture(t)}updateRedEnemyAnimations(e){if(this.isRedEnemyAnimationSprite(this.texture.key)){switch(this.redBiteTimer+=e,this.redBlinkTimer+=e,this.redBiteSequenceTimer+=e,this.redEnemyAnimationState){case"patrol":this.handleRedPatrolState();break;case"bite_starting":this.handleRedBiteStartingState();break;case"bite_opening":this.handleRedBiteOpeningState();break;case"bite_wide":this.handleRedBiteWideState();break;case"bite_closing":this.handleRedBiteClosingState();break}this.checkForRedAnimationTriggers()}}handleRedPatrolState(){let e=800+Math.random()*400;this.redBiteSequenceTimer>=e&&(this.redEyeState=this.redEyeState===1?2:1,this.redBiteSequenceTimer=0),this.changeRedEnemyTexture(this.redEyeState===1?"redEnemyMouthClosedEyes1":"redEnemyMouthClosedEyes2")}handleRedBiteStartingState(){this.redBiteSequenceTimer<80?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes2"):(this.redEnemyAnimationState="bite_opening",this.redBiteSequenceTimer=0,this.redBiteFrameIndex=0)}handleRedBiteOpeningState(){this.redBiteSequenceTimer<100?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes1Wink"):(this.redEnemyAnimationState="bite_wide",this.redBiteSequenceTimer=0,this.redBiteFrameIndex=0)}handleRedBiteWideState(){let e=["redEnemyMouthWideOpenEyes1Wink","redEnemyMouthWideOpenEyes2","redEnemyMouthWideOpenEyes3"],i=Math.floor(this.redBiteSequenceTimer/120);i<e.length?this.changeRedEnemyTexture(e[i]):(this.redEnemyAnimationState="bite_closing",this.redBiteSequenceTimer=0)}handleRedBiteClosingState(){this.redBiteSequenceTimer<80?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes2"):(this.redEnemyAnimationState="patrol",this.redBiteSequenceTimer=0,this.nextRedBiteTime=this.redBiteTimer+Math.random()*2e3+3e3)}checkForRedAnimationTriggers(){this.redBiteTimer>=this.nextRedBiteTime&&this.redEnemyAnimationState==="patrol"&&(this.redEnemyAnimationState="bite_starting",this.redBiteSequenceTimer=0),this.redBlinkTimer>=this.nextRedBlinkTime&&(this.redEnemyAnimationState==="patrol"&&(this.changeRedEnemyTexture("redEnemyMouthClosedBlinking"),this.scene.time.delayedCall(150,()=>{this.redEnemyAnimationState==="patrol"&&this.changeRedEnemyTexture(this.redEyeState===1?"redEnemyMouthClosedEyes1":"redEnemyMouthClosedEyes2")})),this.nextRedBlinkTime=this.redBlinkTimer+Math.random()*1e3+1e3)}changeRedEnemyTexture(e){this.scene&&this.scene.textures.exists(e)&&(this.setTexture(e),this.setDisplaySize(52,52),this.catColor==="red"&&this.setFlipX(this.direction>0))}setPlayerReference(e){this.stalkerPlayerRef=e}canDamagePlayer(){return this.isStalker&&this.stalkerState==="chasing"}updateStalker(e){if(!this.stalkerPlayerRef)return;let t=this.y;switch(this.stalkerState){case"hidden":this.updateStalkerHidden();break;case"activated":this.updateStalkerActivated(e);break;case"chasing":this.updateStalkerChasing(e),this.updateStalkerEyeAnimations(e);break}Math.abs(this.y-t)>.1}updateStalkerHidden(){if(!this.stalkerPlayerRef)return;let e=this.stalkerPlayerRef.x,t=this.stalkerPlayerRef.y,i=Math.abs(e-this.x),s=t<=this.y+40,a=t>=this.y-40;s&&a&&i<=this.stalkerTriggerDistance&&!this.stalkerHasPlayerPassed&&(this.stalkerState="activated",this.stalkerMineTimer=this.stalkerMineDelayDuration,this.stalkerHasPlayerPassed=!0,this.scene.textures.exists("stalkerEnemyEyeOnly")&&this.setTexture("stalkerEnemyEyeOnly"),this.setVisible(!0))}updateStalkerActivated(e){this.stalkerMineTimer-=e,this.stalkerMineTimer<=0&&this.stalkerPopOut()}stalkerPopOut(){this.stalkerState="chasing",this.setVisible(!0),this.scene.textures.exists("stalkerEnemyEye1")&&this.setTexture("stalkerEnemyEye1"),this.stalkerEyeState="eye1",this.body.setGravityY(0),this.body.setImmovable(!1),this.stalkerOriginalY=this.y,this.stalkerCurrentSpeed=80*1.5,this.stalkerChasePersistenceTimer=this.stalkerChasePersistenceDuration,this.stalkerIsInPersistentChase=!0}updateStalkerChasing(e){let t=this.stalkerPlayerRef.x,i=this.stalkerPlayerRef.y,s=this.y;this.y=this.stalkerOriginalY,Math.abs(s-this.stalkerOriginalY)>.1;let a=i<=this.y+40,o=i>=this.y-120,n=a&&o;if(this.stalkerIsInPersistentChase&&(this.stalkerChasePersistenceTimer-=e,this.stalkerChasePersistenceTimer<=0&&(this.stalkerIsInPersistentChase=!1)),n){this.stalkerCurrentSpeed+=this.stalkerSpeedIncrement*.01;let l=80*2.25;this.stalkerCurrentSpeed>l&&(this.stalkerCurrentSpeed=l);let c=t>this.x?1:-1;this.direction=c,this.setVelocityX(this.stalkerCurrentSpeed*c)}else if(this.stalkerIsInPersistentChase){let l=t>this.x?1:-1;this.direction=l,this.setVelocityX(this.stalkerCurrentSpeed*l*.7)}else this.updateRedPatrol()}updateStalkerEyeAnimations(e){if(!this.scene||!this.scene.textures.exists("stalkerEnemyEye1"))return;this.stalkerEyeAnimationTimer+=e;let t;if(this.stalkerEyeState==="blink"?t=100+Math.random()*80:t=1200+(Math.random()-.5)*800,this.stalkerEyeAnimationTimer>=t){let i=Math.random();if(this.stalkerEyeState==="blink"){let o=["eye1","eye2","eye3","eye4"];this.stalkerEyeState=o[Math.floor(Math.random()*4)]}else if(i<.2)this.stalkerEyeState="blink";else{let o=["eye1","eye2","eye3","eye4"];this.stalkerEyeState=o[Math.floor(Math.random()*4)]}let a={eye1:"stalkerEnemyEye1",eye2:"stalkerEnemyEye2",eye3:"stalkerEnemyEye3",eye4:"stalkerEnemyEye4",blink:"stalkerEnemyBlinking"}[this.stalkerEyeState];this.scene.textures.exists(a)&&this.setTexture(a),this.stalkerEyeAnimationTimer=0}}updateGreenEnemyAnimations(e){if(this.greenEyeTimer+=e,this.greenBlinkTimer+=e,this.nextGreenEyeTime===0&&(this.nextGreenEyeTime=1e3+Math.random()*2e3),this.nextGreenBlinkTime===0&&(this.nextGreenBlinkTime=3e3+Math.random()*4e3),this.greenBlinkTimer>=this.nextGreenBlinkTime){this.greenEnemyAnimationState="blinking",this.setTexture("greenEnemyBlink"),setTimeout(()=>{if(this.greenEnemyAnimationState==="blinking"){let t=["eyeRight","eyeCenter","eyeLeft"];this.greenEnemyAnimationState=t[Math.floor(Math.random()*t.length)],this.updateGreenEnemyTexture()}},100+Math.random()*50),this.greenBlinkTimer=0,this.nextGreenBlinkTime=3e3+Math.random()*4e3;return}if(this.greenEnemyAnimationState!=="blinking"&&this.greenEyeTimer>=this.nextGreenEyeTime){let t=this.greenEnemyAnimationState,s=["eyeRight","eyeCenter","eyeLeft"].filter(a=>a!==t);this.greenEnemyAnimationState=s[Math.floor(Math.random()*s.length)],this.updateGreenEnemyTexture(),this.greenEyeTimer=0,this.nextGreenEyeTime=800+Math.random()*1500}}updateGreenEnemyTexture(){let e="greenEnemy";switch(this.greenEnemyAnimationState){case"eyeRight":e="greenEnemy";break;case"eyeCenter":e="greenEnemyEyeCenter";break;case"eyeLeft":e="greenEnemyEyeLeft";break;case"blinking":e="greenEnemyBlink";break}this.scene&&this.scene.textures.exists(e)&&this.setTexture(e)}isBlueCaterpillarAnimationSprite(e){return["blueCaterpillarEyesRight","blueCaterpillarEyesLeft","blueCaterpillarEyesDown","blueCaterpillarBlinking"].includes(e)}initializeBlueCaterpillarAnimations(){this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500,this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.blueCaterpillarAnimationState="eyesDown"}updateBlueCaterpillarPatrol(e){if(!this.body||!this.body.enable)return;if(this.blueCaterpillarLastX||(this.blueCaterpillarLastX=this.x,this.blueCaterpillarStuckFrames=0),Math.abs(this.x-this.blueCaterpillarLastX)<.01){if(this.blueCaterpillarStuckFrames++,this.blueCaterpillarStuckFrames===60){this.replaceSelfWithYellowCaterpillar();return}}else this.blueCaterpillarStuckFrames=0;this.blueCaterpillarLastX=this.x,this.setVelocityX(this.moveSpeed*this.direction),this.blueCaterpillarVelocityCheckTimer||(this.blueCaterpillarVelocityCheckTimer=0),this.blueCaterpillarVelocityCheckTimer+=e,this.blueCaterpillarVelocityCheckTimer>500&&Math.abs(this.body.velocity.x)<5&&(this.blueCaterpillarVelocityCheckTimer=0),this.turnDelayTimer>0&&(this.turnDelayTimer-=e);let i=35;if(this.x<=this.platformBounds.left+i){if(this.turnDelayTimer<=0){this.direction=1,this.turnDelayTimer=100+Math.random()*200;let s=Math.max(this.platformBounds.left+i+5,this.x);this.setX(s),this.setVelocityX(this.moveSpeed*this.direction)}}else if(this.x>=this.platformBounds.right-i&&this.turnDelayTimer<=0){this.direction=-1,this.turnDelayTimer=100+Math.random()*200;let s=Math.min(this.platformBounds.right-i-5,this.x);this.setX(s),this.setVelocityX(this.moveSpeed*this.direction)}if(this.setVelocityX(this.moveSpeed*this.direction),this.x<this.platformBounds.left+5||this.x>this.platformBounds.right-5){let s=Math.max(this.platformBounds.left+10,Math.min(this.platformBounds.right-10,this.x));this.setX(s),this.direction*=-1,this.setVelocityX(this.moveSpeed*this.direction)}this.isBlueCaterpillarAnimationSprite(this.texture.key)&&this.setFlipX(this.direction===1)}updateBlueCaterpillarAnimations(e){if(!this.blueCaterpillarAnimationsEnabled){this.blueCaterpillarAnimationDelay-=e,this.blueCaterpillarAnimationDelay<=0&&(this.blueCaterpillarAnimationsEnabled=!0);return}if(!this.isBlueCaterpillarAnimationSprite(this.texture.key))return;if(this.blueCaterpillarBlinkTimer+=e,this.blueCaterpillarEyeTimer+=e,this.blueCaterpillarAnimationState==="blinking"&&this.blueCaterpillarBlinkTimer>=200&&(this.blueCaterpillarAnimationState="eyesDown",this.blueCaterpillarBlinkTimer=0,this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500),this.blueCaterpillarEyeTimer>=this.nextBlueCaterpillarEyeTime&&this.blueCaterpillarAnimationState!=="blinking"){let i=["eyesRight","eyesLeft","eyesDown"],a=(i.indexOf(this.blueCaterpillarAnimationState)+1)%i.length;this.blueCaterpillarAnimationState=i[a],this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.blueCaterpillarEyeTimer=0}this.blueCaterpillarBlinkTimer>=this.nextBlueCaterpillarBlinkTime&&this.blueCaterpillarAnimationState!=="blinking"&&(this.blueCaterpillarAnimationState="blinking",this.blueCaterpillarBlinkTimer=0);let t="blueCaterpillarEyesDown";switch(this.blueCaterpillarAnimationState){case"eyesRight":t="blueCaterpillarEyesRight";break;case"eyesLeft":t="blueCaterpillarEyesLeft";break;case"eyesDown":t="blueCaterpillarEyesDown";break;case"blinking":t="blueCaterpillarBlinking";break}this.texture.key!==t&&this.scene&&this.scene.textures.exists(t)&&this.setTexture(t)}};var J=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i){super(e,t-15,i-8,"baseblue-eyes-center");this.isPushing=!1;this.platform=null;this.platformLeft=0;this.platformRight=0;this.isStunned=!1;this.stunEndTime=0;this.eyeSprites=["baseblue-eyes-center","baseblue-eyes-down","baseblue-eyes-down-right","baseblue-eyes-middle-right","baseblue-eyes-up","baseblue-eyes-up-left","baseblue-eyes-middle-left","baseblue-eyes-down-left","baseblue-eyes-blinking"];this.currentEyeIndex=0;this.blinkTimer=0;this.nextBlinkTime=0;this.eyeMovementTimer=0;this.nextEyeMovementTime=0;this.isBlinking=!1;this.isRollingEyes=!1;this.eyeRollSequence=[];this.eyeRollIndex=0;e.add.existing(this),e.physics.add.existing(this),this.setDisplaySize(48,48),this.setCollideWorldBounds(!1),this.setBounce(0),this.setGravityY(p.game.gravity),this.setSize(42,46);let s=this.body;s.setImmovable(!0),s.setMass(1e4),s.moves=!1,this.setOffset(20,19);let a=.9+Math.random()*.2;this.movementSpeed=20*a,this.direction=Math.random()<.5?-1:1,this.nextBlinkTime=Phaser.Math.Between(2e3,5e3),this.nextEyeMovementTime=Phaser.Math.Between(1e3,3e3),this.setDepth(15)}setPlatformBounds(e,t){this.platformLeft=e,this.platformRight=t}setInitialDirection(e){this.direction=e}update(e,t){let i=this.body;if(this.isStunned&&e>=this.stunEndTime&&this.endStun(),!this.isStunned){if(!this.isPushing){let s=this.x,a=this.direction;this.x<=this.platformLeft+16?(this.direction=1,this.x=this.platformLeft+16):this.x>=this.platformRight-16&&(this.direction=-1,this.x=this.platformRight-16);let o=this.movementSpeed*this.direction*t/1e3;this.x+=o,this.setFlipX(this.direction>0)}this.updateEyeAnimations(e,t)}}updateEyeAnimations(e,t){if(this.isRollingEyes&&this.eyeRollSequence.length>0){if(this.eyeMovementTimer+=t,this.eyeMovementTimer>=150)if(this.eyeMovementTimer=0,this.eyeRollIndex++,this.eyeRollIndex>=this.eyeRollSequence.length)this.isRollingEyes=!1,this.eyeRollSequence=[],this.eyeRollIndex=0,this.setTexture("baseblue-eyes-center");else{let i=this.eyeRollSequence[this.eyeRollIndex];this.setTexture(this.eyeSprites[i])}return}if(this.blinkTimer+=t,this.isBlinking?this.blinkTimer>=150&&(this.isBlinking=!1,this.blinkTimer=0,this.nextBlinkTime=Phaser.Math.Between(2e3,5e3),this.setTexture("baseblue-eyes-center")):this.blinkTimer>=this.nextBlinkTime&&(this.isBlinking=!0,this.blinkTimer=0,this.setTexture("baseblue-eyes-blinking")),!this.isBlinking&&(this.eyeMovementTimer+=t,this.eyeMovementTimer>=this.nextEyeMovementTime))if(this.eyeMovementTimer=0,this.nextEyeMovementTime=Phaser.Math.Between(1e3,3e3),Math.random()<.15)this.startEyeRoll();else{let i=Phaser.Math.Between(0,7);this.setTexture(this.eyeSprites[i])}}startEyeRoll(){this.isRollingEyes=!0,this.eyeRollIndex=0,this.eyeMovementTimer=0,this.eyeRollSequence=[4,3,3,2,1,7,6,5,4]}startPushing(){this.isPushing=!0}stopPushing(){this.isPushing=!1}startStun(){this.isStunned||this.scene&&(this.isStunned=!0,this.stunEndTime=this.scene.time.now+2e3,this.setTexture("baseblue-eyes-blinking"))}endStun(){this.isStunned=!1,this.setTexture("baseblue-eyes-center")}handlePlayerBounce(){}canBeKilledByInvinciblePlayer(){return!0}handleInvinciblePlayerKill(){return this.squish(),1e3}squish(){this.scene&&this.scene.tweens.add({targets:this,scaleY:.3,scaleX:1.2,alpha:.8,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.baseBlus&&this.scene.baseBlus.remove(this),this.destroy()}})}isPlayerColliding(e){let t=e.getBounds(),i=this.getBounds(),s=Math.min(t.bottom,i.bottom)-Math.max(t.top,i.top),a=Math.min(t.right,i.right)-Math.max(t.left,i.left);return s>0&&a>0&&s<i.height*.5?!1:a>0&&s>0}destroy(){super.destroy()}};var _=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,a){let o=e.textures.exists("beetle-mouth-closed")?"beetle-mouth-closed":"beetle";if(!e.textures.exists("beetle-mouth-closed")){let f=e.add.graphics();f.fillStyle(16711680,1),f.fillRect(0,0,20,16),f.generateTexture("beetle",20,16),f.destroy()}super(e,t,i,o);this.animationTimer=0;this.currentFrame=0;this.animationFrames=["beetle-mouth-closed","beetle-mouth-open-30","beetle-mouth-open-70","beetle-mouth-open-30"];this.totalRotation=0;this.rotationFactor=.004;this.isRolling=!0;this.isBiting=!1;this.nextActionDistance=0;this.distanceTraveled=0;this.biteAnimationTimer=0;this.biteDuration=1200;this.isSquished=!1;e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.setBounce(0);let n=45;this.setDisplaySize(n,n);let l=19,c=this.texture.get().width,h=this.texture.get().height,d=n/c,b=n/h,u=(d+b)/2,m=l/u;if(this.body instanceof Phaser.Physics.Arcade.Body){this.body.setCircle(m);let f=m*2,g=(n-l*2)/2,v=g/u,S=g/u;this.body.setOffset(v,S),console.log("\u{1FAB2} BEETLE CIRCULAR HITBOX:"),console.log("  Circle diameter:",l*2,"px (38px as requested)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",n,"x",n),console.log("  Centering offset:",v,",",S,"(texture space)"),console.log("  Visual sprite centered on hitbox: \u2705")}this.setDepth(15),this.platformBounds={left:s,right:a};let y=.9+Math.random()*.2;this.moveSpeed=80*y,this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction),this.nextActionDistance=100+Math.random()*200}update(e,t){if(t)if(this.x<=this.platformBounds.left+10?this.direction=1:this.x>=this.platformBounds.right-10&&(this.direction=-1),this.isRolling){this.setVelocityX(this.moveSpeed*this.direction),this.distanceTraveled+=Math.abs(this.moveSpeed*this.direction*(t/1e3));let i=this.moveSpeed*this.rotationFactor;this.totalRotation+=i*this.direction,this.setRotation(this.totalRotation),this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed"),this.distanceTraveled>=this.nextActionDistance&&this.startBiting()}else this.isBiting&&(this.setVelocityX(0),this.biteAnimationTimer+=t,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.animateBiting(t),this.biteAnimationTimer>=this.biteDuration&&this.startRolling())}startBiting(){this.isRolling=!1,this.isBiting=!0,this.biteAnimationTimer=0,this.currentFrame=0,this.animationTimer=0,this.setRotation(0),this.totalRotation=0}startRolling(){this.isRolling=!0,this.isBiting=!1,this.distanceTraveled=0,this.nextActionDistance=50+Math.random()*200,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed")}animateBiting(e){if(this.animationTimer+=e,this.animationTimer>=300){this.animationTimer=0,this.currentFrame=(this.currentFrame+1)%this.animationFrames.length;let t=this.animationFrames[this.currentFrame];this.scene&&this.scene.textures.exists(t)&&this.setTexture(t)}}reverseDirection(){this.direction*=-1,this.isRolling&&this.setVelocityX(this.moveSpeed*this.direction)}getDirection(){return this.direction}squish(){this.isSquished||(this.isSquished=!0,this.setVelocity(0,0),this.isRolling=!1,this.isBiting=!1,this.body&&(this.body.enable=!1),this.setRotation(0),this.totalRotation=0,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed"),this.scene&&this.scene.tweens.add({targets:this,scaleY:.2,scaleX:1.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.beetles&&this.scene.beetles.remove(this),this.destroy()}}))}};var V=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,a){super(e,t,i,"rexEyesOpen");this.baseMoveSpeed=60;this.moveSpeed=60;this.speedMultiplier=1;this.direction=1;this.bounceTimer=0;this.isSquishing=!1;this.isStretching=!1;this.isInAir=!1;this.isSquished=!1;this.blinkTimer=0;this.nextBlinkTime=2e3;this.isBlinking=!1;this.blinkDuration=150;e.add.existing(this),e.physics.add.existing(this);let o=40;this.setDisplaySize(o,o),this.setOrigin(.5,.5);let n=18,l=this.texture.get().width,c=this.texture.get().height,h=o/l,d=o/c,b=(h+d)/2,u=n/b;if(this.body instanceof Phaser.Physics.Arcade.Body){this.body.setCircle(u);let m=u*2,y=(l-m)/2,f=(c-m)/2;this.body.setOffset(y,f),this.body.setCollideWorldBounds(!0),this.body.setBounce(0),this.body.setAllowGravity(!0),this.body.setGravityY(0),console.log("\u{1F996} REX ENEMY CREATED:"),console.log("  Display size:",o,"x",o),console.log("  Circle diameter:",n*2,"px"),console.log("  Body is circular:",this.body.isCircle),console.log("  Move speed:",this.moveSpeed)}this.setDepth(15),this.platformBounds={left:s,right:a},this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction),this.nextBlinkTime=Math.random()*2e3+1e3,this.bounceTimer=1e3+Math.random()*1e3}update(e,t){if(this.bounceTimer-=t,this.blinkTimer+=t,this.body instanceof Phaser.Physics.Arcade.Body){let i=this.body.touching.down||this.body.blocked.down;if(i&&this.isInAir?(this.onLanding(),this.isInAir=!1):!i&&!this.isInAir&&(this.isInAir=!0),this.bounceTimer<=0&&i&&!this.isSquishing&&(this.startBounce(),this.bounceTimer=1500+Math.random()*1500),i&&!this.isInAir&&!this.isSquishing&&!this.isStretching&&this.updateBlinking(),this.isInAir&&!i)this.rotation+=.008*t*this.direction,this.texture.key!=="rexBlinking"&&this.setTexture("rexBlinking");else if(i){if(Math.abs(this.rotation)>.1){let s=Math.round(this.rotation/(Math.PI*2))*Math.PI*2;this.rotation=Phaser.Math.Linear(this.rotation,s,.3)}else this.rotation=0;this.texture.key==="rexBlinking"&&!this.isBlinking&&this.setTexture("rexEyesOpen")}this.x<=this.platformBounds.left+20?(this.direction=1,this.setVelocityX(this.moveSpeed*this.direction)):this.x>=this.platformBounds.right-20?(this.direction=-1,this.setVelocityX(this.moveSpeed*this.direction)):this.setVelocityX(this.moveSpeed*this.direction)}}startBounce(){this.setVelocityY(-175),this.isStretching=!1}onLanding(){this.isSquishing=!1}updateBlinking(){this.isBlinking?this.blinkTimer>=this.blinkDuration&&(this.isBlinking=!1,this.setTexture("rexEyesOpen"),this.blinkTimer=0,this.nextBlinkTime=1e3+Math.random()*3e3):this.blinkTimer>=this.nextBlinkTime&&(this.isBlinking=!0,this.setTexture("rexBlinking"),this.blinkTimer=0)}setSpeedMultiplier(e){this.speedMultiplier=e,this.moveSpeed=this.baseMoveSpeed*e}squish(){if(this.isSquished)return;this.isSquished=!0,this.setVelocity(0,0),this.body&&(this.body.enable=!1),this.scene.tweens.killTweensOf(this);let e=12;for(let t=0;t<e;t++){let i=this.scene.add.graphics();i.fillStyle(9498256,1),i.fillCircle(0,0,3),i.x=this.x,i.y=this.y;let s=Math.PI*2*t/e+(Math.random()-.5)*.5,a=100+Math.random()*100,o=Math.cos(s)*a,n=Math.sin(s)*a-50;this.scene.tweens.add({targets:i,x:i.x+o*.5,y:i.y+n*.5,alpha:0,scale:.5,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}this.scene.tweens.add({targets:this,alpha:0,scale:.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.rexEnemies&&this.scene.rexEnemies.remove(this),this.destroy()}})}};var Q=class{constructor(r,e,t){this.collected=!1;this.scene=r;let i=t-5;this.sprite=r.add.container(e,i);let s=["gem-pink-round","gem-yellow-emerald","gem-purple-opal","gem-teal-triangle"],a=s[Math.floor(Math.random()*s.length)],o=r.add.image(0,0,a);if(o.setDisplaySize(16,16),this.sprite.add(o),this.sprite.setDepth(12),this.sparkleTimer=r.time.addEvent({delay:800+Math.random()*400,callback:()=>this.createSparkle(),loop:!0}),r.physics.add.existing(this.sprite,!0),this.sprite.body){let n=this.sprite.body;n.setSize(16,16),n.setOffset(24,24)}r.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let r=this.scene.add.graphics(),e=(Math.random()-.5)*16,t=(Math.random()-.5)*16;r.fillStyle(16777215,.9),r.beginPath();for(let s=0;s<8;s++){let a=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(a)*o,l=Math.sin(a)*o;s===0?r.moveTo(n,l):r.lineTo(n,l)}r.closePath(),r.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(r),i.setDepth(13),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:1.5,scaleY:1.5,alpha:0,duration:200,onComplete:()=>{this.sprite.destroy()}}))}isCollected(){return this.collected}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var ee=class{constructor(r,e,t){this.collected=!1;this.scene=r;let i=t-5;this.sprite=r.add.container(e,i);let a=r.add.image(0,0,"gem-big-blue");if(a.setDisplaySize(22,22),this.sprite.add(a),this.sprite.setDepth(12),this.sparkleTimer=r.time.addEvent({delay:600+Math.random()*300,callback:()=>this.createSparkle(),loop:!0}),r.physics.add.existing(this.sprite,!0),this.sprite.body){let o=this.sprite.body;o.setSize(20,20),o.setOffset(22,22)}r.tweens.add({targets:this.sprite,scaleX:1.3,scaleY:1.3,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let r=this.scene.add.graphics(),e=(Math.random()-.5)*20,t=(Math.random()-.5)*20;r.fillStyle(65535,.9),r.beginPath();for(let s=0;s<8;s++){let a=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(a)*o,l=Math.sin(a)*o;s===0?r.moveTo(n,l):r.lineTo(n,l)}r.closePath(),r.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(r),i.setDepth(13),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var te=class{constructor(r,e,t){this.collected=!1;this.scene=r;let i=t-5;if(this.sprite=r.add.container(e,i),this.diamondSprite=r.add.image(0,0,"gem-diamond"),this.diamondSprite.setDisplaySize(29,29),this.sprite.add(this.diamondSprite),this.sprite.setDepth(13),r.physics.add.existing(this.sprite,!0),this.sprite.body){let s=this.sprite.body;s.setSize(29,29),s.setOffset(10,10)}r.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.sparkleTimer=r.time.addEvent({delay:400+Math.random()*200,callback:()=>this.createSparkle(),loop:!0})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let r=this.scene.add.graphics(),e=(Math.random()-.5)*30,t=(Math.random()-.5)*30;r.fillStyle(16777215,.9),r.beginPath();for(let s=0;s<8;s++){let a=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(a)*o,l=Math.sin(a)*o;s===0?r.moveTo(n,l):r.lineTo(n,l)}r.closePath(),r.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(r),i.setDepth(14),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2.5,scaleY:2.5,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var ie=class{constructor(r,e,t){this.collected=!1;this.scene=r;let i=t-5;if(this.sprite=r.add.container(e,i),this.heartSprite=r.add.image(0,0,"heart-crystal"),this.heartSprite.setDisplaySize(29,29),this.sprite.add(this.heartSprite),this.sprite.setDepth(13),r.physics.add.existing(this.sprite,!0),this.sprite.body){let s=this.sprite.body;s.setSize(29,29),s.setOffset(10,10)}r.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.sparkleTimer=r.time.addEvent({delay:400+Math.random()*200,callback:()=>this.createSparkle(),loop:!0})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let r=this.scene.add.graphics(),e=(Math.random()-.5)*30,t=(Math.random()-.5)*30;r.fillStyle(16738740,.9),r.beginPath();for(let s=0;s<8;s++){let a=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(a)*o,l=Math.sin(a)*o;s===0?r.moveTo(n,l):r.lineTo(n,l)}r.closePath(),r.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(r),i.setDepth(14),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2.5,scaleY:2.5,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var se=class{constructor(r,e,t){this.collected=!1;this.aura=null;this.particles=[];this.debugHitbox=null;this.scene=r;let i=t-5;this.sprite=r.add.image(e,i,"invincibility-pendant"),this.sprite.setDisplaySize(29,29),this.sprite.setDepth(13),r.physics.add.existing(this.sprite,!0),p.debug&&this.createDebugHitbox(e,i),r.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createGoldenAura(e,i),this.sparkleTimer=r.time.addEvent({delay:300+Math.random()*200,callback:()=>this.createSparkle(),loop:!0}),this.createFloatingParticles(e,i)}createGoldenAura(r,e){this.aura=this.scene.add.circle(r,e,25,16766720),this.aura.setAlpha(.2),this.aura.setDepth(12),this.scene.tweens.add({targets:this.aura,scaleX:1.3,scaleY:1.3,alpha:.4,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFloatingParticles(r,e){for(let t=0;t<6;t++){let i=this.scene.add.graphics();i.setDepth(14),i.fillStyle(16766720,.8),i.fillCircle(0,0,2);let s=Math.PI*2/6*t,a=20;i.setPosition(r+Math.cos(s)*a,e+Math.sin(s)*a),this.particles.push(i),this.scene.tweens.add({targets:i,rotation:Math.PI*2,duration:3e3,repeat:-1,ease:"Linear"}),this.scene.tweens.add({targets:i,y:i.y-8,duration:1500+Math.random()*500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:i,alpha:.3,duration:800+Math.random()*400,yoyo:!0,repeat:-1,ease:"Power2.easeInOut"})}}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let r=this.scene.add.graphics(),e=(Math.random()-.5)*35,t=(Math.random()-.5)*35;r.fillStyle(16766720,.9),r.beginPath();for(let s=0;s<8;s++){let a=s/8*Math.PI*2,o=s%2===0?3:1.5,n=Math.cos(a)*o,l=Math.sin(a)*o;s===0?r.moveTo(n,l):r.lineTo(n,l)}r.closePath(),r.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(r),i.setDepth(15),this.scene.tweens.add({targets:i,scaleX:2,scaleY:2,alpha:0,rotation:Math.PI,duration:600,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.aura&&(this.aura.destroy(),this.aura=null),this.particles.forEach(r=>r.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:3,scaleY:3,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}),this.createCollectionBurst())}createCollectionBurst(){for(let e=0;e<20;e++){let t=this.scene.add.circle(this.sprite.x+(Math.random()-.5)*15,this.sprite.y-10,Math.random()*4+2,16766720);t.setDepth(50);let i=Math.PI*2/20*e+(Math.random()-.5)*.8,s=Math.random()*120+80;this.scene.tweens.add({targets:t,x:t.x+Math.cos(i)*s,y:t.y+Math.sin(i)*s-40,alpha:0,scaleX:.1,scaleY:.1,duration:1200,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}let r=this.scene.add.circle(this.sprite.x,this.sprite.y,50,16766720);r.setDepth(49),r.setAlpha(.9),this.scene.tweens.add({targets:r,scaleX:2.5,scaleY:2.5,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>r.destroy()})}createDebugHitbox(r,e){this.debugHitbox=this.scene.add.graphics(),this.debugHitbox.setDepth(999),this.debugHitbox.lineStyle(2,65280,.8),this.debugHitbox.strokeRect(r-14.5,e-14.5,29,29),this.debugHitbox.fillStyle(16711680,1),this.debugHitbox.fillCircle(r,e,2);let t=this.scene.add.text(r,e-35,"PENDANT\\n29x29",{fontSize:"8px",color:"#00ff00",fontFamily:"monospace",align:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:2,y:1}}).setOrigin(.5).setDepth(1e3);this.debugHitbox.setData("debugText",t)}destroy(){if(this.sparkleTimer&&this.sparkleTimer.destroy(),this.aura&&this.aura.destroy(),this.particles.forEach(r=>r.destroy()),this.debugHitbox){let r=this.debugHitbox.getData("debugText");r&&r.destroy(),this.debugHitbox.destroy()}this.sprite.destroy()}};var ae=class{constructor(r,e,t){this.isOpened=!1;this.glowEffect=null;this.debugHitbox=null;this.scene=r,this.chestTier=this.selectRandomChestTier();let i=this.getSpriteKeyForTier(this.chestTier);this.sprite=r.add.sprite(e,t-4,i),this.sprite.setDisplaySize(60,60),this.sprite.setDepth(13),r.physics.add.existing(this.sprite,!0);let s=this.sprite.body;s.setSize(40,30),s.setOffset(-20,-11),p.debug&&this.createDebugHitbox(e,t),this.createGlowEffect(e,t-4,this.chestTier)}selectRandomChestTier(){let r=Math.random();return r<.6?"purple":r<.9?"teal":"yellow"}getSpriteKeyForTier(r){switch(r){case"purple":return"purple-chest";case"teal":return"teal-chest";case"yellow":return"yellow-chest"}}getGlowColorForTier(r){switch(r){case"purple":return 10040012;case"teal":return 35723;case"yellow":return 16766720}}createGlowEffect(r,e,t){let i=this.getGlowColorForTier(t);this.glowEffect=this.scene.add.circle(r,e,18,i),this.glowEffect.setAlpha(.15),this.glowEffect.setDepth(12),this.scene.tweens.add({targets:this.glowEffect,alpha:.05,scaleX:1.2,scaleY:1.2,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}canInteract(){return!this.isOpened}open(){if(this.isOpened)return{coins:0,blueCoins:0,diamonds:0,freeLifes:0,invincibilityPendants:0,totalPoints:0};this.isOpened=!0,this.sprite.setTint(8421504),this.glowEffect&&(this.glowEffect.destroy(),this.glowEffect=null),this.scene.tweens.add({targets:this.sprite,scaleX:1.2,scaleY:1.2,duration:200,ease:"Back.easeOut",yoyo:!0});let r=this.generateRewardsByTier(this.chestTier),e=2500;return e+=r.coins*50,e+=r.blueCoins*500,e+=r.diamonds*1e3,e+=r.freeLifes*2e3,e+=r.invincibilityPendants*300,this.createTreasureBurstEffect(),{coins:r.coins,blueCoins:r.blueCoins,diamonds:r.diamonds,freeLifes:r.freeLifes,invincibilityPendants:r.invincibilityPendants,totalPoints:e}}generateRewardsByTier(r){let e={coins:0,blueCoins:0,diamonds:0,freeLifes:0};switch(r){case"purple":e.coins=Math.floor(Math.random()*3)+2,Math.random()<.1&&(e.freeLifes=1);break;case"teal":e.blueCoins=Math.floor(Math.random()*2)+1,e.coins=Math.floor(Math.random()*2)+1,Math.random()<.25&&(Math.random()<.7,e.freeLifes=1);break;case"yellow":e.coins=Math.floor(Math.random()*2)+2,Math.random()<.8,e.freeLifes=1;break}return e}createTreasureBurstEffect(){for(let e=0;e<15;e++){let t=this.scene.add.circle(this.sprite.x+(Math.random()-.5)*10,this.sprite.y-5,Math.random()*3+2,16766720);t.setDepth(50);let i=Math.PI*2/15*e+(Math.random()-.5)*.5,s=Math.random()*100+50;this.scene.tweens.add({targets:t,x:t.x+Math.cos(i)*s,y:t.y+Math.sin(i)*s-30,alpha:0,scaleX:.1,scaleY:.1,duration:1e3,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}let r=this.scene.add.circle(this.sprite.x,this.sprite.y,40,16777215);r.setDepth(49),r.setAlpha(.8),this.scene.tweens.add({targets:r,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>r.destroy()})}createDebugHitbox(r,e){this.debugHitbox=this.scene.add.graphics(),this.debugHitbox.setDepth(999),this.debugHitbox.lineStyle(2,65280,.8),this.debugHitbox.strokeRect(r-20,e-15,40,30),this.debugHitbox.fillStyle(16711680,1),this.debugHitbox.fillCircle(r,e,2);let t=this.scene.add.text(r,e-35,`CHEST
40x30`,{fontSize:"8px",color:"#00ff00",fontFamily:"monospace",align:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:2,y:1}}).setOrigin(.5).setDepth(1e3);this.debugHitbox.setData("debugText",t)}destroy(){if(this.sprite.destroy(),this.glowEffect&&this.glowEffect.destroy(),this.debugHitbox){let r=this.debugHitbox.getData("debugText");r&&r.destroy(),this.debugHitbox.destroy()}}};var be=class{constructor(r,e,t){this.collected=!1;this.particles=[];this.scene=r;let i=t-5;this.sprite=r.add.container(e,i),this.glowGraphics=r.add.graphics(),this.createGlowEffect(),this.sprite.add(this.glowGraphics);let s=r.add.image(0,0,"crystalBallCollectible");if(s.setDisplaySize(20,20),this.sprite.add(s),this.sprite.setDepth(12),this.particleTimer=r.time.addEvent({delay:200,callback:()=>this.createParticle(),loop:!0}),r.physics.add.existing(this.sprite,!0),this.sprite.body){let a=this.sprite.body;a.setSize(20,20),a.setOffset(22,22)}r.tweens.add({targets:this.glowGraphics,alpha:.3,scaleX:1.2,scaleY:1.2,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:this.sprite,y:i-8,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:s,rotation:Math.PI*2,duration:8e3,repeat:-1,ease:"Linear"})}createGlowEffect(){for(let e=3;e>0;e--)this.glowGraphics.fillStyle(4509863,.1*e),this.glowGraphics.fillCircle(0,0,15+(3-e)*5)}createParticle(){if(!this.sprite||!this.sprite.scene||this.collected)return;let r=this.scene.add.graphics();r.fillStyle(4509863,1),r.fillRect(0,0,2,2);let e=Math.random()*Math.PI*2,t=15+Math.random()*10,i=this.sprite.x+Math.cos(e)*t,s=this.sprite.y+Math.sin(e)*t;r.x=i,r.y=s,r.setDepth(11),this.particles.push(r),this.scene.tweens.add({targets:r,y:s-30,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{let a=this.particles.indexOf(r);a>-1&&this.particles.splice(a,1),r.destroy()}})}collect(){if(!this.collected){this.collected=!0,this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(r=>r.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1);for(let r=0;r<8;r++){let e=this.scene.add.graphics();e.fillStyle(4509863,1),e.fillRect(0,0,3,3);let t=r/8*Math.PI*2;e.x=this.sprite.x,e.y=this.sprite.y,e.setDepth(13),this.scene.tweens.add({targets:e,x:this.sprite.x+Math.cos(t)*40,y:this.sprite.y+Math.sin(t)*40,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>{e.destroy()}})}this.scene.tweens.add({targets:this.sprite,scaleX:1.5,scaleY:1.5,alpha:0,duration:200,onComplete:()=>{this.sprite.destroy()}})}}isCollected(){return this.collected}destroy(){this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(r=>r.destroy()),this.sprite.destroy()}};var me=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,a=0){super(e,t,i,"crystalBallProjectile");this.bounceCount=0;this.MAX_BOUNCES=5;this.BASE_BOUNCE_HEIGHT=32;this.distanceTraveled=0;this.MAX_DISTANCE=5*p.game.tileSize;this.direction=1;this.direction=s,e.add.existing(this),e.physics.add.existing(this),this.setDisplaySize(16,16),this.setSize(20,20),this.setDepth(15);let o=250,l=(o+Math.abs(a*.8))*s;this.setVelocity(l,-120),console.log("\u{1F52B} Projectile velocity compensation: base =",o,"player =",a,"final =",l),this.setGravityY(400),this.setCollideWorldBounds(!0),this.body.onWorldBounds=!0,this.glowGraphics=e.add.graphics(),this.glowGraphics.setDepth(14),this.glowGraphics.fillStyle(4509863,.3),this.glowGraphics.fillCircle(0,0,12),this.glowGraphics.fillStyle(4509863,.2),this.glowGraphics.fillCircle(0,0,18),this.glowGraphics.x=t,this.glowGraphics.y=i,this.scene.events.on("update",this.updateGlow,this),this.rotationTween=e.tweens.add({targets:this,rotation:Math.PI*2*s,duration:500,repeat:-1,ease:"Linear"})}updateGlow(){this.active&&this.glowGraphics&&(this.glowGraphics.x=this.x,this.glowGraphics.y=this.y)}update(e,t){if(super.update(e,t),!this.body){console.log("\u{1F52B} Crystal Ball projectile body missing - destroying"),this.burst();return}let i=this.body;if(this.distanceTraveled+=Math.abs(i.velocity.x)*t/1e3,this.distanceTraveled>=this.MAX_DISTANCE){console.log("\u{1F52B} Crystal Ball projectile hit max distance - bursting"),this.burst();return}i.blocked.down&&(console.log("\u{1F52B} Crystal Ball projectile hit floor - bouncing"),this.handleBounce()),(i.blocked.left||i.blocked.right)&&(console.log("\u{1F52B} Crystal Ball projectile hit wall - bursting"),this.burst())}handleBounce(){if(this.bounceCount++,this.scene.registry.get("sfxEnabled")!==!1&&this.scene.sound.play("crystal-ball-bounce",{volume:.4}),this.bounceCount>=this.MAX_BOUNCES){console.log("\u{1F52B} Crystal Ball projectile max bounces reached - bursting"),this.burst();return}if(!this.body){console.log("\u{1F52B} Crystal Ball projectile body missing during bounce - bursting"),this.burst();return}let t=this.body,i=Math.pow(.8,this.bounceCount-1),s=this.BASE_BOUNCE_HEIGHT*i,a=t.gravity.y||400,o=-Math.sqrt(2*a*s);console.log("\u{1F52B} Bounce",this.bounceCount,"height:",s.toFixed(1),"velocity:",o.toFixed(1)),this.setVelocityY(o),this.setVelocityX(250*this.direction),this.createBounceEffect(),console.log("\u{1F52B} Crystal Ball projectile bounced",this.bounceCount,"times")}createBounceEffect(){if(this.scene)for(let e=0;e<3;e++){let t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillCircle(0,0,1),t.x=this.x+(Math.random()-.5)*10,t.y=this.y+5,t.setDepth(14),this.scene.tweens.add({targets:t,y:t.y-10,alpha:0,duration:200,onComplete:()=>t.destroy()})}}hitEnemy(){this.burst()}burst(){if(this.scene){this.scene.events.off("update",this.updateGlow,this),this.rotationTween&&(this.rotationTween.stop(),this.rotationTween=void 0);for(let e=0;e<8;e++){let t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillCircle(0,0,2);let i=e/8*Math.PI*2;t.x=this.x,t.y=this.y,t.setDepth(15);let s=20+Math.random()*10;this.scene.tweens.add({targets:t,x:this.x+Math.cos(i)*s,y:this.y+Math.sin(i)*s,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}this.glowGraphics&&(this.glowGraphics.destroy(),this.glowGraphics=void 0),this.destroy()}}};var re=class{constructor(r,e,t,i){this.collected=!1;this.particles=[];this.scene=r,this.orbType=i,this.glowColor=i==="cursed"?5768769:4827036;let s=t-5;this.sprite=r.add.container(e,s),this.glowGraphics=r.add.graphics(),this.createGlowEffect(),this.sprite.add(this.glowGraphics);let a=i==="cursed"?"cursedOrbCollectible":"cursedTealOrbCollectible",o=r.add.image(0,0,a);if(o.setDisplaySize(20,20),this.sprite.add(o),this.sprite.setDepth(12),this.particleTimer=r.time.addEvent({delay:250,callback:()=>this.createParticle(),loop:!0}),r.physics.add.existing(this.sprite,!0),this.sprite.body){let n=this.sprite.body;n.setSize(20,20),n.setOffset(22,22)}r.tweens.add({targets:this.glowGraphics,alpha:.2,scaleX:1.3,scaleY:1.3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:this.sprite,y:s-6,duration:2500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),r.tweens.add({targets:o,rotation:-Math.PI*2,duration:1e4,repeat:-1,ease:"Linear"})}createGlowEffect(){let r=this.glowColor;for(let e=4;e>0;e--)this.glowGraphics.fillStyle(r,.08*e),this.glowGraphics.fillCircle(0,0,12+(4-e)*6)}createParticle(){if(!this.sprite||!this.sprite.scene||this.collected)return;let r=this.scene.add.graphics();r.fillStyle(this.glowColor,1),r.fillRect(0,0,2,2);let e=Math.random()*Math.PI*2,t=20+Math.random()*12,i=this.sprite.x+Math.cos(e)*t,s=this.sprite.y+Math.sin(e)*t;r.x=i,r.y=s,r.setDepth(11),this.particles.push(r),this.scene.tweens.add({targets:r,y:s+35,x:i+(Math.random()-.5)*20,alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{let a=this.particles.indexOf(r);a>-1&&this.particles.splice(a,1),r.destroy()}})}collect(){if(!this.collected){this.collected=!0,this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(r=>r.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1);for(let r=0;r<12;r++){let e=this.scene.add.graphics();e.fillStyle(this.glowColor,1),e.fillRect(0,0,3,3);let t=r/12*Math.PI*2;e.x=this.sprite.x,e.y=this.sprite.y,e.setDepth(13),this.scene.tweens.add({targets:e,x:this.sprite.x+Math.cos(t)*50,y:this.sprite.y+Math.sin(t)*50,alpha:0,duration:600,ease:"Power2.easeOut",onComplete:()=>{e.destroy()}})}this.scene.tweens.add({targets:this.sprite,scaleX:1.3,scaleY:1.3,alpha:0,duration:300,onComplete:()=>{this.sprite.destroy()}})}}isCollected(){return this.collected}getType(){return this.orbType}destroy(){this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(r=>r.destroy()),this.sprite.destroy()}};var ye=class{constructor(r){this.enabled=!0;this.isMobileDevice=!1;this.touchPosition=null;this.horizontalInput=0;this.verticalInput=0;this.upPressed=!1;this.downPressed=!1;this.leftPressed=!1;this.rightPressed=!1;this.jumpPressed=!1;this.jumpJustPressed=!1;this.actionPressed=!1;this.actionJustPressed=!1;this.lastJumpState=!1;this.lastActionState=!1;this.touchpadPointerId=-1;this.jumpPointerId=-1;this.actionPointerId=-1;this.touchpadRadius=75;this.deadZone=5;this.scene=r,this.touchpadCenter={x:110,y:p.canvas.height-120},this.detectMobileDevice(),this.createTouchpad(),this.createJumpButton(),this.createActionButton(),this.setupInputHandlers()}detectMobileDevice(){let r="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i=window.innerWidth<=768;this.isMobileDevice=r&&(t||i),console.log("Mobile device detection:",{isTouchDevice:r,isMobileUA:t,isSmallScreen:i,isMobileDevice:this.isMobileDevice})}createTouchpad(){this.touchpadContainer=this.scene.add.container(this.touchpadCenter.x,this.touchpadCenter.y),this.touchpadContainer.setDepth(1e3),this.touchpadContainer.setScrollFactor(0),this.touchpadBackground=this.scene.add.image(0,0,"custom-dpad"),this.touchpadBackground.setDisplaySize(this.touchpadRadius*2,this.touchpadRadius*2),this.touchpadContainer.add(this.touchpadBackground),this.touchpadIndicator=this.scene.add.circle(0,0,8,16716947,.9),this.touchpadIndicator.setStrokeStyle(2,16777215,.9),this.touchpadIndicator.setVisible(!1),this.touchpadContainer.add(this.touchpadIndicator)}createJumpButton(){let r=p.canvas.width-60,e=p.canvas.height-120;this.jumpButton=this.scene.add.container(r,e),this.jumpButton.setDepth(1e3),this.jumpButton.setScrollFactor(0),this.jumpButtonImage=this.scene.add.image(0,0,"custom-jump-button"),this.jumpButtonImage.setDisplaySize(80,80),this.jumpButton.add([this.jumpButtonImage])}createActionButton(){let r=p.canvas.width-175,e=p.canvas.height-120;this.actionButton=this.scene.add.container(r,e),this.actionButton.setDepth(1e3),this.actionButton.setScrollFactor(0),this.actionButton.setVisible(!0),this.actionButtonImage=this.scene.add.image(0,0,"custom-action-button"),this.actionButtonImage.setDisplaySize(80,80),this.actionButton.add([this.actionButtonImage])}setupInputHandlers(){let r=new Set;this.scene.input.on("pointerdown",e=>{r.add(e.id),this.handlePointerDown(e)}),this.scene.input.on("pointermove",e=>{r.has(e.id)&&this.handlePointerMove(e)}),this.scene.input.on("pointerup",e=>{r.delete(e.id),this.handlePointerUp(e)})}handlePointerDown(r){if(!this.enabled||!this.isMobileDevice)return;let e=r.x,t=r.y;if(Math.sqrt(Math.pow(e-this.touchpadCenter.x,2)+Math.pow(t-this.touchpadCenter.y,2))<=92.5&&this.touchpadPointerId===-1){this.touchpadPointerId=r.id,this.updateTouchpadFromPosition(e,t),this.touchpadIndicator.setVisible(!0),this.forceUpdate();return}let s=p.canvas.width-60,a=s-50,o=s+50,n=p.canvas.height-250,l=p.canvas.height;if(e>=a&&e<=o&&t>=n&&t<=l){this.jumpPointerId===-1&&(this.jumpPointerId=r.id,this.jumpPressed=!0,this.jumpButtonImage.setTint(11184810));return}if(this.actionButton.visible){let c=p.canvas.width-175,h=c-55,d=c+55,b=p.canvas.height-250,u=p.canvas.height;e>=h&&e<=d&&t>=b&&t<=u&&this.actionPointerId===-1&&(this.actionPointerId=r.id,this.actionPressed=!0,this.actionButtonImage.setTint(11184810))}}updateTouchpadFromPosition(r,e){let t=r-this.touchpadCenter.x,i=e-this.touchpadCenter.y,s=Math.sqrt(t*t+i*i);if(s<this.deadZone){this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.touchpadIndicator.setPosition(0,0);return}let a=Math.min(s,this.touchpadRadius),o=t/a*(a/this.touchpadRadius),n=i/a*(a/this.touchpadRadius);this.horizontalInput=o,this.verticalInput=n;let l=.3;this.leftPressed=o<-l,this.rightPressed=o>l,this.upPressed=n<-l,this.downPressed=n>l;let c=Math.min(s,this.touchpadRadius-8),h=t/s*c,d=i/s*c;this.touchpadIndicator.setPosition(h,d),this.touchPosition={x:t,y:i}}forceUpdate(){this.touchpadIndicator.visible}handlePointerMove(r){this.enabled&&this.isMobileDevice&&r.id===this.touchpadPointerId&&this.updateTouchpadFromPosition(r.x,r.y)}handlePointerUp(r){this.enabled&&this.isMobileDevice&&(r.id===this.touchpadPointerId&&(this.touchpadPointerId=-1,this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.touchpadIndicator.setVisible(!1),this.touchpadIndicator.setPosition(0,0),this.touchPosition=null),r.id===this.jumpPointerId&&(this.jumpPointerId=-1,this.jumpPressed=!1,this.jumpButtonImage.clearTint()),r.id===this.actionPointerId&&(this.actionPointerId=-1,this.actionPressed=!1,this.actionButtonImage.clearTint()))}update(){this.jumpJustPressed=this.jumpPressed&&!this.lastJumpState,this.lastJumpState=this.jumpPressed,this.actionJustPressed=this.actionPressed&&!this.lastActionState,this.lastActionState=this.actionPressed}getHorizontal(){return this.horizontalInput||(this.leftPressed?-1:this.rightPressed?1:0)}getVertical(){return this.verticalInput||(this.upPressed?-1:this.downPressed?1:0)}getHorizontalInput(){return this.horizontalInput}getVerticalInput(){return this.verticalInput}isJumpPressed(){return this.jumpPressed}isJumpJustPressed(){return this.jumpJustPressed}isActionPressed(){return this.actionPressed}isActionJustPressed(){return this.actionJustPressed}showActionButton(r){this.actionButton.setVisible(r)}disable(){this.enabled=!1,this.touchpadContainer.setVisible(!1),this.jumpButton.setVisible(!1),this.actionButton.setVisible(!1),this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.jumpPressed=!1,this.jumpJustPressed=!1,this.actionPressed=!1,this.actionJustPressed=!1,this.touchpadPointerId=-1,this.jumpPointerId=-1,this.actionPointerId=-1,this.touchpadIndicator.setVisible(!1)}enable(){this.enabled=!0,this.touchpadContainer.setVisible(!0),this.jumpButton.setVisible(!0),this.actionButton.setVisible(!0)}destroy(){this.touchpadContainer.destroy(),this.jumpButton.destroy(),this.actionButton.destroy()}};var fe=(l=>(l.BASEBLU="baseblu",l.BEETLE="beetle",l.CATERPILLAR="caterpillar",l.BLUE_CATERPILLAR="blue_caterpillar",l.CHOMPER="chomper",l.SNAIL="snail",l.JUMPER="jumper",l.STALKER="stalker",l.REX="rex",l))(fe||{}),I=class{static getMaxEnemiesPerFloor(r){return r<=10?2:r<=20||r<=30?3:r<=40||r<=50?4:5}static getSpeedMultiplier(r){return r<=10?1+(r-1)/9*.05:r<=20?1.05+(r-10)/10*.05:r<=30?1.1+(r-20)/10*.05:r<=40?1.15+(r-30)/10*.05:r<=50?1.2+(r-40)/10*.05:1.25}static getBaseBluMaxPerFloor(r){return r<=14?0:1}static getSpawnWeights(r){return r<=4?this.LEVEL_SPAWN_WEIGHTS.tutorial_early:r<=7?this.LEVEL_SPAWN_WEIGHTS.patrol:r<=11?this.LEVEL_SPAWN_WEIGHTS.speed_intro:r<=14?this.LEVEL_SPAWN_WEIGHTS.rex_intro:r<=19?this.LEVEL_SPAWN_WEIGHTS.obstacles:r<=24?this.LEVEL_SPAWN_WEIGHTS.hunter:r<=29?this.LEVEL_SPAWN_WEIGHTS.bouncing:r<=34?this.LEVEL_SPAWN_WEIGHTS.advanced:r<=39?this.LEVEL_SPAWN_WEIGHTS.advanced_2:r<=49?this.LEVEL_SPAWN_WEIGHTS.expert:this.LEVEL_SPAWN_WEIGHTS.beast}static selectEnemiesForFloor(r,e){let t={...this.getSpawnWeights(r)},i=this.getMaxEnemiesPerFloor(r),s=this.getBaseBluMaxPerFloor(r);t.rex>0&&t.jumper>0&&(Math.random()<.5?t.jumper=0:t.rex=0);let a=[],o=0,n;if(r===1)n=1;else{let l=Math.max(1,i-1);n=Math.floor(Math.random()*2)+l}for(let l=0;l<n;l++){let c=[],h=0;for(let[m,y]of Object.entries(t))if(y>0){let f=m;if(f==="baseblu"&&o>=s||f==="chomper"&&e===9)continue;c.push({type:f,weight:y}),h+=y}if(c.length===0)break;let d=Math.random()*h,b=0,u=null;for(let m of c)if(b+=m.weight,d<=b){u=m.type;break}u&&(a.push(u),u==="baseblu"&&o++)}return a}static selectEnemies(r,e){return this.selectEnemiesForFloor(e,0)}static getEnemyDefinition(r){return this.ENEMY_DEFINITIONS[r]}static getColorForEnemyType(r){return this.ENEMY_DEFINITIONS[r].color}static isStalkerType(r){return r==="stalker"}static isBaseBluType(r){return r==="baseblu"}static isBeetleType(r){return r==="beetle"}static isRexType(r){return r==="rex"}static getPointValue(r){return this.ENEMY_DEFINITIONS[r].pointValue}static getAllEnemyTypes(){return Object.values(fe)}static logSpawnInfo(r,e,t){let i=this.getDifficultyBudget(r,e),s=t.reduce((a,o)=>a+this.ENEMY_DEFINITIONS[o].difficultyScore,0)}};I.ENEMY_DEFINITIONS={baseblu:{type:"baseblu",color:"blue",difficultyScore:2,speed:.25,pointValue:1e3,description:"Immovable blocker, can only be killed when invincible"},beetle:{type:"beetle",color:"red",difficultyScore:.8,speed:1,pointValue:75,description:"Simple patrol beetle"},caterpillar:{type:"caterpillar",color:"yellow",difficultyScore:.5,speed:.6,pointValue:50,description:"Slow random movement"},blue_caterpillar:{type:"blue_caterpillar",color:"blue_caterpillar",difficultyScore:.7,speed:.7,pointValue:50,description:"Slightly faster caterpillar variant"},chomper:{type:"chomper",color:"blue",difficultyScore:1,speed:1,pointValue:100,description:"Standard patrol with bite animations"},snail:{type:"snail",color:"red",difficultyScore:1.5,speed:1.2,pointValue:150,description:"Faster patrol enemy"},jumper:{type:"jumper",color:"green",difficultyScore:2.5,speed:1.5,pointValue:200,description:"Fast bouncing movement"},stalker:{type:"stalker",color:"red",difficultyScore:4,speed:1.5,pointValue:300,description:"Hidden activation + chase AI"},rex:{type:"rex",color:"rex",difficultyScore:1.2,speed:.75,pointValue:500,description:"Flipping enemy with periodic jumps"}},I.LEVEL_SPAWN_WEIGHTS={tutorial_early:{caterpillar:.4,beetle:.4,blue_caterpillar:.2,baseblu:0,chomper:0,snail:0,jumper:0,stalker:0,rex:0},patrol:{caterpillar:.3,beetle:.25,blue_caterpillar:.2,chomper:.25,baseblu:0,snail:0,jumper:0,stalker:0,rex:0},speed_intro:{caterpillar:.2,beetle:.2,blue_caterpillar:.15,chomper:.3,snail:.15,baseblu:0,jumper:0,stalker:0,rex:0},rex_intro:{caterpillar:.15,beetle:.15,blue_caterpillar:.1,chomper:.25,snail:.2,rex:.15,baseblu:0,jumper:0,stalker:0},obstacles:{caterpillar:.1,beetle:.1,blue_caterpillar:.1,rex:.15,chomper:.2,snail:.2,baseblu:.15,jumper:0,stalker:0},hunter:{caterpillar:.1,beetle:.1,blue_caterpillar:.05,rex:.15,chomper:.2,snail:.2,baseblu:.1,stalker:.1,jumper:0},bouncing:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.1,jumper:.15,chomper:.15,snail:.2,baseblu:.1,stalker:.15},advanced:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.15,jumper:.15,chomper:.15,snail:.15,baseblu:.1,stalker:.15},advanced_2:{caterpillar:.05,beetle:.05,blue_caterpillar:0,rex:.1,jumper:.2,chomper:.15,snail:.2,baseblu:.1,stalker:.15},expert:{caterpillar:.05,beetle:.05,blue_caterpillar:0,rex:.15,jumper:.15,chomper:.1,snail:.15,baseblu:.15,stalker:.2},beast:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.1,jumper:.1,chomper:.15,snail:.15,baseblu:.15,stalker:.2}};var oe=class{constructor(){this.currentLevel=1;this.isInBonusLevel=!1;this.BEAST_MODE_LEVEL=51;this.MAX_PROGRESSION_LEVEL=50;this.currentLevel=1,this.isInBonusLevel=!1}shouldHaveBonusAfter(r){return r>0&&r%10===0&&r<this.BEAST_MODE_LEVEL}isBonusLevel(){return this.isInBonusLevel}getLevelConfig(r){if(this.isInBonusLevel)return{levelNumber:r,floorCount:5,enemyTypes:[],collectibleTypes:["treasureChest"],worldWidth:24,isEndless:!1,difficultyBudgetPerFloor:0,enemySpawnWeights:{}};let e=r>=this.BEAST_MODE_LEVEL,t=Math.min(r,this.MAX_PROGRESSION_LEVEL),i=I.getSpawnWeights(t);return{levelNumber:r,floorCount:this.calculateFloorCount(r),enemyTypes:this.getEnemyTypes(t),collectibleTypes:this.getCollectibleTypes(t),worldWidth:this.getWorldWidth(t),isEndless:e,difficultyBudgetPerFloor:0,enemySpawnWeights:i}}calculateFloorCount(r){if(r>=this.BEAST_MODE_LEVEL)return-1;if(r<=10)return 10+Math.floor(r/5);if(r<=25){let e=(r-10)/15;return 13+Math.floor(e*5)}else if(r<=40){let e=(r-25)/15;return 19+Math.floor(e*6)}else{let e=(r-40)/10;return 25+Math.floor(e*5)}}getEnemyTypes(r){return["blue","yellow","green","red"]}getEnemyTypesForFloor(r,e){return I.selectEnemiesForFloor(r,e)}getCollectibleTypes(r){return r<=2?["coin","treasureChest"]:r<=3?["coin","blueCoin","treasureChest"]:r<=6?["coin","blueCoin","diamond","freeLife","invincibilityPendant","treasureChest"]:["coin","blueCoin","diamond","freeLife","invincibilityPendant","treasureChest"]}getWorldWidth(r){return r<25?24:r<50?32:40}isLevelComplete(r){let e=this.getLevelConfig(this.currentLevel);return e.isEndless?!1:r>=e.floorCount}nextLevel(){return this.isInBonusLevel?(this.isInBonusLevel=!1,this.currentLevel++):this.shouldHaveBonusAfter(this.currentLevel)?this.isInBonusLevel=!0:this.currentLevel++,this.saveProgress(),this.currentLevel}resetToStart(){this.currentLevel=1,this.isInBonusLevel=!1}getCurrentLevel(){return this.currentLevel}setCurrentLevel(r){this.currentLevel=r,this.saveProgress()}saveProgress(){}loadProgress(){}getFurthestLevel(){return 1}getEnemySpawnRates(r){let e={blue:1.2,yellow:.8,green:.5,red:.3},t=Math.min(r,this.MAX_PROGRESSION_LEVEL),i=1+t*.015,s={};return this.getEnemyTypes(t).forEach(o=>{s[o]=e[o]*i}),s}isBeastMode(){return this.currentLevel>=this.BEAST_MODE_LEVEL}getMaxProgressionLevel(){return this.MAX_PROGRESSION_LEVEL}};var ge=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s=!1){super(e,t,i-9,"door-sprite");this.promptText=null;this.playerNearby=!1;this.isFirstLevel=s,e.add.existing(this),e.physics.add.existing(this,!0),this.setDisplaySize(100,120);let a=this.body;a.setSize(80,100),a.setOffset(-40,-50),this.setDepth(10)}showPrompt(e){this.playerNearby=!0,this.promptText||(this.promptText=this.scene.add.text(this.x,this.y-70,"Press UP to enter",{fontSize:"16px",color:"#ffff00",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(100))}createInstructionPopup(){let e=this.scene.cameras.main.width/2,t=this.scene.cameras.main.height/2,i=this.scene.add.rectangle(e,t,300,150,2894892,.95).setDepth(200),s=this.scene.add.rectangle(e,t,304,154,16777215).setDepth(199);s.setStrokeStyle(2,16777215),s.setFillStyle(),this.promptText=this.scene.add.text(e,t-20,"Level Complete!",{fontSize:"18px",color:"#44ff44",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201);let a=this.scene.add.text(e,t+15,`Press UP to enter the door
and advance to the next level`,{fontSize:"12px",color:"#ffffff",fontFamily:'"Press Start 2P", system-ui',align:"center"}).setOrigin(.5).setDepth(201);this.promptText.setData("popup",i),this.promptText.setData("border",s),this.promptText.setData("instruction",a)}hidePrompt(){if(this.playerNearby=!1,this.promptText){let e=this.promptText.getData("popup"),t=this.promptText.getData("border"),i=this.promptText.getData("instruction");e&&e.destroy(),t&&t.destroy(),i&&i.destroy(),this.promptText.destroy(),this.promptText=null}}createDebugVisualization(){let e=this.scene.add.graphics();e.fillStyle(16711680,1),e.fillCircle(this.x,this.y,5),e.lineStyle(3,65280,1),e.strokeRect(this.x-40,this.y-50,80,100),e.lineStyle(3,255,1);let t=this.body;e.strokeRect(t.x,t.y,t.width,t.height),e.lineStyle(2,16776960,1);let i=this.y+50;e.lineBetween(this.x-60,i,this.x+60,i),e.lineStyle(2,16746496,1);let s=i;e.lineBetween(this.x-80,s,this.x+80,s);let a={fontSize:"12px",color:"#ffffff",backgroundColor:"#000000"};this.scene.add.text(this.x+50,this.y-30,"DOOR CENTER",a).setDepth(100),this.scene.add.text(this.x+50,this.y-10,`X: ${this.x}, Y: ${this.y}`,a).setDepth(100),this.scene.add.text(this.x+50,this.y+10,`Physics: ${t.x}, ${t.y}`,a).setDepth(100),this.scene.add.text(this.x+50,this.y+30,`Size: ${t.width}x${t.height}`,a).setDepth(100),this.scene.add.text(this.x+50,i,"DOOR BOTTOM",a).setDepth(100),this.scene.add.text(this.x+50,s+15,"PLATFORM SURFACE",a).setDepth(100),e.setDepth(50)}isPlayerNearby(){return this.playerNearby}destroy(){this.hidePrompt(),super.destroy()}};var ve=class{constructor(r){this.loadQueue=[];this.loadedAssets=new Set;this.failedAssets=new Set;this.retryCount=new Map;this.loadingPromises=new Map;this.scene=r}registerAssets(r){this.loadQueue.push(...r)}async loadAllAssets(){let r=this.loadQueue.map(e=>this.loadAsset(e));await Promise.allSettled(r)}async loadAsset(r){if(this.loadingPromises.has(r.key))return this.loadingPromises.get(r.key);if(this.loadedAssets.has(r.key))return!0;if(this.failedAssets.has(r.key))return!1;let e=this.attemptLoad(r);return this.loadingPromises.set(r.key,e),e}async attemptLoad(r){let e=r.retries||3,t=this.retryCount.get(r.key)||0;for(;t<e;)try{return await this.loadSingleAsset(r),this.loadedAssets.add(r.key),this.loadingPromises.delete(r.key),!0}catch{t++,this.retryCount.set(r.key,t),t<e&&await new Promise(s=>setTimeout(s,Math.pow(2,t)*1e3))}return r.fallback&&this.scene.textures.exists(r.fallback)?(this.loadedAssets.add(r.key),this.loadingPromises.delete(r.key),!0):(this.failedAssets.add(r.key),this.loadingPromises.delete(r.key),!1)}loadSingleAsset(r){return new Promise((e,t)=>{if(r.type==="image"&&this.scene.textures.exists(r.key)){console.log(`\u26A1 Asset already loaded: ${r.key}`),e();return}if(r.type==="audio"&&this.scene.cache.audio.exists(r.key)){console.log(`\u26A1 Audio already loaded: ${r.key}`),e();return}let i=()=>{this.scene.load.off("filecomplete",s),this.scene.load.off("loaderror",a),e()},s=o=>{o===r.key&&i()},a=o=>{o.key===r.key&&(this.scene.load.off("filecomplete",s),this.scene.load.off("loaderror",a),t(new Error(`Failed to load ${r.key}: ${o.src}`)))};switch(this.scene.load.on("filecomplete",s),this.scene.load.on("loaderror",a),r.type){case"image":this.scene.load.image(r.key,r.url);break;case"audio":this.scene.load.audio(r.key,r.url);break;case"json":this.scene.load.json(r.key,r.url);break;default:t(new Error(`Unsupported asset type: ${r.type}`));return}this.scene.load.isLoading()||this.scene.load.start()})}isAssetLoaded(r){return this.loadedAssets.has(r)&&this.scene.textures.exists(r)}isAssetFailed(r){return this.failedAssets.has(r)}getSafeTexture(r,e="defaultTexture"){return this.isAssetLoaded(r)?r:(this.scene.textures.exists(e)||this.createEmergencyFallback(e),e)}createEmergencyFallback(r){if(this.scene.textures.exists(r))return;let e=this.scene.add.graphics();e.fillStyle(16711680,1),e.fillRect(0,0,32,32),e.generateTexture(r,32,32),e.destroy()}createCommonFallbacks(){[{key:"defaultEnemy",color:4286945,size:{w:36,h:36}},{key:"defaultPlayer",color:65280,size:{w:48,h:64}},{key:"defaultCoin",color:16766720,size:{w:24,h:24}}].forEach(e=>{if(!this.scene.textures.exists(e.key)){let t=this.scene.add.graphics();t.fillStyle(e.color,1),t.fillRect(0,0,e.size.w,e.size.h),t.generateTexture(e.key,e.size.w,e.size.h),t.destroy()}})}};var Se=class{constructor(r){this.isOpen=!1;this.soundEffectsEnabled=!0;this.musicEnabled=!0;this.soundToggle=null;this.musicToggle=null;this.instructionsOverlay=null;this.scene=r,this.loadSettings(),this.create()}create(){let r=this.scene.cameras.main,e=r.width/2,t=r.height/2;this.container=this.scene.add.container(e,t),this.container.setDepth(5e3),this.container.setScrollFactor(0,0),this.backgroundOverlay=this.scene.add.rectangle(0,0,r.width*2,r.height*2,0,.7),this.menuPanel=this.createMenuPanel();let i=this.scene.add.text(0,-200,"GAME MENU",{fontSize:"18px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",align:"center"});i.setOrigin(.5);let s=this.createButton(0,-140,"VIEW INSTRUCTIONS",()=>this.openInstructionsScene(),4854924),a=this.createDivider(-100),o=this.createDivider(-30),n=this.createBizarreInfo(0),l=this.createDivider(110),c=this.createButton(0,150,"RESUME GAME",()=>this.close(),3329330);c.setName("resumeButton"),this.container.add([this.backgroundOverlay,this.menuPanel,i,s,a,o,n,l,c]),this.container.sendToBack(this.backgroundOverlay),this.container.setVisible(!1)}createMenuPanel(){let r=this.scene.add.graphics(),e=Math.min(400,this.scene.cameras.main.width-40),t=Math.min(500,this.scene.cameras.main.height-40),i=-e/2,s=-t/2;return r.fillStyle(4854924,.95),r.fillRoundedRect(i,s,e,t,15),r.lineStyle(3,16766720),r.strokeRoundedRect(i,s,e,t,15),r}createButton(r,e,t,i,s=4854924){let a=this.scene.add.container(r,e),l=this.scene.add.rectangle(0,0,340,50,s,.8);l.setStrokeStyle(2,16766720);let c=this.scene.add.text(0,0,t,{fontSize:"14px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});return c.setOrigin(.5),l.setDepth(10),c.setDepth(11),a.add([l,c]),l.setInteractive({useHandCursor:!0}),l.input&&this.scene.input.setTopOnly(!1),l.on("pointerdown",h=>{i()}),a}createToggleSwitch(r,e,t,i){let s=this.scene.add.container(0,e),a=this.scene.add.text(-90,0,r,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",align:"left",lineSpacing:5});a.setOrigin(0,.5);let o=80,n=60,l=30,c=this.scene.add.rectangle(o,0,n,l,0,0);c.setInteractive({useHandCursor:!0});let h=this.scene.add.graphics(),d=y=>{h.clear(),h.fillStyle(y?3329330:16739179,1),h.fillRoundedRect(o-n/2,-l/2,n,l,15),h.lineStyle(2,16766720),h.strokeRoundedRect(o-n/2,-l/2,n,l,15)};d(t);let b=t?o+15:o-15,u=this.scene.add.circle(b,0,13,16777215);u.setStrokeStyle(2,16766720),s.add([a,h,u,c]);let m=t;return c.on("pointerdown",y=>{y&&y.event&&y.event.stopPropagation(),m=!m,this.scene.tweens.add({targets:u,x:m?o+15:o-15,duration:200,ease:"Power2"}),d(m),i(m)}),c.on("pointerover",()=>{h.clear(),h.fillStyle(m?3329330:16739179,.8),h.fillRoundedRect(o-n/2,-l/2,n,l,15),h.lineStyle(3,16766720),h.strokeRoundedRect(o-n/2,-l/2,n,l,15)}),c.on("pointerout",()=>{d(m)}),s.setData("enabled",m),s.setData("updateState",y=>{m=y,u.x=y?o+15:o-15,d(y)}),s}createDivider(r){let e=this.scene.add.graphics();return e.lineStyle(1,16766720,.3),e.moveTo(-150,r),e.lineTo(150,r),e.strokePath(),e}createBizarreInfo(r){let e=this.scene.add.container(0,r),t=this.scene.add.text(0,0,"BizarreBeasts ($BB)",{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});t.setOrigin(.5);let i=this.scene.add.text(0,25,"CA:",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});i.setOrigin(.5);let s=this.scene.add.text(0,45,"0x0520bf1d3cEE163407aDA79109333aB1599b4004",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",wordWrap:{width:380}});s.setOrigin(.5);let a=this.scene.add.text(0,70,"Created by @bizarrebeast",{fontSize:"10px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});a.setOrigin(.5);let o=this.scene.add.text(0,95,"Join /bizarrebeasts",{fontSize:"10px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});return o.setOrigin(.5),e.add([t,i,s,a,o]),e}createSDKIndicator(r){let e=this.scene.add.container(0,r),t=this.scene.game.sound.mute,i=this.scene.add.text(0,0,`SDK Global: ${t?"MUTED":"ACTIVE"}`,{fontSize:"11px",fontFamily:'"Press Start 2P", system-ui',color:t?"#FF6B6B":"#AAAAAA"});i.setOrigin(.5);let s=this.scene.add.text(0,20,"(Controlled by platform)",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#777777"});return s.setOrigin(.5),e.add([i,s]),e.setData("updateStatus",()=>{let a=this.scene.game.sound.mute;i.setText(`SDK Global: ${a?"MUTED":"ACTIVE"}`),i.setColor(a?"#FF6B6B":"#AAAAAA")}),e}setSoundEffects(r){if(this.soundEffectsEnabled=r,this.scene.registry.set("sfxEnabled",r),this.saveSettings(),this.soundToggle){let e=this.soundToggle.getData("updateState");e&&e(r)}}setMusic(r){if(this.musicEnabled=r,this.scene.registry.set("musicEnabled",r),this.saveSettings(),this.scene.backgroundMusic&&this.scene.backgroundMusic.setVolume(r?.3:0),this.musicToggle){let e=this.musicToggle.getData("updateState");e&&e(r)}}loadSettings(){this.soundEffectsEnabled=!0,this.musicEnabled=!0,this.scene.registry.set("sfxEnabled",this.soundEffectsEnabled),this.scene.registry.set("musicEnabled",this.musicEnabled)}saveSettings(){}open(){if(this.isOpen)return;this.isOpen=!0,this.container.setVisible(!0),this.soundEffectsEnabled&&this.scene.sound.play("menu-toggle",{volume:.5}),this.container.list.filter(t=>t instanceof Phaser.GameObjects.Container&&t.getData("updateStatus")).forEach(t=>{let i=t.getData("updateStatus");i&&i()}),this.pauseGame(),this.scene.input.enabled=!0,this.enableNestedInteractivity(this.container);let e=t=>{this.manualHitTest(t)};this.scene.input.off("pointerdown",e),this.scene.input.on("pointerdown",e),this.container.setData("pointerListener",e),this.scene.children.bringToTop(this.container),this.scene.input.setTopOnly(!1),this.container.setAlpha(1)}enableNestedInteractivity(r){r.list.forEach(e=>{e instanceof Phaser.GameObjects.Rectangle?(e.input||e.setInteractive({useHandCursor:!0}),this.scene.input.enable(e)):e instanceof Phaser.GameObjects.Container&&this.enableNestedInteractivity(e)})}manualHitTest(r){let e=this.container.x,t=this.container.y,i=e+0,s=t+150;Math.abs(r.x-i)<170&&Math.abs(r.y-s)<25&&this.close();let a=e+0,o=t+-140;Math.abs(r.x-a)<170&&Math.abs(r.y-o)<25&&this.openInstructionsScene();let n=e+80,l=t+-60;Math.abs(r.x-n)<30&&Math.abs(r.y-l)<15&&this.setSoundEffects(!this.soundEffectsEnabled);let c=e+80,h=t+-10;Math.abs(r.x-c)<30&&Math.abs(r.y-h)<15&&this.setMusic(!this.musicEnabled)}addDebugVisualization(){let r=this.container.getByName("debugContainer");r&&r.destroy();let e=this.scene.add.container(0,0);e.setName("debugContainer");let t=this.scene.add.graphics(),i=this.container.getByName("resumeButton");if(i){t.lineStyle(4,16711935,1),t.strokeRect(i.x-170,i.y-25,340,50);let u=this.scene.add.text(i.x,i.y-40,`ACTUAL Button Pos: (${i.x}, ${i.y})`,{fontSize:"12px",fontFamily:"Arial",color:"#ff00ff",backgroundColor:"#000000",padding:{x:2,y:2}});u.setOrigin(.5),e.add(u)}t.lineStyle(2,65280,.5),t.strokeRect(-170,125,340,50),t.lineStyle(2,255,.5),t.strokeRect(-170,-165,340,50);let s=this.scene.add.text(0,110,"Created at Y=150",{fontSize:"10px",fontFamily:"Arial",color:"#00ff00"});s.setOrigin(.5);let a=this.scene.add.text(0,-180,"Instructions Zone",{fontSize:"10px",fontFamily:"Arial",color:"#0000ff"});a.setOrigin(.5);let o=this.scene.add.text(-210,-380,"",{fontSize:"10px",fontFamily:"monospace",color:"#ffff00",backgroundColor:"#000000",padding:{x:5,y:5}});o.setName("cursorText");let n=this.scene.add.graphics();n.lineStyle(2,16711680,.8);let l=this.container.x,c=this.container.y;n.strokeRect(0-170,150-25,340,50);let b=this.scene.add.text(0,190,"Manual Hit Test Y=150 (Fixed)",{fontSize:"10px",fontFamily:"Arial",color:"#ff0000"});b.setOrigin(.5),e.add([t,n,s,a,b,o]),this.container.add(e)}updateCursorTracking(r){let e=this.container.getByName("debugContainer");if(!e)return;let t=e.getByName("cursorText");if(!t)return;let i=this.scene.cameras.main,s=this.container.x,a=this.container.y,o=r.x-s,n=r.y-a,l=s+0,c=a+150,h=Math.abs(r.x-l)<170&&Math.abs(r.y-c)<25,d=this.container.getByName("resumeButton"),b="Button not found",u="Rect not found";if(d){let f=d.x,g=d.y;b=`Button container: (${f}, ${g})`;let v=d.list[0];if(v){let S=s+f+v.x,x=a+g+v.y;u=`Rect world: (${Math.round(S)}, ${Math.round(x)})`;let C=r.x>=S-170&&r.x<=S+170&&r.y>=x-25&&r.y<=x+25;u+=C?" HOVERING!":""}}let m=i.scrollY,y=a+150-m;t.setText([`Cursor: (${Math.round(r.x)}, ${Math.round(r.y)})`,`Container: (${Math.round(s)}, ${Math.round(a)})`,`Camera ScrollY: ${Math.round(m)}`,`Button Logic Y: ${a+150} (= 550)`,`Button Visual Y: ${Math.round(y)}`,`Manual Hit: ${h?"YES":"NO"}`,`${b}`,`${u}`])}close(){if(!this.isOpen)return;this.soundEffectsEnabled&&this.scene.sound.play("menu-toggle",{volume:.3}),this.isOpen=!1;let r=this.container.getData("pointerListener");r&&(this.scene.input.off("pointerdown",r),this.container.setData("pointerListener",null)),this.container.setVisible(!1),this.container.setAlpha(1),this.resumeGame()}pauseGame(){this.scene.touchControls&&this.scene.touchControls.disable(),this.scene.physics.pause(),this.scene.anims.pauseAll(),this.scene.registry.set("isPaused",!0),this.scene.input.enabled=!0}resumeGame(){this.scene.physics.resume(),this.scene.anims.resumeAll(),this.scene.time.paused=!1,this.scene.tweens.resumeAll(),this.scene.registry.set("isPaused",!1),this.scene.touchControls&&this.scene.touchControls.enable()}showInstructions(){this.instructionsOverlay||this.createInstructionsOverlay(),this.instructionsOverlay?.setVisible(!0),this.instructionsOverlay?.setAlpha(0),this.scene.tweens.add({targets:this.instructionsOverlay,alpha:1,duration:200})}createInstructionsOverlay(){this.instructionsOverlay=this.scene.add.container(p.canvas.width/2,p.canvas.height/2),this.instructionsOverlay.setDepth(2e3);let r=this.scene.add.rectangle(0,0,p.canvas.width,p.canvas.height,0,.9);r.setInteractive();let e=this.scene.add.graphics();e.fillStyle(32896,.95),e.fillRoundedRect(-300,-250,600,500,15),e.lineStyle(3,2142890),e.strokeRoundedRect(-300,-250,600,500,15);let t=this.scene.add.text(0,-210,"INSTRUCTIONS",{fontSize:"18px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});t.setOrigin(.5);let i=["CONTROLS:","","Move: WASD or Arrow Keys","Jump: Space or E","Climb: Up/Down on ladders","Throw: Q, V, or M","","OBJECTIVE:","","Collect coins and gems","Avoid or defeat enemies","Reach the door to advance","","Press ESC to open this menu"],s=this.scene.add.text(0,-100,i.join(`
`),{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFFFF",align:"center",lineSpacing:8});s.setOrigin(.5);let a=this.createButton(0,210,"CLOSE",()=>this.hideInstructions(),16739179);this.instructionsOverlay.add([r,e,t,s,a]),this.instructionsOverlay.setVisible(!1)}hideInstructions(){this.scene.tweens.add({targets:this.instructionsOverlay,alpha:0,duration:200,onComplete:()=>{this.instructionsOverlay?.setVisible(!1)}})}openInstructionsScene(){this.container.setVisible(!1),this.scene.scene.sleep("GameScene"),this.scene.scene.launch("InstructionsScene",{returnScene:"GameScene",fromMenu:!0,reopenMenu:!0})}getIsOpen(){return this.isOpen}toggle(){this.isOpen?this.close():this.open()}};var le=class{constructor(r){this.MAX_CACHED_BACKGROUNDS=10;this.PRELOAD_COUNT=2;this.currentChapter="";this.currentLevel=1;this.beastModePool=[];this.lastBeastModeRotation=0;this.beastModeLoadingProgress=0;this.beastModeFullyLoaded=!1;this.loadingBatches=[];this.scene=r,this.loadedTextures=new Set,this.textureCache=new Map,this.chapters=new Map,this.backgroundUrls=new Map,this.initializeChapters(),this.initializeBackgroundUrls()}initializeChapters(){this.chapters.set("crystal_cavern",{name:"Crystal Cavern",levelRange:[1,10],backgrounds:["crystal-cavern-1","crystal-cavern-2","crystal-cavern-3","crystal-cavern-4","crystal-cavern-5","crystal-cavern-6","crystal-cavern-7","crystal-cavern-8","crystal-cavern-9","crystal-cavern-10"],theme:"underground crystal caves with glowing gems"}),this.chapters.set("volcanic_crystal",{name:"Volcanic Crystal Cavern",levelRange:[11,20],backgrounds:["volcanic-crystal-1","volcanic-crystal-2","volcanic-crystal-3","volcanic-crystal-4","volcanic-crystal-5","volcanic-crystal-6","volcanic-crystal-7","volcanic-crystal-8","volcanic-crystal-9","volcanic-crystal-10"],theme:"lava-infused crystal formations, heat effects"}),this.chapters.set("steampunk",{name:"Steampunk Crystal Cavern",levelRange:[21,30],backgrounds:["steampunk-1","steampunk-2","steampunk-3","steampunk-4","steampunk-5","steampunk-6","steampunk-7","steampunk-8","steampunk-9","steampunk-10"],theme:"industrial machinery, gears, steam pipes"}),this.chapters.set("storm",{name:"Electrified Crystal Cavern",levelRange:[31,40],backgrounds:["electrified-1","electrified-2","electrified-3","electrified-4","electrified-5","electrified-6","electrified-7","electrified-8","electrified-9","electrified-10"],theme:"lightning, clouds, turbulent weather"}),this.chapters.set("galactic",{name:"Galactic Crystal Cavern",levelRange:[41,50],backgrounds:["galactic-1","galactic-2","galactic-3","galactic-4","galactic-5","galactic-6","galactic-7","galactic-8","galactic-9","galactic-10"],theme:"space, stars, nebulae, cosmic themes"}),this.chapters.set("beast_mode",{name:"Beast Mode",levelRange:[51,1/0],backgrounds:["beast-mode-1","beast-mode-2","beast-mode-3","beast-mode-4","beast-mode-5","beast-mode-6","beast-mode-7","beast-mode-8","beast-mode-9","beast-mode-10","beast-mode-11","beast-mode-12","beast-mode-13"],theme:"random pool from all chapters plus exclusive beast backgrounds"}),this.chapters.set("bonus",{name:"Special Bonus",levelRange:[-1,-1],backgrounds:["bonus-1","bonus-2","bonus-3","bonus-4","bonus-5","bonus-6","bonus-7"],theme:"unique backgrounds for bonus levels"})}initializeBackgroundUrls(){this.backgroundUrls.set("volcanic-crystal-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2011-GZe4EOiyQqMVmrL1suPvCfj2H7XRyU.png?h8lo"),this.backgroundUrls.set("volcanic-crystal-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2012-Xpfr4nKJX0JcfLlrjZxaw0UVKr3xRJ.png?VTjY"),this.backgroundUrls.set("volcanic-crystal-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2013-5VWrULlkLRSqGhIPYBKAGOlY7cvDJs.png?spcG"),this.backgroundUrls.set("volcanic-crystal-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2014-1gw8iVsW1NFUtTX9qkrCaOkzceXgZa.png?uJJ4"),this.backgroundUrls.set("volcanic-crystal-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2015-My6wxLCAKkrjp7DnRUhTTNzy4pGzNz.png?wogd"),this.backgroundUrls.set("volcanic-crystal-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2016-HvPApBdJnsvIKOHL12BVv7OOCRvtXl.png?JpAr"),this.backgroundUrls.set("volcanic-crystal-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2017-M4H2arE4cKPFCFnWvPKeO75XQhGeTr.png?aP8G"),this.backgroundUrls.set("volcanic-crystal-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2018-EaBUdUtkhdA9O7UPGhUzbCSufw5Id3.png?7XYw"),this.backgroundUrls.set("volcanic-crystal-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2019-ypt8lxgxyGduFRNsmei09BL2mKGIYH.png?ojyx"),this.backgroundUrls.set("volcanic-crystal-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2020-VoCdHbTIAHWaULUuJAu1kL8TiARBUM.png?CK3z"),this.backgroundUrls.set("steampunk-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2021-DPL9BM5HXEAbpVzWP2BTZAfO33f54v.png?1fKU"),this.backgroundUrls.set("steampunk-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2022-qDjjzq1C2FmwcHMYRZTzpaGej0yGwb.png?5CrH"),this.backgroundUrls.set("steampunk-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2023-lLNjfzk4mhhPURUbkfRTMNdLplNM22.png?uDB5"),this.backgroundUrls.set("steampunk-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2024-Krew0eCXapHP78qdwQrgTp7Pvy9IMQ.png?tp0E"),this.backgroundUrls.set("steampunk-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2025-bROe8HWWQGVwbIcF2TrA4E3jOprfVJ.png?Z70l"),this.backgroundUrls.set("steampunk-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2026-UTEcGMcuwl5X6QRJj3TEmJxuQMtAVB.png?YEJ9"),this.backgroundUrls.set("steampunk-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2027-QsWK3rAAwdnMlTzY0zQlIQlqYIeZoe.png?v371"),this.backgroundUrls.set("steampunk-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2028-qunz3jvjcvUy0scMr4b18HIWuEABkb.png?DG4r"),this.backgroundUrls.set("steampunk-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2029-metaGhO5uoqBktHCQnoqNmrXrancE4.png?XeH2"),this.backgroundUrls.set("steampunk-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2030-qYeBT9cn6x3uAG4WvPeSa3clML1HpD.png?As4y"),this.backgroundUrls.set("electrified-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2031-O06tOHxb8b80yfdepBVLj3wJjNDMju.png?ILXr"),this.backgroundUrls.set("electrified-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2032-1YFN1MhcMfKXh149SshcFyW07KBHCG.png?PXOw"),this.backgroundUrls.set("electrified-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2033-ve4BB0Wu6RoMblkZbGmx2ST3IyfWHn.png?6pEl"),this.backgroundUrls.set("electrified-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2034-9DMyTcBY2QhKKTskDe6bzWXRZsgLlT.png?Hr6t"),this.backgroundUrls.set("electrified-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2035-qNc9FoZH60Awf13ISIvHpDNSNJifFq.png?Dagv"),this.backgroundUrls.set("electrified-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2036-365hGJnOHpzVyTOpa1618kVJMi6UlX.png?DkAI"),this.backgroundUrls.set("electrified-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2037-KOs54KffvnmZRGfkzDmk3GRvpjQ7mg.png?Edo8"),this.backgroundUrls.set("electrified-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2038-oU56rbW3kuE6MYNXgMgvasvWprLYu4.png?f0hH"),this.backgroundUrls.set("electrified-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2039-4xcZEcBBGlY6iMfY9CO5qh6CtjIbDe.png?otb6"),this.backgroundUrls.set("electrified-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2040-Dr5Q2cJ64opY0LX1D8wIyzMhKfcaEY.png?CbYG"),this.backgroundUrls.set("galactic-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2041-ojno2HZouD4Dt2V1Z8lPT8g9TkR4ie.png?zuLt"),this.backgroundUrls.set("galactic-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2042-zErQ0r8sKPMfgFQwVz0s3ZiGFbdWHA.png?Dppy"),this.backgroundUrls.set("galactic-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2043-RNzRiZW56aIS7iwgav4eUdiwLVjXeD.png?twVY"),this.backgroundUrls.set("galactic-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2044-gn593N3qTHsJT0UPP8gegOuTUMo1y5.png?oLhA"),this.backgroundUrls.set("galactic-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2045-eZS62LEmA5ziCPOdP2Q4F03IIqppAj.png?GGbK"),this.backgroundUrls.set("galactic-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2046-FblgXgSZg6UsQw0SjYc2kIiHh0KH2P.png?CjZV"),this.backgroundUrls.set("galactic-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2047-MZmOHh8GVZiGayV8U0klva12TlXzFq.png?0Irb"),this.backgroundUrls.set("galactic-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2048-4AZugPAFLnrLSulJNqKCiApLZwTYu6.png?3oKl"),this.backgroundUrls.set("galactic-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2049-MqGMDTShcuUgAj5bNZJITaKkhOjNhR.png?iYFP"),this.backgroundUrls.set("galactic-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2050-ff9za6km5crBBMDI3SCAAMmFudZq8E.png?s174"),this.backgroundUrls.set("bonus-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%201-sSavRhv3PSULBYqZTyGpCnPdMjhAq2.png?5PEU"),this.backgroundUrls.set("bonus-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%202-w0skJJAvJH9cYfQluphIJQwMFJpgK3.png?q77P"),this.backgroundUrls.set("bonus-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%203-kn73QdXKclD3LrMf3BXOH4B3ujbuxN.png?t9Nv"),this.backgroundUrls.set("bonus-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%204-opRR6rXctR8XkRkQIo5LfITdiyHhzq.png?Yubo"),this.backgroundUrls.set("bonus-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%205-FOtt55z5rVDYStfszLrUJRnnpovVMb.png?RCnr"),this.backgroundUrls.set("bonus-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%206-mAMzjvs6bdoK8SLuFaztJphnDOLA9U.png?j0bG"),this.backgroundUrls.set("bonus-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%207-9aPLVTEEDFoFgelvBQTC9ISErnYBCj.png?Ongz"),this.backgroundUrls.set("beast-mode-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%201-sRb0H9ErQnF9lBm5DuUzqtpwbZkRVS.png?3q8c"),this.backgroundUrls.set("beast-mode-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%202-LUcNgytry1u8MpUxWVGimvuMvTIVAT.png?vxmF"),this.backgroundUrls.set("beast-mode-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%203-goZNWmCpFDdm6dGhQdNO7CkgPLwqME.png?ExJw"),this.backgroundUrls.set("beast-mode-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%204-d2C0xeqQEzBvpaqO7diW0kqqPLOsk6.png?xmRP"),this.backgroundUrls.set("beast-mode-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%205-dCQCUxMIvQGPsWXKVh8hzq3dX8M7TA.png?M3Hi"),this.backgroundUrls.set("beast-mode-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%206-eOFodTEiDxDZUN3E4wIMGwzxUJ8QIK.png?1gGD"),this.backgroundUrls.set("beast-mode-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%207-TmIgs4UZyBWqt2718z94QbOAdLdlcS.png?iWFS"),this.backgroundUrls.set("beast-mode-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%208-vkOQZUrtkY7OX8U7lF5G9QCnRGKYq0.png?26ru"),this.backgroundUrls.set("beast-mode-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%209-3U9nvV48tv4NvvdFgqprbv3HcVgGg1.png?tx2Q"),this.backgroundUrls.set("beast-mode-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2010-9N8a5M5G9wI0OVoSMXBhlHPqaLg2d2.png?mPP6"),this.backgroundUrls.set("beast-mode-11","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2011-ujFZSIcr0VPwhT4smr13EPziNY4kEa.png?Rnqv"),this.backgroundUrls.set("beast-mode-12","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2012-hjyMpMwqW5hKpVPAsFGPaxuD5RaC7B.png?A52X"),this.backgroundUrls.set("beast-mode-13","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2013-iekgQPJN2LYhyLP6LETjP8hkD2IlnD.png?3eMk")}getChapterForLevel(r,e=!1){return e?"bonus":r>=51?"beast_mode":r>=41?"galactic":r>=31?"storm":r>=21?"steampunk":r>=11?"volcanic_crystal":"crystal_cavern"}getBackgroundForLevel(r,e=!1){let t=this.getChapterForLevel(r,e);if(this.currentLevel=r,t!==this.currentChapter&&(this.currentChapter=t,t==="beast_mode"))return this.getBeastModeBackground(r);let i=this.chapters.get(t);if(!i||i.backgrounds.length===0)return this.getFallbackBackground(r);if(t==="bonus"){let o=(Math.floor(r/10)-1)%i.backgrounds.length;return i.backgrounds[o]}let s=(r-i.levelRange[0])%i.backgrounds.length;return i.backgrounds[s]}getBeastModeBackground(r){r%5===0&&r!==this.lastBeastModeRotation&&(this.lastBeastModeRotation=r,this.rotateBeastModePool()),this.beastModePool.length===0&&this.loadBeastModePool();let e=(r-51)%this.beastModePool.length;return this.beastModePool[e]}loadBeastModePool(){if(this.beastModeFullyLoaded){let r=[];this.chapters.forEach((t,i)=>{i!=="beast_mode"&&r.push(...t.backgrounds)}),this.beastModePool=[...r];let e=this.chapters.get("beast_mode");e&&e.backgrounds.length>0&&this.beastModePool.push(...e.backgrounds)}}prepareBeastModeBatches(){this.loadingBatches=[];let r=["crystal_cavern","volcanic_crystal","steampunk","storm","galactic","bonus"];for(let e of r){let t=this.chapters.get(e);if(t)for(let i=0;i<t.backgrounds.length;i+=10){let s=t.backgrounds.slice(i,Math.min(i+10,t.backgrounds.length));this.loadingBatches.push(s)}}console.log(`\u{1F4E6} Prepared ${this.loadingBatches.length} batches for progressive loading`)}startProgressiveBeastModeLoading(){if(this.loadingBatches.length===0){this.beastModeFullyLoaded=!0,console.log("\u2705 Beast Mode fully loaded!"),this.loadBeastModePool();return}this.progressiveLoadTimer&&this.progressiveLoadTimer.destroy();let r=0;this.progressiveLoadTimer=this.scene.time.addEvent({delay:2e3,repeat:this.loadingBatches.length-1,callback:async()=>{if(r<this.loadingBatches.length){let e=this.loadingBatches[r];console.log(`\u{1F4E5} Loading batch ${r+1}/${this.loadingBatches.length}`),await this.loadBackgroundBatch(e),this.beastModePool.push(...e),this.beastModeLoadingProgress+=e.length,r++,r>=this.loadingBatches.length&&(this.beastModeFullyLoaded=!0,console.log(`\u2705 Beast Mode fully loaded! Total backgrounds: ${this.beastModeLoadingProgress}`),this.loadBeastModePool())}}})}async loadBackgroundBatch(r){let e=[];for(let t of r)if(!this.loadedTextures.has(t)&&!this.scene.textures.exists(t)){let i=this.backgroundUrls.get(t);if(i){let s=new Promise(a=>{this.scene.load.image(t,i),this.scene.load.once("complete",()=>{this.loadedTextures.add(t),a()})});e.push(s)}}e.length>0&&(this.scene.load.start(),await Promise.all(e))}rotateBeastModePool(){for(let r=this.beastModePool.length-1;r>0;r--){let e=Math.floor(Math.random()*(r+1));[this.beastModePool[r],this.beastModePool[e]]=[this.beastModePool[e],this.beastModePool[r]]}}selectRandomSubset(r,e){return[...r].sort(()=>.5-Math.random()).slice(0,e)}async loadChapterBackgrounds(r){if(r==="beast_mode"){console.log("\u{1F9BE} Starting progressive loading for BEAST MODE"),this.beastModeLoadingProgress=0,this.beastModeFullyLoaded=!1;let i=this.chapters.get("beast_mode");i&&(await this.loadBackgroundBatch(i.backgrounds),console.log(`\u2705 Loaded initial ${i.backgrounds.length} Beast Mode exclusives`),this.beastModePool=[...i.backgrounds],this.beastModeLoadingProgress=i.backgrounds.length),this.prepareBeastModeBatches(),this.startProgressiveBeastModeLoading();return}let e=this.chapters.get(r);if(!e)return;console.log(`\u{1F4E5} Loading backgrounds for chapter: ${r}`);let t=[];for(let i of e.backgrounds)if(!this.loadedTextures.has(i))if(this.scene.textures.exists(i))this.loadedTextures.add(i);else{let s=this.backgroundUrls.get(i);if(s){let a=new Promise(o=>{this.scene.load.image(i,s),this.scene.load.once("complete",()=>{this.loadedTextures.add(i),console.log(`\u2705 Loaded background: ${i}`),o()})});t.push(a)}}t.length>0&&(this.scene.load.start(),await Promise.all(t))}unloadChapterBackgrounds(r){let e=this.chapters.get(r);e&&(this.loadedTextures.size<=this.MAX_CACHED_BACKGROUNDS||e.backgrounds.forEach(t=>{this.scene.textures.exists(t)&&t!==this.getBackgroundForLevel(this.currentLevel)&&(this.scene.textures.remove(t),this.loadedTextures.delete(t),this.textureCache.delete(t))}))}preloadNextLevels(r){for(let e=1;e<=this.PRELOAD_COUNT;e++){let t=r+e,i=this.getChapterForLevel(t);if(i!==this.currentChapter){this.loadChapterBackgrounds(i);break}}}disposeUnusedTextures(){let r=this.getBackgroundForLevel(this.currentLevel),e=new Set;for(let t=-1;t<=this.PRELOAD_COUNT;t++){let i=this.currentLevel+t;i>0&&e.add(this.getBackgroundForLevel(i))}this.loadedTextures.forEach(t=>{!e.has(t)&&this.loadedTextures.size>this.MAX_CACHED_BACKGROUNDS&&this.scene.textures.exists(t)&&(this.scene.textures.remove(t),this.loadedTextures.delete(t))})}isChapterTransition(r,e=!1){return e?!1:this.currentChapter==="bonus"?!0:this.getChapterForLevel(r)!==this.currentChapter}getChapterName(r,e=!1){let t=this.getChapterForLevel(r,e);return this.chapters.get(t)?.name||"Unknown"}getBeastModeLoadingProgress(){return{loaded:this.beastModeLoadingProgress,total:70,percentage:Math.round(this.beastModeLoadingProgress/70*100)}}isBeastModeFullyLoaded(){return this.beastModeFullyLoaded}getFallbackBackground(r){return"crystal-cavern-bg"}generateProceduralBackground(r){return this.getFallbackBackground(this.currentLevel)}addBackgroundUrls(r,e){let t=this.chapters.get(r);t&&(t.backgrounds=e)}getCurrentChapterInfo(){let r=this.chapters.get(this.currentChapter);if(!r)return{name:"Unknown",theme:"",progress:0};let e=0;if(this.currentChapter!=="beast_mode"){let[t,i]=r.levelRange;e=(this.currentLevel-t)/(i-t+1)*100}return{name:r.name,theme:r.theme,progress:Math.min(100,Math.max(0,e))}}};var ne=null;async function Be(w){try{typeof window<"u"&&window.OpenGameSDK?(ne=new window.OpenGameSDK({gameId:w,ui:{usePointsWidget:!0}}),await ne.init(),console.log("[PlayFun] SDK initialized")):console.warn("[PlayFun] OpenGameSDK not found on window")}catch(r){console.warn("[PlayFun] SDK init failed:",r)}}function Ee(w){if(ne)try{ne.addPoints(w),ne.savePoints(),console.log("[PlayFun] Score reported:",w)}catch(r){console.warn("[PlayFun] Score report failed:",r)}else console.log("[PlayFun] SDK not available, score not reported:",w)}var xe=class extends Phaser.Scene{constructor(){super({key:"GameScene"});this.coins=[];this.blueCoins=[];this.diamonds=[];this.freeLifes=[];this.invincibilityPendants=[];this.treasureChests=[];this.crystalBalls=[];this.crystalBallProjectiles=[];this.levelHasCrystalBall=!1;this.cursedOrbs=[];this.cursedTealOrbs=[];this.levelHasCursedOrb=!1;this.levelHasCursedTealOrb=!1;this.isGameOver=!1;this.floorLayouts=[];this.ladderPositions=new Map;this.doorPositions=new Map;this.score=0;this.accumulatedScore=0;this.currentFloor=0;this.lives=3;this.totalCoinsCollected=0;this.totalGemsCollected=0;this.totalBlueGemsCollected=0;this.totalDiamondsCollected=0;this.livesEarned=0;this.COINS_PER_EXTRA_LIFE=150;this.MAX_LIVES=99;this.highestFloorGenerated=5;this.justKilledCat=!1;this.comboCount=0;this.comboTimer=null;this.visibilityRadius=160;this.invincibilityActive=!1;this.invincibilityTimer=null;this.invincibilityTimeRemaining=0;this.invincibilityTimerSparkleTimer=null;this.invincibilityWarningPlayed=!1;this.playerGoldenAura=null;this.playerParticleTrail=[];this.playerSpikeOverlap=null;this.playerSpikeCollider=null;this.currentBackground="background-treasure-quest-5";this.backgroundLibrary=["background-treasure-quest-5","background-treasure-quest-6","background-treasure-quest-7"];this.backgroundSprite=null;this.backgroundInitialY=0;this.backgroundHeight=0;this.recentTiles=[];this.tileGrid=new Map;this.tileUsageCount=new Array(12).fill(0);this.door=null;this.isLevelStarting=!1;this.isLevelComplete=!1;this.speechBubble=null;this.thoughtBubble=null;this.bubbleTimer=null;this.BUBBLE_DISPLAY_TIME=3e3;this.loadingOverlay=null;this.showLoadingScreen=!1;this.reopenMenuAfterInit=!1}init(e){this.reopenMenuAfterInit=e?.reopenMenu||!1,this.gameStats=this.game.registry.get("gameStats"),this.gameStats?console.log("\u{1F4CA} Continuing with existing gameStats:",this.gameStats):(console.log("\u{1F3AE} Initializing fresh gameStats tracking (first time)"),this.gameStats={treasureChestsOpened:0,enemyKills:{caterpillar:0,rollz:0,chomper:0,snail:0,bouncer:0,stalker:0,rex:0,blu:0},totalEnemiesDefeated:0,highestFloor:0,livesLost:0},this.game.registry.set("gameStats",this.gameStats));let t=this.game.registry.get("isDeathRetry")||!1,i=this.game.registry.get("playerLives")||0,s=this.game.registry.get("isReplay")||!1,a=s||t&&i>0;this.showLoadingScreen=!a,console.log(`\u{1F3AC} Loading screen decision: isReplay=${s}, isDeathRetry=${t}, skip=${a}, SHOW=${this.showLoadingScreen}`),this.cameras.main.setBackgroundColor("#1a0033"),this.levelManager=new oe,this.backgroundManager=new le(this);let o=this.registry.get("currentLevel")||1,n=`loading-screen-${o>=51?51:o>=41?41:o>=31?31:o>=21?21:o>=11?11:1}`;if(this.textures.exists(n))console.log(`\u26A1 Using pre-generated loading screen: ${n}`),this.instantLoadingScreen=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,n),this.instantLoadingScreen.setOrigin(.5),this.instantLoadingScreen.setDepth(1e5);else{console.log("\u26A0\uFE0F No pre-generated loading screen, creating text");let l=p.canvas.width/2,c=p.canvas.height/2,h=this.add.text(l,c,"LOADING...",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"});h.setOrigin(.5),h.setDepth(1e4),this.preloadLoadingText=h}console.log("\u{1F3AE} GameScene.init() - Loading screen displayed")}preload(){console.log("\u{1F504} GameScene.preload() started at",performance.now());let e=X.getPreloadedCount();e>0&&console.log(`\u2728 Found ${e} preloaded assets from InstructionsScene`),this.assetPool=new ve(this);let t=[{key:"visibilityOverlay",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO",type:"image",retries:3},{key:"background-treasure-quest-5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1",type:"image",retries:3},{key:"background-treasure-quest-6",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%206-gX1QoTf3UJnMPvbDKVt9hYGDD1AltE.png?LWtY",type:"image",retries:3},{key:"background-treasure-quest-7",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%207-YeACeKZk8lSEU1IDy5zOU6G79VqYKx.png?TWtQ",type:"image",retries:3},{key:"playerIdleEye1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%201-p01pa3z9fL9AyLQolMuYyBO3DIqgvB.png?FaaG",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%202-ngx0e1EF33iY14vRpcSvy8QOUjMKnl.png?lsFE",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBlink",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%20blinking-fDIX0Bin2Vh42SGyH0DT70fwWARivM.png?QXG7",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye3",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%203-TLisG1UJypI7PhiKszpBcC8Nx8ZyrS.png?6Tg9",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye4",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%204-kvrv3THif8vcKjFB0NPzOeclqapVi6.png?PuWO",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%205-1P13Nmi3xqoC5kWevrWUxutqyXfr99.png?F4D2",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBootyLeft",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/booty%20shaking%20left%20cheek-c4bJ5CnHbeRJc6LN3OSetpPvTNby88.png?zEph",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBootyRight",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/booty%20shaking%20right%20cheek-7eORz1b8ditvsXDolmHCEUlk7Wmvvd.png?UT5w",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerClimbLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/climbing%20ladder%20left%20foot%20up-Oipv0p2kIPLZcoV2XBC7FMjkKAzxOk.png?6y8P",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerClimbRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/climbing%20ladder%20right%20foot%20up-A7A5enZp5Z0EeXRZE8MVGvLZ9Jx5Ll.png?Hwlb",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerJumpLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/jumping%20left%20foot%20forward-mXUWm73dYQqZMOkl9Wn4MjBnzEdZjX.png?49nU",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerJumpRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/jumping%20right%20foot%20forward-qLrBUCfcOJhpnlFrfX8taL39RPnq4P.png?1QLd",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerRunLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20left%20foot%20forward%20new-aH3WiqHkbYLeW14yketC7EdmowlQ02.png?jLLJ",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerRunRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Running%20right%20foot%20forward-FGGa0yxLpub6kRyvYj29zhOqx4sVj3.png?VhAX",type:"image",retries:3,fallback:"defaultPlayer"},{key:"blueEnemy",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/enemy%20test%201-DFzrumkmpUN5HOwL25dNAVJzRcVxhv.png?rxbT",type:"image",retries:3,fallback:"defaultEnemy"},{key:"tealLadder",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/new%20ladder-ULDbdT9I4h8apxhpJI6WT1PzmaMzLo.png?okOd",type:"image",retries:3}];this.assetPool.registerAssets(t),this.assetPool.createCommonFallbacks(),this.load.image("blueEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/enemy%20test%201-DFzrumkmpUN5HOwL25dNAVJzRcVxhv.png?rxbT"),this.load.image("visibilityOverlay","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO"),this.load.image("custom-dpad","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/dpad-HlSoc5tt8vs8cjbkEROL1GjaGzx8Ko.png?ecZG"),this.load.image("custom-jump-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20button-yS4IpgcdvQerPZjpif3tOLmqIfO7yE.png?pRZm"),this.load.image("custom-action-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/action%20button-0ijEeXV3alwc5ZbDzkD4HaP7PXzsAN.png?1zZP"),this.load.image("test-hud-bg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/test%20gem%20for%20hud-7RamXtpyUYcrX6K6DLnuWOD7ZNssLi.png?1boq"),this.load.image("hud-bg-200","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/gem%20for%20hud-pTsDx0VNBRQzAIh45KCFTFoU0pM1om.png?4RuD"),this.load.image("blueEnemyMouthClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed-HUXqx9HBdotEhJE2LBgzK8Z4kA7e2H.png?AVKZ"),this.load.image("blueEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed%20blinking-bJ1xwYkoCZvjd4T9MdXzR45PfaZIcF.png?6LRV"),this.load.image("blueEnemyMouthPartialOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20partially%20open-PrzEwLEPYIPE6pJTgHBWV7SVvKYcSX.png?0RG2"),this.load.image("blueEnemyMouthPartialOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20partially%20open%20blinking-GfMaaIsvJGkTrtx4vIFnh11fvyTc5N.png?d3qY"),this.load.image("blueEnemyMouthOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20open-4hO9JLZDfnWgcQWlvfqiU7SCOXaA0g.png?sh1i"),this.load.image("blueEnemyMouthOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20open%20blinking-Nl5UA9KyScZCBwu9BrKXR0IdNk3aen.png?B9Tr"),this.load.image("purpleEnemyMouthClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20closed%20mouth-l01A99F3sINIeGx2hkb33YVS16xa3k.png?DjP8"),this.load.image("purpleEnemyMouthPartialOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20mid%20mouth-OvzgXzA7k4tlCopnJB6tiD0RqjATsS.png?wV23"),this.load.image("purpleEnemyMouthOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20full%20open%20mouth-H4bWdRYA3801jLzUyCiuevtXxj8Hmu.png?MkMw"),this.load.image("redEnemyMouthClosedEyes1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%201-RKF3p3F7fxdBSfen8UD9UGqIzf8zlv.png?xRpM"),this.load.image("redEnemyMouthClosedEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%202-vLWsEKkj7nPhdADyj947N0FQDi3QUf.png?Z82J"),this.load.image("redEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%20blinking-PiVnlocHV8Fra4PC2jrZGZISgIPvsv.png?aQjM"),this.load.image("redEnemyMouthPartialOpenEyes1Wink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20partially%20open%20eyes%201%20with%20one%20blinking-CuKxjBkQYU77bxH1e6KMS5tIdsz17T.png?G49S"),this.load.image("redEnemyMouthPartialOpenEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20partially%20open%20eyes%202-A43kcb28mR0IQbtfIU0KJJqBswRrlD.png?QDz4"),this.load.image("redEnemyMouthWideOpenEyes1Wink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%201%20with%20one%20blinking-bYhh1tBYiobaJsDTFoTkLpbeTJY8vs.png?7MZ2"),this.load.image("redEnemyMouthWideOpenEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%202-eeVDATMEgV6VQ9mPDfyEX1CFJPPr4W.png?RQBw"),this.load.image("redEnemyMouthWideOpenEyes3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%203-BYXzuHGU9Dd18kQEB6bztT5k8jFhJt.png?IzuG"),this.load.image("greenEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20right-Lv7YvIjvADM6LmR0OfFEXE674NoQag.png"),this.load.image("greenEnemyEyeCenter","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20center-vxgpMOLHN5TR5FtXa3BLrddj1H4lzA.png"),this.load.image("greenEnemyEyeLeft","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20middle-JpsQ7yYaUP00AU4NCh54ULeIW6lLTK.png"),this.load.image("greenEnemyBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20blinking-Syo5f9Tq7RWub8unCEcZbS7iuykZNI.png"),this.load.image("stalkerEnemyEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%201-Xt3Vtu2FiWWLT9l2wfeakBAqVSZet8.png?gS6O"),this.load.image("stalkerEnemyEye2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%202-n2c58R6bdpzzPAVlVRgMZoKmngtTUo.png?nTFi"),this.load.image("stalkerEnemyEye3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%203-K1hEnZ0oXDlCbLGCuJz1GD1YbYATZ6.png?safa"),this.load.image("stalkerEnemyEye4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%204-Y0pnlUUMFdmHY7HxQk2gGe9Nr41glQ.png?cgFm"),this.load.image("stalkerEnemyBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%205%20blinking-CPlBOBjLFGic1DKAwXNjnMpyRwBVgr.png?vYe6"),this.load.image("stalkerEnemyEyeOnly","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%20only-3BuhEI2UePG6So3jAYE5NPnoQTsnc0.png?6wB1"),this.load.image("playerIdleEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%201-aD6V48lNdWK5R1x5CPNs4XLX869cmI.png?0XJy"),this.load.image("playerIdleEye2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%202-oQdxdPT1VWpTLUelgIRXIHXFw5jEuu.png?nGbT"),this.load.image("playerIdleBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%20blinking-qmZlXgNwk3w2B610GpK1dkndEDFmEg.png?q97J"),this.load.image("playerIdleEye3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%203-TLisG1UJypI7PhiKszpBcC8Nx8ZyrS.png?6Tg9"),this.load.image("playerIdleEye4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%204-kvrv3THif8vcKjFB0NPzOeclqapVi6.png?PuWO"),this.load.image("playerIdleEye5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%205-1P13Nmi3xqoC5kWevrWUxutqyXfr99.png?F4D2"),this.load.image("playerClimbLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20ladder%20left%20foot%20up-HkXPep0kpt9he1WtndEXsXRVHQBdlq.png?ncVM"),this.load.image("playerClimbRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20ladder%20right%20foot%20up-hkc4X4pm3mSs1J3UpRQwRw8GhealC6.png?t8RZ"),this.load.image("playerJumpLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20left%20foot%20forward-DVmoTTdCOBfI9FRTg9vs949sTzKoOB.png?9FM5"),this.load.image("playerJumpRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20right%20foot%20forward-3clf2KnwfbN3O6BsrtaeHSTAviNbnF.png?xx8e"),this.load.image("playerRunLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20left%20foot%20forward%20new-aH3WiqHkbYLeW14yketC7EdmowlQ02.png?jLLJ"),this.load.image("playerRunRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Running%20right%20foot%20forward%202-aGnWjaFUNnYXwTfNKfSCfCLppOHzDU.png?mXmE"),this.load.image("playerRunBody","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body-bM1vl3T1vsaGXNpy1aSdQTw7y8yJWK.png?laFZ"),this.load.image("playerRunBodyEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%202-RdbQz9dbHYM8AMsZxEE7BLRbMD4rUT.png?AhxN"),this.load.image("playerRunBodyEyes3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%203-L2mDyCxbHwvlp6DEq6gxihPbgctDYV.png?tasV"),this.load.image("playerRunBodyEyes4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%204-ZfdYFT0Njqb5scTp0hVEzTo9Z9b2Cp.png?QE3U"),this.load.image("playerRunBodyEyes5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%205-ukOG4fy50XhZTYC6nSIg466Fi8rS1I.png?Oeos"),this.load.image("playerRunBodyEyes6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%206-Ce3qtFJFdtq95juwg15T9jLnK7kkWb.png?Gg1B"),this.load.image("playerRunBodyEyes7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%207-QPAzARJE1Zzu1uOpV808LTO0Kaeoqo.png?7N69"),this.load.image("playerRunBodyBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%20blinking-tpJuDG5352O6gg9GHvj0owyZ7Vo4sy.png?eKh3"),this.load.image("playerRunLegsBothDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/both%20feet%20down-Df4cKPxtG04wJmnzY3QzaUeW22F1BN.png?Iekl"),this.load.image("playerRunLegsLeftMid","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/left%20foot%20up%20mid-DpJL6NyL9T7l7vzP8e2jfvpTJwvofR.png?rZfI"),this.load.image("playerRunLegsLeftHigh","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/left%20foot%20up%20high-jcTqik4ucIuoIwjkuG5a8cmOe9vrDu.png?wU6d"),this.load.image("playerRunLegsRightMid","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/right%20foot%20up%20mid-Qr5UwoShdZYlJJsGojNP8offBrp0yV.png?nrOQ"),this.load.image("playerRunLegsRightHigh","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/right%20foot%20up%20high-e5syDsyAyHiLXqTbbeBGoyUIwV8ZTB.png?c7fW"),this.load.image("purple-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/purple%20chest-4wMMVDFuAO3FpYyH7edWzeA3xVENZw.png?IkvS"),this.load.image("teal-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20chest-FpKKXWv5XWlb5H19IHW0G49DAm7Adb.png?Odul"),this.load.image("yellow-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20chest-QMRMmVk9i7S0qkLteaXfhjqQBI351B.png?sE5u"),this.load.image("crystalBallCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("crystalBallProjectile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("crystalBallTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20timer-DXFxS1g5ICpECl1vorurI4vQgShlfI.png?VWVq"),this.load.image("cursedOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb-rHogWhnYUk2xThrTWajfHqMSfxeyfd.png?0wr6"),this.load.image("cursedTealOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb-wupZvLrfiaRIZZyP4TbIOq5HLiVsXz.png?i2qV"),this.load.image("cursedOrbTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb%20timer-5VBMFlHiVp24NkCpIhkDD4dc6fKiHK.png?hHIh"),this.load.image("cursedTealOrbTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb%20timer-FAoT2eYLkUGfQRCCfS5qwZOkMvFBTg.png?FMZ7"),this.load.image("door-sprite","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U"),this.load.image("door-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/door%20for%20hud-veW9YPgRL7GNNZWIF1VkHhGzn4MgcH.png?x2hT"),this.load.image("crystal-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20hud%20icon-6cCEP7jp90eqI7W9LeBp7v4s3OgCPX.png?nMJm"),this.load.image("talking-bubble","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/go%20bizarre%20talking%20bubble-QlBbag1lDPx9SbnKTlgwwCZ12Fowh2.png?h0Cw"),this.load.image("crystal-cavern-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%201-o5M2rYkM5ffKmdp8pMw6QzmR87KA0k.png?4qbf"),this.load.image("crystal-cavern-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%202-Sdyqtq58gC1XVkllts47M2AzYOTgpX.png?0mX8"),this.load.image("crystal-cavern-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%203-iE9A520YoUrX7GIVwgKojzeC0JuMlg.png?R6UH"),this.load.image("crystal-cavern-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%204-oMun45XW8jHJAX8lWQ3HbOad2TL5gt.png?3ulH"),this.load.image("crystal-cavern-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%205-AQS3zCiGE8QOqamLmdoOJ7SjecHlW8.png?d4aM"),this.load.image("crystal-cavern-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%206-dqO5JRSPRzu4pkpC66pBTL416gw0iV.png?wGuc"),this.load.image("crystal-cavern-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%207-rPVZWuJSGouJJHwzx0PYjHIJ9AWeOG.png?3QAw"),this.load.image("crystal-cavern-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%208-AKdyp1OQa5qT20Wab5aCgnMKwpPEY9.png?ejNY"),this.load.image("crystal-cavern-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%209-s5weyP0mb0UngvFh3FP3FS4s4OuVCo.png?QS83"),this.load.image("crystal-cavern-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2010-HpLzzcMARGk4bAxftjkS7AcaLC3ljt.png?AETo"),this.load.image("crystal-cavern-bg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20background%20compressed-UKsRHy0KcxBQz6FuHbeLvlwcbd3LdS.png?ATB5"),this.load.image("yellowEnemyMouthOpenEyeOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20open%20mouth%20open-lQoAdkobZ4H1EzQlITXFW8pLyuzlpU.png?vG8O"),this.load.image("yellowEnemyMouthOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20closed%20mouth%20open-jvUJJbRjevmC71Cgw86fpsQGJQkwGK.png?yXzx"),this.load.image("yellowEnemyMouthClosedEyeOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20open%20mouth%20closed-6A2FG9PKDMrBHdE76pV9iALE66ogtp.png?L3eK"),this.load.image("yellowEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20closed%20mouth%20closed-Fv7QiPIbIYgPuqmUeGF8Gu234h9Xie.png?nEys"),this.load.image("blueCaterpillarEyesRight","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20right-rgnZpnvBWDB5xqNXCcFANHRKrytkRu.png?wuBQ"),this.load.image("blueCaterpillarEyesLeft","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20left-HsnjWSiRWtlaEQbj1rkVr1tbwQc9ky.png?gCNM"),this.load.image("blueCaterpillarEyesDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20down-WvFuBIqZBj1tTCA5FZUSNSRakKAXY3.png?EWfJ"),this.load.image("blueCaterpillarBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20blinking-JvNYqKH2z9dUyLPOko1QE2GJXwuL36.png?vqim"),this.load.image("gem-big-blue","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem-GzKKZKUsDMh3CXMEIV4OmMl4ksrqqm.png?sill"),this.load.image("gem-pink-round","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20round-E2EKGSTZHnnCdW0QkFmTDRKY7ERfw7.png?izQh"),this.load.image("gem-yellow-emerald","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20emerald-Z65ogfvE2NUX0AtxfwqgUKTooKPL1M.png?NJLZ"),this.load.image("gem-purple-opal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/purple%20opal-vq4CL7MxiGQDenIU0ZvqVQJJbWAvt5.png?GjQL"),this.load.image("gem-teal-triangle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20triangle-HVpi82a0c01MbkO92zYvH4tIN3CdMw.png?N700"),this.load.image("gem-diamond","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond-LB22Ijoji8erIrMFMvtSwd5Y9rDDwS.png?LlEv"),this.load.image("heart-crystal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/free%20life%20heart%20crystal-2EJMsIvSQKzdgrqytakBZcDbGf7Jpf.png?E1JG"),this.load.image("invincibility-pendant","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pendant-cJISby3d7EEREasbi0gRZkn2u3rNrG.png?xf9m"),this.load.image("invincibility-timer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/timer2-X3PMyQUgCU3fz146QaD9mBBy38e8Vw.png?Yy9W"),this.load.image("yellow-ceiling-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20spikes%20ceiling%20tile-8vq9W1Y2e1RSpgUfMl9sTp0ZILFHL3.png?mUEb"),this.load.image("pink-floor-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20spikes%20floor%20tile-ncAVgIHazwYlznCBP4H6LWLiIhN7OF.png?n27v"),this.load.image("baseblue-eyes-center","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20center-BWjYc09iCwYsTuEB3TEsa7GdmDc4Nj.png?NZtQ"),this.load.image("baseblue-eyes-down","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down-Vtp9tuVzlbp29Cn3GqoEVHzSGyZLYX.png?u15t"),this.load.image("baseblue-eyes-down-right","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down%20right-eJGRVL9E1aqNPUimWVa0aoEEHbmMca.png?ObTg"),this.load.image("baseblue-eyes-middle-right","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20middle%20right-ShBskufoh2zXFcfI5AHUCpx6ecnIWi.png?TizP"),this.load.image("baseblue-eyes-up","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20up-lot6W1Y3ns3uhL8Xd59yoSCusiT48e.png?fMIa"),this.load.image("baseblue-eyes-up-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20up%20left-biYISTHmHXS9VFQa63REv8KCGeHMC2.png?Fp2W"),this.load.image("baseblue-eyes-middle-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20middle%20left-o5tw4V3qJ9gmASZ2TjaeUcJpD220CM.png?bL2r"),this.load.image("baseblue-eyes-down-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down%20left-8txJQ9OPVkMTkW0eaWprmvS5igTbqZ.png?hOzV"),this.load.image("baseblue-eyes-blinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20blinking-nZFjSjOXa1RAYpXPefApbKEET49sRr.png?96YM"),this.load.image("beetle-mouth-closed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20closed-6ScuNGGsBgifOGHCCMext3ghafhXlB.png?XErn"),this.load.image("beetle-mouth-open-30","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2030-HXSFqNWDpvxFnv2l35lrddto2TAyCk.png?sdgg"),this.load.image("beetle-mouth-open-70","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2070-gToASj29g9XTDxUDHBKXDOfpYOKudu.png?uZh3"),this.load.image("rexEyesOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20open-xKvtdvPdMIy13IjDLdWArsLxH3bi3m.png"),this.load.image("rexBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20blinking-ix1xWvDmRTfWQT1HB22Z4z0lYCST06.png"),this.load.audio("background-music","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/CRYSTAL%20CAVERN%20-%20Treasure%20Quest%20-%20BizarreBeasts%20-%20MASTER%201-GnktEmoyUQQEEoFTBVrVAhEFyGRwL9.mp3?acKK"),this.load.on("loaderror",i=>{console.error("\u274C Failed to load audio file:",i.key,i.url)}),this.load.on("filecomplete-audio-background-music",()=>{console.log("\u2705 Background music file loaded successfully")}),this.load.on("filecomplete-audio-splash-sound",()=>{console.log("\u2705 Splash sound file loaded successfully")}),this.load.audio("gem-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/regular%20gem%20collect%20sfx-OXLLrrAXWUz21oDTEuQPFb2fxRWxXh.wav?pH1V"),this.load.audio("diamond-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond%20collect%20sfx-V3aWJINX1e3OF5XZJFntg7WjpCup3Y.wav?A9QM"),this.load.audio("big-blue-gem-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem%20collect%20sfx-nYAUNJtHLMfNwACb6CM42eSQVAW6XG.wav?f8N2"),this.load.audio("heart-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20collect%20heart%20sfx-7SPaWI2NI7kkVlgjjKbYXCDQuXI4sG.wav?N1rD"),this.load.audio("cursed-orb-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/collect%20cursed%20orb%20or%20teal%20cursed%20orb-2KpSJv5Zd8lQ4OdgPtmn9YLlS0UqId.wav?ryTu"),this.load.audio("powerup-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/collect%20pendant%20or%20crystal%20ball-rEQiBqrl32yuqNts0U4A3Muol63Fxr.wav?eDiE"),this.load.audio("treasure-chest-open","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20chest%20opening%20sfx-qA8VU8UtwVC4fnaW67wfvM2IzTJRep.wav?WLuy"),this.load.audio("menu-toggle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/menu%20sound-uBdZpD8zUrdGkuqw7jw0j9339NP2wC.wav?rHPB"),this.load.audio("jump-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%201%20sfx-Cfx219m2NwhVClkP67iebiwcV0HiF5.wav?GDjY"),this.load.audio("jump-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%202%20sfx-UU3Gj2quONoFPk7SO3OI3koGgiSRGY.wav?4Zrt"),this.load.audio("jump-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%203%20sfx-8h2X8f0XZJYeVB65fDYk4hth9h1G0O.wav?Wpvy"),this.load.audio("player-land","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20lands%20after%20jump%20sfx-OoLEu6v6m6Oy51qVDCknLhjlMC3Awy.wav?xPtL"),this.load.audio("footstep","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/foot%20step-XZmhUkf7XprYQzm2GbUVYaPZKeW6it.wav?3Vyp"),this.load.audio("crystal-ball-throw","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/throw%20crystal%20ball%20sfx-oZfZHRmRnqebRdw2YrcMLR7LlLCMRp.wav?aKDe"),this.load.audio("crystal-ball-bounce","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20bounce%20sfx-bOZrWB6YiMh6bedqvdLw3YaW63MZxO.wav?ORcs"),this.load.audio("crystal-ball-hit-enemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20hits%20enemy-Rxq3kA6Q8rLBBb5PhGNdBhTI9AMo8W.wav?8sSG"),this.load.audio("continue-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%20complete%20continue%20button%20sfx-tKmarJUBWs3rQJhPDsv2IYj5oc8p5j.wav?V3lH"),this.load.audio("door-open","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/door%20open%20sfx-LqGIt2ZSLGjCz0lSbuC6F6yusdC97e.wav?hCxN"),this.load.audio("menu-toggle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/menu%20open%20and%20close-nUqXoXI4Du6a4mBgJmOcJZuJkGXAa2.wav?EOlm"),this.load.audio("spike-hit","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20hits%20spikes%20sfx-Pt2SxNCgCXtyIz2jiBS3AYiCvYrp8X.wav?IM9a"),this.load.audio("player-dies-enemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20dies%20from%20enemy%20sfx-61hLKPCRlGrkam7zYIUuuWTwHFZXun.wav?d7C2"),this.load.audio("game-over","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/game%20over%20sfx-CcqXjJvB1fNTt9i31KIzjv0KLNN6CF.wav?OQAX"),this.load.audio("squish-caterpillar","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%201%20sfx-Q07M71fpvcarGwZ67kaOsiFBD8hQw9.wav?eCQ1"),this.load.audio("squish-beetle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Rollz%20squish%20sfx-ENEJDyuGH2imVNsLezuv5w3TzofWsG.wav?caYG"),this.load.audio("squish-chomper","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%202-euwtmXFPsH1NH9XQzixjo6lgeA7Nxd.wav?6rLZ"),this.load.audio("squish-snail","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%203-22EnbLa2GEVZPJCf7zWpqhYHS6V4K2.wav?h9e6"),this.load.audio("squish-jumper","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%201%20sfx-MBkO4SrZ1IVUJ6jqjHWa5L0NURtkJH.wav?qytP"),this.load.audio("squish-stalker","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%203-22EnbLa2GEVZPJCf7zWpqhYHS6V4K2.wav?h9e6"),this.load.audio("squish-baseblu","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blu%20squish%20sound-E5dxYXO43VnhG528IWOuy39JyeqnOf.wav?2NUq"),this.load.audio("squish-rex","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20squish%20sound-ZUynOxrurJ001uUoNvxJPYAg8dlChO.wav?FwYW"),this.load.image("floor-tile-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt"),this.load.image("floor-tile-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%202-EuITFMsdSDebMUmfcikeKCDLqDupml.png?C2mi"),this.load.image("floor-tile-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%203-EBjnmTXXufdUFEuzmfnGnaZX4zdI2C.png?69bT"),this.load.image("floor-tile-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%204-ecTwalLp4rzl9hegwIwVMuDBeN1YVJ.png?nxJJ"),this.load.image("floor-tile-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%205-mkUa3smxguUC6BG0k4RBp1L7YemLPJ.png?8kU2"),this.load.image("floor-tile-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%206-P5Eo0dOoipZmfiQ31gzPPNV178XDQz.png?K1oC"),this.load.image("floor-tile-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%207-nTcRVMkcmKM9dgxMMr6Fzs7Enekla1.png?cfe2"),this.load.image("floor-tile-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%208-ImcB9SO68kMOGAn6qXP0aioPKPbNxx.png?znlI"),this.load.image("floor-tile-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%209-VmOFC6UshXy3GJTAyKE5zi7p1oIyAJ.png?oTOf"),this.load.image("floor-tile-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2010-SX5i2rG63ddgysEAxLTRNQvfngiFaS.png?2Bsf"),this.load.image("floor-tile-11","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2011-JwdJf9Mmt0lEbFBGGwurBaYJL3uykp.png?w4JY"),this.load.image("floor-tile-12","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2012-yBmCpaIQiiV7MeRoxI54ACeE3W2f27.png?9jIm"),this.assetPool.loadAllAssets().then(()=>{this.registry.set("assetsReady",!0)}).catch(i=>{console.error("Asset loading failed:",i),this.registry.set("assetsReady",!0)})}init(e){this.reopenMenuAfterInit=e?.reopenMenu||!1,this.gameStats=this.game.registry.get("gameStats"),this.gameStats||(console.log("\u{1F3AE} Initializing fresh gameStats tracking (from 2nd init)"),this.gameStats={treasureChestsOpened:0,enemyKills:{caterpillar:0,rollz:0,chomper:0,snail:0,bouncer:0,stalker:0,rex:0,blu:0},totalEnemiesDefeated:0,highestFloor:0,livesLost:0},this.game.registry.set("gameStats",this.gameStats));let t=this.game.registry.get("isDeathRetry")||!1,i=this.game.registry.get("playerLives")||0,s=this.game.registry.get("isReplay")||!1,a=s||t&&i>0;this.showLoadingScreen=!a,console.log(`\u{1F3AC} Loading screen decision (2nd init): isReplay=${s}, isDeathRetry=${t}, skip=${a}, SHOW=${this.showLoadingScreen}`),this.cameras.main.setBackgroundColor("#1a0033")}create(){if(console.log("\u{1F3AE} GameScene.create() started at",performance.now()),console.log("\u{1F4CA} showLoadingScreen flag:",this.showLoadingScreen),this.showLoadingScreen){console.log("\u{1F3A8} Creating loading screen elements...");let e=this.cameras.main.width,t=this.cameras.main.height;if(console.log(`\u{1F4D0} Screen dimensions: ${e}x${t}`),this.loadingOverlay=this.add.container(0,0),this.loadingOverlay.setDepth(1e4),console.log("\u{1F4E6} Loading container created"),this.textures.exists("instructionsBg")){console.log("\u{1F3A8} Using instructions background image");let u=this.add.image(e/2,t/2,"instructionsBg"),m=e/u.width,y=t/u.height,f=Math.max(m,y);u.setScale(f),this.loadingOverlay.add(u);let g=this.add.rectangle(e/2,t/2,e,t,0,.5);this.loadingOverlay.add(g),console.log("\u{1F5BC}\uFE0F Instructions background added with overlay")}else{console.log("\u26A0\uFE0F Instructions background not found, using solid color");let u=this.add.rectangle(e/2,t/2,e,t,5046398,1);this.loadingOverlay.add(u),console.log("\u{1F7EA} Purple background added")}let i=this.add.text(e/2,t/2-60,"GOING BIZARRE",{fontFamily:'"Press Start 2P", system-ui',fontSize:"28px",color:"#FF69B4",align:"center"});i.setOrigin(.5),i.setShadow(2,2,"#8B008B",4,!1,!0),this.loadingOverlay.add(i),console.log("\u{1F497} GOING BIZARRE text added");let s=e*.6,a=24,o=e/2,n=t/2+10;console.log(`\u{1F4CA} Progress bar dimensions: ${s}x${a} at (${o}, ${n})`);let l=this.add.rectangle(o,n,s,a,4915330);l.setStrokeStyle(3,16738740),this.loadingOverlay.add(l),console.log("\u{1F4CA} Progress bar background added");let c=this.add.rectangle(o-s/2+2,n,0,a-6,16738740);c.setOrigin(0,.5),this.loadingOverlay.add(c),console.log("\u{1F4CA} Progress bar fill added (starting at 0 width)");let h=this.add.text(e/2,t/2+50,"0%",{fontFamily:'"Press Start 2P", system-ui',fontSize:"16px",color:"#FF69B4",align:"center"});h.setOrigin(.5),this.loadingOverlay.add(h),console.log("\u{1F4AF} Percentage text added");let d=0;console.log("\u23F1\uFE0F Starting progress animation");let b=this.time.addEvent({delay:30,callback:()=>{if(d<100){d=Math.min(d+2,100);let u=Math.floor(d);c.width=(s-6)*(d/100),h.setText(`${u}%`),u%20===0&&u>0&&console.log(`\u{1F4C8} Progress: ${u}%`),d>=100&&(console.log("\u2705 Progress complete, removing overlay in 200ms"),this.time.delayedCall(200,()=>{this.loadingOverlay&&(console.log("\u{1F5D1}\uFE0F Destroying loading overlay"),this.loadingOverlay.destroy(),this.loadingOverlay=null),console.log("\u2B1B Setting black background for game"),this.cameras.main.setBackgroundColor("#000000"),this.checkForChapterSplash()}))}},repeat:-1});console.log("\u{1F4CA} Progress timer started")}else this.cameras.main.setBackgroundColor("#000000"),this.checkForChapterSplash();console.log("\u{1F3A8} Scene initialized")}checkForChapterSplash(){this.game.registry.get("isReplay")&&this.game.registry.set("isReplay",!1);let e=[1,11,21,31,41,51],t=this.game.registry.get("currentLevel")||1;console.log(`\u{1F4CA} Current level: ${t}`);let i=this.game.registry.get("showChapterSplash")===!0,s=this.game.registry.get("chapterSplashLevel")||t;if(i){console.log(`\u{1F3AF} Showing chapter splash after bonus for level ${s}`),this.game.registry.set("showChapterSplash",!1),this.game.registry.remove("chapterSplashLevel");let l=`chapterSplashShown_${s}`;this.game.registry.set(l,!0),this.showChapterSplashScreen(s,()=>{console.log("\u2705 Splash complete after bonus, initializing game"),this.initializeGameState(),this.game.registry.set("levelProgression",!0),this.initializeGameAfterSplash()});return}let a=`chapterSplashShown_${t}`,o=this.game.registry.get(a)===!0,n=this.game.registry.has("playerLives")&&this.game.registry.get("playerLives")>0;if(e.includes(t)&&!o&&!n){console.log(`\u{1F3AC} Chapter splash needed for level ${t} (first time)`),this.game.registry.set(a,!0),this.showChapterSplashScreen(t,()=>{console.log("\u2705 Splash complete, initializing game"),this.initializeGameState(),this.game.registry.set("levelProgression",!0),this.initializeGameAfterSplash()});return}console.log("\u23E9 No splash needed, initializing game immediately"),this.initializeGameState(),this.initializeGameAfterSplash()}getChapterSplashUrl(e){return{1:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Crystal%20Cavern%20Chapter%20marker-xVVl4RJLl7pqY1teeQdZ9YR8qRbIbf.png",11:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Volcanic%20Crystal%20Cavern%20Chapter%20marker-DrODhcdT2pkFF5SP0zLVzzpmHeZwBl.png",21:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Steampunk%20Crystal%20Cavern%20Chapter%20marker-Oerxv49ruukEeuSe6Dz9Epj2apX18R.png",31:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Electrified%20Crystal%20Cavern%20Chapter%20marker-GstidG6WUl0ZXoFwC2l5HOqWCrXgaA.png",41:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Galatic%20Crystal%20Cavern%20Chapter%20marker-HTsVFy9CSXYas98BckhvpCBkEV4AwP.png",51:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Beast%20Mode%20splash%20page-hnSUzR7voB81jfSXp0WpSwdDWEm4LD.png"}[e]||""}showPreloadChapterScreen(){}showChapterSplashScreen(e,t){console.log(`\u{1F5BC}\uFE0F Creating splash screen for level ${e} at`,performance.now()),this.instantLoadingScreen&&(this.instantLoadingScreen.destroy(),this.instantLoadingScreen=void 0),this.preloadChapterText&&(this.preloadChapterText.destroy(),this.preloadChapterText=void 0),this.preloadLoadingText&&(this.preloadLoadingText.destroy(),this.preloadLoadingText=void 0);let i=`chapter-${e}`;if(this.textures.exists(i))this.displayChapterSplash(e,t);else{console.log(`\u{1F4E5} Loading chapter splash on-demand: ${i}`);let s=this.getChapterSplashUrl(e);if(!s){console.warn(`\u26A0\uFE0F No splash URL found for level ${e}`),t();return}this.load.image(i,s),this.load.once("complete",()=>{console.log(`\u2705 Splash loaded: ${i}`),this.displayChapterSplash(e,t)}),this.load.start()}}displayChapterSplash(e,t){let i=`chapter-${e}`,s=this.add.image(this.cameras.main.width/2,0,i);console.log(`\u{1F4F7} Splash image created: ${i}`);let a=this.cameras.main.width/s.width,o=this.cameras.main.height/s.height,n=Math.max(a,o);s.setScale(n),s.setOrigin(.5,0),s.setDepth(10001),s.setScrollFactor(0),s.alpha=1,console.log(`\u{1F4D0} Image scaled: ${n.toFixed(2)}x, showing immediately`),console.log("\u23F1\uFE0F Starting 2 second timer"),this.time.delayedCall(2e3,()=>{console.log("\u23F0 Timer complete, starting fade out");let l=this.add.graphics();l.fillStyle(0,0),l.fillRect(0,0,this.cameras.main.width,this.cameras.main.height),l.setDepth(10002),l.setScrollFactor(0),this.tweens.add({targets:s,alpha:0,duration:500,ease:"Power2"}),this.tweens.add({targets:l,alpha:1,duration:400,ease:"Power2.easeInOut",onComplete:()=>{console.log("\u{1F5D1}\uFE0F Destroying splash elements"),s.destroy(),this.tweens.add({targets:l,alpha:0,duration:300,delay:100,ease:"Power2.easeOut",onComplete:()=>{l.destroy(),t()}})}})})}initializeGameState(){this.levelManager||(this.levelManager=new oe);let e=this.game.registry.get("currentLevel")||1;this.levelManager.setCurrentLevel(e),this.isGameOver=!1,this.isLevelComplete=!1,this.currentFloor=0,this.highestFloorGenerated=5;let t=this.game.registry;t.has("lives")&&(console.warn("\u26A0\uFE0F Cleaning up old 'lives' registry key"),t.remove("lives")),t.has("levelProgression")&&t.get("levelProgression")===!0?(this.accumulatedScore=t.get("accumulatedScore")||0,this.score=0,this.lives=t.get("playerLives")||3,(this.lives<0||this.lives>this.MAX_LIVES)&&(console.error(`\u{1F534} Invalid lives count detected: ${this.lives}, resetting to 3`),this.lives=3,t.set("playerLives",this.lives)),this.totalCoinsCollected=t.get("totalCoins"),this.totalGemsCollected=t.get("totalGems")||0,this.totalBlueGemsCollected=t.get("totalBlueGems")||0,this.totalDiamondsCollected=t.get("totalDiamonds")||0,this.livesEarned=t.get("livesEarned")||0,console.log(`\u{1F3AE} Level progression - Lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`)):t.has("playerLives")&&t.get("playerLives")>0?(this.lives=t.get("playerLives"),(this.lives<0||this.lives>this.MAX_LIVES)&&(console.error(`\u{1F534} Invalid lives count detected: ${this.lives}, resetting to 3`),this.lives=3,t.set("playerLives",this.lives)),this.accumulatedScore=t.get("accumulatedScore")||0,this.score=0,this.totalCoinsCollected=t.get("totalCoins"),this.totalGemsCollected=t.get("totalGems")||0,this.totalBlueGemsCollected=t.get("totalBlueGems")||0,this.totalDiamondsCollected=t.get("totalDiamonds")||0,this.livesEarned=t.get("livesEarned")||0,console.log(`\u{1F3AE} Death restart - Lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`)):(this.lives=3,this.score=0,this.accumulatedScore=0,this.totalCoinsCollected=0,this.totalGemsCollected=0,this.totalBlueGemsCollected=0,this.totalDiamondsCollected=0,this.livesEarned=0,console.log(`\u{1F3AE} New game started - Lives: ${this.lives}`),t.set("playerLives",this.lives),t.set("totalCoins",0),t.set("totalGems",0),t.set("totalBlueGems",0),t.set("totalDiamonds",0),t.set("livesEarned",0),t.set("accumulatedScore",0),t.set("currentScore",0),t.set("accumulatedDiamonds",0),[1,11,21,31,41,51].forEach(a=>{t.remove(`chapterSplashShown_${a}`)})),this.gemsCollectedThisLevel=0,this.blueGemsCollectedThisLevel=0,this.diamondsCollectedThisLevel=0,this.accumulatedDiamonds=t.get("accumulatedDiamonds")||0}async initializeGameAfterSplash(){this.backgroundManager=new le(this);let e=this.levelManager?.getCurrentLevel()||1,t=this.levelManager?.isBonusLevel()||!1,i=this.backgroundManager.getChapterForLevel(e,t);i!=="crystal_cavern"&&await this.backgroundManager.loadChapterBackgrounds(i),this.currentBackground=this.backgroundManager.getBackgroundForLevel(e,t);let s=this.add.image(0,0,this.currentBackground);s.setOrigin(0,0),s.setDepth(-100),s.setScrollFactor(.05);let a=this.cameras.main.width,o=this.cameras.main.height,n=a/s.width,l=o/s.height,c=Math.max(n,l)*1.2;s.setScale(c);let h=(o-s.height*c)/2;s.setPosition((a-s.width*c)/2,h),this.backgroundSprite=s,this.backgroundInitialY=h,this.backgroundHeight=s.height*c,this.input.addPointer(2),this.recentTiles=[],this.tileGrid.clear(),this.tileUsageCount=new Array(12).fill(0),this.platforms=this.physics.add.staticGroup(),this.ladders=this.physics.add.staticGroup(),this.spikes=this.physics.add.staticGroup(),this.cats=this.physics.add.group({classType:G,runChildUpdate:!0}),this.stalkerCats=this.physics.add.group({classType:G,runChildUpdate:!0}),this.baseBlus=this.physics.add.group({classType:J,runChildUpdate:!0}),this.beetles=this.physics.add.group({classType:_,runChildUpdate:!0}),this.rexEnemies=this.physics.add.group({classType:V,runChildUpdate:!0}),this.coins=[],this.blueCoins=[],this.diamonds=[],this.treasureChests=[],this.crystalBalls=[],this.freeLifs=[],this.invincibilityPendants=[],this.levelHasCrystalBall=!1,this.createTestLevel();let d=p.game.tileSize,b=3.5*d,y=p.canvas.height-d/2-d/2-32;this.player=new Z(this,100,p.canvas.height+100);let f=this.game.registry,g=f.has("playerLives"),v=f.get("levelProgression");!g||f.get("playerLives")===3||v?(this.player.body.enable=!1,this.startLevelIntro(b,y)):(this.player.setPosition(b,y),this.player.body.enable=!0,this.isLevelStarting=!1,this.changePlayerTexture("playerIdleEye1"),this.showStartBanner()),this.createCats(),this.createCeilingSpikes(),this.createAllCollectibles(),this.createLevelEndDoor(),this.physics.add.collider(this.player,this.platforms,void 0,this.shouldCollideWithPlatform,this),this.physics.add.collider(this.cats,this.platforms),this.physics.add.collider(this.beetles,this.platforms),this.physics.add.collider(this.rexEnemies,this.platforms),this.physics.add.collider(this.cats,this.spikes,void 0,(R,A)=>A.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.beetles,this.spikes,void 0,(R,A)=>A.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.rexEnemies,this.spikes,void 0,(R,A)=>A.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.stalkerCats,this.platforms),this.physics.add.collider(this.stalkerCats,this.spikes,void 0,(R,A)=>A.getData("isFloorSpike")===!0,this),this.physics.add.overlap(this.cats,this.cats,(R,A)=>this.handleEnemyOverlap(R,A),void 0,this),this.physics.add.overlap(this.beetles,this.beetles,(R,A)=>this.handleEnemyOverlap(R,A),void 0,this),this.physics.add.overlap(this.cats,this.beetles,(R,A)=>this.handleEnemyOverlap(R,A),void 0,this),this.physics.add.overlap(this.rexEnemies,this.rexEnemies,(R,A)=>this.handleEnemyOverlap(R,A),void 0,this),this.physics.add.collider(this.cats,this.cats,this.handleCatCatCollision,(R,A)=>{let H=R,K=A,Pe=H.getCatColor()==="green"||H.getCatColor()==="yellow",we=K.getCatColor()==="green"||K.getCatColor()==="yellow";return!(Pe||we)},this),this.physics.add.overlap(this.player,this.cats,this.handlePlayerCatInteraction,void 0,this),this.physics.add.overlap(this.player,this.stalkerCats,this.handlePlayerStalkerCatInteraction,void 0,this),this.physics.add.overlap(this.player,this.beetles,this.handlePlayerBeetleInteraction,void 0,this),this.physics.add.overlap(this.player,this.rexEnemies,this.handlePlayerRexInteraction,void 0,this),this.physics.add.collider(this.baseBlus,this.platforms),this.physics.add.collider(this.baseBlus,this.spikes,void 0,(R,A)=>A.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.player,this.baseBlus,this.handlePlayerBaseBluInteraction,void 0,this),this.playerSpikeOverlap=this.physics.add.overlap(this.player,this.spikes,this.handlePlayerSpikeCollision,void 0,this),this.physics.add.collider(this.player,this.spikes,void 0,(R,A)=>{let H=A,Pe=R.body;return H.getData("isFloorSpike")?Pe.velocity.y<0:!1},this),this.physics.add.overlap(this.player,this.ladders,this.handleLadderOverlap,void 0,this);let C=p.game.floorWidth*p.game.tileSize;this.physics.world.setBounds(0,-1e4,C,2e4),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.followOffset.set(0,100),this.createVisibilitySystem();let T=this.cameras.main.width,P=this.add.image(T/2,92,"hud-bg-200");P.setDisplaySize((T-16)*1.6,96*1.6),P.setOrigin(.5,.5),P.setDepth(98),P.setScrollFactor(0);let k=this.add.graphics();k.fillStyle(16777215),k.fillRoundedRect(8,40,T-16,96,12),k.setScrollFactor(0);let B=k.createGeometryMask();P.setMask(B);let M=this.add.graphics();M.lineStyle(2,8069026,1),M.strokeRoundedRect(8,40,T-16,96,12),M.setDepth(99),M.setScrollFactor(0),this.livesIcon=this.add.image(30,65,"heart-crystal"),this.livesIcon.setDisplaySize(16,16),this.livesIcon.setDepth(100),this.livesIcon.setScrollFactor(0),this.livesText=this.add.text(45,65,"x3",{fontSize:"14px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.livesText.setScrollFactor(0),this.comboText=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"",{fontSize:"13px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(200).setVisible(!1),this.comboText.setScrollFactor(0);let L=this.add.image(30,88,"crystal-hud-icon");L.setDisplaySize(16,16),L.setDepth(100),L.setScrollFactor(0),this.coinCounterText=this.add.text(45,88,"0/150",{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.coinCounterText.setScrollFactor(0);let E=this.add.image(30,111,"door-hud-icon");E.setDisplaySize(16,16),E.setDepth(100),E.setScrollFactor(0);let O=this.levelManager.getCurrentLevel(),D=this.levelManager.isBonusLevel()?"BONUS":O>=51?`${O}`:`${O}`;this.levelText=this.add.text(45,111,D,{fontSize:"14px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.levelText.setScrollFactor(0),this.scoreText=this.add.text(T/2,55,"0",{fontSize:"19px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5,0).setDepth(100),this.scoreText.setScrollFactor(0),this.comboText.setScrollFactor(0);let F=105,U=45,z=U*3,q=T/2-z/2;this.invincibilityTimerImage=this.add.image(q,F,"invincibility-timer"),this.invincibilityTimerImage.setDisplaySize(36,36),this.invincibilityTimerImage.setDepth(101),this.invincibilityTimerImage.setScrollFactor(0),this.invincibilityTimerImage.setVisible(!0),this.invincibilityTimerMask=this.add.graphics(),this.invincibilityTimerMask.setDepth(102),this.invincibilityTimerMask.setScrollFactor(0);let j=this.textures.exists("crystalBallTimer")?"crystalBallTimer":"invincibility-timer";this.crystalBallTimerImage=this.add.image(q+U,F,j),this.crystalBallTimerImage.setDisplaySize(36,36),this.crystalBallTimerImage.setDepth(101),this.crystalBallTimerImage.setScrollFactor(0),this.crystalBallTimerImage.setVisible(!0),this.crystalBallTimerMask=this.add.graphics(),this.crystalBallTimerMask.setDepth(102),this.crystalBallTimerMask.setScrollFactor(0);let Ce=this.textures.exists("cursedOrbTimer")?"cursedOrbTimer":"invincibility-timer";this.cursedOrbTimerImage=this.add.image(q+U*2,F,Ce),this.cursedOrbTimerImage.setDisplaySize(36,36),this.cursedOrbTimerImage.setDepth(101),this.cursedOrbTimerImage.setScrollFactor(0),this.cursedOrbTimerImage.setVisible(!0),this.cursedOrbTimerMask=this.add.graphics(),this.cursedOrbTimerMask.setDepth(102),this.cursedOrbTimerMask.setScrollFactor(0);let ke=this.textures.exists("cursedTealOrbTimer")?"cursedTealOrbTimer":"invincibility-timer";this.cursedTealOrbTimerImage=this.add.image(q+U*3,F,ke),this.cursedTealOrbTimerImage.setDisplaySize(36,36),this.cursedTealOrbTimerImage.setDepth(101),this.cursedTealOrbTimerImage.setScrollFactor(0),this.cursedTealOrbTimerImage.setVisible(!0),this.cursedTealOrbTimerMask=this.add.graphics(),this.cursedTealOrbTimerMask.setDepth(102),this.cursedTealOrbTimerMask.setScrollFactor(0),this.hamburgerMenuButton=this.add.text(T-30,78,"\u2630",{fontSize:"42px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(1,.5).setDepth(100),this.hamburgerMenuButton.setScrollFactor(0),this.updateLivesDisplay(),this.updateCoinCounterDisplay(),this.updateScoreDisplay(),this.touchControls=new ye(this),this.player.setTouchControls(this.touchControls),this.input.keyboard.enabled=!0,this.touchControls.enable(),p.debug&&this.input.keyboard.on("keydown-T",()=>{console.log("\u{1F9EA} Switching to TestScene..."),this.scene.start("TestScene")}),this.menuOverlay=new Se(this),this.reopenMenuAfterInit&&this.time.delayedCall(100,()=>{this.menuOverlay.open(),this.reopenMenuAfterInit=!1});let N=25,ce=this.hamburgerMenuButton.getBounds();this.hamburgerMenuButton.setInteractive(new Phaser.Geom.Rectangle(-N,-N,ce.width+N*2,ce.height+N*2),Phaser.Geom.Rectangle.Contains),this.hamburgerMenuButton.input.hitArea.setPosition(-N/2,-N/2),this.hamburgerMenuButton.off("pointerdown"),this.hamburgerMenuButton.on("pointerdown",()=>{this.playSoundEffect("menu-toggle",.4),this.menuOverlay.toggle()}),this.hamburgerMenuButton.on("pointerover",()=>{this.hamburgerMenuButton.setScale(1.1),this.hamburgerMenuButton.setColor("#b8e60a")}),this.hamburgerMenuButton.on("pointerout",()=>{this.hamburgerMenuButton.setScale(1),this.hamburgerMenuButton.setColor("#9acf07")});let he=this.input.keyboard?.addKey("ESC");if(he&&he.on("down",()=>{this.menuOverlay.toggle()}),this.initializeBubbleSystem(),this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).isEndless&&this.showEndlessModePopup(),this.game.registry.get("backgroundMusicPlaying"))this.backgroundMusic=this.game.registry.get("backgroundMusicInstance");else{let R=this.registry.get("musicEnabled")!==!1;this.sound.context&&this.sound.context.state==="suspended"?(console.log("\u{1F50A} GameScene: Audio context suspended, attempting to resume..."),this.sound.context.resume().then(()=>{console.log("\u2705 GameScene: Audio context resumed, starting music"),this.startBackgroundMusic(R)}).catch(A=>{console.error("\u274C GameScene: Failed to resume audio context:",A),this.startBackgroundMusic(R)})):(console.log("\u{1F50A} GameScene: Audio context state:",this.sound.context?.state||"unknown"),this.startBackgroundMusic(R))}this.levelManager?.getCurrentLevel()>=51&&this.showBeastModeLoadingIndicator()}startBackgroundMusic(e){try{if(!this.cache.audio.exists("background-music")){console.error("\u274C Background music not loaded in cache!");return}this.backgroundMusic=this.sound.add("background-music",{loop:!0,volume:e?.3:0});let t=this.backgroundMusic.play();t&&typeof t.catch=="function"&&t.catch(i=>{console.error("\u274C Background music play() failed:",i)}),console.log("\u{1F3B5} GameScene: Background music started - actually playing:",this.backgroundMusic.isPlaying),setTimeout(()=>{console.log("\u{1F3B5} Music status after 100ms - playing:",this.backgroundMusic.isPlaying,"paused:",this.backgroundMusic.isPaused)},100),this.game.registry.set("backgroundMusicPlaying",!0),this.game.registry.set("backgroundMusicInstance",this.backgroundMusic)}catch(t){console.error("\u274C GameScene: Failed to play background music:",t)}}generateTileTextures(){let e=p.game.tileSize;for(let t=0;t<15;t++){let i=`platform-tile-${t}`;if(this.textures.exists(i))continue;let s=this.add.graphics();s.fillStyle(6965898,1),s.fillRect(0,0,e,e);let o=Math.random();if(o<.4?(s.fillStyle(9071274,.6),s.fillRect(Math.random()*12,Math.random()*12,8+Math.random()*8,8+Math.random()*8)):o<.6&&(s.fillStyle(11168410,.5),s.fillRect(Math.random()*12,Math.random()*12,6+Math.random()*10,6+Math.random()*10)),t<7){let n=[16738740,9662683,4251856,16766720,64154],l=n[t%n.length];s.lineStyle(2,l,.6);for(let c=0;c<3;c++){let h=6+c*8;s.lineBetween(2,h,e-2,h+Math.random()*4-2)}}if(t>=3&&t<=10){let n=[16716947,9662683,4251856,16766720,64154],l=n[t%n.length];s.fillStyle(l,.8);let c=3+t%4;for(let h=0;h<c;h++){let d=4+Math.random()*(e-8),b=4+Math.random()*(e-8),u=1.5+Math.random()*.5;s.fillCircle(d,b,u),s.fillStyle(16777215,.9),s.fillCircle(d-.5,b-.5,.5),s.fillStyle(l,.8)}}if(t>=5&&t<=12){let n=[4251856,16738740,9662683,16766720],l=n[t%n.length],c=1+t%2;for(let h=0;h<c;h++){let d=6+Math.random()*(e-12),b=6+Math.random()*(e-12);s.fillStyle(l,.7);for(let u=0;u<4;u++){let m=(Math.random()-.5)*6,y=(Math.random()-.5)*6,f=.8+Math.random()*.7;s.fillCircle(d+m,b+y,f)}s.fillStyle(l,.9),s.fillCircle(d,b,1.2),s.fillStyle(16777215,.8),s.fillCircle(d-.3,b-.3,.4)}}if(t>=8){let n=[12216520,10233776,6765239,4251856,16738740],l=n[t%n.length],c=(Math.random()-.5)*(e-12);s.fillStyle(l,.7),s.fillRect(e/2-4+c,0,8,e),s.fillStyle(l,.9),s.fillRect(e/2-3+c,2,2,e-4),s.fillRect(e/2+1+c,2,2,e-4),s.fillStyle(16777215,.8),s.fillRect(e/2-2+c,4,1,e-8),s.fillRect(e/2+2+c,4,1,e-8)}if(t%2===0){let n=t%3,l=[9662683,4251856,16738740];s.fillStyle(l[n],.8);let c=5+Math.random()*(e-10),h=5+Math.random()*(e-10);for(let d=0;d<4;d++){let b=c+Math.random()*10-5,u=h+Math.random()*10-5,m=2+Math.random()*3;s.fillCircle(b,u,m),s.fillStyle(16777215,.9),s.fillCircle(b-m/2,u-m/2,m/3),s.fillStyle(l[n],.8)}}if(t%2===1&&t>7){let n=[4251856,16766720,16738740,9662683,64154],l=n[t%n.length],c=1+t%2;for(let h=0;h<c;h++){let d=8+Math.random()*(e-16),b=8+Math.random()*(e-16),u=2+Math.random()*2;s.fillStyle(l,.8),s.fillRect(d-u/2,b-u/4,u,u/2),s.fillRect(d-u/3,b-u/2,u*.66,u),s.fillStyle(l,.95),s.fillCircle(d,b,u*.3),s.fillStyle(16777215,.9),s.fillCircle(d-u*.2,b-u*.2,u*.2)}}if(t%3===0){s.lineStyle(1,2762018,.5);let n=Math.random()*e;s.lineBetween(n,0,n+(Math.random()-.5)*12,e)}s.generateTexture(i,e,e),s.destroy()}}createMiningThemeBackground(){let t=p.game.floorWidth*p.game.tileSize+1e3,i=p.canvas.height*10,s=-500,a=-5e3,o=this.add.graphics();for(let n=a;n<i;n+=20){let l=Math.max(0,Math.min(1,(n-a)/(i-a))),c=Math.floor(26*(1-l)+42*l),h=Math.floor(10*(1-l)+26*l),d=Math.floor(42*(1-l)+74*l),b=c<<16|h<<8|d;o.fillStyle(b,1),o.fillRect(s,n,t,20)}for(let n=-15;n<30;n++){let l=n*400+100;o.fillStyle(6332671,.15),o.fillRect(s,l,t,8);let c=Math.floor(t/120);for(let h=0;h<=c;h++){let d=s+t/c*h+(Math.random()-.5)*40,b=[16739251,7058431,11796331,16757611,11758591],u=b[Math.floor(Math.random()*b.length)];o.fillStyle(u,.2),o.fillTriangle(d,l,d-6,l+30,d+6,l+30),o.fillStyle(16777215,.15),o.fillTriangle(d,l,d-2,l+10,d+2,l+10)}}for(let n=0;n<Math.floor(t/150);n++){let l=s+Math.random()*t,c=a+Math.random()*(i-a),h=[16728193,4244735,6942894,16755520,12216520],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.2);let b=100+Math.random()*150,u=Math.random()*Math.PI/3-Math.PI/6;for(let m=0;m<b;m+=8){let y=l+Math.cos(u)*m,f=c+Math.sin(u)*m;o.fillCircle(y,f,3+Math.random()*4),Math.random()>.7&&(o.fillStyle(16777215,.3),o.fillCircle(y+Math.random()*4-2,f+Math.random()*4-2,1),o.fillStyle(d,.2))}}for(let n=0;n<Math.floor(t/100);n++){let l=s+Math.random()*t,c=a+Math.random()*(i-a),h=Math.random();if(h<.3){let d=[16717636,15277667,10233776,6765239,4149685,2201331,48340,38536,5025616,9159498,13491257,16771899,16761095,16750592,16733986],b=d[Math.floor(Math.random()*d.length)];o.fillStyle(b,.25),o.fillCircle(l,c,8+Math.random()*6),o.fillStyle(16777215,.3),o.fillCircle(l-2,c-2,2)}else h<.6?(o.fillStyle(12216520,.2),o.fillCircle(l,c,6+Math.random()*4),o.fillStyle(16777215,.25),o.fillCircle(l-1,c-1,1.5)):(o.fillStyle(5025616,.2),o.fillCircle(l,c,4+Math.random()*3),o.fillStyle(16777215,.3),o.fillCircle(l-1,c-1,1))}for(let n=0;n<Math.floor(t/200);n++){let l=s+Math.random()*t,c=a+Math.random()*(i-a),h=[4251856,16738740,10025880,16753920],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.1),o.fillRect(l-20,c-5,40+Math.random()*30,10+Math.random()*8),o.fillStyle(d,.3),o.fillRect(l-10,c-2,20,4)}for(let n=0;n<Math.floor(t/60);n++){let l=s+Math.random()*t,c=a+Math.random()*(i-a),h=[4251856,16716947,9662683,65407,16766720],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.08),o.fillCircle(l,c,15),o.fillStyle(d,.15),o.fillCircle(l,c,8),o.fillStyle(d,.3),o.fillCircle(l,c,4),o.fillStyle(16777215,.4),o.fillCircle(l,c,2)}o.lineStyle(3,4251856,.3);for(let n=a+100;n<i;n+=400){let l=n+Math.random()*100,c=Math.floor(t/100);for(let h=0;h<c;h++){let d=s+t/c*h,b=s+t/c*(h+1),u=Math.sin(h*.5)*20;o.lineStyle(2,4251856,.15),o.lineBetween(d,l+u,b,l+Math.sin((h+1)*.5)*20),Math.random()>.7&&(o.fillStyle(16777215,.2),o.fillCircle(d+Math.random()*(b-d),l+u,1))}}for(let n=0;n<Math.floor(t/80);n++){let l=s+Math.random()*t,c=a+Math.random()*(i-a),h=40+Math.random()*60,d=[10233776,6765239,4149685,48340,5025616],b=d[Math.floor(Math.random()*d.length)];o.fillStyle(5917290,.15),o.fillCircle(l,c,h),o.fillStyle(b,.2),o.fillCircle(l,c,h*.7),o.fillStyle(b,.35),o.fillCircle(l,c,h*.3),o.fillStyle(16777215,.3),o.fillCircle(l-h*.2,c-h*.2,h*.15)}o.setDepth(-10),o.setScrollFactor(.5)}createTestLevel(){let e=p.game.tileSize,t=p.game.floorWidth,i=e*5,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),a=s.isEndless?20:s.floorCount,o=s.isEndless?Math.max(a,Math.floor(p.canvas.height/i)):a,n=[],l=[];for(let h=0;h<o;h++){let d=p.canvas.height-e/2-h*i;if(h===0){for(let b=0;b<t;b++){let u=b*e+e/2;this.createPlatformTile(u,d,b===0,b===t-1)}n[h]=-1,l[h]={gapStart:-1,gapSize:0}}else if(!this.levelManager.isBonusLevel()&&Math.random()>.3){let u=Math.floor(Math.random()*(t-5))+2,m=Math.floor(Math.random()*2)+2;l[h]={gapStart:u,gapSize:m};for(let P=0;P<t;P++)(P<u||P>=u+m)&&this.createPlatformTile(P*e+e/2,d,P===0,P===t-1);this.levelManager.isBonusLevel()||this.createSpikesInGap(u,m,d,e);let y=u>3?Math.floor(Math.random()*(u-1))+1:-1,f=u+m<t-2?Math.floor(Math.random()*(t-u-m-2))+u+m+1:-1,g=t/3,v=h>1?n[h-1]:-1,S=Math.floor(Math.random()*3);if(v!==-1){let P=Math.floor(v/g),k=[0,1,2].filter(B=>B!==P);S=k[Math.floor(Math.random()*k.length)]}let x=Math.floor(S*g),C=Math.floor((S+1)*g),T=[];y!==-1&&y>=x&&y<C&&T.push(y),f!==-1&&f>=x&&f<C&&T.push(f),n[h]=T.length>0?T[Math.floor(Math.random()*T.length)]:f!==-1?f:y}else{l[h]={gapStart:-1,gapSize:0};for(let v=0;v<t;v++)this.createPlatformTile(v*e+e/2,d);let u=t/3,m=h>1?n[h-1]:-1,y=Math.floor(Math.random()*3);if(m!==-1){let v=Math.floor(m/u),S=[0,1,2].filter(x=>x!==v);y=S[Math.floor(Math.random()*S.length)]}let f=Math.max(2,Math.floor(y*u)),g=Math.min(t-2,Math.floor((y+1)*u));n[h]=Math.floor(Math.random()*(g-f))+f}}this.floorLayouts=l;let c=s.isEndless?-1:s.floorCount-1;for(let h=0;h<o-1;h++){if(!s.isEndless&&h+1>c)continue;let d=p.canvas.height-e-h*i,b=p.canvas.height-e-(h+1)*i,u=l[h],m=l[h+1],y=[];for(let f=1;f<t-1;f++){let g=this.hasPlatformAt(u,f),v=this.hasPlatformAt(m,f),S=this.hasDoorAt(f,h),x=this.hasDoorAt(f,h+1);g&&v&&!S&&!x&&y.push(f)}if(y.length>0){let f=[];if(h===0)if(y.length>=2){let g=y[Math.floor(Math.random()*y.length)];this.createContinuousLadder(g*e,d,b),f.push(g);let v=6,S=y.filter(x=>Math.abs(x-g)>=v);if(S.length>0){let x=S[Math.floor(Math.random()*S.length)];this.createContinuousLadder(x*e,d,b),f.push(x)}else{let x=0,C=-1;for(let T of y){let P=Math.abs(T-g);P>x&&T!==g&&(x=P,C=T)}C!==-1&&x>=3&&(this.createContinuousLadder(C*e,d,b),f.push(C))}}else{let g=y[0];this.createContinuousLadder(g*e,d,b),f.push(g)}else{let g=this.ladderPositions.get(h-1)||[],v=y.filter(C=>!g.some(T=>Math.abs(C-T)<3)),S=v.length>0?v:y,x=S[Math.floor(Math.random()*S.length)];this.createContinuousLadder(x*e,d,b),f.push(x)}this.storeLadderPositions(h,f)}}}storeLadderPositions(e,t){this.ladderPositions.set(e,t)}hasPlatformAt(e,t){return e.gapStart===-1?!0:t<e.gapStart||t>=e.gapStart+e.gapSize}selectSmartTileVariant(e,t){let i=p.game.tileSize,s=Math.floor(e/i),a=Math.floor(t/i),o=`${s},${a}`;if(this.tileGrid.has(o))return this.tileGrid.get(o);let n=[],l=[],c=[`${s-1},${a}`,`${s+1},${a}`,`${s},${a-1}`,`${s},${a+1}`,`${s-1},${a-1}`,`${s+1},${a-1}`,`${s-1},${a+1}`,`${s+1},${a+1}`];c.forEach(f=>{if(this.tileGrid.has(f)){let g=this.tileGrid.get(f);n.push(g.variant),l.push(g.flipX)}});let h=[[0,4,8],[1,5,9],[2,3,6,7,10,11]],d=f=>{for(let g of h)if(g.includes(f))return g;return null},b=[];for(let f=0;f<12;f++)for(let g of[!1,!0]){let v=100;c.slice(0,4).forEach(P=>{if(this.tileGrid.has(P)){let k=this.tileGrid.get(P);k.variant===f&&k.flipX===g?v-=80:k.variant===f&&(v-=40);let B=d(f),M=d(k.variant);B&&M&&B===M&&(v-=60)}}),c.slice(4).forEach(P=>{if(this.tileGrid.has(P)){let k=this.tileGrid.get(P);k.variant===f&&k.flipX===g?v-=30:k.variant===f&&(v-=15);let B=d(f),M=d(k.variant);B&&M&&B===M&&(v-=25)}});let C=Math.max(...this.tileUsageCount)||1,T=Math.max(0,C-this.tileUsageCount[f])*5;v+=T,this.recentTiles.includes(f)||(v+=20),v+=Math.random()*10,b.push({variant:f,flipX:g,score:v})}b.sort((f,g)=>g.score-f.score);let u=b.slice(0,Math.max(6,Math.floor(b.length*.25))),m=u[Math.floor(Math.random()*u.length)],y={variant:m.variant,flipX:m.flipX};return this.tileGrid.set(o,y),this.recentTiles.push(m.variant),this.tileUsageCount[m.variant]++,this.recentTiles.length>8&&this.recentTiles.shift(),y}createPlatformTile(e,t,i=!1,s=!1){let a=p.game.tileSize,o=this.selectSmartTileVariant(e,t),n=`floor-tile-${o.variant+1}`,l=this.add.sprite(e,t,n);l.setDisplaySize(32,32),l.setDepth(1),l.setFlipX(o.flipX);let c=this.add.sprite(e+3,t+3,n);c.setDisplaySize(32,32),c.setDepth(0),c.setTint(0),c.setAlpha(.3),c.setFlipX(o.flipX);let h=this.add.rectangle(e,t,a,a,0,0);h.setDepth(0),this.physics.add.existing(h,!0),this.platforms.add(h)}createContinuousLadder(e,t,i){let s=p.game.tileSize,o=t>=p.canvas.height-s*2?0:s*.25,n=s*.1,l=t-i+o+n,c=(t+o+i-n)/2,h=this.add.rectangle(e+s/2,c,s*.8,l,16777215,0);if(h.setDepth(10),this.ladders.add(h),this.textures.exists("tealLadder")){let d=e+s/2,b=t-i+s*.5,u=(t+i)/2+1,m=this.add.image(d+1,u,"tealLadder");m.setDisplaySize(m.width*(b/m.height),b),m.setDepth(11)}else{let d=this.add.graphics(),b=e+s/2,u=t-i+s*.5,m=(t+i)/2+1,y=m-u/2,f=m+u/2;d.fillStyle(4251856,1),d.fillRect(b-2,y,4,u),d.fillRect(b-13,y+4,26,4),d.fillRect(b-13,f-8,26,4);let g=Math.floor(u/32);for(let v=1;v<g;v++){let S=y+v*(u/(g+1));d.fillRect(b-13,S,26,3)}d.setDepth(11)}}createSpikesInGap(e,t,i,s){for(let a=e;a<e+t;a++){let o=a*s+s/2,n=i;this.createSpikeSprite(o,n,s)}}createSpikeSprite(e,t,i){let s=t+i/2-1+1,a=this.add.image(e+3,s+3,"pink-floor-spike-tile");a.setDisplaySize(i,i),a.setOrigin(.5,1),a.setDepth(11),a.setTint(0),a.setAlpha(.3);let o=this.add.image(e,s,"pink-floor-spike-tile");o.setDisplaySize(i,i),o.setOrigin(.5,1),o.setDepth(12);let n=i,l=t,c=this.add.rectangle(e,l,i*.9,n,0,0);c.setVisible(!1),c.setData("isFloorSpike",!0),c.setData("visualSpikeHeight",i),c.setData("visualSpikeBaseY",s),this.spikes.add(c)}createCeilingSpikes(){let e=p.game.tileSize,t=e*5,i=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(this.levelManager.isBonusLevel())return;let s=1;for(let a=s;a<this.floorLayouts.length-1;a++){let o=this.floorLayouts[a];if(Math.random()>.8)continue;let n=p.canvas.height-e/2-(a+1)*t+e,l=[],c=this.getLadderPositionsForFloor(a);for(let d=2;d<p.game.floorWidth-2;d++){if(o.gapStart!==-1&&d>=o.gapStart-2&&d<o.gapStart+o.gapSize+2)continue;let b=!1;for(let u of c)if(Math.abs(d-u)<2){b=!0;break}if(!b){if(a===this.floorLayouts.length-2){let u=Math.floor(p.game.floorWidth/2);if(Math.abs(d-u)<2)continue}l.push(d)}}let h=Math.floor(Math.random()*3)+1;for(let d=0;d<Math.min(h,l.length/3)&&l.length!==0;d++){let b=Math.floor(Math.random()*l.length),u=l[b],m=Math.floor(Math.random()*3)+1;for(let y=0;y<m;y++){let f=u+y;if(f>=p.game.floorWidth-2)break;let g=!1;for(let S of c)if(Math.abs(f-S)<2){g=!0;break}if(g)continue;let v=l.indexOf(f);v>-1&&l.splice(v,1),this.createCeilingSpikeGraphics(f*e+e/2,n,e)}}}}createCeilingSpikeGraphics(e,t,i){let s=i*.5+6,a=t-i/2+1,o=this.add.image(e,a,"yellow-ceiling-spike-tile");o.setDisplaySize(i,i),o.setOrigin(.5,0),o.setDepth(12);let n=this.add.rectangle(e,a+s/2,24,s,0,0);n.setVisible(!1),n.setData("isCeilingSpike",!0),n.setData("sprite",o),n.setData("x",e),n.setData("y",a),this.physics.add.existing(n,!0),this.spikes.add(n)}getLadderPositionsForFloor(e){let t=[],i=p.game.tileSize,s=i*5;return this.ladders.children.entries.forEach(a=>{let o=a,n=o.y+o.height/2,l=Math.floor((p.canvas.height-n)/s);if(l===e||l===e-1||l===e+1){let c=Math.floor(o.x/i);t.push(c)}}),t}createCats(){if(this.levelManager.isBonusLevel())return;let e=p.game.tileSize,t=e*5,i=p.game.floorWidth,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),a=s.isEndless?999:s.floorCount-1,o=s.isEndless?Math.min(20,this.floorLayouts.length-1):a-1,n=0;for(let l=2;l<=o&&l<this.floorLayouts.length;l++){let c=this.floorLayouts[l],b=p.canvas.height-e/2-l*t-e/2-15,u=I.selectEnemiesForFloor(this.levelManager.getCurrentLevel(),l);if(u.length===0)continue;let m=this.levelManager.getCurrentLevel(),y=this.calculateEnemyZones(i,m),f=this.ladderPositions.get(l)||[],g=[],v=[...y].sort(()=>Math.random()-.5),S=0,x=new Set;for(let C=0;C<u.length&&C<v.length;C++){let T=u[C],P=v[C],k,B,M;if(I.isBaseBluType(T)){if(u.filter(O=>I.isBaseBluType(O)).length===1){let O=Math.random()<.5;k=e*(O?1:i-1)}else k=e*(S===0?1:i-1),S++;B=e*.5,M=e*(i-.5)}else if(I.isStalkerType(T)){let E=P,O=f.some(D=>D>=P.start&&D<P.end),Y=g.some(D=>D>=P.start&&D<P.end);if(O||Y){let D=v.filter((F,U)=>{if(U<=C)return!1;let z=f.some(j=>j>=F.start&&j<F.end),q=g.some(j=>j>=F.start&&j<F.end);return!z&&!q});D.length>0&&(E=D[0])}k=e*(E.center+(Math.random()-.5)),B=e*.5,M=e*(i-.5)}else k=e*(P.center+(Math.random()-.5)*2),B=e*.5,M=e*(i-.5);let L=I.getSpeedMultiplier(this.levelManager.getCurrentLevel());if(I.isBaseBluType(T)){let E=new J(this,k,b);E.setPlatformBounds(B,M);let O=e*(i/2);k<O?E.setInitialDirection(1):E.setInitialDirection(-1),typeof E.setSpeedMultiplier=="function"&&E.setSpeedMultiplier(L),this.baseBlus.add(E),n++}else if(I.isBeetleType(T)){let E=new _(this,k,b,B,M);typeof E.setSpeedMultiplier=="function"&&E.setSpeedMultiplier(L),this.beetles.add(E),n++}else if(I.isRexType(T)){let E=new V(this,k,b,B,M);typeof E.setSpeedMultiplier=="function"&&E.setSpeedMultiplier(L),this.rexEnemies.add(E),n++}else if(I.isStalkerType(T)){let E=new G(this,k,b,e*.5,e*(i-.5),"red",!0);E.setPlayerReference(this.player),this.setSmartEnemyDirection(E,k,i*e,C,u.length),typeof E.setSpeedMultiplier=="function"&&E.setSpeedMultiplier(L),this.stalkerCats.add(E),n++}else{let E=I.getColorForEnemyType(T);T==="chomper"&&Math.random()<.5&&(E="purple");let O=new G(this,k,b,B,M,E);this.setSmartEnemyDirection(O,k,i*e,C,u.length),typeof O.setSpeedMultiplier=="function"&&O.setSpeedMultiplier(L),this.cats.add(O),n++}}}}getZoneSizeForLevel(e){return e<=10?6:e<=30?5:(e<=50,4)}calculateEnemyZones(e,t){let i=this.getZoneSizeForLevel(t),s=Math.floor(e/i),a=[];for(let o=0;o<s;o++)a.push({start:o*i,end:(o+1)*i,center:o*i+i/2});return a}calculateEnemyPositions(e,t,i,s){let a=[],n=i-3,l=Math.floor(this.currentFloorY/(s*5)),c=this.ladderPositions.get(l)||[];switch(t){case"spread":let d=Math.max(2.5,n/e);for(let v=0;v<e;v++){let S=1.5+d*(v+.5),x=Math.min(.5,(d-2.5)/2),C=(Math.random()-.5)*x,T=Math.max(1.5,Math.min(i-1.5,S+C)),P=6,k=Math.max(P,d*1.2),B=1.5+d*(v+.5),M=Math.max(.5,B-k/2),L=Math.min(i-.5,B+k/2);for(let E of c)E>=M&&E<=L&&(E-M<L-E?M=Math.min(L-P,E+2):L=Math.max(M+P,E-2));a.push({x:T,leftBound:M,rightBound:L})}break;case"cluster":let b=i/2,u=Math.min(2,n/4);for(let v=0;v<e;v++){let S=Math.PI*2*v/e,x=Math.random()*u,C=Math.max(1.5,Math.min(i-1.5,b+Math.cos(S)*x)),T=6,P=Math.max(.5,b-Math.max(u+2,T/2)),k=Math.min(i-.5,b+Math.max(u+2,T/2));for(let B of c)B>=P&&B<=k&&(B-P<k-B?P=Math.min(k-T,B+2):k=Math.max(P+T,B-2));a.push({x:C,leftBound:P,rightBound:k})}break;case"edges":let m=Math.ceil(e/2),y=Math.floor(e/2);for(let v=0;v<m;v++){let x=1.5+v*.8+Math.random()*1.5,C=.5,T=Math.min(i/2+1,i-.5),P=6;T-C<P&&(T=Math.min(C+P,i-.5));for(let k of c)k>=C&&k<=T&&(T=Math.max(C+P,k-2));a.push({x,leftBound:C,rightBound:T})}for(let v=0;v<y;v++){let S=v*.8,x=i-1.5-S-Math.random()*1.5,C=Math.max(i/2-1,.5),T=i-.5,P=6;T-C<P&&(C=Math.max(T-P,.5));for(let k of c)k>=C&&k<=T&&(C=Math.min(T-P,k+2));a.push({x,leftBound:C,rightBound:T})}break;case"random":default:let f=[],g=2.5;for(let v=0;v<e;v++){let S,x=0,C=20;do if(S=1.5+Math.random()*n,x++,x>=C){S=1.5+n/(e+1)*(v+1);break}while(f.some(E=>Math.abs(E-S)<g));f.push(S);let T=6,P=3.5,k=Math.random()*2,B=Math.max(T/2,P+k),M=Math.max(.5,S-B),L=Math.min(i-.5,S+B);if(L-M<T){let E=(M+L)/2;M=Math.max(.5,E-T/2),L=Math.min(i-.5,E+T/2)}for(let E=0;E<v;E++){let O=a[E],Y=f[E];S<Y&&L>O.leftBound?L=Math.min(L,O.leftBound-.5):S>Y&&M<O.rightBound&&(M=Math.max(M,O.rightBound+.5))}for(let E of c)E>=M&&E<=L&&(E-M<L-E?M=Math.min(L-6,E+2):L=Math.max(M+6,E-2));a.push({x:S,leftBound:M,rightBound:L})}break}return a}setSmartEnemyDirection(e,t,i,s,a){let o=i/2,n=Math.abs(t-o),l=t<i*.25||t>i*.75,c;a===1?c=.5:a===2?c=t<o?.7:.3:l?c=t<o?.75:.25:c=s%2===0?.3:.7,c+=(Math.random()-.5)*.3,c=Math.max(.1,Math.min(.9,c)),Math.random()<c&&typeof e.reverseDirection=="function"&&e.reverseDirection()}createTemporaryFloorGrid(){let e=p.game.tileSize,t=e*5,i=p.canvas.width,s=this.add.graphics();s.lineStyle(2,65280,.7),s.setDepth(100);for(let a=0;a<this.floorLayouts.length;a++){let n=p.canvas.height-e/2-a*t-e/2;s.moveTo(0,n),s.lineTo(i,n),this.add.text(10,n-20,`Floor ${a} (Top:${Math.round(n)})`,{fontSize:"12px",color:"#00ff00",backgroundColor:"#000000aa",padding:{x:4,y:2}}).setDepth(101)}s.strokePath()}createStalkerCats(){let e=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(!e.enemyTypes.includes("red"))return;let t=p.game.tileSize,i=t*5,s=p.game.floorWidth,a=e.isEndless?999:e.floorCount-1,o=e.isEndless?Math.min(25,this.floorLayouts.length-1):a-1;for(let n=2;n<=o&&n<this.floorLayouts.length;n++){let l=this.floorLayouts[n],d=p.canvas.height-t/2-n*i-t/2-15,b=n<20?1:2,u=Math.random()<.6?Math.floor(Math.random()*b)+1:0;if(u===0)continue;let m=[];if(l.gapStart===-1)for(let y=2;y<s-2;y++)m.push(y);else{for(let y=2;y<l.gapStart-1;y++)m.push(y);for(let y=l.gapStart+l.gapSize+1;y<s-2;y++)m.push(y)}for(let y=0;y<Math.min(u,m.length);y++){let f=Math.floor(Math.random()*m.length),g=m[f],v=g*t+t/2;m.splice(f,1);let S=t*.5,x=t*(s-.5);l.gapStart!==-1&&(g<l.gapStart?x=t*(l.gapStart-.5):S=t*(l.gapStart+l.gapSize+.5));let C=new G(this,v,d,S,x,"red",!0);C.setPlayerReference(this.player),this.stalkerCats.add(C)}}}handleCatCatCollision(e,t){let i=e,s=t,a=10;i.x<s.x?(i.setX(i.x-a),s.setX(s.x+a)):(s.setX(s.x-a),i.setX(i.x+a)),i.reverseDirection(),s.reverseDirection()}createAllCollectibles(){let e=p.game.tileSize,t=e*5,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).collectibleTypes;if(this.levelManager.isBonusLevel()){this.createBonusLevelChests();return}for(let a=0;a<this.floorLayouts.length;a++){let o=this.floorLayouts[a],l=p.canvas.height-e/2-a*t-e-8,c=[];for(let y=1;y<p.game.floorWidth-1;y++)this.hasPlatformAt(o,y)&&!this.hasLadderAt(y,a)&&!this.hasDoorAt(y,a)&&c.push(y);if(c.length===0)continue;let h=[];if(s.includes("coin")&&a>0){let y=Math.floor(Math.random()*3)+2;this.placeCollectiblesOfType(c,y,"coin",l,a,h)}s.includes("blueCoin")&&a>0&&Math.random()<.2&&this.placeCollectiblesOfType(c,1,"blueCoin",l,a,h),s.includes("diamond")&&a>1&&Math.random()<.08&&this.placeCollectiblesOfType(c,1,"diamond",l,a,h),s.includes("freeLife")&&a>2&&Math.random()<.03&&this.placeCollectiblesOfType(c,1,"freeLife",l,a,h);let d=Math.random();if(s.includes("invincibilityPendant")&&!(a===0)&&d<.03&&this.placeCollectiblesOfType(c,1,"invincibilityPendant",l,a,h),s.includes("treasureChest")&&a>=3){let y=this.levelManager.getCurrentLevel();this.shouldSpawnChestOnFloor(y,a)&&this.placeCollectiblesOfType(c,1,"treasureChest",l,a,h)}let m=this.levelManager.getCurrentLevel();m>=3&&!this.levelHasCrystalBall&&a>=2&&Math.random()<.3&&(console.log("\u{1F52E} TRYING to spawn Crystal Ball - Level:",m,"Floor:",a,"HasCrystalBall:",this.levelHasCrystalBall),this.placeCollectiblesOfType(c,1,"crystalBall",l,a,h),this.levelHasCrystalBall=!0,console.log("\u{1F52E} Crystal Ball spawn attempted, levelHasCrystalBall now:",this.levelHasCrystalBall)),m>=11&&!this.levelHasCursedOrb&&a>=2&&Math.random()<.2&&(this.placeCollectiblesOfType(c,1,"cursedOrb",l,a,h),this.levelHasCursedOrb=!0),m>=21&&!this.levelHasCursedTealOrb&&a>=2&&Math.random()<.15&&(this.placeCollectiblesOfType(c,1,"cursedTealOrb",l,a,h),this.levelHasCursedTealOrb=!0)}}placeCollectiblesOfType(e,t,i,s,a,o){let n=p.game.tileSize,l=i==="treasureChest"?e.filter(c=>this.isSafeForTreasureChest(c,a)):e.filter(c=>!this.hasLadderAt(c,a)&&!this.hasDoorAt(c,a));for(let c=0;c<Math.min(t,l.length);c++){let h=0,d=-1;for(;h<20&&d===-1;){let u=Math.floor(Math.random()*l.length),m=l[u];if(!this.isPositionOccupiedWithVariety(m,i,o)){d=m,o.push({x:d,type:i});for(let y=l.length-1;y>=0;y--)Math.abs(l[y]-d)<2&&l.splice(y,1)}h++}if(d===-1)break;let b=d*n+n/2;switch(i){case"coin":let u=new Q(this,b,s);this.coins.push(u),this.physics.add.overlap(this.player,u.sprite,()=>this.handleCoinCollection(u),void 0,this);break;case"blueCoin":let m=new ee(this,b,s);this.blueCoins.push(m),this.physics.add.overlap(this.player,m.sprite,()=>this.handleBlueCoinCollection(m),void 0,this);break;case"diamond":let y=new te(this,b,s);this.diamonds.push(y),this.physics.add.overlap(this.player,y.sprite,()=>this.handleDiamondCollection(y),void 0,this);break;case"freeLife":let f=new ie(this,b,s);this.freeLifes.push(f),this.physics.add.overlap(this.player,f.sprite,()=>this.handleFreeLifeCollection(f),void 0,this);break;case"invincibilityPendant":let g=new se(this,b,s);this.invincibilityPendants.push(g),this.physics.add.overlap(this.player,g.sprite,()=>{this.handleInvincibilityPendantCollection(g)},void 0,this);break;case"treasureChest":let v=new ae(this,b,s);this.treasureChests.push(v);break;case"crystalBall":console.log("\u{1F52E} SPAWNING Crystal Ball at",b,s,"floor:",a);let S=new be(this,b,s);this.crystalBalls.push(S),console.log("\u{1F52E} Crystal Ball created, total crystal balls:",this.crystalBalls.length),this.physics.add.overlap(this.player,S.sprite,()=>this.handleCrystalBallCollection(S),void 0,this);break;case"cursedOrb":let x=new re(this,b,s,"cursed");this.cursedOrbs.push(x),this.physics.add.overlap(this.player,x.sprite,()=>this.handleCursedOrbCollection(x),void 0,this);break;case"cursedTealOrb":let C=new re(this,b,s,"cursedTeal");this.cursedTealOrbs.push(C),this.physics.add.overlap(this.player,C.sprite,()=>this.handleCursedTealOrbCollection(C),void 0,this);break}}}hasLadderAt(e,t){return(this.ladderPositions.get(t)||[]).includes(e)}hasDoorAt(e,t){let i=this.doorPositions.get(t);return i===void 0?!1:Math.abs(e-i)<=2}createBonusLevelChests(){let e=p.game.tileSize,t=e*5,i=[2,3];for(let s=0;s<i.length;s++){let a=i[s];if(a>=this.floorLayouts.length)continue;let o=this.floorLayouts[a],l=p.canvas.height-e/2-a*t-e-8,c=[];for(let u=1;u<p.game.floorWidth-1;u++)this.hasPlatformAt(o,u)&&!this.hasLadderAt(u,a)&&!this.hasDoorAt(u,a)&&c.push(u);if(c.length===0)continue;let h=Math.floor(Math.random()*c.length),d=c[h]*e+e/2,b=new ae(this,d,l);this.treasureChests.push(b)}this.createBonusLevelCollectibles(),this.createBonusLevelFreeLife()}createBonusLevelCollectibles(){let e=p.game.tileSize,t=e*5;for(let i=1;i<this.floorLayouts.length-1;i++){let s=this.floorLayouts[i],o=p.canvas.height-e/2-i*t-e-8,n=[];for(let u=1;u<p.game.floorWidth-1;u++)this.hasPlatformAt(s,u)&&!this.hasLadderAt(u,i)&&!this.hasDoorAt(u,i)&&n.push(u);if(n.length===0)continue;let l=[...n].sort(()=>Math.random()-.5),c=0;if(l.length>0){let u=Math.min(Math.floor(l.length/3),l.length-1),m=l[u]*e+e/2,y=new te(this,m,o);this.diamonds.push(y),this.time.delayedCall(100,()=>{this.physics.add.overlap(this.player,y.sprite,()=>this.handleDiamondCollection(y),void 0,this)}),l.splice(u,1)}let h=Math.max(1,Math.floor(l.length/6));for(let u=0;u<5&&u<l.length;u++){let m=Math.min(u*h,l.length-1),y=l[m]*e+e/2,f=new ee(this,y,o);this.blueCoins.push(f),this.physics.add.overlap(this.player,f.sprite,()=>this.handleBlueCoinCollection(f),void 0,this),l.splice(m,1)}let d=0,b=2;for(let u=0;u<l.length;u++)if(d===0||u>=d+b){let m=l[u]*e+e/2,y=new Q(this,m,o);this.coins.push(y),this.physics.add.overlap(this.player,y.sprite,()=>this.handleCoinCollection(y),void 0,this),d=u}}}createBonusLevelFreeLife(){let e=p.game.tileSize,t=e*5,i=3;if(i<this.floorLayouts.length){let s=this.floorLayouts[i],o=p.canvas.height-e/2-i*t-e-8,n=[];for(let l=1;l<p.game.floorWidth-1;l++)this.hasPlatformAt(s,l)&&!this.hasLadderAt(l,i)&&!this.hasDoorAt(l,i)&&n.push(l);if(n.length>0){let l=Math.min(2,n.length-1),c=n[l]*e+e/2,h=new ie(this,c,o);this.freeLifes.push(h),this.time.delayedCall(100,()=>{this.physics.add.overlap(this.player,h.sprite,()=>{this.handleFreeLifeCollection(h)},void 0,this)})}}}createLevel10TestingCollectibles(){let e=p.game.tileSize,t=e*5,i=[];for(let s=1;s<this.floorLayouts.length-1;s++)i.push(s);for(let s of i){if(s>=this.floorLayouts.length)continue;let a=this.floorLayouts[s],n=p.canvas.height-e/2-s*t-e-8,l=[];for(let h=1;h<p.game.floorWidth-1;h++)this.hasPlatformAt(a,h)&&!this.hasLadderAt(h,s)&&!this.hasDoorAt(h,s)&&l.push(h);if(l.length===0)continue;let c=Math.min(3,l.length);for(let h=0;h<c;h++){let d=Math.floor(Math.random()*l.length),u=l.splice(d,1)[0]*e+e/2,m=new se(this,u,n);this.invincibilityPendants.push(m),this.physics.add.overlap(this.player,m.sprite,()=>this.handleInvincibilityPendantCollection(m),void 0,this)}}}shouldSpawnChestOnFloor(e,t){if(e<=4){let i=this.levelManager.getLevelConfig(e),s=Math.floor(i.floorCount/2);return t===s||t===s+1&&Math.random()<.5}else if(e<=6){let i=this.levelManager.getLevelConfig(e),s=Math.floor(i.floorCount/3),a=Math.floor(i.floorCount*2/3);return t===s||t===a}else return t%3===0||Math.random()<.35}isSafeForTreasureChest(e,t){let i=p.game.floorWidth,s=p.game.tileSize,o=Math.ceil((60+16)/s);if(e<o||e>=i-o)return!1;let n=this.floorLayouts[t];if(n&&n.gapStart!==-1){let b=n.gapStart+n.gapSize;if(e>=n.gapStart-o&&e<=b+o-1)return!1}let l=this.ladderPositions.get(t)||[],c=this.ladderPositions.get(t-1)||[],h=[...l,...c];for(let b of h)if(Math.abs(e-b)<=o)return!1;let d=this.doorPositions.get(t);return!(d!==void 0&&Math.abs(e-d)<=o+1)}isPositionOccupied(e,t,i){if(this.hasLadderAt(e,t))return!0;let s=this.doorPositions.get(t);if(s!==void 0&&Math.abs(e-s)<4)return!0;let a=this.ladderPositions.get(t)||[];for(let o of a)if(Math.abs(e-o)<2)return!0;return i.some(o=>Math.abs(o-e)<2)}isPositionOccupiedWithVariety(e,t,i){return i.some(o=>Math.abs(o.x-e)<2)?!0:i.some(o=>o.type===t&&Math.abs(o.x-e)<3)}handleCoinCollection(e){if(this.isLevelStarting||e.isCollected())return;this.score+=p.scoring.coinCollect,this.playSoundEffect("gem-collect",.5),this.totalCoinsCollected++,this.totalGemsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalGems",this.totalGemsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,p.scoring.coinCollect),this.triggerFarcadeHapticFeedback(),e.collect();let t=this.coins.indexOf(e);t>-1&&this.coins.splice(t,1)}handleBlueCoinCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=500;this.score+=t,this.playSoundEffect("big-blue-gem-collect",.5),this.totalCoinsCollected+=5,this.totalBlueGemsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalBlueGems",this.totalBlueGemsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),this.triggerFarcadeHapticFeedback(),e.collect();let i=this.blueCoins.indexOf(e);i>-1&&this.blueCoins.splice(i,1)}handleDiamondCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=1e3;this.score+=t,this.playSoundEffect("diamond-collect",.5),this.totalCoinsCollected+=10,this.totalDiamondsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalDiamonds",this.totalDiamondsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),this.triggerFarcadeHapticFeedback(),e.collect();let i=this.diamonds.indexOf(e);i>-1&&this.diamonds.splice(i,1)}handleFreeLifeCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=2e3;this.score+=t,this.playSoundEffect("heart-collect",.5),this.lives<this.MAX_LIVES&&(this.lives++,this.game.registry.set("playerLives",this.lives),console.log(`\u{1F49A} Free life collected! Lives: ${this.lives}`),this.showExtraLifePopup("Heart Crystal!")),this.updateScoreDisplay(),this.updateLivesDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),e.collect();let i=this.freeLifes.indexOf(e);i>-1&&this.freeLifes.splice(i,1)}handleInvincibilityPendantCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=300;this.score+=t,this.playSoundEffect("powerup-collect",.5),this.activateInvincibility(),this.updateScoreDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),e.collect();let i=this.invincibilityPendants.indexOf(e);i>-1&&this.invincibilityPendants.splice(i,1)}handleCrystalBallCollection(e){if(console.log("\u{1F52E} CRYSTAL BALL COLLISION DETECTED!"),this.isLevelStarting){console.log("\u274C Cannot collect - level is starting");return}if(e.isCollected()){console.log("\u274C Cannot collect - already collected");return}console.log("\u{1F52E} COLLECTING Crystal Ball - activating power-up!"),this.playSoundEffect("powerup-collect",.5),this.player.activateCrystalBall(),e.collect();let t=this.crystalBalls.indexOf(e);t>-1&&(this.crystalBalls.splice(t,1),console.log("\u{1F52E} Crystal Ball removed from array, remaining:",this.crystalBalls.length)),this.triggerFarcadeHapticFeedback()}handleCursedOrbCollection(e){if(console.log("\u{1F480} CURSED ORB COLLISION DETECTED!"),this.isLevelStarting){console.log("\u274C Cannot collect - level is starting");return}if(e.isCollected()){console.log("\u274C Cannot collect - already collected");return}this.playSoundEffect("cursed-orb-collect",.5),this.player.activateCursedOrb(),e.collect();let t=this.cursedOrbs.indexOf(e);t>-1&&this.cursedOrbs.splice(t,1),this.triggerFarcadeHapticFeedback()}handleCursedTealOrbCollection(e){if(console.log("\u{1F300} CURSED TEAL ORB COLLISION DETECTED!"),this.isLevelStarting){console.log("\u274C Cannot collect - level is starting");return}if(e.isCollected()){console.log("\u274C Cannot collect - already collected");return}this.playSoundEffect("cursed-orb-collect",.5),this.player.activateCursedTealOrb(),e.collect();let t=this.cursedTealOrbs.indexOf(e);t>-1&&this.cursedTealOrbs.splice(t,1),this.triggerFarcadeHapticFeedback()}activateDarknessEffect(){console.log("\u{1F480} Activating darkness effect!"),this.darknessOverlay?this.darknessOverlay.setVisible(!0):(this.darknessOverlay=this.add.image(p.canvas.width/2,p.canvas.height/2-50,"visibilityOverlay"),this.darknessOverlay.setScrollFactor(0),this.darknessOverlay.setDepth(150),this.darknessOverlay.setOrigin(.5,.5)),this.darknessOverlay.setAlpha(0),this.tweens.add({targets:this.darknessOverlay,alpha:1,duration:500,ease:"Power2.easeIn"})}deactivateDarknessEffect(){console.log("\u{1F480} Deactivating darkness effect!"),this.darknessOverlay&&this.tweens.add({targets:this.darknessOverlay,alpha:0,duration:500,ease:"Power2.easeOut",onComplete:()=>{this.darknessOverlay&&this.darknessOverlay.setVisible(!1)}})}createCrystalBallProjectile(e,t,i,s=0){console.log("Creating crystal ball projectile at",e,t,"direction:",i,"player velocity:",s),this.playSoundEffect("crystal-ball-throw",.5);let a=new me(this,e,t,i,s);this.crystalBallProjectiles.push(a),this.physics.add.overlap(a,this.cats,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(a,this.beetles,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(a,this.stalkerCats,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(a,this.baseBlus,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(a,this.rexEnemies,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.collider(a,this.platforms),this.physics.add.collider(a,this.spikes),console.log("Crystal ball projectile created, total projectiles:",this.crystalBallProjectiles.length)}updateCrystalBallProjectiles(e,t){for(let i=this.crystalBallProjectiles.length-1;i>=0;i--){let s=this.crystalBallProjectiles[i];!s||!s.scene?this.crystalBallProjectiles.splice(i,1):s.update(e,t)}}handleProjectileEnemyCollision(e,t){if(console.log("\u{1F4A5} Crystal Ball projectile hit enemy!"),this.playSoundEffect("crystal-ball-hit-enemy",.5),t){let a=this.getEnemyTypeName(t);this.gameStats&&a!=="unknown"&&a in this.gameStats.enemyKills?(this.gameStats.enemyKills[a]++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats),console.log(`\u2705 Crystal ball kill tracked: ${a} | Total ${a}: ${this.gameStats.enemyKills[a]} | Total enemies: ${this.gameStats.totalEnemiesDefeated}`)):console.error(`\u274C Crystal ball kill NOT tracked! Enemy type: ${a}`)}t&&t.body&&(t.body.enable=!1,this.createCrystalBallDefeatEffect(t.x,t.y),this.tweens.add({targets:t,scaleX:0,scaleY:0,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>{t.defeat?t.defeat():t.destroy&&t.destroy()}}));let i=t.getPointValue?t.getPointValue():100;this.score+=i,this.updateScoreDisplay(),this.showPointPopup(t.x,t.y-20,i),console.log("\u{1F4A5} Enemy defeated by crystal ball, awarded",i,"points"),e.hitEnemy();let s=this.crystalBallProjectiles.indexOf(e);s>-1&&(this.crystalBallProjectiles.splice(s,1),console.log("\u{1F4A5} Projectile removed, remaining:",this.crystalBallProjectiles.length)),this.triggerFarcadeHapticFeedback()}updateCrystalBallTimer(e,t){if(this.crystalBallTimerImage.setVisible(!0),console.log("Crystal ball timer update:",e,"ms remaining"),e>0){let i=e/t;if(this.crystalBallTimerMask.x=this.crystalBallTimerImage.x,this.crystalBallTimerMask.y=this.crystalBallTimerImage.y,this.crystalBallTimerMask.clear(),this.crystalBallTimerMask.fillStyle(4509863,.6),this.crystalBallTimerMask.beginPath(),this.crystalBallTimerMask.moveTo(0,0),this.crystalBallTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-i),!1),this.crystalBallTimerMask.lineTo(0,0),this.crystalBallTimerMask.closePath(),this.crystalBallTimerMask.fillPath(),e<=2e3){let s=Math.sin(Date.now()/100)*.5+.5;this.crystalBallTimerImage.setAlpha(.5+s*.5),console.log("Crystal ball timer WARNING - flashing")}else this.crystalBallTimerImage.setAlpha(1)}else this.crystalBallTimerMask.clear(),this.crystalBallTimerImage.setAlpha(1),console.log("Crystal ball timer - power-up expired, hiding timer")}updateCursedOrbTimer(e,t){if(e>0){this.cursedOrbTimerImage.setVisible(!0);let i=e/t;if(this.cursedOrbTimerMask.x=this.cursedOrbTimerImage.x,this.cursedOrbTimerMask.y=this.cursedOrbTimerImage.y,this.cursedOrbTimerMask.clear(),this.cursedOrbTimerMask.fillStyle(5768769,.7),this.cursedOrbTimerMask.beginPath(),this.cursedOrbTimerMask.moveTo(0,0),this.cursedOrbTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-i),!1),this.cursedOrbTimerMask.lineTo(0,0),this.cursedOrbTimerMask.closePath(),this.cursedOrbTimerMask.fillPath(),e<=2e3){let s=Math.sin(Date.now()/100)*.5+.5;this.cursedOrbTimerImage.setAlpha(.5+s*.5)}else this.cursedOrbTimerImage.setAlpha(1)}else this.cursedOrbTimerMask.clear(),this.cursedOrbTimerImage.setAlpha(1)}updateCursedTealOrbTimer(e,t){if(e>0){this.cursedTealOrbTimerImage.setVisible(!0);let i=e/t;if(this.cursedTealOrbTimerMask.x=this.cursedTealOrbTimerImage.x,this.cursedTealOrbTimerMask.y=this.cursedTealOrbTimerImage.y,this.cursedTealOrbTimerMask.clear(),this.cursedTealOrbTimerMask.fillStyle(4827036,.7),this.cursedTealOrbTimerMask.beginPath(),this.cursedTealOrbTimerMask.moveTo(0,0),this.cursedTealOrbTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-i),!1),this.cursedTealOrbTimerMask.lineTo(0,0),this.cursedTealOrbTimerMask.closePath(),this.cursedTealOrbTimerMask.fillPath(),e<=2e3){let s=Math.sin(Date.now()/100)*.5+.5;this.cursedTealOrbTimerImage.setAlpha(.5+s*.5)}else this.cursedTealOrbTimerImage.setAlpha(1)}else this.cursedTealOrbTimerMask.clear(),this.cursedTealOrbTimerImage.setAlpha(1)}activateInvincibility(){this.invincibilityTimer&&this.invincibilityTimer.destroy(),this.invincibilityActive=!0,this.invincibilityTimeRemaining=10,this.invincibilityWarningPlayed=!1,this.player.setSpeedMultiplier(1.5),this.invincibilityTimer=this.time.addEvent({delay:100,callback:()=>this.updateInvincibilityTimer(),loop:!0}),this.addPlayerGoldenAura(),this.startTimerSparkles(),this.enableSpikeWalking()}updateInvincibilityTimer(){if(this.invincibilityTimeRemaining-=.1,!this.invincibilityWarningPlayed&&this.invincibilityTimeRemaining<=2&&this.invincibilityTimeRemaining>0&&(this.invincibilityWarningPlayed=!0,console.log("\u23F0 Timer warning for invincibility")),this.invincibilityTimeRemaining<=0)this.invincibilityActive=!1,this.invincibilityTimeRemaining=0,this.invincibilityTimer&&(this.invincibilityTimer.destroy(),this.invincibilityTimer=null),this.invincibilityTimerMask.clear(),this.stopTimerSparkles(),this.removePlayerGoldenAura(),this.player.setSpeedMultiplier(1),this.disableSpikeWalking();else if(this.updateInvincibilityMask(),this.invincibilityTimeRemaining<=3){let e=Math.sin(this.invincibilityTimeRemaining*10)*.2+.8;this.invincibilityTimerImage.setAlpha(e)}}updateInvincibilityMask(){this.invincibilityTimerMask.x=this.invincibilityTimerImage.x,this.invincibilityTimerMask.y=this.invincibilityTimerImage.y;let e=this.invincibilityTimeRemaining/10;this.invincibilityTimerMask.clear(),this.invincibilityTimerMask.fillStyle(16766720,.6),this.invincibilityTimerMask.beginPath(),this.invincibilityTimerMask.moveTo(0,0),this.invincibilityTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-e),!1),this.invincibilityTimerMask.lineTo(0,0),this.invincibilityTimerMask.closePath(),this.invincibilityTimerMask.fillPath()}addPlayerGoldenAura(){this.playerGoldenAura||!this.player||(this.playerGoldenAura=this.add.circle(this.player.x,this.player.y,25,16766720),this.playerGoldenAura.setAlpha(.3),this.playerGoldenAura.setDepth(this.player.depth-1),this.tweens.add({targets:this.playerGoldenAura,scaleX:1.4,scaleY:1.4,alpha:.1,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createPlayerParticleTrail())}removePlayerGoldenAura(){this.playerGoldenAura&&(this.playerGoldenAura.destroy(),this.playerGoldenAura=null),this.playerParticleTrail.forEach(e=>e.destroy()),this.playerParticleTrail=[]}startTimerSparkles(){this.invincibilityTimerSparkleTimer&&this.invincibilityTimerSparkleTimer.destroy(),this.invincibilityTimerSparkleTimer=this.time.addEvent({delay:300+Math.random()*200,callback:()=>this.createTimerSparkle(),loop:!0})}stopTimerSparkles(){this.invincibilityTimerSparkleTimer&&(this.invincibilityTimerSparkleTimer.destroy(),this.invincibilityTimerSparkleTimer=null)}createTimerSparkle(){if(!this.invincibilityTimerImage||!this.invincibilityActive)return;let e=this.invincibilityTimerImage.x,t=this.invincibilityTimerImage.y,i=e+(Math.random()-.5)*50,s=t+(Math.random()-.5)*50,a=this.add.graphics();a.fillStyle(16766720,.9),a.beginPath();for(let n=0;n<8;n++){let l=n/8*Math.PI*2,c=n%2===0?3:1.5,h=Math.cos(l)*c,d=Math.sin(l)*c;n===0?a.moveTo(h,d):a.lineTo(h,d)}a.closePath(),a.fillPath();let o=this.add.container(i,s);o.add(a),o.setDepth(103),o.setScrollFactor(0),this.tweens.add({targets:o,scaleX:2,scaleY:2,alpha:0,rotation:Math.PI,duration:600,ease:"Power2",onComplete:()=>{o.destroy()}})}createPlayerParticleTrail(){for(let e=0;e<8;e++){let t=this.add.graphics();t.setDepth(this.player.depth+1),t.fillStyle(16766720,.8),t.fillCircle(0,0,2),this.playerParticleTrail.push(t),this.animateParticle(t,e)}}animateParticle(e,t){if(!this.player||!this.invincibilityActive){e.destroy();return}let i=Math.PI*2/8*t+this.time.now*.003,s=20+Math.sin(this.time.now*.005+t)*5;e.setPosition(this.player.x+Math.cos(i)*s,this.player.y+Math.sin(i)*s),this.invincibilityActive&&this.time.delayedCall(50,()=>this.animateParticle(e,t))}enableSpikeWalking(){this.playerSpikeOverlap&&(this.playerSpikeOverlap.active=!1),this.playerSpikeCollider=this.physics.add.collider(this.player,this.spikes,void 0,(e,t)=>t.getData("isFloorSpike"),this)}disableSpikeWalking(){this.playerSpikeCollider&&(this.physics.world.removeCollider(this.playerSpikeCollider),this.playerSpikeCollider=null),this.playerSpikeOverlap&&(this.playerSpikeOverlap.active=!0)}shouldCollideWithPlatform(){return!this.player.getIsClimbing()}handleEnemyOverlap(e,t){if(!e||!t||!e.body||!t.body)return;let i=e,s=t;if(i.isSquished||s.isSquished)return;let a=e.body,o=t.body,n=Date.now(),l=1e3,c=i.lastSeparation&&n-i.lastSeparation<l,h=s.lastSeparation&&n-s.lastSeparation<l;if(c||h)return;let d=Math.abs(a.center.x-o.center.x),b=(a.width+o.width)/2;if(d<b*.8){i.lastSeparation=n,s.lastSeparation=n;let u=a.center.x<o.center.x;i.direction!==void 0&&(i.direction=u?-1:1),s.direction!==void 0&&(s.direction=u?1:-1);let m=1.2;(e.constructor.name==="Cat"&&i.moveSpeed||e.constructor.name==="Beetle"&&i.moveSpeed||e.constructor.name==="Rex"&&i.moveSpeed)&&a.setVelocityX(i.moveSpeed*i.direction*m),(t.constructor.name==="Cat"&&s.moveSpeed||t.constructor.name==="Beetle"&&s.moveSpeed||t.constructor.name==="Rex"&&s.moveSpeed)&&o.setVelocityX(s.moveSpeed*s.direction*m),this.time.delayedCall(300,()=>{e&&e.body&&i.moveSpeed&&i.direction!==void 0&&e.body.setVelocityX(i.moveSpeed*i.direction),t&&t.body&&s.moveSpeed&&s.direction!==void 0&&t.body.setVelocityX(s.moveSpeed*s.direction)})}}handlePlayerCatInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t,a=i.body,o=s.body,n=a.velocity.y>0,l=a.bottom<=o.top+5;n&&l?(this.justKilledCat=!0,this.handleCatKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.justKilledCat||this.handlePlayerDamage(i,s)}handlePlayerBaseBluInteraction(e,t){if(this.isGameOver)return;let i=e,s=t,a=i.body,o=s.body;if(this.invincibilityActive&&s.canBeKilledByInvinciblePlayer()){let c=s.handleInvinciblePlayerKill();this.score+=c,this.updateScoreDisplay(),this.showPointPopup(s.x,s.y-20,c),this.gameStats&&(this.gameStats.enemyKills.blu++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats)),this.playSoundEffect("squish-baseblu",.5),a.setVelocityY(p.game.jumpVelocity*.5),this.baseBlus.remove(s);return}let n=a.velocity.y>0,l=a.bottom<=o.top+10;if(n&&l)s.handlePlayerBounce(),s.startStun(),a.setVelocityY(p.game.jumpVelocity*.7);else{s.startStun();let c=a.x<o.x?-1:1;a.setVelocityX(c*100)}}handlePlayerBeetleInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t,a=i.body,o=s.body,n=a.velocity.y>0,l=a.y+a.height/2,d=o.y+o.height/2-l>5||a.bottom<=o.top+12;if(n&&d){this.justKilledCat=!0,this.handleBeetleKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1});return}this.invincibilityActive?(this.justKilledCat=!0,this.handleBeetleKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.handlePlayerDamage(i,s)}handlePlayerStalkerCatInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t;if(!s.canDamagePlayer())return;let a=i.body,o=s.body,n=a.velocity.y>0,l=a.bottom<=o.top+5;n&&l?(this.justKilledCat=!0,this.handleStalkerCatKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.justKilledCat||this.handlePlayerDamage(i,s)}handlePlayerSpikeCollision(e,t){if(this.isGameOver||this.invincibilityActive)return;let i=e,s=i.body,a=t;if(a.getData("isCeilingSpike")){if(s.velocity.y<-50){let n=a.getData("graphics");n&&this.tweens.add({targets:n,x:n.x+2,duration:50,yoyo:!0,repeat:3,onComplete:()=>{n.x=a.getData("x")-p.game.tileSize/2}}),this.handlePlayerDamage(i)}}else if(a.getData("isFloorSpike")){let l=a.getData("visualSpikeHeight"),c=a.getData("visualSpikeBaseY");s.velocity.y>50&&this.handlePlayerDamage(i)}else s.velocity.y>50&&this.handlePlayerDamage(i)}handleCatKill(e,t){if(t.isSquished)return;let i=t.getCatColor();if(e.getIsClimbing()){let h;switch(i){case"yellow":h="caterpillar";break;case"blue_caterpillar":h="blue_caterpillar";break;case"blue":h="chomper";break;case"purple":h="chomper";break;case"red":h="snail";break;case"green":h="jumper";break;default:h="chomper";break}let d=I.getPointValue(h);this.score+=d,this.updateScoreDisplay();let b=this.getEnemyTypeName(t);this.gameStats&&b!=="unknown"&&b in this.gameStats.enemyKills&&(this.gameStats.enemyKills[b]++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats),console.log(`\u2705 Kill tracked (climbing): ${b} | Total ${b}: ${this.gameStats.enemyKills[b]} | Total enemies: ${this.gameStats.totalEnemiesDefeated}`)),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,d);return}let s;switch(i){case"yellow":s="caterpillar";break;case"blue_caterpillar":s="blue_caterpillar";break;case"blue":s="chomper";break;case"red":s="snail";break;case"green":s="jumper";break;default:s="chomper";break}let a=I.getPointValue(s),o=Math.max(1,this.comboCount),n=a*o;this.score+=n,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(p.game.jumpVelocity*.7);let l=this.getEnemyTypeName(t);this.gameStats&&l!=="unknown"&&l in this.gameStats.enemyKills?(this.gameStats.enemyKills[l]++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats),console.log(`\u2705 Kill tracked: ${l} | Total ${l}: ${this.gameStats.enemyKills[l]} | Total enemies: ${this.gameStats.totalEnemiesDefeated}`)):console.error(`\u274C Kill NOT tracked! Enemy type: ${l}`);let c="squish-chomper";switch(i){case"yellow":c="squish-caterpillar";break;case"blue_caterpillar":c="squish-baseblu";break;case"blue":case"purple":c="squish-chomper";break;case"red":c="squish-snail";break;case"green":c="squish-jumper";break}this.playSoundEffect(c,.5),t.squish(),this.showPointPopup(t.x,t.y-20,n)}handleBeetleKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){let o=I.getPointValue("beetle");this.score+=o,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,o);return}let i=I.getPointValue("beetle"),s=Math.max(1,this.comboCount),a=i*s;this.score+=a,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(p.game.jumpVelocity*.7),this.gameStats&&(this.gameStats.enemyKills.rollz++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats)),this.playSoundEffect("squish-beetle",.5),t.squish(),this.showPointPopup(t.x,t.y-20,a)}handlePlayerRexInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t,a=i.body,o=s.body,n=a.velocity.y>0,c=o.top-a.bottom>5||a.bottom<=o.top+12;if(n&&c){this.justKilledCat=!0,this.handleRexKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1});return}this.invincibilityActive?(this.justKilledCat=!0,this.handleRexKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.handlePlayerDamage(i,s)}handleRexKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){this.score+=500,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,500);return}let i=500,s=Math.max(1,this.comboCount),a=i*s;this.score+=a,this.updateScoreDisplay(),this.comboCount++,this.comboText&&(this.comboCount>1?(this.comboText.setText(`COMBO x${this.comboCount}`),this.comboText.setVisible(!0)):this.comboText.setVisible(!1)),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(this.COMBO_WINDOW,()=>{this.comboCount=0,this.comboText&&this.comboText.setVisible(!1)}),e.setVelocityY(p.game.jumpVelocity*.7),this.gameStats&&(this.gameStats.enemyKills.rex++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats)),this.playSoundEffect("squish-rex",.5),t.squish(),this.showPointPopup(t.x,t.y-20,a)}handleInvincibilityEnemyKill(e,t){if(t.isSquished)return;let i=200;if(t.constructor.name==="Beetle")i=75;else if(t.constructor.name==="Cat"){let n=t.getCatColor(),l;switch(n){case"yellow":l="caterpillar";break;case"blue_caterpillar":l="blue_caterpillar";break;case"blue":l="chomper";break;case"red":l=t.isStalker?"stalker":"snail";break;case"green":l="jumper";break;default:l="chomper";break}i=I.getPointValue(l)}let s=i*3;this.score+=s,this.updateScoreDisplay();let a=this.getEnemyTypeName(t);this.gameStats&&a!=="unknown"&&a in this.gameStats.enemyKills&&(this.gameStats.enemyKills[a]++,this.gameStats.totalEnemiesDefeated++,this.game.registry.set("gameStats",this.gameStats),console.log(`\u2705 Kill tracked (invincibility): ${a} | Total ${a}: ${this.gameStats.enemyKills[a]} | Total enemies: ${this.gameStats.totalEnemiesDefeated}`)),e.setVelocityY(p.game.jumpVelocity*.5);let o="squish-chomper";if(t.constructor.name==="Beetle")o="squish-beetle";else if(t.constructor.name==="Cat")switch(t.getCatColor()){case"yellow":o="squish-caterpillar";break;case"blue_caterpillar":o="squish-baseblu";break;case"blue":o="squish-chomper";break;case"red":o=t.isStalker?"squish-stalker":"squish-snail";break;case"green":o="squish-jumper";break}this.playSoundEffect(o,.5),t.squish(),this.showInvincibilityPointPopup(t.x,t.y-20,s)}handleStalkerCatKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){this.score+=200,this.updateScoreDisplay(),e.setVelocityY(p.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,200);return}let i=200,s=Math.max(1,this.comboCount),a=i*s;this.score+=a,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(p.game.jumpVelocity*.7),this.playSoundEffect("squish-stalker",.5),t.squish(),this.showPointPopup(t.x,t.y-20,a)}updateScoreDisplay(){let e=this.accumulatedScore+this.score;this.scoreText.setText(`${e}`)}updateDebugKillTracker(){if(this.debugKillTracker&&this.gameStats){let e=this.gameStats.enemyKills;this.debugKillTracker.setText(`DEBUG KILLS:
Cat: ${e.caterpillar}
Rollz: ${e.rollz}
Chomp: ${e.chomper}
Snail: ${e.snail}
Bounce: ${e.bouncer}
Stalk: ${e.stalker}
Rex: ${e.rex}
Blu: ${e.blu}
Total: ${this.gameStats.totalEnemiesDefeated}`),console.log("\u{1F4CA} Debug tracker updated:",this.gameStats.enemyKills)}else console.log("\u26A0\uFE0F Debug tracker not ready - gameStats:",this.gameStats)}updateComboDisplay(){this.comboCount>1&&(this.comboText.setText(`COMBO x${this.comboCount}!`),this.comboText.setVisible(!0),this.tweens.add({targets:this.comboText,scaleX:1.2,scaleY:1.2,duration:100,ease:"Power2",yoyo:!0}))}resetCombo(){this.comboCount=0,this.comboText.setVisible(!1),this.comboTimer&&(this.comboTimer.destroy(),this.comboTimer=null)}createVisibilitySystem(){this.visibilityMask=this.add.image(0,0,"visibilityOverlay"),this.visibilityMask.setDepth(98),this.visibilityMask.setOrigin(.5,.5)}updateVisibilitySystem(){if(!this.visibilityMask)return;let t=this.levelManager.getCurrentLevel()%10===9;this.visibilityMask.setVisible(t);let i=this.player.x,s=this.player.y,a=i,o=s-192;this.visibilityMask.setPosition(a,o)}showPointPopup(e,t,i){let s=this.add.text(e,t,`+${i}`,{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(150);this.tweens.add({targets:s,alpha:0,duration:1200,ease:"Power1.easeOut",onComplete:()=>{s.destroy()}})}createCrystalBallDefeatEffect(e,t){for(let i=0;i<6;i++){let s=this.add.graphics();s.fillStyle(4509863,1),s.fillCircle(0,0,2);let a=i/6*Math.PI*2;s.x=e,s.y=t,s.setDepth(25);let o=15+Math.random()*10;this.tweens.add({targets:s,x:e+Math.cos(a)*o,y:t+Math.sin(a)*o,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>s.destroy()})}}createPortalSuckAnimation(e,t,i){let s=this.add.graphics();s.setDepth(25);let a=3,o=[];for(let l=0;l<a;l++){let c=this.add.graphics();c.setDepth(24+l),o.push(c);let h=l*120*Math.PI/180;c.lineStyle(2,10053375,.8),this.tweens.add({targets:c,rotation:h+Math.PI*4,scaleX:{from:2,to:0},scaleY:{from:2,to:0},alpha:{from:.8,to:0},duration:800,ease:"Power2.easeIn",onUpdate:()=>{c.clear(),c.lineStyle(3,10053375,c.alpha);let d=[],b=3,u=15*c.scaleX;c.x=e,c.y=t;for(let m=0;m<b*Math.PI*2;m+=.1){let y=m/(b*Math.PI*2)*u,f=Math.cos(m+c.rotation)*y,g=Math.sin(m+c.rotation)*y;d.push({x:f,y:g})}if(d.length>1){c.beginPath(),c.moveTo(d[0].x,d[0].y);for(let m=1;m<d.length;m++)c.lineTo(d[m].x,d[m].y);c.strokePath()}},onComplete:()=>{c.destroy()}})}let n=this.add.graphics();n.setDepth(26),n.fillStyle(4509863,.6),n.fillCircle(e,t,5),this.tweens.add({targets:n,scaleX:{from:0,to:3,duration:400},scaleY:{from:0,to:3,duration:400},yoyo:!0,ease:"Power2.easeInOut",onComplete:()=>{n.destroy(),s.destroy(),i&&i()}})}showInvincibilityPointPopup(e,t,i){let s=this.add.text(e,t,`+${i}`,{fontSize:"18px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(150);this.tweens.add({targets:s,alpha:0,y:t-30,scaleX:1.5,scaleY:1.5,duration:1500,ease:"Power2.easeOut",onComplete:()=>{s.destroy()}})}handlePlayerDamage(e,t){if(this.isGameOver)return;if(this.invincibilityActive){t&&t.squish&&this.handleInvincibilityEnemyKill(e,t);return}this.playSoundEffect("player-dies-enemy",.5),this.resetCombo(),e.getCrystalBallActive&&e.getCrystalBallActive()&&(console.log("\u{1F52E} Player died - shutting off Crystal Ball power-up"),e.stopCrystalBallParticles&&e.stopCrystalBallParticles(),this.updateCrystalBallTimer(0,2e4));let i=this.lives;this.lives--,this.gameStats&&(this.gameStats.livesLost++,this.game.registry.set("gameStats",this.gameStats)),this.game.registry.set("playerLives",this.lives),this.updateLivesDisplay(),console.log(`\u{1F494} Player died! Lives: ${i} -> ${this.lives}`),this.triggerFarcadeHapticFeedback(),e.setVelocity(0,0),e.setTint(16711680),e.body.enable=!1,this.lives>0?this.showLostLifePopup():(this.isGameOver=!0,this.showGameOverScreen())}handleLadderOverlap(e,t){let i=e;if(i.checkLadderProximity(t)&&(i.getIsClimbing()||i.startClimbing(t)),i.getIsClimbing()){let s=t,a=s.y-s.height/2,o=s.y+s.height/2;(i.y<a-32||i.y>o+8)&&i.exitClimbing()}}updateTreasureChestInteraction(){for(let e=this.treasureChests.length-1;e>=0;e--){let t=this.treasureChests[e];if(!t.canInteract())continue;if(Phaser.Math.Distance.Between(this.player.x,this.player.y,t.sprite.x,t.sprite.y)<32&&this.player.body.blocked.down){this.openTreasureChest(t);break}}}updateDoorPrompt(){if(!this.door||!this.player||!this.player.body)return;let t=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).floorCount-1,s=this.player.body.blocked?.down||!1,o=Phaser.Math.Distance.Between(this.player.x,this.player.y,this.door.x,this.door.y)<80,n=this.currentFloor===t;o&&n&&s?(this.door.showPrompt(this.player),(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP).isDown||this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown||this.touchControls?.upPressed)&&!this.isLevelComplete&&this.completeLevel()):this.door.hidePrompt()}openTreasureChest(e){if(this.isLevelStarting)return;let t=e.open();this.playSoundEffect("treasure-chest-open",.5),this.gameStats&&(this.gameStats.treasureChestsOpened++,this.game.registry.set("gameStats",this.gameStats)),this.score+=2500,this.updateScoreDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-30,2500),this.triggerFarcadeHapticFeedback(),this.spawnTreasureChestContents(e.sprite.x,e.sprite.y,t),this.tweens.add({targets:e.sprite,alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{let i=this.treasureChests.indexOf(e);i>-1&&this.treasureChests.splice(i,1),e.destroy()}})}spawnTreasureChestContents(e,t,i){let s=[{x:e-60,y:t},{x:e+60,y:t},{x:e-45,y:t},{x:e+45,y:t},{x:e-30,y:t},{x:e+30,y:t},{x:e-15,y:t},{x:e+15,y:t},{x:e,y:t-30},{x:e,y:t+15}],a=0;for(let o=0;o<i.coins&&!(a>=s.length);o++){let n=s[a++],l=new Q(this,n.x,n.y);this.coins.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleCoinCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.3,scaleY:1.3,duration:300,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<i.blueCoins&&!(a>=s.length);o++){let n=s[a++],l=new ee(this,n.x,n.y);this.blueCoins.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleBlueCoinCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.4,scaleY:1.4,duration:400,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<i.diamonds&&!(a>=s.length);o++){let n=s[a++],l=new te(this,n.x,n.y);this.diamonds.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleDiamondCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.5,scaleY:1.5,duration:500,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<i.freeLifs&&!(a>=s.length);o++){let n=s[a++],l=new ie(this,n.x,n.y);this.freeLifes.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleFreeLifeCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.5,scaleY:1.5,duration:500,ease:"Back.easeOut",yoyo:!0})}}playSoundEffect(e,t=.5){if(this.registry.get("sfxEnabled")!==!1)if(this.sound.context&&this.sound.context.state==="suspended")console.log("\u{1F507} Audio context suspended, trying to resume for sound:",e),this.sound.context.resume().then(()=>{try{this.sound.play(e,{volume:t})}catch(s){console.warn("\u26A0\uFE0F Failed to play sound effect:",e,s)}}).catch(s=>{console.error("\u274C Failed to resume audio context for sound:",e,s)});else try{this.sound.play(e,{volume:t})}catch(s){console.warn("\u26A0\uFE0F Failed to play sound effect:",e,s)}}update(e,t){if(this.isGameOver||!this.touchControls||!this.player||!this.player.body||!this.cats||!this.stalkerCats||!this.baseBlus||!this.beetles||!this.ladders)return;this.updateBackgroundPosition(),this.touchControls.update(),this.updateTreasureChestInteraction(),this.updateDoorPrompt(),this.player.update(e,t),this.updateCrystalBallProjectiles(e,t),this.playerGoldenAura&&this.invincibilityActive&&this.playerGoldenAura.setPosition(this.player.x,this.player.y),this.updateVisibilitySystem(),this.cats&&this.cats.children&&(this.cats.children.entries.forEach(l=>{l.update(this.time.now,this.game.loop.delta)}),this.checkAndReplaceStuckChompers()),this.stalkerCats&&this.stalkerCats.children&&this.stalkerCats.children.entries.forEach(l=>{l.update(this.time.now,this.game.loop.delta)}),this.baseBlus&&this.baseBlus.children&&this.baseBlus.children.entries.forEach(l=>{l.update(this.time.now,this.game.loop.delta)}),this.beetles&&this.beetles.children&&this.beetles.children.entries.forEach(l=>{l.update(e,t)}),this.rexEnemies&&this.rexEnemies.children&&this.rexEnemies.children.entries.forEach(l=>{l.update(e,t)});let i=!1;this.ladders&&this.ladders.children&&this.ladders.children.entries.forEach(l=>{this.physics.world.overlap(this.player,l)&&(i=!0)}),i||this.player.clearNearbyLadder(),this.player.getIsClimbing()&&!i&&this.player.exitClimbing();let s=p.game.tileSize,a=s*5,o=Math.max(0,Math.floor((p.canvas.height-this.player.y-s/2)/a));o!==this.currentFloor&&(this.currentFloor=o,this.gameStats&&(this.gameStats.highestFloor=Math.max(this.gameStats.highestFloor||0,o),this.game.registry.set("gameStats",this.gameStats))),this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).isEndless&&this.currentFloor>=this.highestFloorGenerated-3&&this.generateNextFloors()}generateNextFloors(){let e=p.game.tileSize,t=p.game.floorWidth,i=e*5,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),a=s.isEndless?999:s.floorCount,o;s.isEndless?o=5:o=Math.min(5,Math.max(0,s.floorCount-1-this.highestFloorGenerated));for(let n=0;n<o;n++){let l=this.highestFloorGenerated+n+1,c=p.canvas.height-e/2-l*i,h=Math.random()>.3,d;if(h){let g=Math.floor(Math.random()*(t-5))+2,v=Math.floor(Math.random()*2)+2;d={gapStart:g,gapSize:v};for(let S=0;S<t;S++)(S<g||S>=g+v)&&this.createPlatformTile(S*e+e/2,c);this.levelManager.isBonusLevel()||this.createSpikesInGap(g,v,c,e)}else{d={gapStart:-1,gapSize:0};for(let g=0;g<t;g++)this.createPlatformTile(g*e+e/2,c)}this.floorLayouts[l]=d;let b=!s.isEndless&&l>=s.floorCount-1;if(l>0&&this.floorLayouts[l-1]&&!b){let g=this.floorLayouts[l-1],v=[];for(let S=1;S<t-1;S++)this.hasPlatformAt(g,S)&&this.hasPlatformAt(d,S)&&v.push(S);if(v.length>0){let S=v[Math.floor(Math.random()*v.length)],x=-(l-1)*i+p.canvas.height-e,C=-l*i+p.canvas.height-e;this.createContinuousLadder(S*e,x,C),this.storeLadderPositions(l-1,[S])}}let u=c-e-8,m=[];for(let g=1;g<t-1;g++)this.hasPlatformAt(d,g)&&m.push(g);if(m.length>0){let g=s.collectibleTypes,v=[];if(g.includes("coin")&&l>0){let S=Math.floor(Math.random()*3)+2;this.placeCollectiblesOfType(m,S,"coin",u,l,v)}if(g.includes("blueCoin")&&l>0&&Math.random()<.2&&this.placeCollectiblesOfType(m,1,"blueCoin",u,l,v),g.includes("diamond")&&l>1&&Math.random()<.08&&this.placeCollectiblesOfType(m,1,"diamond",u,l,v),g.includes("treasureChest")&&l>=3){let S=this.levelManager.getCurrentLevel();this.shouldSpawnChestOnFloor(S,l)&&this.placeCollectiblesOfType(m,1,"treasureChest",u,l,v)}}let y=s.enemyTypes,f=[];if(y.includes("blue")&&f.push("blue"),y.includes("yellow")&&f.push("yellow"),y.includes("green")&&f.push("green"),y.includes("red")&&f.push("red"),f.length>0&&l>1&&Math.random()>.5){let g=f[Math.floor(Math.random()*f.length)];if(d.gapStart===-1){let S=c-e/2-15,x=new G(this,t/2*e,S,e*1.5,e*(t-1.5),g);this.cats.add(x),enemiesCreated++}else if(d.gapStart>3){let S=c-e/2-15,x=new G(this,d.gapStart/2*e,S,e*.5,e*(d.gapStart-.5),g);x.getCatColor()==="green"&&(x.platformBounds={left:e*.5,right:e*(d.gapStart-.5)}),this.cats.add(x),enemiesCreated++}}}this.highestFloorGenerated+=o}waitForAssetsAndStartIntro(e,t){let i=()=>{let s=this.registry.get("assetsReady"),a=this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot"),o=this.textures.exists("playerRunLeftFoot")&&this.textures.exists("playerRunRightFoot");s&&a&&o?this.startLevelIntro(e,t):this.time.delayedCall(100,i)};i()}startLevelIntro(e,t){this.isLevelStarting=!0,console.log("\u{1F3AC} === LEVEL INTRO START ==="),console.log("Canvas dimensions:",p.canvas.width,"x",p.canvas.height),console.log("Target spawn position (sprite center):",e,t),console.log("Platform calculations:"),console.log("  - Platform center Y:",p.canvas.height-p.game.tileSize/2),console.log("  - Platform top Y:",p.canvas.height-p.game.tileSize),console.log("  - Player feet should be at Y:",t+32);let i=p.game.tileSize,s=i/2,a=p.canvas.height-i/2;console.log("Tile size:",i),console.log("Ladder X position:",s),console.log("Floor Y position:",a);let o=i*5,n=t,l=n+o,c=(n+l)/2+1;console.log("\u{1FA9C} LADDER CALCULATIONS:"),console.log("  - Ladder top:",n),console.log("  - Ladder bottom:",l),console.log("  - Ladder height:",o),console.log("  - Ladder center Y:",c),console.log("  - Player spawn floor Y:",t);let h;if(this.textures.exists("tealLadder"))h=this.add.image(s+1,c,"tealLadder"),h.setDisplaySize(h.width*(o/h.height),o),h.setDepth(5);else{h=this.add.graphics(),h.fillStyle(4251856,1),h.fillRect(s-2,n,4,o),h.fillRect(s-13,n,26,4),h.fillRect(s-13,l-4,26,4);let b=Math.floor(o/32);for(let u=1;u<b;u++){let m=n+u*(o/(b+1));h.fillRect(s-13,m,26,3)}h.setDepth(5)}let d=l-20;this.player.x=s,this.player.y=d,console.log("\u{1F464} PLAYER POSITIONING:"),console.log("  - Player start Y (bottom of ladder - 20):",d),console.log("  - Player start X:",s),console.log("  - Player needs to climb to Y:",t),console.log("  - Distance to climb:",t-d),console.log("  - Spawn floor visual Y:",t),console.log("  - Canvas height:",p.canvas.height),this.textures.exists("playerClimbLeftFoot")?this.player.setTexture("playerClimbLeftFoot"):this.player.setTexture("playerIdleEye1"),this.player.setDisplaySize(48,64),console.log("  - Player sprite size: 48x64"),console.log("  - Visual alignment check:"),console.log("    * Spawn floor is at Y:",t),console.log("    * Player bottom when standing:",t+32,"(half sprite height)"),console.log("    * Floor surface Y:",p.canvas.height-16),this.animatePlayerClimbing(s,t,()=>{this.animatePlayerBouncing(e,t,()=>{this.player.body.enable=!0,this.isLevelStarting=!1,this.game.registry.set("levelProgression",!1),this.tweens.add({targets:h,alpha:0,duration:500,onComplete:()=>{h.destroy()}}),this.showStartBanner()})})}animatePlayerClimbing(e,t,i){console.log("\u{1F9D7} === CLIMBING ANIMATION START ==="),console.log("  - Ladder X:",e),console.log("  - Target Y (spawn floor center):",t),console.log("  - Player current position:",this.player.x,this.player.y),console.log("  - Distance to climb:",t-this.player.y),console.log("  - Player should end with feet on floor at Y:",t+32);let s=this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot");console.log("  - Climb sprites available:",s),s||console.warn("\u26A0\uFE0F Climb sprites not loaded! Using fallback animation");let a=0,o=80,l=this.time.addEvent({delay:120,callback:()=>{this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot")&&(a%2===0?this.player.setTexture("playerClimbLeftFoot"):this.player.setTexture("playerClimbRightFoot"),this.player.setDisplaySize(48,64)),a++},loop:!0}),c=-1;this.tweens.add({targets:this.player,y:t,duration:2e3,ease:"Linear",onUpdate:h=>{let d=Math.floor(h.progress*10);d!==c&&(c=d,console.log(`  \u{1F9D7} Climbing: ${d*10}% - Player Y: ${this.player.y.toFixed(1)} (Target: ${t})`))},onComplete:()=>{console.log("\u{1F9D7} === CLIMBING COMPLETE ==="),console.log("  - Final player Y:",this.player.y),console.log("  - Target Y was:",t),console.log("  - Y difference:",Math.abs(this.player.y-t)),l.destroy(),i()}})}animatePlayerBouncing(e,t,i){console.log("\u{1F3C3} === BOUNCING ANIMATION START ==="),console.log("  - Target position:",e,t),console.log("  - Player current position:",this.player.x,this.player.y),console.log("  - Horizontal distance to move:",e-this.player.x),this.player.setFlipX(!1);let s=this.textures.exists("playerJumpRightFoot")?"playerJumpRightFoot":"playerIdleEye1";this.player.setTexture(s),console.log("  - Using jump texture:",s);let a=-1;this.tweens.add({targets:this.player,x:e,duration:800,ease:"Power2.easeOut",onUpdate:o=>{let n=Math.floor(o.progress*10);n!==a&&(a=n,console.log(`  \u{1F3C3} Bouncing: ${n*10}% - Player pos: (${this.player.x.toFixed(1)}, ${this.player.y.toFixed(1)})`))},onComplete:()=>{console.log("\u{1F3C3} === BOUNCING COMPLETE ==="),console.log("  - Final player position:",this.player.x,this.player.y),console.log("  - Target position was:",e,t),console.log("  - Position difference: X:",Math.abs(this.player.x-e),"Y:",Math.abs(this.player.y-t)),this.changePlayerTexture("playerIdleEye1"),this.time.delayedCall(300,()=>{console.log("\u{1F4AD} Triggering talking bubble"),this.player.onBubbleTrigger&&this.player.onBubbleTrigger()}),console.log("\u2705 === ENTIRE INTRO SEQUENCE COMPLETE ==="),console.log("  - Player final position:",this.player.x,this.player.y),console.log("  - Expected spawn position:",e,t),i()}}),this.tweens.add({targets:this.player,y:t-25,duration:200,ease:"Power2.easeOut",yoyo:!0,repeat:1,onComplete:()=>{this.player.y=t}})}showStartBanner(){let e=this.levelManager.getCurrentLevel(),t=this.levelManager.getLevelConfig(e),i=e%10===9,s=this.levelManager.isBonusLevel(),a=s?"BONUS LEVEL!":t.isEndless?"ENDLESS MODE!":`LEVEL ${e}`,o=this.add.text(p.canvas.width/2,p.canvas.height/2-(i&&!s?120:100),a,{fontSize:"28px",color:s?"#00ff00":"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0),n=null;i&&!t.isEndless&&!s&&(n=this.add.text(p.canvas.width/2,p.canvas.height/2-85,"DARK MODE!",{fontSize:"18px",color:"#9932cc",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0));let l=this.add.text(p.canvas.width/2,p.canvas.height/2-50,"GO!",{fontSize:"36px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0).setAlpha(0);this.time.delayedCall(500,()=>{this.tweens.add({targets:l,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{o.destroy(),l.destroy(),n&&n.destroy()}})})}showEndlessModePopup(){let e=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,350,200,2894892,.95).setDepth(250).setScrollFactor(0),t=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,354,204,16777215).setDepth(249).setScrollFactor(0);t.setStrokeStyle(3,16777215),t.setFillStyle();let i=this.add.text(p.canvas.width/2,p.canvas.height/2-50,"ENDLESS MODE UNLOCKED!",{fontSize:"24px",color:"#ff44ff",fontFamily:"Arial Black",fontStyle:"bold",align:"center"}).setOrigin(.5).setDepth(251).setScrollFactor(0),s=this.add.text(p.canvas.width/2,p.canvas.height/2+10,`No more levels!
Climb as high as you can!
Difficulty has plateaued.`,{fontSize:"16px",color:"#ffffff",fontFamily:"Arial",align:"center"}).setOrigin(.5).setDepth(251).setScrollFactor(0);this.time.delayedCall(3e3,()=>{e.destroy(),t.destroy(),i.destroy(),s.destroy()})}createLevelEndDoor(){let e=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(!e.isEndless&&e.floorCount>0){let t=p.game.tileSize,i=t*5,s=e.floorCount-1,a=p.canvas.height-t/2-s*i,o=this.findSafeDoorPosition(s),l=a-t/2-50,c=this.levelManager.getCurrentLevel()===1;this.door=new ge(this,o,l,c),this.storeDoorPosition(s,Math.floor(o/t)),this.physics.add.overlap(this.player,this.door,this.handleDoorOverlap,void 0,this)}}findSafeDoorPosition(e){let t=p.game.tileSize,i=p.game.floorWidth,s=this.floorLayouts[e],a=3,o=this.ladderPositions.get(e)||[],n=[];for(let c=2;c<i-2-a;c++){let h=!0;for(let d=0;d<a;d++)if(!this.hasPlatformAt(s,c+d)){h=!1;break}if(h){for(let d of o)if(Math.abs(c-d)<4){h=!1;break}}h&&n.push(c)}let l;if(n.length>0){let c=Math.floor(i/2);l=n.reduce((h,d)=>Math.abs(d-c)<Math.abs(h-c)?d:h)}else l=Math.floor(i/2)-Math.floor(a/2);return(l+a/2)*t}storeDoorPosition(e,t){this.doorPositions||(this.doorPositions=new Map),this.doorPositions.set(e,t)}handleDoorOverlap(e,t){let i=t,s=e,o=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).floorCount-1,l=s.body.blocked.down;this.currentFloor===o&&l?(i.showPrompt(s),(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP).isDown||this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown||this.touchControls?.upPressed)&&!this.isLevelComplete&&this.completeLevel()):i.hidePrompt()}completeLevel(){this.isLevelComplete||(this.isLevelComplete=!0,this.playSoundEffect("door-open",.5),this.player.body.enable=!1,this.showLevelCompleteScreen())}showLevelCompleteScreen(){let e=this.levelManager.getCurrentLevel();this.triggerFarcadeHapticFeedback();let t=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(299).setScrollFactor(0),i=this.add.graphics();i.fillStyle(4854924,1),i.lineStyle(2,8069026,1),i.fillRoundedRect(p.canvas.width/2-175,p.canvas.height/2-140,350,280,12),i.strokeRoundedRect(p.canvas.width/2-175,p.canvas.height/2-140,350,280,12),i.setDepth(300).setScrollFactor(0);let s=this.add.text(p.canvas.width/2,p.canvas.height/2-95,`LEVEL ${e}
COMPLETE!`,{fontSize:"22px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),a=this.add.text(p.canvas.width/2,p.canvas.height/2-10,`Score: ${this.accumulatedScore+this.score}
Floors Climbed: ${this.currentFloor}`,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),o=this.levelManager.shouldHaveBonusAfter(e),n=this.levelManager.isBonusLevel(),l="";if(o&&!n)l="Next: BONUS LEVEL!";else if(n)l=`Next: Level ${e+1}`;else{let b=e+1;l=this.levelManager.getLevelConfig(b).isEndless?"Next: BEAST MODE!":`Next: Level ${b}`}let c=this.add.text(p.canvas.width/2,p.canvas.height/2+50,l,{fontSize:"12px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),h=this.add.rectangle(p.canvas.width/2,p.canvas.height/2+100,150,40,2142890).setDepth(301).setScrollFactor(0);h.setInteractive({useHandCursor:!0}),h.setStrokeStyle(2,1608322);let d=this.add.text(p.canvas.width/2,p.canvas.height/2+100,"CONTINUE",{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(302).setScrollFactor(0);h.on("pointerdown",()=>{this.playSoundEffect("continue-button",.5);let b=this.game.registry;b.set("levelProgression",!0);let u=this.accumulatedScore+this.score;b.set("accumulatedScore",u),b.set("totalCoins",this.totalCoinsCollected),b.set("totalGems",this.totalGemsCollected),b.set("totalBlueGems",this.totalBlueGemsCollected),b.set("totalDiamonds",this.totalDiamondsCollected),b.set("livesEarned",this.livesEarned),b.set("accumulatedCoins",this.totalCoinsCollected),b.set("accumulatedGems",this.totalGemsCollected),b.set("accumulatedBlueGems",this.totalBlueGemsCollected),b.set("accumulatedDiamonds",this.totalDiamondsCollected);let m=this.levelManager.isBonusLevel(),y=this.levelManager.getCurrentLevel(),f=!m&&this.levelManager.shouldHaveBonusAfter(y),g=this.levelManager.nextLevel(),v=this.levelManager.isBonusLevel();if(console.log(`\u{1F4CA} Level transition: ${y} -> ${g} (Bonus: ${v})`),console.log(`\u{1F49A} Current lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`),b.set("currentLevel",g),this.backgroundManager.isChapterTransition(g,v)){let S=this.backgroundManager.getChapterForLevel(g,v);this.backgroundManager.loadChapterBackgrounds(S).then(()=>{let x=this.backgroundManager.getChapterForLevel(g-1,!1);this.backgroundManager.unloadChapterBackgrounds(x)})}g===51?this.showBeastModeNotification(()=>{b.set("isReplay",!0),this.scene.restart()}):m&&!v&&g>1?(console.log("\u{1F4CD} Transitioning from bonus to chapter, showing splash for level",g),b.set("showChapterSplash",!0),b.set("chapterSplashLevel",g),b.set("isReplay",!0),this.scene.restart()):(b.set("isReplay",!0),this.scene.restart())})}showChapterTransition(e,t){let i=this.backgroundManager.getChapterName(e),s=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(299).setScrollFactor(0),a=this.add.graphics();a.fillStyle(4854924,1),a.lineStyle(2,8069026,1),a.fillRoundedRect(p.canvas.width/2-150,p.canvas.height/2-60,300,120,12),a.strokeRoundedRect(p.canvas.width/2-150,p.canvas.height/2-60,300,120,12),a.setDepth(300).setScrollFactor(0);let o=this.add.text(p.canvas.width/2,p.canvas.height/2-20,"ENTERING",{fontSize:"14px",color:"#FFD700",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(301).setScrollFactor(0),n=this.add.text(p.canvas.width/2,p.canvas.height/2+10,i.toUpperCase(),{fontSize:"16px",color:"#9ACF07",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(301).setScrollFactor(0);s.setAlpha(0),a.setAlpha(0),o.setAlpha(0),n.setAlpha(0),this.tweens.add({targets:[s,a,o,n],alpha:1,duration:500,onComplete:()=>{this.time.delayedCall(1500,()=>{this.tweens.add({targets:[s,a,o,n],alpha:0,duration:500,onComplete:()=>{s.destroy(),a.destroy(),o.destroy(),n.destroy(),t()}})})}})}showBeastModeNotification(e){let t=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.8).setDepth(299).setScrollFactor(0),i=this.add.graphics();i.fillStyle(4854924,1),i.lineStyle(2,8069026,1),i.fillRoundedRect(p.canvas.width/2-200,p.canvas.height/2-100,400,200,12),i.strokeRoundedRect(p.canvas.width/2-200,p.canvas.height/2-100,400,200,12),i.setDepth(300).setScrollFactor(0);let s=this.add.text(p.canvas.width/2,p.canvas.height/2-40,"BEAST MODE",{fontSize:"24px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(301).setScrollFactor(0),a=this.add.text(p.canvas.width/2,p.canvas.height/2,"ACTIVATED",{fontSize:"16px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(301).setScrollFactor(0),o=this.add.text(p.canvas.width/2,p.canvas.height/2+30,"Infinite floors at maximum difficulty!",{fontSize:"10px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0);this.triggerFarcadeHapticFeedback(),this.tweens.add({targets:s,scaleX:1.1,scaleY:1.1,duration:500,yoyo:!0,repeat:-1,ease:"Power2"}),this.time.delayedCall(3e3,()=>{t.destroy(),i.destroy(),s.destroy(),a.destroy(),o.destroy(),e()})}updateCoinCounterDisplay(){let e=this.totalCoinsCollected%this.COINS_PER_EXTRA_LIFE;this.coinCounterText.setText(`${e}/${this.COINS_PER_EXTRA_LIFE}`)}updateLivesDisplay(){let e=this.lives,t=e>0?`x${e}`:"GAME OVER";this.livesText.setText(t),this.livesIcon&&this.livesIcon.setVisible(e>0)}showBeastModeLoadingIndicator(){this.beastModeLoadingText=this.add.text(this.cameras.main.width/2,100,"BEAST MODE: LOADING CHAOS... 0%",{fontSize:"16px",color:"#ff00ff",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:3}),this.beastModeLoadingText.setOrigin(.5),this.beastModeLoadingText.setScrollFactor(0),this.beastModeLoadingText.setDepth(200),this.beastModeLoadingTimer=this.time.addEvent({delay:500,repeat:-1,callback:()=>{if(this.backgroundManager&&this.beastModeLoadingText){let e=this.backgroundManager.getBeastModeLoadingProgress();this.backgroundManager.isBeastModeFullyLoaded()?(this.beastModeLoadingText.setText("BEAST MODE: FULLY LOADED!"),this.beastModeLoadingText.setColor("#00ff00"),this.time.delayedCall(2e3,()=>{this.beastModeLoadingText&&(this.beastModeLoadingText.destroy(),this.beastModeLoadingText=void 0),this.beastModeLoadingTimer&&(this.beastModeLoadingTimer.destroy(),this.beastModeLoadingTimer=void 0)})):this.beastModeLoadingText.setText(`BEAST MODE: LOADING CHAOS... ${e.percentage}%`)}}})}checkForExtraLife(){let e=Math.floor(this.totalCoinsCollected/this.COINS_PER_EXTRA_LIFE);if(e>this.livesEarned){let t=e-this.livesEarned;console.log(`\u{1F48E} Checking extra lives: ${t} new lives to award (${this.totalCoinsCollected} gems / ${this.COINS_PER_EXTRA_LIFE})`);for(let i=0;i<t;i++)if(this.lives<this.MAX_LIVES){let s=this.lives;this.lives++,this.livesEarned++,this.game.registry.set("playerLives",this.lives),this.game.registry.set("livesEarned",this.livesEarned),this.updateLivesDisplay(),console.log(`\u{1F49A} Extra life earned from gems! Lives: ${s} -> ${this.lives}`),this.playSoundEffect("heart-collect",.5),this.showExtraLifePopup("150 Gems!")}else this.livesEarned++,this.game.registry.set("livesEarned",this.livesEarned),console.log(`\u{1F49B} Extra life earned but at max (${this.MAX_LIVES})`)}}showExtraLifePopup(e=""){let t=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-50,"EXTRA LIFE!",{fontSize:"20px",color:"#00ff00",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:0,stroke:!1,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0),i=null;e&&(i=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-20,e,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:0,stroke:!1,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0));let s=i?[t,i]:[t];this.tweens.add({targets:s,y:"-=30",alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{t.destroy(),i&&i.destroy()}})}showLostLifePopup(){this.physics.pause(),this.touchControls.disable(),this.input.keyboard.enabled=!1;let e=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(199).setScrollFactor(0),t=280,i=180,s=this.cameras.main.width/2,a=this.cameras.main.height/2,o=this.add.graphics();o.fillStyle(4854924,1),o.lineStyle(2,8069026,1),o.fillRoundedRect(s-t/2,a-i/2,t,i,12),o.strokeRoundedRect(s-t/2,a-i/2,t,i,12),o.setDepth(200).setScrollFactor(0);let n=this.add.text(s,a-45,"LIFE LOST!",{fontSize:"22px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),l=this.add.text(s,a-10,`Lives Remaining: ${this.lives}`,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),c=this.add.rectangle(s,a+40,140,35,2142890).setDepth(201).setScrollFactor(0);c.setInteractive({useHandCursor:!0}),c.setStrokeStyle(2,1608322);let h=this.add.text(s,a+40,"CONTINUE",{fontSize:"12px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(202).setScrollFactor(0);c.on("pointerdown",()=>{this.playSoundEffect("continue-button",.5),this.game.registry.set("isDeathRetry",!0),this.scene.restart()}),c.on("pointerover",()=>{c.setFillStyle(6750054)}),c.on("pointerout",()=>{c.setFillStyle(4521796)})}showGameOverScreen(){this.playSoundEffect("game-over",.5),this.physics.pause(),this.touchControls.disable(),this.input.keyboard.enabled=!1;let e=this.accumulatedScore+this.score,t=this.add.rectangle(p.canvas.width/2,p.canvas.height/2,p.canvas.width,p.canvas.height,0,.7).setDepth(199).setScrollFactor(0),i=380,s=470,a=this.cameras.main.width/2,o=this.cameras.main.height/2,n=this.add.graphics();n.fillStyle(4854924,1),n.lineStyle(2,8069026,1),n.fillRoundedRect(a-i/2,o-s/2,i,s,12),n.strokeRoundedRect(a-i/2,o-s/2,i,s,12),n.setDepth(200).setScrollFactor(0);let l=this.add.text(a,o-190,"GAME OVER!",{fontSize:"24px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),c=this.add.text(a,o-155,`Score: ${this.accumulatedScore+this.score}`,{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),h=this.add.text(a,o-125,"\u{1F4CA} PERFORMANCE STATS",{fontSize:"12px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),d=this.add.text(a,o-100,`Level Reached: ${this.levelManager.getCurrentLevel()}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),b=this.add.text(a,o-80,`Gems Collected: ${this.totalGemsCollected+this.totalBlueGemsCollected+this.totalDiamondsCollected}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),u=this.add.text(a,o-60,`Treasure Chests: ${this.gameStats?.treasureChestsOpened||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),m=this.add.text(a,o-30,"\u2694\uFE0F ENEMIES DEFEATED",{fontSize:"12px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),y=o+15,f=this.add.text(a,y,`Caterpillar: ${this.gameStats?.enemyKills?.caterpillar||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),g=this.add.text(a,y+18,`Rollz: ${this.gameStats?.enemyKills?.rollz||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),v=this.add.text(a,y+36,`Chomper: ${this.gameStats?.enemyKills?.chomper||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),S=this.add.text(a,y+54,`Snail: ${this.gameStats?.enemyKills?.snail||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),x=this.add.text(a,y+72,`Bouncer: ${this.gameStats?.enemyKills?.bouncer||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),C=this.add.text(a,y+90,`Stalker: ${this.gameStats?.enemyKills?.stalker||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),T=this.add.text(a,y+108,`Rex: ${this.gameStats?.enemyKills?.rex||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),P=this.add.text(a,y+126,`Blu: ${this.gameStats?.enemyKills?.blu||0}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),k=this.add.text(a,y+148,`Total: ${this.gameStats?.totalEnemiesDefeated||0}`,{fontSize:"11px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),B=this.add.rectangle(a,o+195,150,40,2142890).setDepth(201).setScrollFactor(0);B.setInteractive({useHandCursor:!0}),B.setStrokeStyle(2,1608322);let M=this.add.text(a,o+195,"CONTINUE",{fontSize:"14px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(202).setScrollFactor(0);B.on("pointerdown",()=>{Ee(e),this.restartGame()}),B.on("pointerover",()=>{B.setFillStyle(2475971),M.setScale(1.1)}),B.on("pointerout",()=>{B.setFillStyle(2142890),M.setScale(1)}),this.input.keyboard.on("keydown-R",()=>{Ee(e),this.restartGame()})}changePlayerTexture(e){this.textures.exists(e)&&(this.player.setTexture(e),this.player.setDisplaySize(48,64))}initializeBubbleSystem(){this.createPlaceholderBubbles(),this.player.setBubbleTriggerCallback(()=>{this.showRandomBubble()}),this.player.setMovementStartCallback(()=>{this.hideBubble()})}createDebugGrid(){this.children.list.forEach(l=>{l.getData&&l.getData("debugGrid")&&l.destroy()});let e=this.add.graphics();e.setDepth(200),e.setScrollFactor(1),e.setData("debugGrid",!0);let t=this.player.x,i=this.player.y,s=20,a=200;e.lineStyle(1,16711680,.5);for(let l=t-a;l<=t+a;l+=s)e.lineBetween(l,i-a,l,i+a);for(let l=i-a;l<=i+a;l+=s)e.lineBetween(t-a,l,t+a,l);e.lineStyle(2,65280,.8),e.lineBetween(t,i-a,t,i+a),e.lineBetween(t-a,i,t+a,i);let o=40;for(let l=t-a;l<=t+a;l+=o)for(let c=i-a;c<=i+a;c+=o){let h=l-t,d=c-i;this.add.text(l,c,`${h},${d}`,{fontSize:"8px",color:"#ffffff",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:1,y:1}}).setOrigin(.5).setDepth(201).setScrollFactor(1).setData("debugGrid",!0)}let n=this.add.circle(t,i,3,16711680);n.setDepth(202).setScrollFactor(1),n.setData("debugGrid",!0),this.time.delayedCall(1e4,()=>{this.children.list.forEach(l=>{l.getData&&l.getData("debugGrid")&&l.destroy()})})}createPlaceholderBubbles(){}showRandomBubble(){this.speechBubble||this.thoughtBubble||this.showSpeechBubble()}showSpeechBubble(){let e=this.add.image(0,0,"talking-bubble");e.setDepth(150),e.setScrollFactor(1),e.x=this.player.x+20+e.width*.5,e.y=this.player.y+20-e.height*.5,this.speechBubble=e,this.player.notifyBubbleActive(!0),this.bubbleTimer=this.time.delayedCall(this.BUBBLE_DISPLAY_TIME,()=>{this.hideBubble()})}showThoughtBubble(){let e=this.add.image(0,0,"thoughtBubblePlaceholder");e.setDepth(150),e.setScrollFactor(1);let t=-105*(Math.PI/180),i=45,s=(Math.random()-.5)*8,a=(Math.random()-.5)*8;e.x=this.player.x+Math.cos(t)*i+s,e.y=this.player.y+Math.sin(t)*i+a,this.thoughtBubble=e,this.player.notifyBubbleActive(!0),this.bubbleTimer=this.time.delayedCall(this.BUBBLE_DISPLAY_TIME,()=>{this.hideBubble()})}hideBubble(){this.speechBubble&&(this.speechBubble.destroy(),this.speechBubble=null),this.thoughtBubble&&(this.thoughtBubble.destroy(),this.thoughtBubble=null),this.bubbleTimer&&(this.bubbleTimer.destroy(),this.bubbleTimer=null),this.player.notifyBubbleActive(!1)}updateBackgroundPosition(){if(!this.backgroundSprite)return;let t=this.cameras.main.scrollY*.05,i=this.backgroundInitialY-t,s=p.canvas.height,a=this.backgroundHeight,o=0,n=s-a;a>s?(i=Math.min(o,i),i=Math.max(n,i)):i=o,this.backgroundSprite.setY(i)}getEnemyTypeName(e){let t=e.constructor?.name||"Unknown";if(console.log(`\u{1F50D} Enemy type detection - Constructor: ${t}`),t==="Cat"||e instanceof G){let i=null;if(typeof e.getCatColor=="function")try{i=e.getCatColor()}catch(a){console.error("Error calling getCatColor:",a)}if(!i&&e.catColor!==void 0&&(i=e.catColor),!i&&e.color!==void 0&&(i=e.color),!i&&typeof e.getData=="function")try{i=e.getData("color")||e.getData("catColor")}catch(a){console.error("Error calling getData:",a)}let s=!1;if(typeof e.getIsStalker=="function")try{s=e.getIsStalker()}catch{s=!1}if(s||(s=e.isStalker===!0||e.getData?.("isStalker")===!0),console.log(`\u{1F3A8} Cat enemy - Color: ${i}, IsStalker: ${s}`),i){let a=String(i).toLowerCase();if(a.includes("yellow")||a==="blue_caterpillar"||a==="bluecaterpillar")return"caterpillar";if(a==="blue"||a==="purple")return"chomper";if(a==="red")return s?"stalker":"snail";if(a==="green")return"bouncer"}return console.warn(`\u26A0\uFE0F Could not determine Cat enemy type - Color: ${i}`),"unknown"}return t==="Beetle"||e instanceof _?(console.log("\u{1F41E} Identified as Beetle/Rollz"),"rollz"):t==="Rex"||e instanceof V?(console.log("\u{1F996} Identified as Rex"),"rex"):t==="BaseBlu"||e instanceof J?(console.log("\u{1F47B} Identified as BaseBlu"),"blu"):t==="StalkerCat"?(console.log("\u{1F441}\uFE0F Identified as StalkerCat"),"stalker"):(console.warn(`\u274C Unknown enemy type - Constructor: ${t}`),"unknown")}triggerFarcadeHapticFeedback(){try{"vibrate"in navigator&&navigator.vibrate(50)}catch{}}restartGame(){this.game.registry.set("isDeathRetry",!1),this.game.registry.set("isLevelProgression",!1),this.game.registry.set("currentLevel",1),this.game.registry.set("playerLives",3),this.game.registry.set("totalCoins",0),this.game.registry.set("livesEarned",0),this.game.registry.set("accumulatedScore",0),this.gameStats={treasureChestsOpened:0,enemyKills:{caterpillar:0,rollz:0,chomper:0,snail:0,bouncer:0,stalker:0,rex:0,blu:0},totalEnemiesDefeated:0,highestFloor:0,livesLost:0},this.game.registry.set("gameStats",this.gameStats),console.log("\u{1F3AE} Reset gameStats for new game"),this.scene.restart()}checkAndReplaceStuckChompers(){this.cats&&this.cats.children.entries.forEach(e=>{if(e instanceof G){let t=e,i=t.getData("stuckRecoveryCount")||0;if(t.getCatColor()==="blue"&&i>=3){console.warn("Replacing chronically stuck Chomper with Snail at position",t.x,t.y);let s=t.x,a=t.y,o=t.platformBounds;t.destroy();let n=new G(this,s,a,o.left,o.right,"red",!1);this.cats.add(n),console.log("Successfully replaced stuck Chomper with Snail")}}})}shutdown(){this.backgroundSprite=null,this.backgroundInitialY=0,this.backgroundHeight=0}};var Te=class extends Phaser.Scene{constructor(){super({key:"TestScene"});this.controlButtons=[];this.enemySpawnButtons=[];this.speedMultiplier=1;this.isInvincible=!1;this.showHitboxes=!1;this.selectedFloor=1;this.spawnMenuCollapsed=!1;this.platformSpawnPoints=[]}preload(){this.load.image("rexEyesOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20open-xKvtdvPdMIy13IjDLdWArsLxH3bi3m.png"),this.load.image("rexBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20blinking-ix1xWvDmRTfWQT1HB22Z4z0lYCST06.png")}init(){this.physics.world.gravity.y=p.game.gravity}create(){this.cameras.main.setBackgroundColor(2759230),this.createTitle(),this.createPlatforms(),this.createPlayer(),this.initializeEnemyGroups(),this.createUnifiedControlMenu(),this.createStatsDisplay(),this.setupCollisions(),this.setupKeyboardShortcuts(),this.createExitButton()}createTitle(){this.titleText=this.add.text(this.cameras.main.centerX,30,"\u{1F9EA} ENEMY TEST LABORATORY \u{1F9EA}",{fontSize:"20px",color:"#00ff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(1e3)}createPlatforms(){this.platforms=this.physics.add.staticGroup(),this.ladders=this.physics.add.staticGroup();let e=[650,510,370,230,90];e.forEach((b,u)=>{let y=this.cameras.main.centerX,f=Math.ceil(350/32);for(let g=0;g<f;g++){let v=y-175+g*32+16,S=this.platforms.create(v,b,"platform");S.setDisplaySize(32,32),S.setDepth(1),S.refreshBody()}this.platformSpawnPoints.push({x:y,y:b-50,width:350}),this.add.text(50,b-10,`P${u+1}`,{fontSize:"12px",color:"#ffff00",fontFamily:"monospace"})});let t=750,i=this.cameras.main.centerX-150,s=e[e.length-1]-20,a=t,o=a-s,n=Math.ceil(o/32);for(let b=0;b<n;b++){let u=a-b*32,m=this.ladders.create(i,u,"ladder");m.setDisplaySize(32,32),m.setDepth(5),m.refreshBody()}let l=this.cameras.main.centerX+150,c=Math.ceil(o/32);for(let b=0;b<c;b++){let u=a-b*32,m=this.ladders.create(l,u,"ladder");m.setDisplaySize(32,32),m.setDepth(5),m.refreshBody()}let h=this.cameras.main.width,d=Math.ceil(h/32);for(let b=0;b<d;b++){let u=b*32+16,m=this.platforms.create(u,t,"platform");m.setDisplaySize(32,32),m.setDepth(1),m.refreshBody()}}createPlayer(){this.player=new Z(this,this.cameras.main.centerX,700),this.player.setDepth(20),this.cameras.main.setBounds(0,0,this.cameras.main.width,this.cameras.main.height),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setFollowOffset(0,50)}initializeEnemyGroups(){this.cats=this.physics.add.group(),this.baseBlus=this.physics.add.group(),this.beetles=this.physics.add.group(),this.stalkerCats=this.physics.add.group(),this.rexEnemies=this.physics.add.group({classType:V,runChildUpdate:!0})}createUnifiedControlMenu(){let e=this.cameras.main.width-210,t=60;this.spawnMenuContainer=this.add.container(0,0),this.spawnMenuContainer.setDepth(1e3);let i=200,a=this.add.rectangle(e+100,t+200,i,460,0,.8);a.setStrokeStyle(2,65280),this.spawnMenuContainer.add(a);let o=this.add.text(e+70,t-10,"CONTROLS",{fontSize:"14px",color:"#00ff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5);this.spawnMenuContainer.add(o),this.spawnMenuToggle=this.add.text(e+170,t-10,"[-]",{fontSize:"14px",color:"#ffff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.spawnMenuToggle.setDepth(1001),this.spawnMenuToggle.on("pointerdown",()=>{this.toggleSpawnMenu()});let n=t+20;this.createFloorSelectorInMenu(e+100,n),n+=40,this.createSpeedControlsInMenu(e+100,n),n+=50,this.createInvincibilityToggleInMenu(e+100,n),n+=40,this.createClearAllButtonInMenu(e+100,n),n+=40;let l=this.add.rectangle(e+100,n,i-20,2,65280,.5);this.spawnMenuContainer.add(l),n+=15;let c=this.add.text(e+100,n,"SPAWN ENEMIES",{fontSize:"12px",color:"#00ff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5);this.spawnMenuContainer.add(c),n+=25,this.createEnemyButtonsInMenu(e,n)}createSpeedControls(e,t){this.speedText=this.add.text(e-80,t-10,"Speed: 1x",{fontSize:"12px",color:"#ffffff",fontFamily:"monospace"}).setScrollFactor(0);let i=[.5,1,2,4],s=[];i.forEach((a,o)=>{let n=e-60+o*35,l=this.add.rectangle(n,t+10,30,20,4473924);l.setStrokeStyle(1,65280),l.setInteractive({useHandCursor:!0}),l.setScrollFactor(0);let c=this.add.text(n,t+10,`${a}x`,{fontSize:"10px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5).setScrollFactor(0);l.on("pointerdown",()=>{this.speedMultiplier=a,this.physics.world.timeScale=a,this.speedText.setText(`Speed: ${a}x`),s.forEach(h=>{h.button.setFillStyle(4473924)}),l.setFillStyle(65280)}),s.push({button:l,text:c,action:()=>{}})}),s[1].button.setFillStyle(65280)}createInvincibilityToggle(e,t){let i=this.add.rectangle(e,t,120,25,4473924);i.setStrokeStyle(1,65280),i.setInteractive({useHandCursor:!0}),i.setScrollFactor(0),this.invincibleText=this.add.text(e,t,"Invincible: OFF",{fontSize:"11px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5).setScrollFactor(0),i.on("pointerdown",()=>{this.isInvincible=!this.isInvincible,this.invincibleText.setText(`Invincible: ${this.isInvincible?"ON":"OFF"}`),i.setFillStyle(this.isInvincible?65280:4473924),this.isInvincible?this.player.setTint(16776960):this.player.clearTint()})}createClearAllButton(e,t){let i=this.add.rectangle(e,t,100,25,16729156);i.setStrokeStyle(1,16777215),i.setInteractive({useHandCursor:!0}),i.setScrollFactor(0);let s=this.add.text(e,t,"CLEAR ALL",{fontSize:"11px",color:"#ffffff",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0);i.on("pointerdown",()=>{this.clearAllEnemies(),i.setFillStyle(16746632),this.time.delayedCall(100,()=>{i.setFillStyle(16729156)})})}createEnemySpawnButtonsOLD(){let e=this.cameras.main.width-200,t=100;this.spawnMenuContainer=this.add.container(0,0),this.spawnMenuContainer.setScrollFactor(0);let a=this.add.rectangle(e+90,t+130,180,280,0,.7);a.setStrokeStyle(2,65280),this.spawnMenuContainer.add(a);let o=this.add.text(e+60,t-10,"SPAWN ENEMIES",{fontSize:"14px",color:"#00ff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5);this.spawnMenuContainer.add(o),this.spawnMenuToggle=this.add.text(e+160,t-10,"[-]",{fontSize:"14px",color:"#ffff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5).setInteractive({useHandCursor:!0}),this.spawnMenuToggle.on("pointerdown",()=>{this.toggleSpawnMenu()}),this.spawnMenuToggle.setScrollFactor(0),[{type:"caterpillar",name:"CTRPLR",color:"yellow"},{type:"blue_caterpillar",name:"BLU-CAT",color:"blue_caterpillar"},{type:"beetle",name:"BEETLE",color:"red"},{type:"chomper",name:"CHMPR",color:"blue"},{type:"chomper",name:"P-CHMP",color:"purple"},{type:"snail",name:"SNAIL",color:"red"},{type:"jumper",name:"JUMPER",color:"green"},{type:"stalker",name:"STALKR",color:"red"},{type:"baseblu",name:"BLU",color:"blue"}].forEach((l,c)=>{let h=Math.floor(c/2),d=c%2,b=e+45+d*90,u=t+30+h*35,m=this.add.rectangle(b,u,80,25,4473924);m.setStrokeStyle(1,65280),m.setInteractive({useHandCursor:!0}),this.spawnMenuContainer.add(m);let y=this.add.text(b,u,l.name,{fontSize:"10px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5);this.spawnMenuContainer.add(y),m.on("pointerdown",()=>{this.spawnEnemy(l.type,l.color),m.setFillStyle(65280),this.time.delayedCall(100,()=>{m.setFillStyle(4473924)})}),m.on("pointerover",()=>{m.setFillStyle(6710886)}),m.on("pointerout",()=>{m.setFillStyle(4473924)}),this.enemySpawnButtons.push({button:m,text:y,enemyType:l.type})})}spawnEnemy(e,t){let i=3-this.selectedFloor;if(i<0||i>=this.platformSpawnPoints.length){console.warn("Invalid floor selected:",this.selectedFloor);return}let s=this.platformSpawnPoints[i],a=(Math.random()-.5)*s.width*.8,o=s.x+a,n=s.y,l=s.x-s.width/2,c=s.x+s.width/2;switch(e){case"baseblu":let h=new J(this,o,n);h.setPlatformBounds(l,c),this.baseBlus.add(h);break;case"beetle":let d=new _(this,o,n,l,c);this.beetles.add(d);break;case"stalker":let b=new G(this,o,n,l,c,t,!0);b.setPlayerReference(this.player),this.stalkerCats.add(b);break;case"REX":let u=new V(this,o,n,l,c);this.rexEnemies.add(u);break;default:let m=new G(this,o,n,l,c,t,!1);this.cats.add(m);break}}clearAllEnemies(){this.cats.clear(!0,!0),this.baseBlus.clear(!0,!0),this.beetles.clear(!0,!0),this.stalkerCats.clear(!0,!0),this.rexEnemies.clear(!0,!0)}createFloorSelectorInMenu(e,t){let i=this.add.text(e-60,t,"Floor:",{fontSize:"12px",color:"#ffffff",fontFamily:"monospace"});this.spawnMenuContainer.add(i);let s=this.add.text(e,t,`${this.selectedFloor}`,{fontSize:"12px",color:"#00ff00",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5);this.spawnMenuContainer.add(s);let a=this.add.text(e-25,t,"\u25C4",{fontSize:"16px",color:"#ffff00",fontFamily:"monospace"}).setOrigin(.5).setInteractive({useHandCursor:!0});this.spawnMenuContainer.add(a),a.on("pointerdown",()=>{this.selectedFloor>1&&(this.selectedFloor--,s.setText(`${this.selectedFloor}`))});let o=this.add.text(e+25,t,"\u25BA",{fontSize:"16px",color:"#ffff00",fontFamily:"monospace"}).setOrigin(.5).setInteractive({useHandCursor:!0});this.spawnMenuContainer.add(o),o.on("pointerdown",()=>{this.selectedFloor<3&&(this.selectedFloor++,s.setText(`${this.selectedFloor}`))})}createSpeedControlsInMenu(e,t){this.speedText=this.add.text(e,t-10,"Speed: 1x",{fontSize:"11px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5),this.spawnMenuContainer.add(this.speedText);let i=[.5,1,2,4];i.forEach((s,a)=>{let o=e-60+a*35,n=this.add.rectangle(o,t+10,30,20,4473924);n.setStrokeStyle(1,65280),n.setInteractive({useHandCursor:!0}),this.spawnMenuContainer.add(n);let l=this.add.text(o,t+10,`${s}x`,{fontSize:"10px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5);this.spawnMenuContainer.add(l),n.on("pointerdown",()=>{this.speedMultiplier=s,this.physics.world.timeScale=s,this.speedText.setText(`Speed: ${s}x`),i.forEach((c,h)=>{this.spawnMenuContainer.getAt(7+h*2).setFillStyle(h===a?65280:4473924)})}),a===1&&n.setFillStyle(65280)})}createInvincibilityToggleInMenu(e,t){let i=this.add.rectangle(e,t,120,25,4473924);i.setStrokeStyle(1,65280),i.setInteractive({useHandCursor:!0}),this.spawnMenuContainer.add(i),this.invincibleText=this.add.text(e,t,"Invincible: OFF",{fontSize:"11px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5),this.spawnMenuContainer.add(this.invincibleText),i.on("pointerdown",()=>{this.isInvincible=!this.isInvincible,this.invincibleText.setText(`Invincible: ${this.isInvincible?"ON":"OFF"}`),i.setFillStyle(this.isInvincible?65280:4473924),this.isInvincible?this.player.setTint(16776960):this.player.clearTint()})}createClearAllButtonInMenu(e,t){let i=this.add.rectangle(e,t,100,25,16729156);i.setStrokeStyle(1,16777215),i.setInteractive({useHandCursor:!0}),this.spawnMenuContainer.add(i);let s=this.add.text(e,t,"CLEAR ALL",{fontSize:"11px",color:"#ffffff",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5);this.spawnMenuContainer.add(s),i.on("pointerdown",()=>{this.clearAllEnemies(),i.setFillStyle(16746632),this.time.delayedCall(100,()=>{i.setFillStyle(16729156)})})}createEnemyButtonsInMenu(e,t){[{type:"caterpillar",name:"CTRPLR",color:"yellow"},{type:"blue_caterpillar",name:"BLU-CAT",color:"blue_caterpillar"},{type:"beetle",name:"BEETLE",color:"red"},{type:"chomper",name:"CHMPR",color:"blue"},{type:"chomper",name:"P-CHMP",color:"purple"},{type:"snail",name:"SNAIL",color:"red"},{type:"jumper",name:"JUMPER",color:"green"},{type:"stalker",name:"STALKR",color:"red"},{type:"baseblu",name:"BLU",color:"blue"},{type:"REX",name:"REX",color:"rex"}].forEach((s,a)=>{let o=Math.floor(a/2),n=a%2,l=e+55+n*90,c=t+o*35,h=this.add.rectangle(l,c,80,25,4473924);h.setStrokeStyle(1,65280),h.setInteractive({useHandCursor:!0}),this.spawnMenuContainer.add(h);let d=this.add.text(l,c,s.name,{fontSize:"10px",color:"#ffffff",fontFamily:"monospace"}).setOrigin(.5);this.spawnMenuContainer.add(d),h.on("pointerdown",()=>{this.spawnEnemy(s.type,s.color),h.setFillStyle(65280),this.time.delayedCall(100,()=>{h.setFillStyle(4473924)})})})}toggleSpawnMenu(){this.spawnMenuCollapsed=!this.spawnMenuCollapsed,this.spawnMenuCollapsed?(this.spawnMenuContainer.setVisible(!1),this.spawnMenuToggle.setText("[+]")):(this.spawnMenuContainer.setVisible(!0),this.spawnMenuToggle.setText("[-]"))}createStatsDisplay(){let t=this.cameras.main.height-100,i=this.add.rectangle(90,t+40,160,80,0,.7);i.setStrokeStyle(1,65280),i.setScrollFactor(0),i.setDepth(999),this.statsText=this.add.text(10,t,"",{fontSize:"11px",color:"#00ff00",fontFamily:"monospace",lineSpacing:5}).setScrollFactor(0).setDepth(1e3)}setupCollisions(){this.physics.add.collider(this.player,this.platforms,void 0,(e,t)=>!this.player.getIsClimbing(),this),this.physics.add.overlap(this.player,this.ladders,(e,t)=>{if(this.player.checkLadderProximity(t)&&(this.player.getIsClimbing()||this.player.startClimbing(t)),this.player.getIsClimbing()){let i=t,s=i.y-i.height/2,a=i.y+i.height/2;this.player.y<s-20?(this.player.exitClimbing(),this.player.setVelocityY(-50)):this.player.y>a+32&&this.player.exitClimbing()}},void 0,this),this.physics.add.collider(this.cats,this.platforms),this.physics.add.collider(this.baseBlus,this.platforms),this.physics.add.collider(this.beetles,this.platforms),this.physics.add.collider(this.stalkerCats,this.platforms),this.physics.add.collider(this.rexEnemies,this.platforms),this.physics.add.collider(this.cats,this.cats,this.handleEnemyCollision,void 0,this),this.physics.add.collider(this.beetles,this.beetles,this.handleBeetleCollision,void 0,this),this.physics.add.overlap(this.player,this.cats,this.handlePlayerEnemyCollision,void 0,this),this.physics.add.overlap(this.player,this.baseBlus,this.handlePlayerEnemyCollision,void 0,this),this.physics.add.overlap(this.player,this.beetles,this.handlePlayerEnemyCollision,void 0,this),this.physics.add.overlap(this.player,this.stalkerCats,this.handlePlayerEnemyCollision,void 0,this),this.physics.add.overlap(this.player,this.rexEnemies,this.handlePlayerEnemyCollision,void 0,this)}handleEnemyCollision(e,t){e.reverseDirection&&e.reverseDirection(),t.reverseDirection&&t.reverseDirection()}handleBeetleCollision(e,t){e.reverseDirection&&e.reverseDirection(),t.reverseDirection&&t.reverseDirection()}handlePlayerEnemyCollision(e,t){if(this.isInvincible){t.squish&&t.squish();return}let i=e.body.bottom,s=t.body.top,a=e.body.velocity.y;i<s+10&&a>0?t.squish?(t.squish(),e.setVelocityY(-200)):t.handlePlayerBounce&&(t.handlePlayerBounce(),e.setVelocityY(-300)):(e.setTint(16711680),this.time.delayedCall(200,()=>{e.clearTint()}))}setupKeyboardShortcuts(){this.input.keyboard?.on("keydown-ESC",()=>{this.exitTestScene()}),this.input.keyboard?.on("keydown-ONE",()=>{this.speedMultiplier=.5,this.physics.world.timeScale=.5,this.speedText.setText("Speed: 0.5x")}),this.input.keyboard?.on("keydown-TWO",()=>{this.speedMultiplier=1,this.physics.world.timeScale=1,this.speedText.setText("Speed: 1x")}),this.input.keyboard?.on("keydown-THREE",()=>{this.speedMultiplier=2,this.physics.world.timeScale=2,this.speedText.setText("Speed: 2x")}),this.input.keyboard?.on("keydown-FOUR",()=>{this.speedMultiplier=4,this.physics.world.timeScale=4,this.speedText.setText("Speed: 4x")}),this.input.keyboard?.on("keydown-I",()=>{this.isInvincible=!this.isInvincible,this.invincibleText.setText(`Invincible: ${this.isInvincible?"ON":"OFF"}`),this.isInvincible?this.player.setTint(16776960):this.player.clearTint()}),this.input.keyboard?.on("keydown-C",()=>{this.clearAllEnemies()}),this.input.keyboard?.on("keydown-H",()=>{this.showHitboxes=!this.showHitboxes,this.physics.world.drawDebug=this.showHitboxes,!this.showHitboxes&&this.physics.world.debugGraphic&&this.physics.world.debugGraphic.clear(),this.showHitboxes&&!this.physics.world.debugGraphic&&this.physics.world.createDebugGraphic()})}createExitButton(){let e=this.add.rectangle(this.cameras.main.width-50,30,80,30,16711680);e.setStrokeStyle(2,16777215),e.setInteractive({useHandCursor:!0}),e.setScrollFactor(0),e.setDepth(1002);let t=this.add.text(this.cameras.main.width-50,30,"EXIT",{fontSize:"14px",color:"#ffffff",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5).setScrollFactor(0).setDepth(1003);e.on("pointerdown",()=>{this.exitTestScene()}),e.on("pointerover",()=>{e.setFillStyle(16729156)}),e.on("pointerout",()=>{e.setFillStyle(16711680)})}exitTestScene(){this.physics.world.timeScale=1,this.scene.start("GameScene")}update(e,t){this.player.update(e,t);let i=!1;this.physics.overlap(this.player,this.ladders,()=>{i=!0}),!i&&!this.player.getIsClimbing()&&this.player.clearNearbyLadder(),this.cats.children.entries.forEach(s=>{s.update&&s.update(e,t)}),this.beetles.children.entries.forEach(s=>{s.update&&s.update(e,t)}),this.baseBlus.children.entries.forEach(s=>{s.update&&s.update(e,t)}),this.stalkerCats.children.entries.forEach(s=>{s.update&&s.update(e,t)}),this.rexEnemies.children.entries.forEach(s=>{s.update&&s.update(e,t)}),this.updateStats()}updateStats(){let e=this.cats.children.entries.length+this.baseBlus.children.entries.length+this.beetles.children.entries.length+this.stalkerCats.children.entries.length,t=Math.round(this.game.loop.actualFps);this.statsText.setText([`FPS: ${t}`,`Enemies: ${e}`,`Speed: ${this.speedMultiplier}x`,`Invincible: ${this.isInvincible?"ON":"OFF"}`,`Hitboxes: ${this.showHitboxes?"ON":"OFF"}`])}};var Me=[de,pe,ue,xe];p.debug&&(Me.push(Te),console.log("TestScene enabled - Press 'T' in game to access"));var Oe={type:Phaser.WEBGL,width:p.canvas.width,height:p.canvas.height,scale:{mode:Phaser.Scale.FIT,parent:document.body,autoCenter:Phaser.Scale.CENTER_BOTH,resolution:window.devicePixelRatio||1},backgroundColor:"#000000",scene:Me,physics:{default:"arcade",arcade:{gravity:{y:p.game.gravity},debug:!1}},audio:{disableWebAudio:!1,noAudio:!1},fps:{target:60},pixelArt:!1,antialias:!0,render:{pixelArt:!1,roundPixels:!1}},W=new Phaser.Game(Oe);W.registry.set("isReplay",!1);console.log("[PlayFun] Viewport Debug:",{innerHeight:window.innerHeight,innerWidth:window.innerWidth,clientHeight:document.documentElement.clientHeight,clientWidth:document.documentElement.clientWidth,devicePixelRatio:window.devicePixelRatio});W.events.once("ready",()=>{Be("352aad5d-b6fa-4ad7-9ccf-ab9da95d4867");let w=!1,r=()=>{W.sound.context&&(W.sound.context.state==="suspended"?W.sound.context.resume().then(()=>{console.log("[PlayFun] Audio context resumed"),w=!0}).catch(e=>{console.warn("[PlayFun] Could not resume audio:",e)}):W.sound.context.state==="running"&&!w&&(w=!0))};W.canvas.addEventListener("click",r,{passive:!0}),W.canvas.addEventListener("touchstart",r,{passive:!1}),W.canvas.addEventListener("touchend",r,{passive:!1}),document.addEventListener("keydown",r,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||r()})});})();
</script></body></html>