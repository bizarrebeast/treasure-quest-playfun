<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Treasure Quest</title>

    
    <meta name="x-ogp-key" content="5532b232-6595-4d58-abc6-80f31529ec1b" id="ogp-key-meta">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet">

    
    <script src="https://sdk.play.fun/latest"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.88.2/dist/phaser.min.js"></script>

    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #2e2348;
        font-family: "Press Start 2P", system-ui;
      }
      canvas { display: block; }
      canvas:focus { outline: none; }

      /* Font preload */
      .font-preload {
        position: absolute;
        left: -9999px;
        top: -9999px;
        font-size: 1px;
        visibility: hidden;
      }
      .font-preload-press-start { font-family: "Press Start 2P"; }
    </style>
  </head>
  <body>
    
    <div class="font-preload font-preload-press-start">.</div>

    
    
  

<script>"use strict";var Game=(()=>{var he=class extends Phaser.Scene{constructor(){super({key:"LoadingScene"})}preload(){}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}this.scene.start("SplashScene")}};var Oe={buildType:"playfun",debug:!1,canvas:{width:720,height:720},game:{tileSize:32,floorHeight:8,floorWidth:22,floorSpacing:140,gravity:800,playerSpeed:160,climbSpeed:120,jumpVelocity:-350},scoring:{enemyDefeat:100,coinCollect:50,floorBonus:500},hud:{topBarHeight:80,bottomBarHeight:80,gameAreaHeight:560},touchControls:{dpadPosition:{x:100,y:640},dpadSize:60,jumpPosition:{x:620,y:640},jumpSize:60},platform:{isDgen1:!1,isPlayFun:!0,hasLocalStorage:!0,hasWallet:!1,autoSave:!1,saveInterval:3e4}},w=Oe;var b=w;var de=class extends Phaser.Scene{constructor(){super({key:"SplashScene"});this.transitionComplete=!1}preload(){let e=this.registry.get("isDgen1")||window.location.port==="3001";console.log("\u{1F3AE} Loading dgen1 splash (720x720)"),this.load.image("titleBackground","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/splash%20page%20dgen1-Fh7ukfdeGjMSeC55Peq00Ip9l8GzhI.png?d0YY"),this.load.audio("splash-sound","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/splash%20page%20sfx-2Un9YwdWUGtqQ3ynYGocaBKgQmQTmD.wav?X7j7"),this.load.on("loaderror",t=>{console.error("\u274C Failed to load:",t.key,"- CORS or network issue"),t.key==="splash-sound"&&this.registry.set("audioLoadFailed",!0)}),console.log("\u{1F3AE} SplashScene: Loading title background and sound")}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}if(this.setupAudioUnlock(),this.registry.get("sfxEnabled")!==!1)try{this.sound.play("splash-sound",{volume:.5})}catch{console.log("\u{1F507} Splash sound blocked - will play after user interaction")}this.setupTitleBackground(),this.startTimer()}setupAudioUnlock(){let e=!1,t=()=>{if(!e&&(e=!0,console.log("\u{1F50A} Attempting to unlock audio context..."),this.sound.context)){if(console.log("\u{1F50A} Audio context state:",this.sound.context.state),this.sound.context.state==="suspended")this.sound.context.resume().then(()=>{console.log("\u2705 Audio context successfully resumed!");let o=this.sound.context,n=o.createBuffer(1,1,22050),l=o.createBufferSource();l.buffer=n,l.connect(o.destination),l.start(0),console.log("\u2705 Played empty buffer to unlock iOS audio");try{let h=this.sound.add("splash-sound",{volume:.001});h.play(),h.once("complete",()=>{h.destroy(),console.log("\u2705 Audio fully unlocked with silent sound")})}catch(h){console.log("\u26A0\uFE0F Could not play silent sound:",h)}this.registry.get("sfxEnabled")!==!1&&!this.registry.get("splashSoundPlayed")&&setTimeout(()=>{try{this.sound.play("splash-sound",{volume:.5}),this.registry.set("splashSoundPlayed",!0),console.log("\u2705 Splash sound played after unlock")}catch(h){console.log("\u26A0\uFE0F Could not play splash sound:",h)}},100)}).catch(o=>{console.error("\u274C Failed to resume audio context:",o)});else if(this.sound.context.state==="running"){console.log("\u2705 Audio context already running");try{let o=this.sound.context,n=o.createBuffer(1,1,22050),l=o.createBufferSource();l.buffer=n,l.connect(o.destination),l.start(0),console.log("\u2705 Played empty buffer for iOS compatibility")}catch(o){console.log("\u26A0\uFE0F Could not play empty buffer:",o)}}}};this.input.on("pointerdown",t),this.input.on("pointerup",t);let i=this.add.zone(b.canvas.width/2,b.canvas.height/2,b.canvas.width,b.canvas.height);i.setInteractive(),i.on("pointerdown",t),i.on("pointerup",t);let s=this.sys.canvas,r=o=>{t(),s.removeEventListener("touchstart",r),s.removeEventListener("touchend",r),s.removeEventListener("mousedown",r)};s.addEventListener("touchstart",r,{passive:!0}),s.addEventListener("touchend",r,{passive:!0}),s.addEventListener("mousedown",r,{passive:!0}),this.sys.game.device.input.touch&&this.input.addPointer(2)}setupTitleBackground(){let e=b.canvas.width,t=b.canvas.height;this.titleImage=this.add.image(e/2,t/2,"titleBackground"),this.titleImage.setDepth(0);let i=e/this.titleImage.width,s=t/this.titleImage.height,r=Math.max(i,s);this.titleImage.setScale(r),console.log("\u{1F3AE} SplashScene: Title background positioned and scaled")}startTimer(){console.log("\u{1F3AE} SplashScene: Starting 2-second timer"),this.time.delayedCall(2e3,()=>{this.transitionToGame()})}transitionToGame(){this.transitionComplete||(this.transitionComplete=!0,console.log("\u{1F3AE} SplashScene: Auto-transitioning to instructions after 2 seconds"),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("InstructionsScene")}))}update(){}};var z=class{static markAsPreloaded(a){this.preloadedAssets.add(a),this.loadingAssets.delete(a),console.log(`\u2705 Asset preloaded: ${a}`)}static markAsLoading(a){this.loadingAssets.add(a)}static isPreloaded(a){return this.preloadedAssets.has(a)}static isLoading(a){return this.loadingAssets.has(a)}static getPreloadedCount(){return this.preloadedAssets.size}static clear(){this.preloadedAssets.clear(),this.loadingAssets.clear()}static getCriticalAssets(){return[{key:"visibilityOverlay",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO",type:"image"},{key:"background-treasure-quest-5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1",type:"image"},{key:"playerIdleEye1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%201-p01pa3z9fL9AyLQolMuYyBO3DIqgvB.png?FaaG",type:"image"},{key:"playerIdleEye2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%202-ngx0e1EF33iY14vRpcSvy8QOUjMKnl.png?lsFE",type:"image"},{key:"floor-tile-1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt",type:"image"},{key:"floor-tile-2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%202-EuITFMsdSDebMUmfcikeKCDLqDupml.png?C2mi",type:"image"},{key:"floor-tile-3",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%203-EBjnmTXXufdUFEuzmfnGnaZX4zdI2C.png?69bT",type:"image"},{key:"doorClosed",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U",type:"image"},{key:"tealLadder",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/new%20ladder-ULDbdT9I4h8apxhpJI6WT1PzmaMzLo.png?okOd",type:"image"},{key:"gem-collect",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/regular%20gem%20collect%20sfx-OXLLrrAXWUz21oDTEuQPFb2fxRWxXh.wav?pH1V",type:"audio"},{key:"jump-1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%201%20sfx-Cfx219m2NwhVClkP67iebiwcV0HiF5.wav?GDjY",type:"audio"}]}static getSecondaryAssets(){return[{key:"playerRunLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/running%20body%20eyes%20looking%20left%20foot%20forward-5O5kkQBPD5v2vMJvsBZrCmvWqE5PkV.png?z5EH",type:"image"},{key:"playerRunRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/running%20body%20eyes%20looking%20right%20foot%20forward-7xJdHJFy5Q9V4EhFXVqXRZo1hxKA1z.png?jd5P",type:"image"},{key:"blueCat",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed-HUXqx9HBdotEhJE2LBgzK8Z4kA7e2H.png?AVKZ",type:"image"},{key:"floor-tile-4",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%204-ecTwalLp4rzl9hegwIwVMuDBeN1YVJ.png?nxJJ",type:"image"}]}};z.preloadedAssets=new Set,z.loadingAssets=new Set;var K=class{static generateLoadingScreen(a,e){let t=`loading-screen-${e}`;if(a.textures.exists(t))return t;let i=a.cameras.main.width,s=a.cameras.main.height,r=a.add.renderTexture(0,0,i,s);r.setOrigin(0,0),r.fill(3023688);let o=i/2,n=s/2,l=a.add.text(o,n,"LOADING...",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"});return l.setOrigin(.5),r.draw(l),r.saveTexture(t),l.destroy(),r.destroy(),this.generatedScreens.set(t,"LOADING..."),console.log(`\u2728 Generated loading screen: ${t}`),t}static preGenerateAll(a){[1,11,21,31,41,51].forEach(t=>{this.generateLoadingScreen(a,t)})}static getLoadingScreenKey(a){return a>=51?"loading-screen-51":a>=41?"loading-screen-41":a>=31?"loading-screen-31":a>=21?"loading-screen-21":a>=11?"loading-screen-11":"loading-screen-1"}static showInstantLoadingScreen(a,e){let t=this.getLoadingScreenKey(e),i=a.add.image(a.cameras.main.centerX,a.cameras.main.centerY,t);return i.setOrigin(.5),i.setDepth(1e5),i.setScrollFactor(0),console.log(`\u26A1 Instant loading screen displayed: ${t}`),i}};K.generatedScreens=new Map;var ue=class extends Phaser.Scene{constructor(){super({key:"InstructionsScene"});this.scrollY=0;this.maxScrollY=0;this.contentHeight=0;this.isDragging=!1;this.dragStartY=0;this.scrollStartY=0;this.fromMenu=!1;this.reopenMenu=!1}init(e){this.fromMenu=e?.fromMenu||!1,this.reopenMenu=e?.reopenMenu||!1}preload(){this.load.image("instructionsBg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1"),this.loadGameSprites()}loadGameSprites(){this.load.image("playerIdleEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%201-aD6V48lNdWK5R1x5CPNs4XLX869cmI.png?0XJy"),this.load.image("playerJumpRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20right%20foot%20forward-3clf2KnwfbN3O6BsrtaeHSTAviNbnF.png?xx8e"),this.load.image("playerClimbInstructions","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20instructions%20sprite-1DYkU3H7zBfBhzSDEkjgUSCrDXYBRW.png?v0Zt"),this.load.image("playerThrowingGem","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%20throwing%20gem-7trW3lxLa5cH2ASj5SX3nkwO6dDh6z.png?uNG0"),this.load.image("playerBothFeetDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/both%20feet%20down-Df4cKPxtG04wJmnzY3QzaUeW22F1BN.png?Iekl"),this.load.image("crystal-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20hud%20icon-6cCEP7jp90eqI7W9LeBp7v4s3OgCPX.png?nMJm"),this.load.image("blueCoin","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem-GzKKZKUsDMh3CXMEIV4OmMl4ksrqqm.png?sill"),this.load.image("diamond","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond-LB22Ijoji8erIrMFMvtSwd5Y9rDDwS.png?LlEv"),this.load.image("crystalBallCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("cursedOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb-rHogWhnYUk2xThrTWajfHqMSfxeyfd.png?0wr6"),this.load.image("tealOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb-wupZvLrfiaRIZZyP4TbIOq5HLiVsXz.png?i2qV"),this.load.image("pendant","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pendant-cJISby3d7EEREasbi0gRZkn2u3rNrG.png?xf9m"),this.load.image("heart-crystal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/free%20life%20heart%20crystal-2EJMsIvSQKzdgrqytakBZcDbGf7Jpf.png?E1JG"),this.load.image("yellow-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20chest-QMRMmVk9i7S0qkLteaXfhjqQBI351B.png?sE5u"),this.load.image("blueEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20mid%20mouth-OvzgXzA7k4tlCopnJB6tiD0RqjATsS.png"),this.load.image("yellowEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillars%20for%20instructions-kZxgRN7GYjkDNz2YNyG01YlnoFmwHl.png"),this.load.image("redEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%201-RKF3p3F7fxdBSfen8UD9UGqIzf8zlv.png?xRpM"),this.load.image("greenEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20for%20instructions-id5JdSwy2HEqrh3atcd89xIimkk8fI.png"),this.load.image("stalkerEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%201-Xt3Vtu2FiWWLT9l2wfeakBAqVSZet8.png?gS6O"),this.load.image("beetle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2070-gToASj29g9XTDxUDHBKXDOfpYOKudu.png?uZh3"),this.load.image("rexEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20for%20instructions-nQEFZF5vjHMbWTsA9J6aVk3eAFyBDt.png"),this.load.image("baseblue-eyes-center","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20center-BWjYc09iCwYsTuEB3TEsa7GdmDc4Nj.png?NZtQ"),this.load.image("ladderInstructions","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/ladder%20for%20instructions-G7U9VNDZ8e7krygwL64remh9sNOppw.png?i8q2"),this.load.image("floor-tile-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt"),this.load.image("pink-floor-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20spikes%20floor%20tile-ncAVgIHazwYlznCBP4H6LWLiIhN7OF.png?n27v"),this.load.image("yellow-ceiling-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20spikes%20ceiling%20tile-8vq9W1Y2e1RSpgUfMl9sTp0ZILFHL3.png?mUEb"),this.load.image("doorClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U")}create(){if(this.game.registry.get("isReplay")){this.scene.start("GameScene");return}this.setupBackground(),this.createTitle(),this.createScrollableContainer(),this.createInstructionCategories(),this.createSkipButton(),this.createScrollIndicator(),this.setupScrolling(),this.generateLoadingScreens(),this.startBackgroundPreload()}setupBackground(){let e=b.canvas.width,t=b.canvas.height;this.bgImage=this.add.image(e/2,t/2,"instructionsBg"),this.bgImage.setDepth(0);let i=e/this.bgImage.width,s=t/this.bgImage.height,r=Math.max(i,s);this.bgImage.setScale(r)}createTitle(){let e=b.canvas.width;this.titleText=this.add.text(e/2,60,"HOW TO PLAY",{fontSize:"28px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",stroke:"#000000",strokeThickness:3}),this.titleText.setOrigin(.5,.5),this.titleText.setDepth(100);let t=this.add.graphics();t.fillStyle(4915330,.6),t.lineStyle(2,16711935);let i=this.titleText.getBounds();t.fillRoundedRect(i.x-20,i.y-10,i.width+40,i.height+20,10),t.strokeRoundedRect(i.x-20,i.y-10,i.width+40,i.height+20,10),t.setDepth(99)}createScrollableContainer(){let e=b.canvas.width,t=b.canvas.height,i=this.add.graphics();i.fillStyle(4915330,.6),i.lineStyle(2,16711935),i.fillRoundedRect(20,100,e-40,t-200,15),i.strokeRoundedRect(20,100,e-40,t-200,15),i.setDepth(5),this.scrollContainer=this.add.container(0,0),this.scrollContainer.setDepth(10),this.maskGraphics=this.add.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(20,100,e-40,t-200),this.maskGraphics.setVisible(!1);let s=this.maskGraphics.createGeometryMask();this.scrollContainer.setMask(s)}createInstructionCategories(){let e=120;[{title:"MOVEMENT & CONTROLS",items:[{sprite:"playerIdleEye1",title:"Move",description:"Use the pink crystal D-pad to move left and right",spriteSize:{width:38,height:58}},{sprite:"playerJumpRightFoot",title:"Jump",description:"Tap the pink crystal button to jump",spriteSize:{width:38,height:58}},{sprite:"playerClimbInstructions",title:"Climb",description:"Use the D-pad UP/DOWN to climb ladders",spriteSize:{width:38,height:58}},{sprite:"playerThrow",title:"Throw",description:"Tap the yellow crystal button to throw crystal balls",spriteSize:{width:38,height:58}}]},{title:"COLLECTIBLES",items:[{sprite:"crystal-hud-icon",title:"Gems",description:"Collect for 50 points each. 150 gems = free life",spriteSize:{width:45,height:45}},{sprite:"blueCoin",title:"Blue Gems",description:"Rare gems worth 500 points each",spriteSize:{width:40,height:40}},{sprite:"diamond",title:"Diamonds",description:"Valuable gems worth 1000 points each",spriteSize:{width:35,height:35}},{sprite:"heart-crystal",title:"Heart Crystal",description:"Gain an extra life worth 2000 points",spriteSize:{width:35,height:35}},{sprite:"yellow-chest",title:"Treasure Chest",description:"Contains random rewards (2500 points + items)",spriteSize:{width:48,height:48}}]},{title:"POWER-UPS & CURSES",items:[{sprite:"pendant",title:"Pendant",description:"Power-up: Invincibility for 10 seconds",spriteSize:{width:40,height:40}},{sprite:"crystalBallCollectible",title:"Crystal Ball",description:"Power-up: Throw crystal balls for 20 seconds",spriteSize:{width:40,height:40}},{sprite:"cursedOrbCollectible",title:"Cursed Orb",description:"Curse: Darkness effect for 10 seconds",spriteSize:{width:40,height:40}},{sprite:"tealOrbCollectible",title:"Teal Orb",description:"Curse: Controls reversed for 10 seconds",spriteSize:{width:40,height:40}}]},{title:"ENEMIES",items:[{sprite:"yellowEnemy",title:"Caterpillar",description:"Slow random movement (50 points)",spriteSize:{width:58,height:58}},{sprite:"beetle",title:"Rollz",description:"Simple patrol enemy (75 points)",spriteSize:{width:54,height:54}},{sprite:"blueEnemy",title:"Chomper",description:"Standard patrol enemy (100 points)",spriteSize:{width:58,height:58}},{sprite:"redEnemy",title:"Snail",description:"Faster patrol movement (150 points)",spriteSize:{width:58,height:58}},{sprite:"greenEnemy",title:"Bouncer",description:"Fast bouncing movement (200 points)",spriteSize:{width:58,height:58}},{sprite:"stalkerEnemy",title:"Stalker",description:"Activates and chases you (300 points)",spriteSize:{width:58,height:58}},{sprite:"rexEnemy",title:"Rex",description:"Slow moving, nervous flipping jumper (500 points)",spriteSize:{width:58,height:58}},{sprite:"baseblue-eyes-center",title:"Blu",description:"Immovable blocker (1000 points when invincible)",spriteSize:{width:58,height:58}}]},{title:"ENVIRONMENT & HAZARDS",items:[{sprite:"ladderInstructions",title:"Ladders",description:"Climb up and down between floors",spriteSize:{width:48,height:72}},{sprite:"floor-tile-1",title:"Platforms",description:"Solid ground you can walk and jump on",spriteSize:{width:38,height:38}},{sprite:"pink-floor-spike-tile",title:"Floor Spikes",description:"Sharp floor hazards that damage you",spriteSize:{width:38,height:38}},{sprite:"yellow-ceiling-spike-tile",title:"Ceiling Spikes",description:"Sharp ceiling hazards that damage you",spriteSize:{width:38,height:38}},{sprite:"doorClosed",title:"Exit Door",description:"Use D-pad UP at the door to complete the level",spriteSize:{width:36,height:48}}]}].forEach(i=>{e=this.createCategory(i.title,i.items,e),e+=40}),this.contentHeight=e,this.maxScrollY=Math.max(0,this.contentHeight-(b.canvas.height-200))}createCategory(e,t,i){let s=b.canvas.width,r=i,o=this.add.text(s/2,r+20,e,{fontSize:"15px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFF00",fontStyle:"bold"});return o.setOrigin(.5,.5),this.scrollContainer.add(o),r+=60,t.forEach(n=>{r=this.createInstructionItem(n,r),r+=10}),r}createInstructionItem(e,t){let i=b.canvas.width,s=this.add.graphics();s.fillStyle(32896,.7),s.lineStyle(2,2142890);let r=e.sprite==="playerThrow"?130:110;if(s.fillRoundedRect(60,t,i-120,r,10),s.strokeRoundedRect(60,t,i-120,r,10),this.scrollContainer.add(s),e.sprite==="playerThrow"){if(this.textures.exists("playerThrowingGem")&&this.textures.exists("playerBothFeetDown")){let d=this.add.container(100,t+60),p=this.add.image(0,0,"playerBothFeetDown");p.setDisplaySize(e.spriteSize.width,e.spriteSize.height),d.add(p);let u=this.add.image(0,0,"playerThrowingGem");u.setDisplaySize(e.spriteSize.width,e.spriteSize.height),d.add(u),this.scrollContainer.add(d)}}else if(this.textures.exists(e.sprite)){let d=this.add.image(100,t+55,e.sprite);e.sprite==="pink-floor-spike-tile"?(d.setCrop(0,1,d.width,d.height-1),d.setDisplaySize(e.spriteSize.width,e.spriteSize.height-1)):e.sprite==="yellow-ceiling-spike-tile"?(d.setCrop(0,0,d.width,d.height-1),d.setDisplaySize(e.spriteSize.width,e.spriteSize.height-1)):d.setDisplaySize(e.spriteSize.width,e.spriteSize.height),this.scrollContainer.add(d)}let o=e.sprite==="playerThrow"?t+25:t+20,n=this.add.text(140,o,e.title,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",fontStyle:"bold"});n.setOrigin(0,.5),this.scrollContainer.add(n);let l=e.sprite==="playerThrow"?t+75:t+65,c=this.add.text(140,l,e.description,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFFFF",wordWrap:{width:i-200},lineSpacing:4});return c.setOrigin(0,.5),this.scrollContainer.add(c),e.sprite==="playerThrow"?t+140:t+120}createSkipButton(){let e=b.canvas.width,t=b.canvas.height;this.skipButton=this.add.container(e-80,t-50),this.skipButton.setDepth(101);let i=this.add.graphics();i.fillStyle(3329330,.9),i.lineStyle(2,16766720),i.fillRoundedRect(-60,-20,120,40,8),i.strokeRoundedRect(-60,-20,120,40,8),this.skipButton.add(i);let s=this.fromMenu?"CLOSE":"SKIP ALL",r=this.add.text(0,0,s,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#000000",fontStyle:"bold"});r.setOrigin(.5,.5),this.skipButton.add(r),this.skipButton.setSize(120,40),this.skipButton.setInteractive(),this.skipButton.on("pointerdown",()=>{console.log("\u{1F3AE} InstructionsScene: Skip requested"),this.transitionToGame()}),this.skipButton.on("pointerover",()=>{i.clear(),i.fillStyle(3329330,1),i.lineStyle(3,16766720),i.fillRoundedRect(-60,-20,120,40,8),i.strokeRoundedRect(-60,-20,120,40,8)}),this.skipButton.on("pointerout",()=>{i.clear(),i.fillStyle(3329330,.9),i.lineStyle(2,16766720),i.fillRoundedRect(-60,-20,120,40,8),i.strokeRoundedRect(-60,-20,120,40,8)})}createScrollIndicator(){let e=b.canvas.height;this.scrollIndicator=this.add.container(b.canvas.width-20,e/2),this.scrollIndicator.setDepth(101);let t=this.add.graphics();t.fillStyle(0,.7),t.fillRoundedRect(-8,-155,16,310,8),this.scrollIndicator.add(t);let i=this.add.graphics();i.lineStyle(2,16766720,1),i.fillStyle(4915330,.8),i.fillRoundedRect(-7,-153,14,306,7),i.strokeRoundedRect(-7,-153,14,306,7),this.scrollIndicator.add(i);let s=this.add.graphics();s.fillStyle(16766720,.3),s.fillRoundedRect(-8,-25,16,50,8),this.scrollIndicator.add(s);let r=this.add.graphics();r.lineStyle(2,16777215,1),r.fillStyle(16766720,1),r.fillRoundedRect(-6,-22,12,44,6),r.strokeRoundedRect(-6,-22,12,44,6),this.scrollIndicator.add(r);let o=this.add.text(0,-165,"\u25B2",{fontSize:"12px",color:"#FFD700"}).setOrigin(.5);this.scrollIndicator.add(o);let n=this.add.text(0,165,"\u25BC",{fontSize:"12px",color:"#FFD700"}).setOrigin(.5);this.scrollIndicator.add(n),this.tweens.add({targets:[s,r],scaleX:1.2,scaleY:1.1,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.updateScrollIndicator()}setupScrolling(){this.input.on("wheel",(e,t,i,s)=>{this.scrollY+=s*.5,this.scrollY=Phaser.Math.Clamp(this.scrollY,0,this.maxScrollY),this.updateScrollPosition()}),this.input.on("pointerdown",e=>{this.isDragging=!0,this.dragStartY=e.y,this.scrollStartY=this.scrollY}),this.input.on("pointermove",e=>{if(this.isDragging){let t=this.dragStartY-e.y;this.scrollY=this.scrollStartY+t,this.scrollY=Phaser.Math.Clamp(this.scrollY,0,this.maxScrollY),this.updateScrollPosition()}}),this.input.on("pointerup",()=>{this.isDragging=!1})}updateScrollPosition(){this.scrollContainer.y=-this.scrollY,this.updateScrollIndicator()}updateScrollIndicator(){if(this.maxScrollY>0){let e=this.scrollY/this.maxScrollY,t=(e-.5)*260,i=this.scrollIndicator.list[2],s=this.scrollIndicator.list[3];i.y=t,s.y=t;let r=this.scrollIndicator.list[4],o=this.scrollIndicator.list[5];r.setAlpha(e>0?.5:1),o.setAlpha(e<1?1:.5),this.scrollIndicator.setVisible(!0)}else this.scrollIndicator.setVisible(!1)}transitionToGame(){let e=this.registry.get("currentLevel")||1,t=K.showInstantLoadingScreen(this,e);this.cameras.main.fadeOut(100,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{if(this.fromMenu&&this.reopenMenu){this.scene.stop("InstructionsScene"),this.scene.wake("GameScene");let i=this.scene.get("GameScene");i&&i.menuOverlay&&i.menuOverlay.container.setVisible(!0)}else this.scene.start("GameScene")})}generateLoadingScreens(){console.log("\u{1F3A8} Pre-generating loading screens for instant display");let e=this.registry.get("currentLevel")||1;K.generateLoadingScreen(this,e),e%10>=8&&K.generateLoadingScreen(this,e+10)}startBackgroundPreload(){console.log("\u{1F504} Starting background preload of GameScene assets");let e=z.getCriticalAssets(),t=z.getSecondaryAssets(),i=[...e,...t],s=0;if(i.forEach(r=>{r.type==="image"&&!this.textures.exists(r.key)?(this.load.image(r.key,r.url),z.markAsLoading(r.key),s++):r.type==="audio"&&!this.cache.audio.exists(r.key)&&(this.load.audio(r.key,r.url),z.markAsLoading(r.key),s++)}),s===0){console.log("\u2705 All assets already loaded");return}console.log(`\u{1F4E6} Queued ${s} assets for background loading`),this.load.on("progress",r=>{let o=Math.round(r*100);console.log(`\u23F3 Background preload progress: ${o}%`)}),this.load.on("filecomplete",r=>{z.markAsPreloaded(r)}),this.load.on("complete",()=>{let r=z.getPreloadedCount();console.log(`\u2705 Background preload complete! ${r} assets ready for GameScene`)}),this.load.on("loaderror",r=>{console.warn(`\u26A0\uFE0F Failed to preload: ${r.key} - will retry in GameScene`)}),this.load.start()}update(){}};var pe=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i){let s=e.textures.exists("playerIdleEye1")?"playerIdleEye1":"player";if(!e.textures.exists("playerIdleEye1")){let r=e.add.graphics();r.fillStyle(65280,1),r.fillRect(0,0,24,32),r.generateTexture("player",24,32),r.destroy()}super(e,t,i,s);this.isClimbing=!1;this.currentLadder=null;this.nearbyLadder=null;this.currentJumpSound=1;this.touchControls=null;this.walkAnimationTimer=0;this.climbAnimationTimer=0;this.footstepTimer=0;this.FOOTSTEP_INTERVAL=300;this.idleAnimationTimer=0;this.currentFrame="idle";this.currentIdleState="eye1";this.currentClimbFoot="left";this.isMoving=!1;this.isJumping=!1;this.runningTiltTimer=0;this.lastFrameWasJump=!1;this.jumpButtonDown=!1;this.jumpHoldTime=0;this.isAirborne=!1;this.jumpReleased=!1;this.MIN_JUMP_VELOCITY=-120;this.MAX_JUMP_VELOCITY=w.game.jumpVelocity;this.MAX_JUMP_HOLD_TIME=300;this.speedMultiplier=1;this.crystalBallActive=!1;this.crystalBallTimer=0;this.CRYSTAL_BALL_DURATION=2e4;this.crystalBallParticles=[];this.crystalBallWarningPlayed=!1;this.cursedOrbActive=!1;this.cursedOrbTimer=0;this.CURSED_ORB_DURATION=1e4;this.cursedOrbParticles=[];this.cursedOrbWarningPlayed=!1;this.cursedTealOrbActive=!1;this.cursedTealOrbTimer=0;this.CURSED_TEAL_ORB_DURATION=1e4;this.cursedTealOrbParticles=[];this.cursedTealOrbWarningPlayed=!1;this.idleTimer=0;this.IDLE_THRESHOLD=5e3;this.bubbleActive=!1;this.onBubbleTrigger=null;this.onMovementStart=null;this.longIdleTimer=0;this.LONG_IDLE_THRESHOLD=3e4;this.isPlayingLongIdle=!1;this.longIdleFrame="left";this.longIdleAnimationTimer=0;this.runBodySprite=null;this.runLegsSprite=null;this.useTwoLayerRunning=!0;this.currentLegFrame="bothDown";this.legAnimationStep=0;this.bodyAnimationTimer=0;this.legAnimationTimer=0;this.runningEyeTimer=0;this.currentRunningEye="playerRunBody";this.isFiringProjectile=!1;this.debugLogTimer=0;e.add.existing(this),e.physics.add.existing(this),(s==="playerIdleEye1"||s.startsWith("player"))&&this.setDisplaySize(48,64),this.setCollideWorldBounds(!0),this.setBounce(0),this.setSize(18,49),this.setOffset(15,12),this.setDepth(20),this.initializeTwoLayerRunning(e,t,i),this.cursors=e.input.keyboard.createCursorKeys(),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE)}setTouchControls(e){this.touchControls=e}setBubbleTriggerCallback(e){this.onBubbleTrigger=e}setMovementStartCallback(e){this.onMovementStart=e}initializeTwoLayerRunning(e,t,i){if(e.textures.exists("playerRunBody")&&e.textures.exists("playerRunLegsBothDown")&&this.useTwoLayerRunning){let r=t,o=i;this.runBodySprite=e.add.image(r,o,"playerRunBody"),this.runBodySprite.setDisplaySize(48,64),this.runBodySprite.setDepth(21),this.runBodySprite.setVisible(!1),this.runLegsSprite=e.add.image(r,o,"playerRunLegsBothDown"),this.runLegsSprite.setDisplaySize(48,64),this.runLegsSprite.setDepth(19),this.runLegsSprite.setVisible(!1),this.currentLegFrame="bothDown",this.legAnimationStep=0}else this.useTwoLayerRunning=!1}updateTwoLayerPosition(){this.runBodySprite&&this.runLegsSprite&&this.runBodySprite.visible&&((this.runBodySprite.x!==this.x||this.runBodySprite.y!==this.y)&&(this.runBodySprite.x=this.x,this.runBodySprite.y=this.y,this.runLegsSprite.x=this.x,this.runLegsSprite.y=this.y),this.runBodySprite.flipX!==this.flipX&&(this.runBodySprite.setFlipX(this.flipX),this.runLegsSprite.setFlipX(this.flipX)))}showTwoLayerRunning(e){this.useTwoLayerRunning&&this.runBodySprite&&this.runLegsSprite&&(this.runBodySprite.setVisible(e),this.runLegsSprite.setVisible(e),this.setVisible(!e))}updateLegAnimation(){if(!this.runLegsSprite||!this.useTwoLayerRunning)return;let t=["bothDown","leftMid","leftHigh","leftMid","bothDown","rightMid","rightHigh","rightMid"][this.legAnimationStep];this.currentLegFrame=t;let i={bothDown:"playerRunLegsBothDown",leftMid:"playerRunLegsLeftMid",leftHigh:"playerRunLegsLeftHigh",rightMid:"playerRunLegsRightMid",rightHigh:"playerRunLegsRightHigh"};this.runLegsSprite.setTexture(i[t]),this.legAnimationStep=(this.legAnimationStep+1)%8}updateBodyExpression(){if(!this.runBodySprite||!this.useTwoLayerRunning)return;if(this.isFiringProjectile){this.runBodySprite.setTexture("playerRunBodyEyes7");return}let e=Math.random();if(e<.05)this.runBodySprite.setTexture("playerRunBodyBlink"),this.scene.time.delayedCall(100,()=>{this.runBodySprite&&!this.isFiringProjectile&&this.runBodySprite.setTexture(this.currentRunningEye)});else if(e<.8){let t=["playerRunBody","playerRunBodyEyes2","playerRunBodyEyes3","playerRunBodyEyes4","playerRunBodyEyes5","playerRunBodyEyes6"],i=Phaser.Utils.Array.GetRandom(t);this.currentRunningEye=i,this.runBodySprite.setTexture(i)}}notifyBubbleActive(e){this.bubbleActive=e,e&&(this.idleTimer=0)}update(e,t){if(!this.body)return;let i=this.scene;if(i.isGameOver)return;this.debugLogTimer+=t,this.debugLogTimer>2e3&&(this.debugLogTimer=0);let s=600;this.body.velocity.y>s&&this.setVelocityY(s);let r=i.isLevelStarting||!1,o=w.canvas.height-w.game.tileSize-10;if(this.y>o&&!this.isClimbing&&!r&&(this.y=o,this.setVelocityY(0),this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.blocked.down=!0)),this.body.velocity.y>0&&!this.isClimbing&&!r&&this.y+this.body.velocity.y*t/1e3>o){let D=(o-this.y)*1e3/t;this.setVelocityY(Math.max(0,D))}let n=this.body.blocked.down,l=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),c=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),h=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),d=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),p=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),u=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),m=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),y=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.V),g=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M),f=this.cursedTealOrbActive,v=this.cursors.left.isDown||h.isDown||this.touchControls?.leftPressed||!1,S=this.cursors.right.isDown||p.isDown||this.touchControls?.rightPressed||!1,x=this.cursors.up.isDown||c.isDown||this.touchControls?.upPressed||!1,P=this.cursors.down.isDown||d.isDown||this.touchControls?.downPressed||!1,C=f?S:v,k=f?v:S,E=f?P:x,O=f?x:P,M=Phaser.Input.Keyboard.JustDown(l)||Phaser.Input.Keyboard.JustDown(u)||this.touchControls?.isJumpJustPressed()||!1,L=l.isDown||u.isDown||this.touchControls?.jumpPressed||!1,T=Phaser.Input.Keyboard.JustDown(m)||Phaser.Input.Keyboard.JustDown(y)||Phaser.Input.Keyboard.JustDown(g)||this.touchControls?.isActionJustPressed()||!1;this.isMoving=(C||k)&&!this.isClimbing;let A=this.isJumping;if(this.isJumping=!n&&Math.abs(this.body.velocity.y)>10&&!this.isClimbing,A&&(n||this.isClimbing)&&(this.isJumping=!1),!this.isClimbing){let Y=w.game.playerSpeed*this.speedMultiplier;C?(this.setVelocityX(-Y),this.setFlipX(!0)):k?(this.setVelocityX(Y),this.setFlipX(!1)):this.setVelocityX(0);let D=(this.nearbyLadder!==null||this.currentLadder!==null)&&E;this.isClimbing&&(D=!0);let X=!this.body.velocity.y||this.body.velocity.y>-100;if(M&&n&&!this.isAirborne&&!D&&!this.isClimbing&&X){this.jumpButtonDown=!0,this.jumpHoldTime=0,this.isAirborne=!0,this.jumpReleased=!1;let q=this.touchControls?.jumpPressed||!1,j=-150;this.setVelocityY(j),this.playJumpSound(),console.log(`[${q?"TOUCH":"KEYBOARD"}] Jump started - Initial velocity: ${j}, Target max: ${this.MAX_JUMP_VELOCITY}`),this.triggerHapticFeedback()}if(this.isAirborne&&this.jumpButtonDown&&!this.jumpReleased){if(L){if(this.jumpHoldTime+=t,this.jumpHoldTime<this.MAX_JUMP_HOLD_TIME&&this.body?.velocity.y<0){let j=1-Math.min(this.jumpHoldTime/this.MAX_JUMP_HOLD_TIME,1),R=this.touchControls?.jumpPressed||!1,xe=t/1e3,W=-1600*j*xe,ne=this.body.velocity.y,ce=Math.max(ne+W,this.MAX_JUMP_VELOCITY);this.setVelocityY(ce)}}else if(this.jumpButtonDown=!1,this.jumpReleased=!0,this.body.velocity.y<0){let q=this.body.velocity.y<-250?.85:.92;this.setVelocityY(this.body.velocity.y*q)}}if(n&&this.isAirborne&&this.body?.velocity.y>=0){let q=this.touchControls?.jumpPressed?"TOUCH":"KEYBOARD",j=this.jumpHoldTime;console.log(`[${q}] Jump completed - Total hold time: ${j.toFixed(0)}ms`),this.isAirborne=!1,this.jumpButtonDown=!1,this.jumpReleased=!1,this.jumpHoldTime=0,this.triggerHapticFeedback()}}if(this.isClimbing&&this.currentLadder){this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setAllowGravity(!1),this.setVelocityX(0);let Y=this.currentLadder,F=Y.y+Y.height/2,D=this.y>=F-10;this.y>F-10&&(this.y=F-10,this.setVelocityY(0));let X=!1;if(E){let R=w.game.climbSpeed*this.speedMultiplier;this.setVelocityY(-R),X=!0}else if(O&&!D){let R=w.game.climbSpeed*this.speedMultiplier;this.setVelocityY(R),X=!0}else this.setVelocityY(0);this.isMoving=X;let q=D&&O;if((C||k)&&!E&&!O&&!D&&!q){this.exitClimbing();let R=w.game.playerSpeed*this.speedMultiplier;C?this.setVelocityX(-R):k&&this.setVelocityX(R)}let j=F>=w.canvas.height-w.game.tileSize*3;M&&!E&&(j||!D)&&!q&&(this.exitClimbing(),this.setVelocityY(this.MAX_JUMP_VELOCITY),this.playJumpSound())}T&&this.fireCrystalBall(),this.updateBubbleSystem(),this.updateCrystalBallTimer(t),this.updateCursedOrbTimer(t),this.updateCursedTealOrbTimer(t),this.updateSmartAnimations(),this.runBodySprite&&this.runBodySprite.visible&&(this.body.velocity.x!==0||this.body.velocity.y!==0)&&this.updateTwoLayerPosition()}startClimbing(e){this.isClimbing=!0,this.currentLadder=e,this.isAirborne=!1,this.isJumping=!1,this.jumpButtonDown=!1,this.jumpReleased=!1,this.jumpHoldTime=0,this.body instanceof Phaser.Physics.Arcade.Body&&(this.body.setAllowGravity(!1),this.body.setVelocityY(0));let t=e;this.x=t.x,this.currentClimbFoot="left",this.changePlayerTexture("playerClimbLeftFoot"),this.climbAnimationTimer=0,this.resetAnimationTimers(),this.resetRunningTilt()}exitClimbing(){this.isClimbing=!1,this.currentLadder=null,this.body instanceof Phaser.Physics.Arcade.Body&&this.body.setAllowGravity(!0),this.currentFrame="idle",this.changePlayerTexture("playerIdleEye1"),this.resetAnimationTimers()}checkLadderProximity(e){this.nearbyLadder=e;let t=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),i=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),s=this.cursors.up.isDown||t.isDown||this.touchControls?.upPressed||!1,r=this.cursors.down.isDown||i.isDown||this.touchControls?.downPressed||!1;if(s||r){let o=e;return Math.abs(this.x-o.x)<20}return!1}clearNearbyLadder(){this.isClimbing||(this.nearbyLadder=null)}getIsClimbing(){return this.isClimbing}setSpeedMultiplier(e){this.speedMultiplier=e}updateBubbleSystem(){if(!this.body)return;let e=this.scene.game.loop.delta,t=this.body.blocked.down,i=!this.isMoving&&!this.isClimbing&&!this.isJumping&&t;i&&!this.bubbleActive?(this.idleTimer+=e,this.idleTimer>=this.IDLE_THRESHOLD&&(this.onBubbleTrigger&&this.onBubbleTrigger(),this.idleTimer=0)):((this.isMoving||this.isClimbing||this.isJumping)&&this.bubbleActive&&this.onMovementStart&&this.onMovementStart(),this.idleTimer=0),i?(this.longIdleTimer+=e,this.longIdleTimer>=this.LONG_IDLE_THRESHOLD&&!this.isPlayingLongIdle&&(this.isPlayingLongIdle=!0,this.longIdleFrame="left",this.longIdleAnimationTimer=0)):(this.isPlayingLongIdle&&(this.isPlayingLongIdle=!1,this.currentFrame="idle",this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")),this.longIdleTimer=0,this.longIdleAnimationTimer=0)}updateSmartAnimations(){if(!this.body)return;let e=this.scene.game.loop.delta,t=this.body.blocked.down;if(this.isClimbing){this.isJumping=!1,this.isMoving?this.handleClimbingAnimation(e):(this.changePlayerTexture("playerClimbLeftFoot"),this.resetAnimationTimers()),this.showTwoLayerRunning(!1);return}else!t&&this.isJumping&&!this.isClimbing?this.handleJumpingAnimation():this.isMoving&&t?this.handleRunningAnimation(e):t&&this.handleIdleAnimation(e)}handleJumpingAnimation(){let e=this.flipX?"playerJumpLeftFoot":"playerJumpRightFoot";this.changePlayerTexture(e),this.currentFrame="idle",this.showTwoLayerRunning(!1),this.resetRunningTilt()}handleClimbingAnimation(e){this.showTwoLayerRunning(!1),this.climbAnimationTimer+=e,this.climbAnimationTimer>=120&&this.isMoving?(this.currentClimbFoot==="left"?(this.currentClimbFoot="right",this.changePlayerTexture("playerClimbRightFoot")):(this.currentClimbFoot="left",this.changePlayerTexture("playerClimbLeftFoot")),this.climbAnimationTimer=0):this.isMoving||(this.changePlayerTexture("playerClimbLeftFoot"),this.resetAnimationTimers())}handleRunningAnimation(e){if(this.footstepTimer+=e,this.footstepTimer>=this.FOOTSTEP_INTERVAL&&(this.footstepTimer=0),this.useTwoLayerRunning&&this.runBodySprite&&this.runLegsSprite){if(this.currentFrame==="idle"){this.currentFrame="leftStep",this.showTwoLayerRunning(!0),this.legAnimationTimer=0,this.bodyAnimationTimer=0,this.runningTiltTimer=0,this.lastFrameWasJump=!1,this.legAnimationStep=0,this.footstepTimer=0;return}this.legAnimationTimer+=e,this.bodyAnimationTimer+=e,this.showTwoLayerRunning(!0),this.legAnimationTimer>=28&&(this.updateLegAnimation(),this.legAnimationTimer=0),this.bodyAnimationTimer>=300&&(this.updateBodyExpression(),this.bodyAnimationTimer=0)}else{if(this.currentFrame==="idle"){this.currentFrame="leftStep",this.changePlayerTexture("playerRunLeftFoot"),this.walkAnimationTimer=0,this.runningTiltTimer=0,this.lastFrameWasJump=!1;return}this.walkAnimationTimer+=e,this.runningTiltTimer+=e,this.applyRunningTilt(),this.walkAnimationTimer>=120&&(this.currentFrame==="rightStep"?(this.currentFrame="leftStep",this.changePlayerTexture("playerRunLeftFoot")):(this.currentFrame="rightStep",this.changePlayerTexture("playerRunRightFoot")),this.walkAnimationTimer=0)}}handleIdleAnimation(e){if(this.footstepTimer=0,this.isPlayingLongIdle){this.handleLongIdleAnimation(e);return}if(this.idleAnimationTimer+=e,this.currentFrame!=="idle"){this.currentFrame="idle",this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1"),this.idleAnimationTimer=0,this.walkAnimationTimer=0,this.climbAnimationTimer=0,this.legAnimationTimer=0,this.bodyAnimationTimer=0,this.showTwoLayerRunning(!1),this.resetRunningTilt();return}let t;if(this.currentIdleState==="blink"?t=100+Math.random()*80:t=({eye1:1200,eye2:1100,eye3:1400,eye4:1600,eye5:1800}[this.currentIdleState]||1200)+(Math.random()-.5)*800,this.idleAnimationTimer>=t){let i=Math.random(),s=["eye1","eye2","eye3","eye4","eye5"];switch(this.currentIdleState){case"eye1":i<.25?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.55?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.75?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):i<.9?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye2":i<.3?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.6?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.8?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):i<.95?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye3":i<.2?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.45?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.7?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.9?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye4":i<.15?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.4?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.65?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.85?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break;case"eye5":i<.1?(this.currentIdleState="blink",this.changePlayerTexture("playerIdleBlink")):i<.45?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.75?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.9?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4"));break;case"blink":i<.35?(this.currentIdleState="eye1",this.changePlayerTexture("playerIdleEye1")):i<.65?(this.currentIdleState="eye2",this.changePlayerTexture("playerIdleEye2")):i<.8?(this.currentIdleState="eye3",this.changePlayerTexture("playerIdleEye3")):i<.95?(this.currentIdleState="eye4",this.changePlayerTexture("playerIdleEye4")):(this.currentIdleState="eye5",this.changePlayerTexture("playerIdleEye5"));break}this.idleAnimationTimer=0}}handleLongIdleAnimation(e){this.longIdleAnimationTimer+=e;let t=400;this.showTwoLayerRunning(!1),this.longIdleAnimationTimer>=t&&(this.longIdleFrame==="left"?(this.longIdleFrame="right",this.changePlayerTexture("playerIdleBootyRight")):(this.longIdleFrame="left",this.changePlayerTexture("playerIdleBootyLeft")),this.longIdleAnimationTimer=0)}resetAnimationTimers(){this.walkAnimationTimer=0,this.climbAnimationTimer=0,this.idleAnimationTimer=0}changePlayerTexture(e){this.scene.textures.exists(e)&&(this.setTexture(e),this.setDisplaySize(48,64))}applyRunningTilt(){let i=Math.sin(this.runningTiltTimer*.02)*.08;this.setRotation(i)}resetRunningTilt(){this.setRotation(0),this.runningTiltTimer=0}addRoundedHitboxVisualization(){if(!w.debug)return;let e=this.scene.add.graphics(),t=this.body;e.lineStyle(2,65416,.8),e.strokeRoundedRect(t.x-this.x,t.y-this.y,t.width,t.height,6),e.setDepth(25),this.scene.add.existing(e),this.scene.events.on("postupdate",()=>{e&&e.active&&(e.x=this.x,e.y=this.y)})}triggerHapticFeedback(){let e=this.scene;e&&e.triggerFarcadeHapticFeedback&&e.triggerFarcadeHapticFeedback()}activateCrystalBall(){console.log("\u{1F52E} ACTIVATING Crystal Ball power-up for 10 seconds!"),this.crystalBallActive=!0,this.crystalBallTimer=this.CRYSTAL_BALL_DURATION,this.crystalBallWarningPlayed=!1,this.startCrystalBallParticles();let e=this.scene;e&&e.updateCrystalBallTimer?(console.log("\u{1F52E} Updating HUD timer with",this.crystalBallTimer,"ms"),e.updateCrystalBallTimer(this.crystalBallTimer,this.CRYSTAL_BALL_DURATION)):console.log("\u274C Could not update HUD timer - scene method not found")}updateCrystalBallTimer(e){if(this.crystalBallActive){this.crystalBallTimer-=e,!this.crystalBallWarningPlayed&&this.crystalBallTimer<=2e3&&this.crystalBallTimer>0&&(this.crystalBallWarningPlayed=!0,console.log("\u23F0 Timer warning for crystal ball")),this.crystalBallGlow&&(this.crystalBallGlow.x=this.x,this.crystalBallGlow.y=this.y),this.crystalBallTimer<=0&&(this.crystalBallActive=!1,this.crystalBallTimer=0,this.stopCrystalBallParticles());let t=this.scene;t&&t.updateCrystalBallTimer&&t.updateCrystalBallTimer(this.crystalBallTimer,this.CRYSTAL_BALL_DURATION)}}getCrystalBallActive(){return this.crystalBallActive}getCrystalBallTimeRemaining(){return this.crystalBallTimer}fireCrystalBall(){if(console.log("\u{1F52B} Fire button pressed! Active:",this.crystalBallActive,"Climbing:",this.isClimbing),!this.crystalBallActive){console.log("\u274C Cannot fire - Crystal Ball power-up not active");return}if(this.isClimbing){console.log("\u274C Cannot fire - Player is climbing");return}this.isFiringProjectile=!0,this.scene.time.delayedCall(400,()=>{this.isFiringProjectile=!1,this.runBodySprite&&this.useTwoLayerRunning&&this.isRunning&&this.runBodySprite.setTexture(this.currentRunningEye)});let e=this.scene;if(e&&e.createCrystalBallProjectile){let t=this.flipX?-1:1,i=this.body?this.body.velocity.x:0;console.log("\u{1F52B} FIRING Crystal Ball projectile! Direction:",t,"Player velocity:",i),e.createCrystalBallProjectile(this.x,this.y,t,i)}else console.log("\u274C Could not fire - scene method not found")}startCrystalBallParticles(){this.stopCrystalBallParticles(),this.crystalBallParticleTimer=this.scene.time.addEvent({delay:150,callback:()=>this.createCrystalBallParticle(),loop:!0})}createCrystalBallParticle(){if(!this.crystalBallActive||!this.scene)return;let e=this.scene.add.graphics();e.fillStyle(4509863,.3),e.fillCircle(0,0,4),e.fillStyle(4509863,.6),e.fillCircle(0,0,2),e.fillStyle(4509863,1),e.fillRect(-1,-1,2,2);let t=Math.random()*Math.PI*2,i=25+Math.random()*15,s=this.x+Math.cos(t)*i,r=this.y+Math.sin(t)*i;e.x=s,e.y=r,e.setDepth(19),this.crystalBallParticles.push(e),this.scene.tweens.add({targets:e,x:this.x+Math.cos(t+1)*(i+10),y:r-20,alpha:0,duration:1200,ease:"Power2.easeOut",onComplete:()=>{let o=this.crystalBallParticles.indexOf(e);o>-1&&this.crystalBallParticles.splice(o,1),e.destroy()}})}stopCrystalBallParticles(){this.crystalBallParticleTimer&&(this.crystalBallParticleTimer.destroy(),this.crystalBallParticleTimer=void 0),this.crystalBallParticles.forEach(e=>e.destroy()),this.crystalBallParticles=[],this.crystalBallGlow&&(this.crystalBallGlow.destroy(),this.crystalBallGlow=void 0)}createPlayerGlow(){if(!this.crystalBallGlow||!this.crystalBallActive)return;this.crystalBallGlow.clear();let e=4509863;this.crystalBallGlow.x=this.x,this.crystalBallGlow.y=this.y,this.crystalBallGlow.fillStyle(e,.1),this.crystalBallGlow.fillCircle(0,0,35),this.crystalBallGlow.fillStyle(e,.2),this.crystalBallGlow.fillCircle(0,0,25),this.crystalBallGlow.fillStyle(e,.3),this.crystalBallGlow.fillCircle(0,0,15),this.scene.tweens.add({targets:this.crystalBallGlow,scaleX:1.2,scaleY:1.2,alpha:.7,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}activateCursedOrb(){this.cursedOrbActive=!0,this.cursedOrbTimer=this.CURSED_ORB_DURATION,this.cursedOrbWarningPlayed=!1,this.startCursedOrbParticles();let e=this.scene;e&&e.updateCursedOrbTimer&&e.updateCursedOrbTimer(this.cursedOrbTimer,this.CURSED_ORB_DURATION),e&&e.activateDarknessEffect&&e.activateDarknessEffect()}activateCursedTealOrb(){this.cursedTealOrbActive=!0,this.cursedTealOrbTimer=this.CURSED_TEAL_ORB_DURATION,this.cursedTealOrbWarningPlayed=!1,this.startCursedTealOrbParticles();let e=this.scene;e&&e.updateCursedTealOrbTimer&&e.updateCursedTealOrbTimer(this.cursedTealOrbTimer,this.CURSED_TEAL_ORB_DURATION)}getCursedOrbActive(){return this.cursedOrbActive}getCursedTealOrbActive(){return this.cursedTealOrbActive}updateCursedOrbTimer(e){if(this.cursedOrbActive){if(this.cursedOrbTimer-=e,!this.cursedOrbWarningPlayed&&this.cursedOrbTimer<=2e3&&this.cursedOrbTimer>0&&(this.cursedOrbWarningPlayed=!0,console.log("\u23F0 Timer warning for cursed orb")),this.cursedOrbGlow&&(this.cursedOrbGlow.x=this.x,this.cursedOrbGlow.y=this.y),this.cursedOrbTimer<=0){this.cursedOrbActive=!1,this.cursedOrbTimer=0,this.stopCursedOrbParticles();let i=this.scene;i&&i.deactivateDarknessEffect&&i.deactivateDarknessEffect()}let t=this.scene;t&&t.updateCursedOrbTimer&&t.updateCursedOrbTimer(this.cursedOrbTimer,this.CURSED_ORB_DURATION)}}updateCursedTealOrbTimer(e){if(this.cursedTealOrbActive){this.cursedTealOrbTimer-=e,!this.cursedTealOrbWarningPlayed&&this.cursedTealOrbTimer<=2e3&&this.cursedTealOrbTimer>0&&(this.cursedTealOrbWarningPlayed=!0,console.log("\u23F0 Timer warning for cursed teal orb")),this.cursedTealOrbGlow&&(this.cursedTealOrbGlow.x=this.x,this.cursedTealOrbGlow.y=this.y),this.cursedTealOrbTimer<=0&&(this.cursedTealOrbActive=!1,this.cursedTealOrbTimer=0,this.stopCursedTealOrbParticles());let t=this.scene;t&&t.updateCursedTealOrbTimer&&t.updateCursedTealOrbTimer(this.cursedTealOrbTimer,this.CURSED_TEAL_ORB_DURATION)}}startCursedOrbParticles(){this.stopCursedOrbParticles(),this.cursedOrbGlow=this.scene.add.graphics(),this.cursedOrbGlow.setDepth(18),this.createCursedOrbPlayerGlow(),this.cursedOrbParticleTimer=this.scene.time.addEvent({delay:200,callback:()=>this.createCursedOrbParticle(),loop:!0})}startCursedTealOrbParticles(){this.stopCursedTealOrbParticles(),this.cursedTealOrbGlow=this.scene.add.graphics(),this.cursedTealOrbGlow.setDepth(18),this.createCursedTealOrbPlayerGlow(),this.cursedTealOrbParticleTimer=this.scene.time.addEvent({delay:180,callback:()=>this.createCursedTealOrbParticle(),loop:!0})}createCursedOrbParticle(){if(!this.cursedOrbActive||!this.scene)return;let e=this.scene.add.graphics();e.fillStyle(5768769,.4),e.fillCircle(0,0,3),e.fillStyle(5768769,.8),e.fillCircle(0,0,1);let t=Math.random()*Math.PI*2,i=30+Math.random()*15,s=this.x+Math.cos(t)*i,r=this.y+Math.sin(t)*i;e.x=s,e.y=r,e.setDepth(19),this.cursedOrbParticles.push(e),this.scene.tweens.add({targets:e,y:r+25,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{let o=this.cursedOrbParticles.indexOf(e);o>-1&&this.cursedOrbParticles.splice(o,1),e.destroy()}})}createCursedTealOrbParticle(){if(!this.cursedTealOrbActive||!this.scene)return;let e=this.scene.add.graphics();e.fillStyle(4827036,.4),e.fillCircle(0,0,3),e.fillStyle(4827036,.8),e.fillCircle(0,0,1);let t=Math.random()*Math.PI*2,i=25+Math.random()*20,s=this.x+Math.cos(t)*i,r=this.y+Math.sin(t)*i;e.x=s,e.y=r,e.setDepth(19),this.cursedTealOrbParticles.push(e),this.scene.tweens.add({targets:e,x:s+Math.sin(t)*30,y:r-20,alpha:0,duration:1300,ease:"Power2.easeOut",onComplete:()=>{let o=this.cursedTealOrbParticles.indexOf(e);o>-1&&this.cursedTealOrbParticles.splice(o,1),e.destroy()}})}createCursedOrbPlayerGlow(){if(!this.cursedOrbGlow||!this.cursedOrbActive)return;this.cursedOrbGlow.clear();let e=5768769;this.cursedOrbGlow.x=this.x,this.cursedOrbGlow.y=this.y,this.cursedOrbGlow.fillStyle(e,.15),this.cursedOrbGlow.fillCircle(0,0,40),this.cursedOrbGlow.fillStyle(e,.25),this.cursedOrbGlow.fillCircle(0,0,25),this.scene.tweens.add({targets:this.cursedOrbGlow,scaleX:1.3,scaleY:1.3,alpha:.6,duration:1200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createCursedTealOrbPlayerGlow(){if(!this.cursedTealOrbGlow||!this.cursedTealOrbActive)return;this.cursedTealOrbGlow.clear();let e=4827036;this.cursedTealOrbGlow.x=this.x,this.cursedTealOrbGlow.y=this.y,this.cursedTealOrbGlow.fillStyle(e,.12),this.cursedTealOrbGlow.fillCircle(0,0,38),this.cursedTealOrbGlow.fillStyle(e,.22),this.cursedTealOrbGlow.fillCircle(0,0,22),this.scene.tweens.add({targets:this.cursedTealOrbGlow,rotation:Math.PI*2,scaleX:1.4,scaleY:1.4,alpha:.7,duration:900,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}stopCursedOrbParticles(){this.cursedOrbParticleTimer&&(this.cursedOrbParticleTimer.destroy(),this.cursedOrbParticleTimer=void 0),this.cursedOrbParticles.forEach(e=>e.destroy()),this.cursedOrbParticles=[],this.cursedOrbGlow&&(this.cursedOrbGlow.destroy(),this.cursedOrbGlow=void 0)}stopCursedTealOrbParticles(){this.cursedTealOrbParticleTimer&&(this.cursedTealOrbParticleTimer.destroy(),this.cursedTealOrbParticleTimer=void 0),this.cursedTealOrbParticles.forEach(e=>e.destroy()),this.cursedTealOrbParticles=[],this.cursedTealOrbGlow&&(this.cursedTealOrbGlow.destroy(),this.cursedTealOrbGlow=void 0)}stopAllCursedOrbParticles(){this.stopCursedOrbParticles()}stopAllCursedTealOrbParticles(){this.stopCursedTealOrbParticles()}playJumpSound(){if(this.scene.registry.get("sfxEnabled")!==!1){let t=`jump-${this.currentJumpSound}`;this.scene.sound.play(t,{volume:.4})}this.currentJumpSound=this.currentJumpSound>=3?1:this.currentJumpSound+1}};var H=class B extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,r,o,n=!1){let l=["blue","yellow","green","red","blue_caterpillar"],c;o?c=o:c=l[Math.floor(Math.random()*l.length)];let h;c==="blue"?h="blueEnemyMouthClosed":c==="purple"?h="purpleEnemyMouthClosed":c==="yellow"?h="yellowEnemyMouthClosedEyeOpen":c==="green"?h="greenEnemy":c==="red"?h="redEnemyMouthClosedEyes1":c==="blue_caterpillar"?h="blueCaterpillarEyesDown":h="blueEnemyMouthClosed";super(e,t,i,h);this.baseSpeed=80;this.bounceTimer=0;this.randomMoveTimer=0;this.isSquished=!1;this.gapDetectionCooldown=0;this.collisionCooldown=0;this.debugGraphics=null;this.debugUpdateHandler=null;this.yellowEnemyAnimationState="mouthClosed";this.blueEnemyAnimationState="idle";this.biteTimer=0;this.blinkTimer=0;this.biteAnimationTimer=0;this.blinkAnimationTimer=0;this.nextExpressionTime=0;this.nextBiteTime=0;this.nextBlinkTime=0;this.blueTextureFixed=!1;this.stuckTimer=0;this.lastPositionX=0;this.stuckThreshold=1500;this.positionCheckInterval=250;this.positionCheckTimer=0;this.positionHistory=[];this.velocityStuckTimer=0;this.individualSpeedMultiplier=1;this.turnDelayTimer=0;this.redEnemyAnimationState="patrol";this.redBiteTimer=0;this.redBlinkTimer=0;this.redBiteSequenceTimer=0;this.redEyeState=1;this.nextRedBiteTime=0;this.nextRedBlinkTime=0;this.redBiteFrameIndex=0;this.greenEnemyAnimationState="eyeRight";this.greenEyeTimer=0;this.greenBlinkTimer=0;this.nextGreenEyeTime=0;this.nextGreenBlinkTime=0;this.blueCaterpillarAnimationState="eyesDown";this.blueCaterpillarEyeTimer=0;this.blueCaterpillarBlinkTimer=0;this.nextBlueCaterpillarEyeTime=0;this.nextBlueCaterpillarBlinkTime=0;this.blueCaterpillarAnimationDelay=0;this.blueCaterpillarAnimationsEnabled=!0;this.blueCaterpillarVelocityLogTimer=0;this.blueCaterpillarVelocityCheckTimer=0;this.blueCaterpillarLastX=0;this.blueCaterpillarStuckFrames=0;this.isStalker=!1;this.stalkerState="hidden";this.stalkerTriggerDistance=64;this.stalkerPlayerRef=null;this.stalkerOriginalY=0;this.stalkerHasPlayerPassed=!1;this.stalkerMineTimer=0;this.stalkerMineDelayDuration=3e3;this.stalkerCurrentSpeed=80*1.5;this.stalkerSpeedIncrement=5;this.stalkerChasePersistenceTimer=0;this.stalkerChasePersistenceDuration=4e3;this.stalkerIsInPersistentChase=!1;this.stalkerEyeState="eye1";this.stalkerEyeAnimationTimer=0;if(this.catColor=c,this.isStalker=n,c==="green"&&(this.setDisplaySize(36,36),console.log("\u{1F7E2} GREEN INITIAL: Display size set to 36x36")),this.isStalker&&(this.stalkerOriginalY=i,e.textures.exists("stalkerEnemyEye1")&&this.setTexture("stalkerEnemyEye1"),this.stalkerEyeState="eye1"),e.add.existing(this),e.physics.add.existing(this),(c==="blue"||c==="purple")&&this.body instanceof Phaser.Physics.Arcade.Body){this.body.setSize(63.5,45);let p=(c==="blue"?this.isBlueEnemyAnimationSprite(h):this.isPurpleEnemyAnimationSprite(h))?32:19;this.body.setOffset(-15.75+2,p-4.5)}else if(c==="yellow"&&this.body instanceof Phaser.Physics.Arcade.Body){let d=this.body.width,p=this.body.height;this.body.setSize(d*.7,p*.7);let u=(d-this.body.width)/2,m=(p-this.body.height)/2;this.body.setOffset(u,m)}else if(c==="blue_caterpillar"&&this.body instanceof Phaser.Physics.Arcade.Body){let d=this.body.width,p=this.body.height;this.body.setSize(54,20)}else if(c==="red"&&this.body instanceof Phaser.Physics.Arcade.Body)if(this.isStalker){let p=this.texture.get().width,u=42,m=u/p,y=12/m;this.body.setCircle(y);let g=y*2,f=(p-g)/2,v=(p-g)/2+14/m;this.body.setOffset(f,v),console.log("\u{1F441}\uFE0F STALKER CIRCULAR HITBOX:"),console.log("  Circle radius:",y,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",u,"x",u)}else{let p=this.texture.get().width,u=this.isStalker?42:52,m=u/p,y=15/m;this.body.setCircle(y);let g=y*2,f=(p-g)/2,v=(p-g)/2+14/m;this.body.setOffset(f,v),console.log("\u{1F534} SNAIL CIRCULAR HITBOX:"),console.log("  Circle radius:",y,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",u,"x",u)}else if(c==="green"&&this.body instanceof Phaser.Physics.Arcade.Body){let d=this.texture.get().width,p=this.texture.get().height,u=this.displayWidth/d,m=this.displayHeight/p,y=12,g=(u+m)/2,f=y/g;this.body.setCircle(f),console.log("\u{1F7E2} GREEN BOUNCER CIRCULAR HITBOX:"),console.log("  Circle radius requested:",y,"px (screen space)"),console.log("  Circle radius actual:",f,"px (texture space)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Current sprite display size:",this.displayWidth,"x",this.displayHeight),console.log("  Texture frame size:",d,"x",p);let v=f*2,S=(d-v)/2,x=(p-v)/2,P=5/g;this.body.setOffset(S,x+P),console.log("  Circle offset applied:",this.body.offset.x,",",this.body.offset.y),console.log("  Average scale:",g),console.log("  Visual offset in texture space:",0,P)}if(this.setCollideWorldBounds(!0),this.setBounce(0),this.body instanceof Phaser.Physics.Arcade.Body&&c!=="green"&&this.body.setAllowGravity(!1),c==="yellow"&&this.isYellowEnemyAnimationSprite(h))this.setDisplaySize(54,21.6),this.setOffset(15,5),this.setFlipX(!1),this.initializeYellowEnemyAnimations();else if(c==="blue_caterpillar"&&this.isBlueCaterpillarAnimationSprite(h)){this.setDisplaySize(64,25.6);let d=this.texture.get().width,p=this.texture.get().height,u=(d-54)/2,m=(p-20)/2,y=23,g=15;this.setOffset(y,g),console.log("  Calculated center offset:",u,",",m),console.log("  Final offset applied:",y,",",g),console.log("  Sprite position:",this.x,",",this.y),this.setFlipX(!1),this.initializeBlueCaterpillarAnimations(),this.blueCaterpillarAnimationsEnabled=!1,this.blueCaterpillarAnimationDelay=1500,this.body instanceof Phaser.Physics.Arcade.Body&&(console.log("  Final physics body offset:",this.body.offset.x,",",this.body.offset.y),console.log("  Physics body position:",this.body.x,",",this.body.y))}else if(c==="blue"&&this.isBlueEnemyAnimationSprite(h))this.setDisplaySize(36,36),this.setOffset(5,32),this.setFlipX(!1),this.initializeBlueEnemyAnimations();else if(c==="purple"&&this.isPurpleEnemyAnimationSprite(h))this.setDisplaySize(36,36),this.setOffset(5,32),this.setFlipX(!1),this.initializeBlueEnemyAnimations();else if(c==="red"&&this.isRedEnemyAnimationSprite(h)){let d=this.isStalker?42:52;this.setDisplaySize(d,d);let p=this.isStalker?24:26;this.setOffset(18,p),this.setFlipX(!1),this.initializeRedEnemyAnimations(),this.isStalker}else c==="green"&&h==="greenEnemy"&&(this.setFlipX(!1),console.log("\u{1F7E2} GREEN VISUAL FINAL:"),console.log("  Display size remains:",this.displayWidth,"x",this.displayHeight),console.log("  Physics body handles visual offset"));this.body instanceof Phaser.Physics.Arcade.Body,this.setDepth(15),this.platformBounds={left:s,right:r},this.setupBehavior(),c==="blue"&&e.textures.exists("blueEnemy")&&this.setFlipX(this.direction>0),this.isStalker?(this.setVisible(!1),this.setVelocity(0,0),this.body.setGravityY(0),this.body.setImmovable(!0)):(this.setVelocityX(this.moveSpeed*this.direction),this.catColor==="blue_caterpillar"&&this.body&&(this.body.setImmovable(!1),this.body.moves=!0))}getCatColor(){return this.catColor}getIsStalker(){return this.isStalker}setupBehavior(){this.individualSpeedMultiplier=.85+Math.random()*.3;let i=(this.scene.levelManager?.getCurrentLevel()||1)<=10;switch(this.catColor){case"blue":case"purple":this.moveSpeed=this.baseSpeed*this.individualSpeedMultiplier;break;case"yellow":let s=i?.4:.6;this.moveSpeed=this.baseSpeed*s*this.individualSpeedMultiplier;break;case"blue_caterpillar":let r=i?.65:.8;this.moveSpeed=this.baseSpeed*r*this.individualSpeedMultiplier;break;case"green":this.moveSpeed=this.baseSpeed*1*this.individualSpeedMultiplier;break;case"red":this.moveSpeed=this.baseSpeed*1.2*this.individualSpeedMultiplier;break}if(this.catColor==="yellow"&&i){let s=(this.platformBounds.left+this.platformBounds.right)/2;this.direction=this.x<s?-1:1}else this.catColor==="green"?(this.direction=Math.random()<.5?-1:1,this.bounceTimer=Math.random()*1500):this.direction=Math.random()<.5?-1:1}update(e,t){if(!this.isSquished){if(this.collisionCooldown-=t,this.isStalker){this.updateStalker(t);return}if(this.body)switch(this.catColor){case"blue":case"purple":this.updateBluePatrol(),this.updateBlueEnemyAnimations(t),this.checkIfChomperStuck(t);break;case"yellow":this.updateYellowPatrol(t),this.updateYellowEnemyAnimations(t),this.checkIfCaterpillarStuck(t);break;case"blue_caterpillar":this.updateBlueCaterpillarPatrol(t),this.updateBlueCaterpillarAnimations(t),this.checkIfCaterpillarStuck(t);break;case"green":this.updateGreenBounce(t),this.updateGreenEnemyAnimations(t);break;case"red":this.updateRedPatrol(),this.updateRedEnemyAnimations(t);break}}}updateBluePatrol(){(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&this.setVelocityX(0),this.turnDelayTimer>0&&(this.turnDelayTimer-=Phaser.Math.Clamp(16,0,100));let e=40;this.x<=this.platformBounds.left+e?this.turnDelayTimer<=0&&(this.direction=1,this.x<this.platformBounds.left+20&&(this.x=this.platformBounds.left+20),this.turnDelayTimer=50+Math.random()*150,(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+1e3,this.setVelocityX(this.moveSpeed*this.direction))):this.x>=this.platformBounds.right-e&&this.turnDelayTimer<=0&&(this.direction=-1,this.x>this.platformBounds.right-20&&(this.x=this.platformBounds.right-20),this.turnDelayTimer=50+Math.random()*150,(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full")&&(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+1e3,this.setVelocityX(this.moveSpeed*this.direction))),this.blueEnemyAnimationState==="idle"&&this.setVelocityX(this.moveSpeed*this.direction),(this.catColor==="blue"||this.catColor==="purple")&&this.setFlipX(this.direction>0)}updateYellowPatrol(e){let s=(this.scene.levelManager?.getCurrentLevel()||1)<=10;if(this.randomMoveTimer-=e,this.randomMoveTimer<=0){let n=s?.05:.3;Math.random()<n&&(this.direction=Math.random()<.5?-1:1),s?this.randomMoveTimer=2e3+Math.random()*1e3:this.randomMoveTimer=500+Math.random()*1e3}this.turnDelayTimer>0&&(this.turnDelayTimer-=e);let r=Math.abs(this.body.velocity.x)<5&&Math.abs(this.moveSpeed)>0,o=35;this.x<=this.platformBounds.left+o||r&&this.direction===-1?this.turnDelayTimer<=0&&(this.direction=1,this.turnDelayTimer=100+Math.random()*400):(this.x>=this.platformBounds.right-o||r&&this.direction===1)&&this.turnDelayTimer<=0&&(this.direction=-1,this.turnDelayTimer=100+Math.random()*400),this.setVelocityX(this.moveSpeed*this.direction),this.isYellowEnemyAnimationSprite(this.texture.key)&&this.setFlipX(this.direction===1)}updateGreenBounce(e){if(this.bounceTimer-=e,this.bounceTimer<=0&&this.body?.touching.down&&(this.setVelocityY(-200),this.bounceTimer=1e3+Math.random()*1e3),this.x<=this.platformBounds.left+20){this.direction=1;let t=.9+Math.random()*.2;this.setVelocityX(this.moveSpeed*this.direction*t)}else if(this.x>=this.platformBounds.right-20){this.direction=-1;let t=.9+Math.random()*.2;this.setVelocityX(this.moveSpeed*this.direction*t)}else this.setVelocityX(this.moveSpeed*this.direction)}updateRedPatrol(){if(this.x<=this.platformBounds.left+25?(this.direction=1,this.x<=this.platformBounds.left+5&&this.setX(this.platformBounds.left+5)):this.x>=this.platformBounds.right-25&&(this.direction=-1,this.x>=this.platformBounds.right-5&&this.setX(this.platformBounds.right-5)),Math.random()<5e-4&&this.x>this.platformBounds.left+25&&this.x<this.platformBounds.right-25&&(this.direction*=-1),this.x<this.platformBounds.left+5||this.x>this.platformBounds.right-5){let t=Math.max(this.platformBounds.left+5,Math.min(this.platformBounds.right-5,this.x));this.setX(t),this.direction*=-1}this.setVelocityX(this.moveSpeed*this.direction)}reverseDirection(){this.isSquished||this.collisionCooldown<=0&&(this.direction*=-1,this.setVelocityX(this.moveSpeed*this.direction),this.collisionCooldown=200,this.catColor==="blue"&&this.setFlipX(this.direction>0))}getDirection(){return this.direction}squish(){this.isSquished||(this.isSquished=!0,this.setVelocity(0,0),this.body&&(this.body.enable=!1),this.cleanupDebugVisualization(),this.scene.tweens.add({targets:this,scaleY:.2,scaleX:1.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.cats&&this.scene.cats.remove(this),this.destroy()}}))}addDebugVisualization(){w.debug&&(this.debugGraphics=this.scene.add.graphics(),this.debugUpdateHandler=()=>{if(this.debugGraphics&&this.debugGraphics.active&&this.active){this.debugGraphics.clear(),this.debugGraphics.lineStyle(2,255,.8);let e=this.displayWidth,t=this.displayHeight;this.debugGraphics.strokeRect(this.x-e/2,this.y-t/2,e,t),this.debugGraphics.lineStyle(1,16777215,.8),this.debugGraphics.lineBetween(this.x-5,this.y,this.x+5,this.y),this.debugGraphics.lineBetween(this.x,this.y-5,this.x,this.y+5);let i=this.body;i&&(this.debugGraphics.lineStyle(2,16711680,.8),this.debugGraphics.strokeRect(i.x,i.y,i.width,i.height))}},this.scene.events.on("postupdate",this.debugUpdateHandler),this.debugGraphics.setDepth(25),this.scene.add.existing(this.debugGraphics))}cleanupDebugVisualization(){this.debugUpdateHandler&&(this.scene.events.off("postupdate",this.debugUpdateHandler),this.debugUpdateHandler=null),this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=null)}addRoundedHitboxVisualization(){}isYellowEnemyAnimationSprite(e){return["yellowEnemyMouthOpenEyeOpen","yellowEnemyMouthOpenBlinking","yellowEnemyMouthClosedEyeOpen","yellowEnemyMouthClosedBlinking"].includes(e)}isBlueEnemyAnimationSprite(e){return["blueEnemyMouthClosed","blueEnemyMouthClosedBlinking","blueEnemyMouthPartialOpen","blueEnemyMouthPartialOpenBlinking","blueEnemyMouthOpen","blueEnemyMouthOpenBlinking"].includes(e)}isPurpleEnemyAnimationSprite(e){return["purpleEnemyMouthClosed","purpleEnemyMouthPartialOpen","purpleEnemyMouthOpen"].includes(e)}initializeYellowEnemyAnimations(){this.nextBlinkTime=Math.random()*1e3+1e3,this.nextExpressionTime=Math.random()*3e3+3e3,this.yellowEnemyAnimationState="mouthClosed"}initializeBlueEnemyAnimations(){this.nextBiteTime=Math.random()*2e3+2e3,this.nextBlinkTime=Number.MAX_SAFE_INTEGER,this.blueEnemyAnimationState="idle"}updateBlueEnemyAnimations(e){if(!this.isBlueEnemyAnimationSprite(this.texture.key)&&!this.isPurpleEnemyAnimationSprite(this.texture.key)){this.catColor==="blue"&&!this.blueTextureFixed&&this.scene.textures.exists("blueEnemyMouthClosed")?(this.setTexture("blueEnemyMouthClosed"),this.setDisplaySize(36,36),this.blueTextureFixed=!0,this.initializeBlueEnemyAnimations()):this.catColor==="purple"&&!this.blueTextureFixed&&this.scene.textures.exists("purpleEnemyMouthClosed")&&(this.setTexture("purpleEnemyMouthClosed"),this.setDisplaySize(36,36),this.blueTextureFixed=!0,this.initializeBlueEnemyAnimations());return}switch(this.blueTextureFixed=!1,this.biteTimer+=e,this.biteAnimationTimer+=e,this.blueEnemyAnimationState){case"idle":this.handleIdleState();break;case"bite_partial":this.handleBitePartialState();break;case"bite_full":this.handleBiteFullState();break;case"blinking":this.blueEnemyAnimationState="idle";break}this.checkForNewAnimations()}handleIdleState(){this.changeBlueEnemyTexture("blueEnemyMouthClosed")}handleBitePartialState(){this.biteAnimationTimer<150?this.changeBlueEnemyTexture("blueEnemyMouthPartialOpen"):this.biteAnimationTimer>300?(console.warn("Bite partial state exceeded max duration - forcing transition"),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+3e3,this.setVelocityX(this.moveSpeed*this.direction)):(this.blueEnemyAnimationState="bite_full",this.biteAnimationTimer=0)}handleBiteFullState(){this.biteAnimationTimer<200?this.changeBlueEnemyTexture("blueEnemyMouthOpen"):this.biteAnimationTimer>350?(console.warn("Bite full state exceeded max duration - forcing idle"),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+3e3,this.setVelocityX(this.moveSpeed*this.direction)):(this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.nextBiteTime=this.biteTimer+Math.random()*2e3+2e3,this.setVelocityX(this.moveSpeed*this.direction))}handleBlinkingState(){this.blueEnemyAnimationState="idle",this.blinkAnimationTimer=0,this.nextBlinkTime=Number.MAX_SAFE_INTEGER}checkForNewAnimations(){this.biteTimer>=this.nextBiteTime&&this.blueEnemyAnimationState==="idle"&&(this.blueEnemyAnimationState="bite_partial",this.biteAnimationTimer=0)}changeBlueEnemyTexture(e){if(!this.scene)return;let t=e;if(this.catColor==="purple"&&(e==="blueEnemyMouthClosed"?t="purpleEnemyMouthClosed":e==="blueEnemyMouthPartialOpen"?t="purpleEnemyMouthPartialOpen":e==="blueEnemyMouthOpen"&&(t="purpleEnemyMouthOpen")),this.scene.textures.exists(t))this.setTexture(t),this.setDisplaySize(36,36);else{let i=this.catColor==="purple"?"purpleEnemyMouthClosed":"blueEnemyMouthClosed";this.scene.textures.exists(i)&&(this.setTexture(i),this.setDisplaySize(36,36))}}checkIfChomperStuck(e){if(this.positionCheckTimer+=e,this.positionCheckTimer>=this.positionCheckInterval&&(this.positionHistory.push(this.x),this.positionHistory.length>8&&this.positionHistory.shift(),this.positionCheckTimer=0),Math.abs(this.body.velocity.x)<1){if(this.velocityStuckTimer+=e,this.velocityStuckTimer>1e3&&this.x>this.platformBounds.left+40&&this.x<this.platformBounds.right-40){console.warn("Chomper velocity stuck - forcing reset"),this.forceResetChomper();return}}else this.velocityStuckTimer=0;if(this.positionHistory.length>=4&&this.positionHistory.every(i=>Math.abs(i-this.positionHistory[0])<2)&&this.x>this.platformBounds.left+40&&this.x<this.platformBounds.right-40){console.warn("Chomper position stuck (not at edge) - forcing reset"),this.forceResetChomper();return}if(this.blueEnemyAnimationState==="bite_partial"||this.blueEnemyAnimationState==="bite_full"){if(this.biteAnimationTimer>400){console.warn("Bite animation taking too long - forcing reset"),this.forceResetChomper();return}let t=this.x;if(Math.abs(t-this.lastPositionX)>1)this.stuckTimer=0;else if(this.stuckTimer+=e,this.stuckTimer>=this.stuckThreshold){console.error("Chomper stuck during bite - forcing recovery!"),this.forceResetChomper();return}this.lastPositionX=t}else this.stuckTimer=0,this.lastPositionX=this.x}forceResetChomper(){console.warn("=== FORCE RESETTING STUCK CHOMPER ==="),this.blueEnemyAnimationState="idle",this.biteAnimationTimer=0,this.blinkAnimationTimer=0,this.biteTimer=0,this.blinkTimer=0,this.nextBiteTime=5e3,this.nextBlinkTime=Number.MAX_SAFE_INTEGER,this.stuckTimer=0,this.positionCheckTimer=0,this.velocityStuckTimer=0,this.positionHistory=[],this.changeBlueEnemyTexture("blueEnemyMouthClosed"),this.x<=this.platformBounds.left+50?(this.direction=1,this.x=this.platformBounds.left+51):this.x>=this.platformBounds.right-50?(this.direction=-1,this.x=this.platformBounds.right-51):this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction*1.2),this.scene.time.delayedCall(500,()=>{this.active&&this.setVelocityX(this.moveSpeed*this.direction)}),this.setData("recoveredFromStuck",!0),this.setData("stuckRecoveryCount",(this.getData("stuckRecoveryCount")||0)+1),this.getData("stuckRecoveryCount")>=2&&(console.error("Chomper stuck 2+ times - marking for replacement"),this.setData("needsReplacement",!0))}checkIfCaterpillarStuck(e){if(!this.body)return;let t=this.catColor==="blue_caterpillar"?"Blue Caterpillar":"Yellow Caterpillar";if(this.positionCheckTimer+=e,this.positionCheckTimer>=this.positionCheckInterval&&(this.positionHistory.push(this.x),this.positionHistory.length>6&&this.positionHistory.shift(),this.positionCheckTimer=0),!!this.body){if(Math.abs(this.body.velocity.x)<1){if(this.velocityStuckTimer+=e,this.velocityStuckTimer>400&&this.x>this.platformBounds.left+30&&this.x<this.platformBounds.right-30){this.forceResetCaterpillar();return}}else this.velocityStuckTimer=0;if(this.positionHistory.length>=4&&this.positionHistory.every(s=>Math.abs(s-this.positionHistory[0])<3)&&this.x>this.platformBounds.left+30&&this.x<this.platformBounds.right-30){this.forceResetCaterpillar();return}(this.x<this.platformBounds.left-10||this.x>this.platformBounds.right+10)&&this.forceResetCaterpillar()}}replaceSelfWithYellowCaterpillar(){let e=new B(this.scene,this.x,this.y,this.platformBounds.left,this.platformBounds.right,"yellow",!1);this.speedMultiplier&&e.setSpeedMultiplier(this.speedMultiplier);let t=this.scene;t.yellowEnemies&&t.yellowEnemies.add(e),t.cats&&t.cats.add(e),t.blueCaterpillars&&t.blueCaterpillars.remove(this),t.cats&&t.cats.remove(this),this.destroy()}forceResetCaterpillar(){let e=this.catColor==="blue_caterpillar"?"Blue Caterpillar":"Yellow Caterpillar";this.catColor==="blue_caterpillar"?(this.blueCaterpillarAnimationState="eyesDown",this.blueCaterpillarBlinkTimer=0,this.blueCaterpillarEyeTimer=0,this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500,this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.scene&&this.scene.textures.exists("blueCaterpillarEyesDown")&&this.setTexture("blueCaterpillarEyesDown")):(this.yellowAnimationState="mouth_closed",this.yellowBlinkTimer=0,this.yellowMouthTimer=0),this.stuckTimer=0,this.positionCheckTimer=0,this.velocityStuckTimer=0,this.positionHistory=[],this.randomMoveTimer=200,this.turnDelayTimer=0;let t=(this.platformBounds.left+this.platformBounds.right)/2;if(this.x<t?this.direction=1:this.direction=-1,this.x<=this.platformBounds.left+20||this.x>=this.platformBounds.right-20){let i=this.platformBounds.left+50+Math.random()*(this.platformBounds.right-this.platformBounds.left-100);this.setX(i)}this.setVelocityX(this.moveSpeed*this.direction*1.5),this.scene.time.delayedCall(500,()=>{this.active&&this.setVelocityX(this.moveSpeed*this.direction)}),this.setData("recoveredFromStuck",!0),this.setData("stuckRecoveryCount",(this.getData("stuckRecoveryCount")||0)+1),this.getData("stuckRecoveryCount")>=3&&this.setData("needsReplacement",!0)}isRedEnemyAnimationSprite(e){return["redEnemyMouthClosedEyes1","redEnemyMouthClosedEyes2","redEnemyMouthClosedBlinking","redEnemyMouthPartialOpenEyes1Wink","redEnemyMouthPartialOpenEyes2","redEnemyMouthWideOpenEyes1Wink","redEnemyMouthWideOpenEyes2","redEnemyMouthWideOpenEyes3"].includes(e)}initializeRedEnemyAnimations(){this.nextRedBiteTime=Math.random()*2e3+3e3,this.nextRedBlinkTime=Math.random()*500+1e3,this.redEnemyAnimationState="patrol",this.redEyeState=Math.random()<.5?1:2}updateYellowEnemyAnimations(e){if(!this.isYellowEnemyAnimationSprite(this.texture.key))return;this.biteTimer+=e,this.biteTimer>=this.nextExpressionTime&&(this.yellowEnemyAnimationState=this.yellowEnemyAnimationState==="mouthClosed"?"mouthOpen":"mouthClosed",this.nextExpressionTime=this.biteTimer+Math.random()*3e3+3e3);let t="yellowEnemyMouthClosedEyeOpen";this.yellowEnemyAnimationState==="mouthOpen"&&(t="yellowEnemyMouthOpenEyeOpen"),this.texture.key!==t&&this.setTexture(t)}updateRedEnemyAnimations(e){if(this.isRedEnemyAnimationSprite(this.texture.key)){switch(this.redBiteTimer+=e,this.redBlinkTimer+=e,this.redBiteSequenceTimer+=e,this.redEnemyAnimationState){case"patrol":this.handleRedPatrolState();break;case"bite_starting":this.handleRedBiteStartingState();break;case"bite_opening":this.handleRedBiteOpeningState();break;case"bite_wide":this.handleRedBiteWideState();break;case"bite_closing":this.handleRedBiteClosingState();break}this.checkForRedAnimationTriggers()}}handleRedPatrolState(){let e=800+Math.random()*400;this.redBiteSequenceTimer>=e&&(this.redEyeState=this.redEyeState===1?2:1,this.redBiteSequenceTimer=0),this.changeRedEnemyTexture(this.redEyeState===1?"redEnemyMouthClosedEyes1":"redEnemyMouthClosedEyes2")}handleRedBiteStartingState(){this.redBiteSequenceTimer<80?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes2"):(this.redEnemyAnimationState="bite_opening",this.redBiteSequenceTimer=0,this.redBiteFrameIndex=0)}handleRedBiteOpeningState(){this.redBiteSequenceTimer<100?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes1Wink"):(this.redEnemyAnimationState="bite_wide",this.redBiteSequenceTimer=0,this.redBiteFrameIndex=0)}handleRedBiteWideState(){let e=["redEnemyMouthWideOpenEyes1Wink","redEnemyMouthWideOpenEyes2","redEnemyMouthWideOpenEyes3"],i=Math.floor(this.redBiteSequenceTimer/120);i<e.length?this.changeRedEnemyTexture(e[i]):(this.redEnemyAnimationState="bite_closing",this.redBiteSequenceTimer=0)}handleRedBiteClosingState(){this.redBiteSequenceTimer<80?this.changeRedEnemyTexture("redEnemyMouthPartialOpenEyes2"):(this.redEnemyAnimationState="patrol",this.redBiteSequenceTimer=0,this.nextRedBiteTime=this.redBiteTimer+Math.random()*2e3+3e3)}checkForRedAnimationTriggers(){this.redBiteTimer>=this.nextRedBiteTime&&this.redEnemyAnimationState==="patrol"&&(this.redEnemyAnimationState="bite_starting",this.redBiteSequenceTimer=0),this.redBlinkTimer>=this.nextRedBlinkTime&&(this.redEnemyAnimationState==="patrol"&&(this.changeRedEnemyTexture("redEnemyMouthClosedBlinking"),this.scene.time.delayedCall(150,()=>{this.redEnemyAnimationState==="patrol"&&this.changeRedEnemyTexture(this.redEyeState===1?"redEnemyMouthClosedEyes1":"redEnemyMouthClosedEyes2")})),this.nextRedBlinkTime=this.redBlinkTimer+Math.random()*1e3+1e3)}changeRedEnemyTexture(e){this.scene&&this.scene.textures.exists(e)&&(this.setTexture(e),this.setDisplaySize(52,52),this.catColor==="red"&&this.setFlipX(this.direction>0))}setPlayerReference(e){this.stalkerPlayerRef=e}canDamagePlayer(){return this.isStalker&&this.stalkerState==="chasing"}updateStalker(e){if(!this.stalkerPlayerRef)return;let t=this.y;switch(this.stalkerState){case"hidden":this.updateStalkerHidden();break;case"activated":this.updateStalkerActivated(e);break;case"chasing":this.updateStalkerChasing(e),this.updateStalkerEyeAnimations(e);break}Math.abs(this.y-t)>.1}updateStalkerHidden(){if(!this.stalkerPlayerRef)return;let e=this.stalkerPlayerRef.x,t=this.stalkerPlayerRef.y,i=Math.abs(e-this.x),s=t<=this.y+40,r=t>=this.y-40;s&&r&&i<=this.stalkerTriggerDistance&&!this.stalkerHasPlayerPassed&&(this.stalkerState="activated",this.stalkerMineTimer=this.stalkerMineDelayDuration,this.stalkerHasPlayerPassed=!0,this.scene.textures.exists("stalkerEnemyEyeOnly")&&this.setTexture("stalkerEnemyEyeOnly"),this.setVisible(!0))}updateStalkerActivated(e){this.stalkerMineTimer-=e,this.stalkerMineTimer<=0&&this.stalkerPopOut()}stalkerPopOut(){this.stalkerState="chasing",this.setVisible(!0),this.scene.textures.exists("stalkerEnemyEye1")&&this.setTexture("stalkerEnemyEye1"),this.stalkerEyeState="eye1",this.body.setGravityY(0),this.body.setImmovable(!1),this.stalkerOriginalY=this.y,this.stalkerCurrentSpeed=80*1.5,this.stalkerChasePersistenceTimer=this.stalkerChasePersistenceDuration,this.stalkerIsInPersistentChase=!0}updateStalkerChasing(e){let t=this.stalkerPlayerRef.x,i=this.stalkerPlayerRef.y,s=this.y;this.y=this.stalkerOriginalY,Math.abs(s-this.stalkerOriginalY)>.1;let r=i<=this.y+40,o=i>=this.y-120,n=r&&o;if(this.stalkerIsInPersistentChase&&(this.stalkerChasePersistenceTimer-=e,this.stalkerChasePersistenceTimer<=0&&(this.stalkerIsInPersistentChase=!1)),n){this.stalkerCurrentSpeed+=this.stalkerSpeedIncrement*.01;let l=80*2.25;this.stalkerCurrentSpeed>l&&(this.stalkerCurrentSpeed=l);let c=t>this.x?1:-1;this.direction=c,this.setVelocityX(this.stalkerCurrentSpeed*c)}else if(this.stalkerIsInPersistentChase){let l=t>this.x?1:-1;this.direction=l,this.setVelocityX(this.stalkerCurrentSpeed*l*.7)}else this.updateRedPatrol()}updateStalkerEyeAnimations(e){if(!this.scene||!this.scene.textures.exists("stalkerEnemyEye1"))return;this.stalkerEyeAnimationTimer+=e;let t;if(this.stalkerEyeState==="blink"?t=100+Math.random()*80:t=1200+(Math.random()-.5)*800,this.stalkerEyeAnimationTimer>=t){let i=Math.random();if(this.stalkerEyeState==="blink"){let o=["eye1","eye2","eye3","eye4"];this.stalkerEyeState=o[Math.floor(Math.random()*4)]}else if(i<.2)this.stalkerEyeState="blink";else{let o=["eye1","eye2","eye3","eye4"];this.stalkerEyeState=o[Math.floor(Math.random()*4)]}let r={eye1:"stalkerEnemyEye1",eye2:"stalkerEnemyEye2",eye3:"stalkerEnemyEye3",eye4:"stalkerEnemyEye4",blink:"stalkerEnemyBlinking"}[this.stalkerEyeState];this.scene.textures.exists(r)&&this.setTexture(r),this.stalkerEyeAnimationTimer=0}}updateGreenEnemyAnimations(e){if(this.greenEyeTimer+=e,this.greenBlinkTimer+=e,this.nextGreenEyeTime===0&&(this.nextGreenEyeTime=1e3+Math.random()*2e3),this.nextGreenBlinkTime===0&&(this.nextGreenBlinkTime=3e3+Math.random()*4e3),this.greenBlinkTimer>=this.nextGreenBlinkTime){this.greenEnemyAnimationState="blinking",this.setTexture("greenEnemyBlink"),setTimeout(()=>{if(this.greenEnemyAnimationState==="blinking"){let t=["eyeRight","eyeCenter","eyeLeft"];this.greenEnemyAnimationState=t[Math.floor(Math.random()*t.length)],this.updateGreenEnemyTexture()}},100+Math.random()*50),this.greenBlinkTimer=0,this.nextGreenBlinkTime=3e3+Math.random()*4e3;return}if(this.greenEnemyAnimationState!=="blinking"&&this.greenEyeTimer>=this.nextGreenEyeTime){let t=this.greenEnemyAnimationState,s=["eyeRight","eyeCenter","eyeLeft"].filter(r=>r!==t);this.greenEnemyAnimationState=s[Math.floor(Math.random()*s.length)],this.updateGreenEnemyTexture(),this.greenEyeTimer=0,this.nextGreenEyeTime=800+Math.random()*1500}}updateGreenEnemyTexture(){let e="greenEnemy";switch(this.greenEnemyAnimationState){case"eyeRight":e="greenEnemy";break;case"eyeCenter":e="greenEnemyEyeCenter";break;case"eyeLeft":e="greenEnemyEyeLeft";break;case"blinking":e="greenEnemyBlink";break}this.scene&&this.scene.textures.exists(e)&&this.setTexture(e)}isBlueCaterpillarAnimationSprite(e){return["blueCaterpillarEyesRight","blueCaterpillarEyesLeft","blueCaterpillarEyesDown","blueCaterpillarBlinking"].includes(e)}initializeBlueCaterpillarAnimations(){this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500,this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.blueCaterpillarAnimationState="eyesDown"}updateBlueCaterpillarPatrol(e){if(!this.body||!this.body.enable)return;if(this.blueCaterpillarLastX||(this.blueCaterpillarLastX=this.x,this.blueCaterpillarStuckFrames=0),Math.abs(this.x-this.blueCaterpillarLastX)<.01){if(this.blueCaterpillarStuckFrames++,this.blueCaterpillarStuckFrames===60){this.replaceSelfWithYellowCaterpillar();return}}else this.blueCaterpillarStuckFrames=0;this.blueCaterpillarLastX=this.x,this.setVelocityX(this.moveSpeed*this.direction),this.blueCaterpillarVelocityCheckTimer||(this.blueCaterpillarVelocityCheckTimer=0),this.blueCaterpillarVelocityCheckTimer+=e,this.blueCaterpillarVelocityCheckTimer>500&&Math.abs(this.body.velocity.x)<5&&(this.blueCaterpillarVelocityCheckTimer=0),this.turnDelayTimer>0&&(this.turnDelayTimer-=e);let i=35;if(this.x<=this.platformBounds.left+i){if(this.turnDelayTimer<=0){this.direction=1,this.turnDelayTimer=100+Math.random()*200;let s=Math.max(this.platformBounds.left+i+5,this.x);this.setX(s),this.setVelocityX(this.moveSpeed*this.direction)}}else if(this.x>=this.platformBounds.right-i&&this.turnDelayTimer<=0){this.direction=-1,this.turnDelayTimer=100+Math.random()*200;let s=Math.min(this.platformBounds.right-i-5,this.x);this.setX(s),this.setVelocityX(this.moveSpeed*this.direction)}if(this.setVelocityX(this.moveSpeed*this.direction),this.x<this.platformBounds.left+5||this.x>this.platformBounds.right-5){let s=Math.max(this.platformBounds.left+10,Math.min(this.platformBounds.right-10,this.x));this.setX(s),this.direction*=-1,this.setVelocityX(this.moveSpeed*this.direction)}this.isBlueCaterpillarAnimationSprite(this.texture.key)&&this.setFlipX(this.direction===1)}updateBlueCaterpillarAnimations(e){if(!this.blueCaterpillarAnimationsEnabled){this.blueCaterpillarAnimationDelay-=e,this.blueCaterpillarAnimationDelay<=0&&(this.blueCaterpillarAnimationsEnabled=!0);return}if(!this.isBlueCaterpillarAnimationSprite(this.texture.key))return;if(this.blueCaterpillarBlinkTimer+=e,this.blueCaterpillarEyeTimer+=e,this.blueCaterpillarAnimationState==="blinking"&&this.blueCaterpillarBlinkTimer>=200&&(this.blueCaterpillarAnimationState="eyesDown",this.blueCaterpillarBlinkTimer=0,this.nextBlueCaterpillarBlinkTime=Math.random()*1500+1500),this.blueCaterpillarEyeTimer>=this.nextBlueCaterpillarEyeTime&&this.blueCaterpillarAnimationState!=="blinking"){let i=["eyesRight","eyesLeft","eyesDown"],r=(i.indexOf(this.blueCaterpillarAnimationState)+1)%i.length;this.blueCaterpillarAnimationState=i[r],this.nextBlueCaterpillarEyeTime=Math.random()*2e3+1e3,this.blueCaterpillarEyeTimer=0}this.blueCaterpillarBlinkTimer>=this.nextBlueCaterpillarBlinkTime&&this.blueCaterpillarAnimationState!=="blinking"&&(this.blueCaterpillarAnimationState="blinking",this.blueCaterpillarBlinkTimer=0);let t="blueCaterpillarEyesDown";switch(this.blueCaterpillarAnimationState){case"eyesRight":t="blueCaterpillarEyesRight";break;case"eyesLeft":t="blueCaterpillarEyesLeft";break;case"eyesDown":t="blueCaterpillarEyesDown";break;case"blinking":t="blueCaterpillarBlinking";break}this.texture.key!==t&&this.scene&&this.scene.textures.exists(t)&&this.setTexture(t)}};var Q=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i){super(e,t-15,i-8,"baseblue-eyes-center");this.isPushing=!1;this.platform=null;this.platformLeft=0;this.platformRight=0;this.isStunned=!1;this.stunEndTime=0;this.eyeSprites=["baseblue-eyes-center","baseblue-eyes-down","baseblue-eyes-down-right","baseblue-eyes-middle-right","baseblue-eyes-up","baseblue-eyes-up-left","baseblue-eyes-middle-left","baseblue-eyes-down-left","baseblue-eyes-blinking"];this.currentEyeIndex=0;this.blinkTimer=0;this.nextBlinkTime=0;this.eyeMovementTimer=0;this.nextEyeMovementTime=0;this.isBlinking=!1;this.isRollingEyes=!1;this.eyeRollSequence=[];this.eyeRollIndex=0;e.add.existing(this),e.physics.add.existing(this),this.setDisplaySize(48,48),this.setCollideWorldBounds(!1),this.setBounce(0),this.setGravityY(w.game.gravity),this.setSize(42,46);let s=this.body;s.setImmovable(!0),s.setMass(1e4),s.moves=!1,this.setOffset(20,19);let r=.9+Math.random()*.2;this.movementSpeed=20*r,this.direction=Math.random()<.5?-1:1,this.nextBlinkTime=Phaser.Math.Between(2e3,5e3),this.nextEyeMovementTime=Phaser.Math.Between(1e3,3e3),this.setDepth(15)}setPlatformBounds(e,t){this.platformLeft=e,this.platformRight=t}setInitialDirection(e){this.direction=e}update(e,t){let i=this.body;if(this.isStunned&&e>=this.stunEndTime&&this.endStun(),!this.isStunned){if(!this.isPushing){let s=this.x,r=this.direction;this.x<=this.platformLeft+16?(this.direction=1,this.x=this.platformLeft+16):this.x>=this.platformRight-16&&(this.direction=-1,this.x=this.platformRight-16);let o=this.movementSpeed*this.direction*t/1e3;this.x+=o,this.setFlipX(this.direction>0)}this.updateEyeAnimations(e,t)}}updateEyeAnimations(e,t){if(this.isRollingEyes&&this.eyeRollSequence.length>0){if(this.eyeMovementTimer+=t,this.eyeMovementTimer>=150)if(this.eyeMovementTimer=0,this.eyeRollIndex++,this.eyeRollIndex>=this.eyeRollSequence.length)this.isRollingEyes=!1,this.eyeRollSequence=[],this.eyeRollIndex=0,this.setTexture("baseblue-eyes-center");else{let i=this.eyeRollSequence[this.eyeRollIndex];this.setTexture(this.eyeSprites[i])}return}if(this.blinkTimer+=t,this.isBlinking?this.blinkTimer>=150&&(this.isBlinking=!1,this.blinkTimer=0,this.nextBlinkTime=Phaser.Math.Between(2e3,5e3),this.setTexture("baseblue-eyes-center")):this.blinkTimer>=this.nextBlinkTime&&(this.isBlinking=!0,this.blinkTimer=0,this.setTexture("baseblue-eyes-blinking")),!this.isBlinking&&(this.eyeMovementTimer+=t,this.eyeMovementTimer>=this.nextEyeMovementTime))if(this.eyeMovementTimer=0,this.nextEyeMovementTime=Phaser.Math.Between(1e3,3e3),Math.random()<.15)this.startEyeRoll();else{let i=Phaser.Math.Between(0,7);this.setTexture(this.eyeSprites[i])}}startEyeRoll(){this.isRollingEyes=!0,this.eyeRollIndex=0,this.eyeMovementTimer=0,this.eyeRollSequence=[4,3,3,2,1,7,6,5,4]}startPushing(){this.isPushing=!0}stopPushing(){this.isPushing=!1}startStun(){this.isStunned||this.scene&&(this.isStunned=!0,this.stunEndTime=this.scene.time.now+2e3,this.setTexture("baseblue-eyes-blinking"))}endStun(){this.isStunned=!1,this.setTexture("baseblue-eyes-center")}handlePlayerBounce(){}canBeKilledByInvinciblePlayer(){return!0}handleInvinciblePlayerKill(){return this.squish(),1e3}squish(){this.scene&&this.scene.tweens.add({targets:this,scaleY:.3,scaleX:1.2,alpha:.8,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.baseBlus&&this.scene.baseBlus.remove(this),this.destroy()}})}isPlayerColliding(e){let t=e.getBounds(),i=this.getBounds(),s=Math.min(t.bottom,i.bottom)-Math.max(t.top,i.top),r=Math.min(t.right,i.right)-Math.max(t.left,i.left);return s>0&&r>0&&s<i.height*.5?!1:r>0&&s>0}destroy(){super.destroy()}};var ee=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,r){let o=e.textures.exists("beetle-mouth-closed")?"beetle-mouth-closed":"beetle";if(!e.textures.exists("beetle-mouth-closed")){let g=e.add.graphics();g.fillStyle(16711680,1),g.fillRect(0,0,20,16),g.generateTexture("beetle",20,16),g.destroy()}super(e,t,i,o);this.animationTimer=0;this.currentFrame=0;this.animationFrames=["beetle-mouth-closed","beetle-mouth-open-30","beetle-mouth-open-70","beetle-mouth-open-30"];this.totalRotation=0;this.rotationFactor=.004;this.isRolling=!0;this.isBiting=!1;this.nextActionDistance=0;this.distanceTraveled=0;this.biteAnimationTimer=0;this.biteDuration=1200;this.isSquished=!1;e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.setBounce(0);let n=45;this.setDisplaySize(n,n);let l=19,c=this.texture.get().width,h=this.texture.get().height,d=n/c,p=n/h,u=(d+p)/2,m=l/u;if(this.body instanceof Phaser.Physics.Arcade.Body){this.body.setCircle(m);let g=m*2,f=(n-l*2)/2,v=f/u,S=f/u;this.body.setOffset(v,S),console.log("\u{1FAB2} BEETLE CIRCULAR HITBOX:"),console.log("  Circle diameter:",l*2,"px (38px as requested)"),console.log("  Body is circular:",this.body.isCircle),console.log("  Display size:",n,"x",n),console.log("  Centering offset:",v,",",S,"(texture space)"),console.log("  Visual sprite centered on hitbox: \u2705")}this.setDepth(15),this.platformBounds={left:s,right:r};let y=.9+Math.random()*.2;this.moveSpeed=80*y,this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction),this.nextActionDistance=100+Math.random()*200}update(e,t){if(t)if(this.x<=this.platformBounds.left+10?this.direction=1:this.x>=this.platformBounds.right-10&&(this.direction=-1),this.isRolling){this.setVelocityX(this.moveSpeed*this.direction),this.distanceTraveled+=Math.abs(this.moveSpeed*this.direction*(t/1e3));let i=this.moveSpeed*this.rotationFactor;this.totalRotation+=i*this.direction,this.setRotation(this.totalRotation),this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed"),this.distanceTraveled>=this.nextActionDistance&&this.startBiting()}else this.isBiting&&(this.setVelocityX(0),this.biteAnimationTimer+=t,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.animateBiting(t),this.biteAnimationTimer>=this.biteDuration&&this.startRolling())}startBiting(){this.isRolling=!1,this.isBiting=!0,this.biteAnimationTimer=0,this.currentFrame=0,this.animationTimer=0,this.setRotation(0),this.totalRotation=0}startRolling(){this.isRolling=!0,this.isBiting=!1,this.distanceTraveled=0,this.nextActionDistance=50+Math.random()*200,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed")}animateBiting(e){if(this.animationTimer+=e,this.animationTimer>=300){this.animationTimer=0,this.currentFrame=(this.currentFrame+1)%this.animationFrames.length;let t=this.animationFrames[this.currentFrame];this.scene&&this.scene.textures.exists(t)&&this.setTexture(t)}}reverseDirection(){this.direction*=-1,this.isRolling&&this.setVelocityX(this.moveSpeed*this.direction)}getDirection(){return this.direction}squish(){this.isSquished||(this.isSquished=!0,this.setVelocity(0,0),this.isRolling=!1,this.isBiting=!1,this.body&&(this.body.enable=!1),this.setRotation(0),this.totalRotation=0,this.scene&&this.scene.textures.exists("beetle-mouth-closed")&&this.setTexture("beetle-mouth-closed"),this.scene&&this.scene.tweens.add({targets:this,scaleY:.2,scaleX:1.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.beetles&&this.scene.beetles.remove(this),this.destroy()}}))}};var te=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,r){super(e,t,i,"rexEyesOpen");this.baseMoveSpeed=60;this.moveSpeed=60;this.speedMultiplier=1;this.direction=1;this.bounceTimer=0;this.isSquishing=!1;this.isStretching=!1;this.isInAir=!1;this.isSquished=!1;this.blinkTimer=0;this.nextBlinkTime=2e3;this.isBlinking=!1;this.blinkDuration=150;e.add.existing(this),e.physics.add.existing(this);let o=40;this.setDisplaySize(o,o),this.setOrigin(.5,.5);let n=18,l=this.texture.get().width,c=this.texture.get().height,h=o/l,d=o/c,p=(h+d)/2,u=n/p;if(this.body instanceof Phaser.Physics.Arcade.Body){this.body.setCircle(u);let m=u*2,y=(l-m)/2,g=(c-m)/2;this.body.setOffset(y,g),this.body.setCollideWorldBounds(!0),this.body.setBounce(0),this.body.setAllowGravity(!0),this.body.setGravityY(0),console.log("\u{1F996} REX ENEMY CREATED:"),console.log("  Display size:",o,"x",o),console.log("  Circle diameter:",n*2,"px"),console.log("  Body is circular:",this.body.isCircle),console.log("  Move speed:",this.moveSpeed)}this.setDepth(15),this.platformBounds={left:s,right:r},this.direction=Math.random()<.5?-1:1,this.setVelocityX(this.moveSpeed*this.direction),this.nextBlinkTime=Math.random()*2e3+1e3,this.bounceTimer=1e3+Math.random()*1e3}update(e,t){if(this.bounceTimer-=t,this.blinkTimer+=t,this.body instanceof Phaser.Physics.Arcade.Body){let i=this.body.touching.down||this.body.blocked.down;if(i&&this.isInAir?(this.onLanding(),this.isInAir=!1):!i&&!this.isInAir&&(this.isInAir=!0),this.bounceTimer<=0&&i&&!this.isSquishing&&(this.startBounce(),this.bounceTimer=1500+Math.random()*1500),i&&!this.isInAir&&!this.isSquishing&&!this.isStretching&&this.updateBlinking(),this.isInAir&&!i)this.rotation+=.008*t*this.direction,this.texture.key!=="rexBlinking"&&this.setTexture("rexBlinking");else if(i){if(Math.abs(this.rotation)>.1){let s=Math.round(this.rotation/(Math.PI*2))*Math.PI*2;this.rotation=Phaser.Math.Linear(this.rotation,s,.3)}else this.rotation=0;this.texture.key==="rexBlinking"&&!this.isBlinking&&this.setTexture("rexEyesOpen")}this.x<=this.platformBounds.left+20?(this.direction=1,this.setVelocityX(this.moveSpeed*this.direction)):this.x>=this.platformBounds.right-20?(this.direction=-1,this.setVelocityX(this.moveSpeed*this.direction)):this.setVelocityX(this.moveSpeed*this.direction)}}startBounce(){this.setVelocityY(-175),this.isStretching=!1}onLanding(){this.isSquishing=!1}updateBlinking(){this.isBlinking?this.blinkTimer>=this.blinkDuration&&(this.isBlinking=!1,this.setTexture("rexEyesOpen"),this.blinkTimer=0,this.nextBlinkTime=1e3+Math.random()*3e3):this.blinkTimer>=this.nextBlinkTime&&(this.isBlinking=!0,this.setTexture("rexBlinking"),this.blinkTimer=0)}setSpeedMultiplier(e){this.speedMultiplier=e,this.moveSpeed=this.baseMoveSpeed*e}squish(){if(this.isSquished)return;this.isSquished=!0,this.setVelocity(0,0),this.body&&(this.body.enable=!1),this.scene.tweens.killTweensOf(this);let e=12;for(let t=0;t<e;t++){let i=this.scene.add.graphics();i.fillStyle(9498256,1),i.fillCircle(0,0,3),i.x=this.x,i.y=this.y;let s=Math.PI*2*t/e+(Math.random()-.5)*.5,r=100+Math.random()*100,o=Math.cos(s)*r,n=Math.sin(s)*r-50;this.scene.tweens.add({targets:i,x:i.x+o*.5,y:i.y+n*.5,alpha:0,scale:.5,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}this.scene.tweens.add({targets:this,alpha:0,scale:.5,duration:200,ease:"Power2",onComplete:()=>{this.scene&&this.scene.rexEnemies&&this.scene.rexEnemies.remove(this),this.destroy()}})}};var $=class{constructor(a,e,t){this.collected=!1;this.scene=a;let i=t-5;this.sprite=a.add.container(e,i);let s=["gem-pink-round","gem-yellow-emerald","gem-purple-opal","gem-teal-triangle"],r=s[Math.floor(Math.random()*s.length)],o=a.add.image(0,0,r);if(o.setDisplaySize(16,16),this.sprite.add(o),this.sprite.setDepth(12),this.sparkleTimer=a.time.addEvent({delay:800+Math.random()*400,callback:()=>this.createSparkle(),loop:!0}),a.physics.add.existing(this.sprite,!0),this.sprite.body){let n=this.sprite.body;n.setSize(16,16),n.setOffset(24,24)}a.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let a=this.scene.add.graphics(),e=(Math.random()-.5)*16,t=(Math.random()-.5)*16;a.fillStyle(16777215,.9),a.beginPath();for(let s=0;s<8;s++){let r=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(r)*o,l=Math.sin(r)*o;s===0?a.moveTo(n,l):a.lineTo(n,l)}a.closePath(),a.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(a),i.setDepth(13),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:1.5,scaleY:1.5,alpha:0,duration:200,onComplete:()=>{this.sprite.destroy()}}))}isCollected(){return this.collected}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var J=class{constructor(a,e,t){this.collected=!1;this.scene=a;let i=t-5;this.sprite=a.add.container(e,i);let r=a.add.image(0,0,"gem-big-blue");if(r.setDisplaySize(22,22),this.sprite.add(r),this.sprite.setDepth(12),this.sparkleTimer=a.time.addEvent({delay:600+Math.random()*300,callback:()=>this.createSparkle(),loop:!0}),a.physics.add.existing(this.sprite,!0),this.sprite.body){let o=this.sprite.body;o.setSize(20,20),o.setOffset(22,22)}a.tweens.add({targets:this.sprite,scaleX:1.3,scaleY:1.3,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let a=this.scene.add.graphics(),e=(Math.random()-.5)*20,t=(Math.random()-.5)*20;a.fillStyle(65535,.9),a.beginPath();for(let s=0;s<8;s++){let r=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(r)*o,l=Math.sin(r)*o;s===0?a.moveTo(n,l):a.lineTo(n,l)}a.closePath(),a.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(a),i.setDepth(13),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var _=class{constructor(a,e,t){this.collected=!1;this.scene=a;let i=t-5;if(this.sprite=a.add.container(e,i),this.diamondSprite=a.add.image(0,0,"gem-diamond"),this.diamondSprite.setDisplaySize(29,29),this.sprite.add(this.diamondSprite),this.sprite.setDepth(13),a.physics.add.existing(this.sprite,!0),this.sprite.body){let s=this.sprite.body;s.setSize(29,29),s.setOffset(10,10)}a.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.sparkleTimer=a.time.addEvent({delay:400+Math.random()*200,callback:()=>this.createSparkle(),loop:!0})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let a=this.scene.add.graphics(),e=(Math.random()-.5)*30,t=(Math.random()-.5)*30;a.fillStyle(16777215,.9),a.beginPath();for(let s=0;s<8;s++){let r=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(r)*o,l=Math.sin(r)*o;s===0?a.moveTo(n,l):a.lineTo(n,l)}a.closePath(),a.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(a),i.setDepth(14),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2.5,scaleY:2.5,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var Z=class{constructor(a,e,t){this.collected=!1;this.scene=a;let i=t-5;if(this.sprite=a.add.container(e,i),this.heartSprite=a.add.image(0,0,"heart-crystal"),this.heartSprite.setDisplaySize(29,29),this.sprite.add(this.heartSprite),this.sprite.setDepth(13),a.physics.add.existing(this.sprite,!0),this.sprite.body){let s=this.sprite.body;s.setSize(29,29),s.setOffset(10,10)}a.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:this.sprite,scaleX:1.1,scaleY:1.1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.sparkleTimer=a.time.addEvent({delay:400+Math.random()*200,callback:()=>this.createSparkle(),loop:!0})}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let a=this.scene.add.graphics(),e=(Math.random()-.5)*30,t=(Math.random()-.5)*30;a.fillStyle(16738740,.9),a.beginPath();for(let s=0;s<8;s++){let r=s/8*Math.PI*2,o=s%2===0?2:1,n=Math.cos(r)*o,l=Math.sin(r)*o;s===0?a.moveTo(n,l):a.lineTo(n,l)}a.closePath(),a.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(a),i.setDepth(14),this.scene.tweens.add({targets:i,scaleX:3,scaleY:3,alpha:0,rotation:Math.PI,duration:500,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:2.5,scaleY:2.5,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}))}destroy(){this.sparkleTimer&&this.sparkleTimer.destroy(),this.sprite.destroy()}};var ie=class{constructor(a,e,t){this.collected=!1;this.aura=null;this.particles=[];this.debugHitbox=null;this.scene=a;let i=t-5;this.sprite=a.add.image(e,i,"invincibility-pendant"),this.sprite.setDisplaySize(29,29),this.sprite.setDepth(13),a.physics.add.existing(this.sprite,!0),w.debug&&this.createDebugHitbox(e,i),a.tweens.add({targets:this.sprite,y:i-5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createGoldenAura(e,i),this.sparkleTimer=a.time.addEvent({delay:300+Math.random()*200,callback:()=>this.createSparkle(),loop:!0}),this.createFloatingParticles(e,i)}createGoldenAura(a,e){this.aura=this.scene.add.circle(a,e,25,16766720),this.aura.setAlpha(.2),this.aura.setDepth(12),this.scene.tweens.add({targets:this.aura,scaleX:1.3,scaleY:1.3,alpha:.4,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFloatingParticles(a,e){for(let t=0;t<6;t++){let i=this.scene.add.graphics();i.setDepth(14),i.fillStyle(16766720,.8),i.fillCircle(0,0,2);let s=Math.PI*2/6*t,r=20;i.setPosition(a+Math.cos(s)*r,e+Math.sin(s)*r),this.particles.push(i),this.scene.tweens.add({targets:i,rotation:Math.PI*2,duration:3e3,repeat:-1,ease:"Linear"}),this.scene.tweens.add({targets:i,y:i.y-8,duration:1500+Math.random()*500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:i,alpha:.3,duration:800+Math.random()*400,yoyo:!0,repeat:-1,ease:"Power2.easeInOut"})}}createSparkle(){if(!this.sprite||!this.sprite.scene)return;let a=this.scene.add.graphics(),e=(Math.random()-.5)*35,t=(Math.random()-.5)*35;a.fillStyle(16766720,.9),a.beginPath();for(let s=0;s<8;s++){let r=s/8*Math.PI*2,o=s%2===0?3:1.5,n=Math.cos(r)*o,l=Math.sin(r)*o;s===0?a.moveTo(n,l):a.lineTo(n,l)}a.closePath(),a.fillPath();let i=this.scene.add.container(this.sprite.x+e,this.sprite.y+t);i.add(a),i.setDepth(15),this.scene.tweens.add({targets:i,scaleX:2,scaleY:2,alpha:0,rotation:Math.PI,duration:600,ease:"Power2",onComplete:()=>{i.destroy()}})}isCollected(){return this.collected}collect(){this.collected||(this.collected=!0,this.sparkleTimer&&this.sparkleTimer.destroy(),this.aura&&(this.aura.destroy(),this.aura=null),this.particles.forEach(a=>a.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1),this.scene.tweens.add({targets:this.sprite,scaleX:3,scaleY:3,alpha:0,duration:500,ease:"Back.easeOut",onComplete:()=>{this.sprite.destroy()}}),this.createCollectionBurst())}createCollectionBurst(){for(let e=0;e<20;e++){let t=this.scene.add.circle(this.sprite.x+(Math.random()-.5)*15,this.sprite.y-10,Math.random()*4+2,16766720);t.setDepth(50);let i=Math.PI*2/20*e+(Math.random()-.5)*.8,s=Math.random()*120+80;this.scene.tweens.add({targets:t,x:t.x+Math.cos(i)*s,y:t.y+Math.sin(i)*s-40,alpha:0,scaleX:.1,scaleY:.1,duration:1200,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}let a=this.scene.add.circle(this.sprite.x,this.sprite.y,50,16766720);a.setDepth(49),a.setAlpha(.9),this.scene.tweens.add({targets:a,scaleX:2.5,scaleY:2.5,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>a.destroy()})}createDebugHitbox(a,e){this.debugHitbox=this.scene.add.graphics(),this.debugHitbox.setDepth(999),this.debugHitbox.lineStyle(2,65280,.8),this.debugHitbox.strokeRect(a-14.5,e-14.5,29,29),this.debugHitbox.fillStyle(16711680,1),this.debugHitbox.fillCircle(a,e,2);let t=this.scene.add.text(a,e-35,"PENDANT\\n29x29",{fontSize:"8px",color:"#00ff00",fontFamily:"monospace",align:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:2,y:1}}).setOrigin(.5).setDepth(1e3);this.debugHitbox.setData("debugText",t)}destroy(){if(this.sparkleTimer&&this.sparkleTimer.destroy(),this.aura&&this.aura.destroy(),this.particles.forEach(a=>a.destroy()),this.debugHitbox){let a=this.debugHitbox.getData("debugText");a&&a.destroy(),this.debugHitbox.destroy()}this.sprite.destroy()}};var se=class{constructor(a,e,t){this.isOpened=!1;this.glowEffect=null;this.debugHitbox=null;this.scene=a,this.chestTier=this.selectRandomChestTier();let i=this.getSpriteKeyForTier(this.chestTier);this.sprite=a.add.sprite(e,t-4,i),this.sprite.setDisplaySize(60,60),this.sprite.setDepth(13),a.physics.add.existing(this.sprite,!0);let s=this.sprite.body;s.setSize(40,30),s.setOffset(-20,-11),!1&&w.debug&&this.createDebugHitbox(e,t),this.createGlowEffect(e,t-4,this.chestTier)}selectRandomChestTier(){let a=Math.random();return a<.6?"purple":a<.9?"teal":"yellow"}getSpriteKeyForTier(a){switch(a){case"purple":return"purple-chest";case"teal":return"teal-chest";case"yellow":return"yellow-chest"}}getGlowColorForTier(a){switch(a){case"purple":return 10040012;case"teal":return 35723;case"yellow":return 16766720}}createGlowEffect(a,e,t){let i=this.getGlowColorForTier(t);this.glowEffect=this.scene.add.circle(a,e,18,i),this.glowEffect.setAlpha(.15),this.glowEffect.setDepth(12),this.scene.tweens.add({targets:this.glowEffect,alpha:.05,scaleX:1.2,scaleY:1.2,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}canInteract(){return!this.isOpened}open(){if(this.isOpened)return{coins:0,blueCoins:0,diamonds:0,freeLifes:0,invincibilityPendants:0,totalPoints:0};this.isOpened=!0,this.sprite.setTint(8421504),this.glowEffect&&(this.glowEffect.destroy(),this.glowEffect=null),this.scene.tweens.add({targets:this.sprite,scaleX:1.2,scaleY:1.2,duration:200,ease:"Back.easeOut",yoyo:!0});let a=this.generateRewardsByTier(this.chestTier),e=2500;return e+=a.coins*50,e+=a.blueCoins*500,e+=a.diamonds*1e3,e+=a.freeLifes*2e3,e+=a.invincibilityPendants*300,this.createTreasureBurstEffect(),{coins:a.coins,blueCoins:a.blueCoins,diamonds:a.diamonds,freeLifes:a.freeLifes,invincibilityPendants:a.invincibilityPendants,totalPoints:e}}generateRewardsByTier(a){let e={coins:0,blueCoins:0,diamonds:0,freeLifes:0};switch(a){case"purple":e.coins=Math.floor(Math.random()*3)+2,Math.random()<.1&&(e.freeLifes=1);break;case"teal":e.blueCoins=Math.floor(Math.random()*2)+1,e.coins=Math.floor(Math.random()*2)+1,Math.random()<.25&&(Math.random()<.7,e.freeLifes=1);break;case"yellow":e.coins=Math.floor(Math.random()*2)+2,Math.random()<.8,e.freeLifes=1;break}return e}createTreasureBurstEffect(){for(let e=0;e<15;e++){let t=this.scene.add.circle(this.sprite.x+(Math.random()-.5)*10,this.sprite.y-5,Math.random()*3+2,16766720);t.setDepth(50);let i=Math.PI*2/15*e+(Math.random()-.5)*.5,s=Math.random()*100+50;this.scene.tweens.add({targets:t,x:t.x+Math.cos(i)*s,y:t.y+Math.sin(i)*s-30,alpha:0,scaleX:.1,scaleY:.1,duration:1e3,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}let a=this.scene.add.circle(this.sprite.x,this.sprite.y,40,16777215);a.setDepth(49),a.setAlpha(.8),this.scene.tweens.add({targets:a,scaleX:2,scaleY:2,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>a.destroy()})}createDebugHitbox(a,e){this.debugHitbox=this.scene.add.graphics(),this.debugHitbox.setDepth(999),this.debugHitbox.lineStyle(2,65280,.8),this.debugHitbox.strokeRect(a-20,e-15,40,30),this.debugHitbox.fillStyle(16711680,1),this.debugHitbox.fillCircle(a,e,2);let t=this.scene.add.text(a,e-35,`CHEST
40x30`,{fontSize:"8px",color:"#00ff00",fontFamily:"monospace",align:"center",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:2,y:1}}).setOrigin(.5).setDepth(1e3);this.debugHitbox.setData("debugText",t)}destroy(){if(this.sprite.destroy(),this.glowEffect&&this.glowEffect.destroy(),this.debugHitbox){let a=this.debugHitbox.getData("debugText");a&&a.destroy(),this.debugHitbox.destroy()}}};var be=class{constructor(a,e,t){this.collected=!1;this.particles=[];this.scene=a;let i=t-5;this.sprite=a.add.container(e,i),this.glowGraphics=a.add.graphics(),this.createGlowEffect(),this.sprite.add(this.glowGraphics);let s=a.add.image(0,0,"crystalBallCollectible");if(s.setDisplaySize(20,20),this.sprite.add(s),this.sprite.setDepth(12),this.particleTimer=a.time.addEvent({delay:200,callback:()=>this.createParticle(),loop:!0}),a.physics.add.existing(this.sprite,!0),this.sprite.body){let r=this.sprite.body;r.setSize(20,20),r.setOffset(22,22)}a.tweens.add({targets:this.glowGraphics,alpha:.3,scaleX:1.2,scaleY:1.2,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:this.sprite,y:i-8,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:s,rotation:Math.PI*2,duration:8e3,repeat:-1,ease:"Linear"})}createGlowEffect(){for(let e=3;e>0;e--)this.glowGraphics.fillStyle(4509863,.1*e),this.glowGraphics.fillCircle(0,0,15+(3-e)*5)}createParticle(){if(!this.sprite||!this.sprite.scene||this.collected)return;let a=this.scene.add.graphics();a.fillStyle(4509863,1),a.fillRect(0,0,2,2);let e=Math.random()*Math.PI*2,t=15+Math.random()*10,i=this.sprite.x+Math.cos(e)*t,s=this.sprite.y+Math.sin(e)*t;a.x=i,a.y=s,a.setDepth(11),this.particles.push(a),this.scene.tweens.add({targets:a,y:s-30,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{let r=this.particles.indexOf(a);r>-1&&this.particles.splice(r,1),a.destroy()}})}collect(){if(!this.collected){this.collected=!0,this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(a=>a.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1);for(let a=0;a<8;a++){let e=this.scene.add.graphics();e.fillStyle(4509863,1),e.fillRect(0,0,3,3);let t=a/8*Math.PI*2;e.x=this.sprite.x,e.y=this.sprite.y,e.setDepth(13),this.scene.tweens.add({targets:e,x:this.sprite.x+Math.cos(t)*40,y:this.sprite.y+Math.sin(t)*40,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>{e.destroy()}})}this.scene.tweens.add({targets:this.sprite,scaleX:1.5,scaleY:1.5,alpha:0,duration:200,onComplete:()=>{this.sprite.destroy()}})}}isCollected(){return this.collected}destroy(){this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(a=>a.destroy()),this.sprite.destroy()}};var me=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,r=0){super(e,t,i,"crystalBallProjectile");this.bounceCount=0;this.MAX_BOUNCES=5;this.BASE_BOUNCE_HEIGHT=32;this.distanceTraveled=0;this.MAX_DISTANCE=5*w.game.tileSize;this.direction=1;this.direction=s,e.add.existing(this),e.physics.add.existing(this),this.setDisplaySize(16,16),this.setSize(12,12),this.setDepth(15);let o=250,l=(o+Math.abs(r*.8))*s;this.setVelocity(l,-120),console.log("\u{1F52B} Projectile velocity compensation: base =",o,"player =",r,"final =",l),this.setGravityY(400),this.setCollideWorldBounds(!0),this.body.onWorldBounds=!0,this.glowGraphics=e.add.graphics(),this.glowGraphics.setDepth(14),this.glowGraphics.fillStyle(4509863,.3),this.glowGraphics.fillCircle(0,0,12),this.glowGraphics.fillStyle(4509863,.2),this.glowGraphics.fillCircle(0,0,18),this.glowGraphics.x=t,this.glowGraphics.y=i,this.scene.events.on("update",this.updateGlow,this),this.rotationTween=e.tweens.add({targets:this,rotation:Math.PI*2*s,duration:500,repeat:-1,ease:"Linear"})}updateGlow(){this.active&&this.glowGraphics&&(this.glowGraphics.x=this.x,this.glowGraphics.y=this.y)}update(e,t){if(super.update(e,t),!this.body){console.log("\u{1F52B} Crystal Ball projectile body missing - destroying"),this.burst();return}let i=this.body;if(this.distanceTraveled+=Math.abs(i.velocity.x)*t/1e3,this.distanceTraveled>=this.MAX_DISTANCE){console.log("\u{1F52B} Crystal Ball projectile hit max distance - bursting"),this.burst();return}i.blocked.down&&(console.log("\u{1F52B} Crystal Ball projectile hit floor - bouncing"),this.handleBounce()),(i.blocked.left||i.blocked.right)&&(console.log("\u{1F52B} Crystal Ball projectile hit wall - bursting"),this.burst())}handleBounce(){if(this.bounceCount++,this.scene.registry.get("sfxEnabled")!==!1&&this.scene.sound.play("crystal-ball-bounce",{volume:.4}),this.bounceCount>=this.MAX_BOUNCES){console.log("\u{1F52B} Crystal Ball projectile max bounces reached - bursting"),this.burst();return}if(!this.body){console.log("\u{1F52B} Crystal Ball projectile body missing during bounce - bursting"),this.burst();return}let t=this.body,i=Math.pow(.8,this.bounceCount-1),s=this.BASE_BOUNCE_HEIGHT*i,r=t.gravity.y||400,o=-Math.sqrt(2*r*s);console.log("\u{1F52B} Bounce",this.bounceCount,"height:",s.toFixed(1),"velocity:",o.toFixed(1)),this.setVelocityY(o),this.setVelocityX(250*this.direction),this.createBounceEffect(),console.log("\u{1F52B} Crystal Ball projectile bounced",this.bounceCount,"times")}createBounceEffect(){if(this.scene)for(let e=0;e<3;e++){let t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillCircle(0,0,1),t.x=this.x+(Math.random()-.5)*10,t.y=this.y+5,t.setDepth(14),this.scene.tweens.add({targets:t,y:t.y-10,alpha:0,duration:200,onComplete:()=>t.destroy()})}}hitEnemy(){this.burst()}burst(){if(this.scene){this.scene.events.off("update",this.updateGlow,this),this.rotationTween&&(this.rotationTween.stop(),this.rotationTween=void 0);for(let e=0;e<8;e++){let t=this.scene.add.graphics();t.fillStyle(4509863,1),t.fillCircle(0,0,2);let i=e/8*Math.PI*2;t.x=this.x,t.y=this.y,t.setDepth(15);let s=20+Math.random()*10;this.scene.tweens.add({targets:t,x:this.x+Math.cos(i)*s,y:this.y+Math.sin(i)*s,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>t.destroy()})}this.glowGraphics&&(this.glowGraphics.destroy(),this.glowGraphics=void 0),this.destroy()}}};var ae=class{constructor(a,e,t,i){this.collected=!1;this.particles=[];this.scene=a,this.orbType=i,this.glowColor=i==="cursed"?5768769:4827036;let s=t-5;this.sprite=a.add.container(e,s),this.glowGraphics=a.add.graphics(),this.createGlowEffect(),this.sprite.add(this.glowGraphics);let r=i==="cursed"?"cursedOrbCollectible":"cursedTealOrbCollectible",o=a.add.image(0,0,r);if(o.setDisplaySize(20,20),this.sprite.add(o),this.sprite.setDepth(12),this.particleTimer=a.time.addEvent({delay:250,callback:()=>this.createParticle(),loop:!0}),a.physics.add.existing(this.sprite,!0),this.sprite.body){let n=this.sprite.body;n.setSize(20,20),n.setOffset(22,22)}a.tweens.add({targets:this.glowGraphics,alpha:.2,scaleX:1.3,scaleY:1.3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:this.sprite,y:s-6,duration:2500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),a.tweens.add({targets:o,rotation:-Math.PI*2,duration:1e4,repeat:-1,ease:"Linear"})}createGlowEffect(){let a=this.glowColor;for(let e=4;e>0;e--)this.glowGraphics.fillStyle(a,.08*e),this.glowGraphics.fillCircle(0,0,12+(4-e)*6)}createParticle(){if(!this.sprite||!this.sprite.scene||this.collected)return;let a=this.scene.add.graphics();a.fillStyle(this.glowColor,1),a.fillRect(0,0,2,2);let e=Math.random()*Math.PI*2,t=20+Math.random()*12,i=this.sprite.x+Math.cos(e)*t,s=this.sprite.y+Math.sin(e)*t;a.x=i,a.y=s,a.setDepth(11),this.particles.push(a),this.scene.tweens.add({targets:a,y:s+35,x:i+(Math.random()-.5)*20,alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{let r=this.particles.indexOf(a);r>-1&&this.particles.splice(r,1),a.destroy()}})}collect(){if(!this.collected){this.collected=!0,this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(a=>a.destroy()),this.particles=[],this.sprite.body&&(this.sprite.body.enable=!1);for(let a=0;a<12;a++){let e=this.scene.add.graphics();e.fillStyle(this.glowColor,1),e.fillRect(0,0,3,3);let t=a/12*Math.PI*2;e.x=this.sprite.x,e.y=this.sprite.y,e.setDepth(13),this.scene.tweens.add({targets:e,x:this.sprite.x+Math.cos(t)*50,y:this.sprite.y+Math.sin(t)*50,alpha:0,duration:600,ease:"Power2.easeOut",onComplete:()=>{e.destroy()}})}this.scene.tweens.add({targets:this.sprite,scaleX:1.3,scaleY:1.3,alpha:0,duration:300,onComplete:()=>{this.sprite.destroy()}})}}isCollected(){return this.collected}getType(){return this.orbType}destroy(){this.particleTimer&&this.particleTimer.destroy(),this.particles.forEach(a=>a.destroy()),this.sprite.destroy()}};var ye=class{constructor(a){this.enabled=!0;this.isMobileDevice=!1;this.touchPosition=null;this.horizontalInput=0;this.verticalInput=0;this.upPressed=!1;this.downPressed=!1;this.leftPressed=!1;this.rightPressed=!1;this.jumpPressed=!1;this.jumpJustPressed=!1;this.actionPressed=!1;this.actionJustPressed=!1;this.lastJumpState=!1;this.lastActionState=!1;this.touchpadPointerId=-1;this.jumpPointerId=-1;this.actionPointerId=-1;this.touchpadRadius=110;this.deadZone=5;this.scene=a;let e=this.scene.game.config.height;this.touchpadCenter={x:120,y:e-120},this.detectMobileDevice(),this.createTouchpad(),this.createJumpButton(),this.createActionButton(),this.setupInputHandlers();let t=w.buildType==="dgen1";!1&&(w.debug||t)&&(console.log("\u{1F3AF} Creating debug visualizations for touch controls"),this.createDebugVisualization(),this.createXAxisGrid())}detectMobileDevice(){let a="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),i=window.innerWidth<=768;this.isMobileDevice=a&&(t||i);let s=window.game?.registry?.get("isDgen1")||!1,r=w.debug||s;console.log("\u{1F3AE} Touch Controls Detection:",{isTouchDevice:a,isMobileUA:t,isSmallScreen:i,isMobileDevice:this.isMobileDevice,enableForTesting:r,finalEnabled:this.isMobileDevice||r}),r&&(this.isMobileDevice=!0,console.log("\u26A0\uFE0F Touch controls enabled for desktop testing"))}createTouchpad(){this.touchpadContainer=this.scene.add.container(this.touchpadCenter.x,this.touchpadCenter.y),this.touchpadContainer.setDepth(1e3),this.touchpadContainer.setScrollFactor(0),this.touchpadBackground=this.scene.add.image(0,0,"custom-dpad");let a=this.touchpadRadius-10;this.touchpadBackground.setDisplaySize(a*2,a*2),this.touchpadContainer.add(this.touchpadBackground),this.touchpadIndicator=this.scene.add.circle(0,0,8,16716947,.9),this.touchpadIndicator.setStrokeStyle(2,16777215,.9),this.touchpadIndicator.setVisible(!1),this.touchpadContainer.add(this.touchpadIndicator)}createJumpButton(){console.log("\u{1F3AE} Jump Button Canvas Check:",{GameSettingsWidth:w.canvas.width,GameSettingsHeight:w.canvas.height,SceneWidth:this.scene.cameras.main.width,SceneHeight:this.scene.cameras.main.height,GameWidth:this.scene.game.config.width,GameHeight:this.scene.game.config.height});let a=this.scene.game.config.width,e=this.scene.game.config.height,t=620,i=e-120;console.log("\u{1F3AF} Jump Button Position:",{buttonX:t,buttonY:i,actualCanvasWidth:a}),this.jumpButton=this.scene.add.container(t,i),this.jumpButton.setDepth(1e3),this.jumpButton.setScrollFactor(0),this.jumpButtonImage=this.scene.add.image(0,0,"custom-jump-button"),this.jumpButtonImage.setDisplaySize(80,80),this.jumpButton.add([this.jumpButtonImage])}createActionButton(){let a=this.scene.game.config.height,e=445,t=a-120;this.actionButton=this.scene.add.container(e,t),this.actionButton.setDepth(1e3),this.actionButton.setScrollFactor(0),this.actionButton.setVisible(!0),this.actionButtonImage=this.scene.add.image(0,0,"custom-action-button"),this.actionButtonImage.setDisplaySize(80,80),this.actionButton.add([this.actionButtonImage])}setupInputHandlers(){let a=new Set;this.scene.input.on("pointerdown",e=>{a.add(e.id),this.handlePointerDown(e)}),this.scene.input.on("pointermove",e=>{a.has(e.id)&&this.handlePointerMove(e)}),this.scene.input.on("pointerup",e=>{a.delete(e.id),this.handlePointerUp(e)})}handlePointerDown(a){if(!this.enabled)return;if(!this.isMobileDevice){console.log("\u274C Touch controls disabled - not mobile device");return}console.log("\u{1F446} Pointer down:",{x:a.x,y:a.y,id:a.id,enabled:this.enabled,isMobile:this.isMobileDevice});let e=a.x,t=a.y,i=Math.sqrt(Math.pow(e-this.touchpadCenter.x,2)+Math.pow(t-this.touchpadCenter.y,2));if(console.log("\u{1F3AF} Touchpad check:",{distance:i,threshold:110,center:this.touchpadCenter,touch:{x:e,y:t}}),i<=110&&this.touchpadPointerId===-1){console.log("\u2705 Touchpad activated"),this.touchpadPointerId=a.id,this.updateTouchpadFromPosition(e,t),this.touchpadIndicator.setVisible(!0),this.forceUpdate();return}let s=620,r=s-87.5,o=s+87.5,l=this.scene.game.config.height-120,c=l-100,h=l+100;if(console.log("\u{1F998} Jump button check:",{touchX:e,touchY:t,bounds:{left:r,right:o,top:c,bottom:h},inBounds:e>=r&&e<=o&&t>=c&&t<=h}),e>=r&&e<=o&&t>=c&&t<=h){this.jumpPointerId===-1&&(console.log("\u2705 Jump button pressed!"),this.jumpPointerId=a.id,this.jumpPressed=!0);return}if(this.actionButton.visible){let y=this.scene.game.config.height-120,g=y-100,f=y+100;e>=357.5&&e<=532.5&&t>=g&&t<=f&&this.actionPointerId===-1&&(this.actionPointerId=a.id,this.actionPressed=!0)}}updateTouchpadFromPosition(a,e){let t=a-this.touchpadCenter.x,i=e-this.touchpadCenter.y,s=Math.sqrt(t*t+i*i);if(s<this.deadZone){this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.touchpadIndicator.setPosition(0,0);return}let r=Math.min(s,this.touchpadRadius),o=t/r*(r/this.touchpadRadius),n=i/r*(r/this.touchpadRadius);this.horizontalInput=o,this.verticalInput=n;let l=.3;this.leftPressed=o<-l,this.rightPressed=o>l,this.upPressed=n<-l,this.downPressed=n>l;let c=Math.min(s,this.touchpadRadius-8),h=t/s*c,d=i/s*c;this.touchpadIndicator.setPosition(h,d),this.touchPosition={x:t,y:i}}forceUpdate(){this.touchpadIndicator.visible}handlePointerMove(a){this.enabled&&this.isMobileDevice&&a.id===this.touchpadPointerId&&this.updateTouchpadFromPosition(a.x,a.y)}handlePointerUp(a){this.enabled&&this.isMobileDevice&&(a.id===this.touchpadPointerId&&(this.touchpadPointerId=-1,this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.touchpadIndicator.setVisible(!1),this.touchpadIndicator.setPosition(0,0),this.touchPosition=null),a.id===this.jumpPointerId&&(this.jumpPointerId=-1,this.jumpPressed=!1,console.log("\u{1F504} Jump button released")),a.id===this.actionPointerId&&(this.actionPointerId=-1,this.actionPressed=!1))}update(){this.jumpJustPressed=this.jumpPressed&&!this.lastJumpState,this.lastJumpState=this.jumpPressed,this.actionJustPressed=this.actionPressed&&!this.lastActionState,this.lastActionState=this.actionPressed}getHorizontal(){return this.horizontalInput||(this.leftPressed?-1:this.rightPressed?1:0)}getVertical(){return this.verticalInput||(this.upPressed?-1:this.downPressed?1:0)}getHorizontalInput(){return this.horizontalInput}getVerticalInput(){return this.verticalInput}isJumpPressed(){return this.jumpPressed}isJumpJustPressed(){return this.jumpJustPressed}isActionPressed(){return this.actionPressed}isActionJustPressed(){return this.actionJustPressed}showActionButton(a){this.actionButton.setVisible(a)}disable(){this.enabled=!1,this.touchpadContainer.setVisible(!1),this.jumpButton.setVisible(!1),this.actionButton.setVisible(!1),this.horizontalInput=0,this.verticalInput=0,this.leftPressed=!1,this.rightPressed=!1,this.upPressed=!1,this.downPressed=!1,this.jumpPressed=!1,this.jumpJustPressed=!1,this.actionPressed=!1,this.actionJustPressed=!1,this.touchpadPointerId=-1,this.jumpPointerId=-1,this.actionPointerId=-1,this.touchpadIndicator.setVisible(!1)}enable(){this.enabled=!0,this.touchpadContainer.setVisible(!0),this.jumpButton.setVisible(!0),this.actionButton.setVisible(!0)}createDebugVisualization(){let a=this.scene.add.graphics();a.setDepth(1001),a.setScrollFactor(0),a.lineStyle(2,65280,.8),a.strokeCircle(this.touchpadCenter.x,this.touchpadCenter.y,110);let e=620,t=e-87.5,i=e+87.5,s=this.scene.game.config.height,r=s-120,o=r-100,n=r+100;a.lineStyle(2,16711680,.8),a.strokeRect(t,o,175,200);let l=445,c=l-87.5,h=l+87.5,d=s-120,p=d-100,u=d+100;a.lineStyle(2,255,.8),a.strokeRect(c,p,175,200);let m={fontSize:"12px",color:"#ffffff",fontFamily:"Arial"};this.scene.add.text(this.touchpadCenter.x,this.touchpadCenter.y-120,`TOUCHPAD
Hitbox: 110px
Visual: 100px`,{...m,color:"#00ff00",align:"center"}).setOrigin(.5).setDepth(1002).setScrollFactor(0),this.scene.add.text(e,o-10,`JUMP
175x200px`,{...m,color:"#ff0000",align:"center"}).setOrigin(.5).setDepth(1002).setScrollFactor(0),this.scene.add.text(l,p-10,`ACTION
175x200px`,{...m,color:"#0000ff",align:"center"}).setOrigin(.5).setDepth(1002).setScrollFactor(0)}createXAxisGrid(){let a=this.scene.add.graphics();a.setDepth(999),a.setScrollFactor(0);let e=w.canvas.width,t=w.canvas.height;console.log("\u{1F4D0} Creating X-axis grid:",{canvasWidth:e,canvasHeight:t});for(let r=0;r<=e;r+=20)r%100===0?(a.lineStyle(2,16776960,.5),this.scene.add.text(r,30,`X:${r}`,{fontSize:"14px",color:"#ffff00",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:2,y:2}}).setOrigin(.5).setDepth(1003).setScrollFactor(0)):r%50===0?a.lineStyle(1,16777215,.4):a.lineStyle(1,16777215,.2),a.moveTo(r,0),a.lineTo(r,t);a.lineStyle(3,65535,.8),a.moveTo(120,0),a.lineTo(120,t),this.scene.add.text(120,60,`TOUCHPAD
X:120`,{fontSize:"12px",color:"#00ffff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2},align:"center"}).setOrigin(.5).setDepth(1003).setScrollFactor(0);let i=620;a.moveTo(i,0),a.lineTo(i,t),this.scene.add.text(i,60,`JUMP
X:${i}`,{fontSize:"12px",color:"#00ffff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2},align:"center"}).setOrigin(.5).setDepth(1003).setScrollFactor(0);let s=445;a.moveTo(s,0),a.lineTo(s,t),this.scene.add.text(s,90,`ACTION
X:${s}`,{fontSize:"12px",color:"#00ffff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2},align:"center"}).setOrigin(.5).setDepth(1003).setScrollFactor(0),this.scene.add.text(e/2,10,`Canvas Width: ${e}px`,{fontSize:"16px",color:"#ff00ff",fontFamily:"Arial",backgroundColor:"#000000",padding:{x:4,y:2}}).setOrigin(.5).setDepth(1003).setScrollFactor(0)}destroy(){this.touchpadContainer.destroy(),this.jumpButton.destroy(),this.actionButton.destroy()}};var Ce=(l=>(l.BASEBLU="baseblu",l.BEETLE="beetle",l.CATERPILLAR="caterpillar",l.BLUE_CATERPILLAR="blue_caterpillar",l.CHOMPER="chomper",l.SNAIL="snail",l.JUMPER="jumper",l.STALKER="stalker",l.REX="rex",l))(Ce||{}),I=class{static getMaxEnemiesPerFloor(a){return a<=10?2:a<=20||a<=30?3:a<=40||a<=50?4:5}static getSpeedMultiplier(a){return a<=10?1+(a-1)/9*.05:a<=20?1.05+(a-10)/10*.05:a<=30?1.1+(a-20)/10*.05:a<=40?1.15+(a-30)/10*.05:a<=50?1.2+(a-40)/10*.05:1.25}static getBaseBluMaxPerFloor(a){return a<=14?0:1}static getSpawnWeights(a){return a<=4?this.LEVEL_SPAWN_WEIGHTS.tutorial_early:a<=7?this.LEVEL_SPAWN_WEIGHTS.patrol:a<=11?this.LEVEL_SPAWN_WEIGHTS.speed_intro:a<=14?this.LEVEL_SPAWN_WEIGHTS.rex_intro:a<=19?this.LEVEL_SPAWN_WEIGHTS.obstacles:a<=24?this.LEVEL_SPAWN_WEIGHTS.hunter:a<=29?this.LEVEL_SPAWN_WEIGHTS.bouncing:a<=34?this.LEVEL_SPAWN_WEIGHTS.advanced:a<=39?this.LEVEL_SPAWN_WEIGHTS.advanced_2:a<=49?this.LEVEL_SPAWN_WEIGHTS.expert:this.LEVEL_SPAWN_WEIGHTS.beast}static selectEnemiesForFloor(a,e){let t={...this.getSpawnWeights(a)},i=this.getMaxEnemiesPerFloor(a),s=this.getBaseBluMaxPerFloor(a);t.rex>0&&t.jumper>0&&(Math.random()<.5?t.jumper=0:t.rex=0);let r=[],o=0,n;if(a===1)n=1;else{let l=Math.max(1,i-1);n=Math.floor(Math.random()*2)+l}for(let l=0;l<n;l++){let c=[],h=0;for(let[m,y]of Object.entries(t))if(y>0){let g=m;if(g==="baseblu"&&o>=s||g==="chomper"&&e===9)continue;c.push({type:g,weight:y}),h+=y}if(c.length===0)break;let d=Math.random()*h,p=0,u=null;for(let m of c)if(p+=m.weight,d<=p){u=m.type;break}u&&(r.push(u),u==="baseblu"&&o++)}return r}static selectEnemies(a,e){return this.selectEnemiesForFloor(e,0)}static getEnemyDefinition(a){return this.ENEMY_DEFINITIONS[a]}static getColorForEnemyType(a){return this.ENEMY_DEFINITIONS[a].color}static isStalkerType(a){return a==="stalker"}static isBaseBluType(a){return a==="baseblu"}static isBeetleType(a){return a==="beetle"}static isRexType(a){return a==="rex"}static getPointValue(a){return this.ENEMY_DEFINITIONS[a].pointValue}static getAllEnemyTypes(){return Object.values(Ce)}static logSpawnInfo(a,e,t){let i=this.getDifficultyBudget(a,e),s=t.reduce((r,o)=>r+this.ENEMY_DEFINITIONS[o].difficultyScore,0)}};I.ENEMY_DEFINITIONS={baseblu:{type:"baseblu",color:"blue",difficultyScore:2,speed:.25,pointValue:1e3,description:"Immovable blocker, can only be killed when invincible"},beetle:{type:"beetle",color:"red",difficultyScore:.8,speed:1,pointValue:75,description:"Simple patrol beetle"},caterpillar:{type:"caterpillar",color:"yellow",difficultyScore:.5,speed:.6,pointValue:50,description:"Slow random movement"},blue_caterpillar:{type:"blue_caterpillar",color:"blue_caterpillar",difficultyScore:.7,speed:.7,pointValue:50,description:"Slightly faster caterpillar variant"},chomper:{type:"chomper",color:"blue",difficultyScore:1,speed:1,pointValue:100,description:"Standard patrol with bite animations"},snail:{type:"snail",color:"red",difficultyScore:1.5,speed:1.2,pointValue:150,description:"Faster patrol enemy"},jumper:{type:"jumper",color:"green",difficultyScore:2.5,speed:1.5,pointValue:200,description:"Fast bouncing movement"},stalker:{type:"stalker",color:"red",difficultyScore:4,speed:1.5,pointValue:300,description:"Hidden activation + chase AI"},rex:{type:"rex",color:"rex",difficultyScore:1.2,speed:.75,pointValue:500,description:"Flipping enemy with periodic jumps"}},I.LEVEL_SPAWN_WEIGHTS={tutorial_early:{caterpillar:.4,beetle:.4,blue_caterpillar:.2,baseblu:0,chomper:0,snail:0,jumper:0,stalker:0,rex:0},patrol:{caterpillar:.3,beetle:.25,blue_caterpillar:.2,chomper:.25,baseblu:0,snail:0,jumper:0,stalker:0,rex:0},speed_intro:{caterpillar:.2,beetle:.2,blue_caterpillar:.15,chomper:.3,snail:.15,baseblu:0,jumper:0,stalker:0,rex:0},rex_intro:{caterpillar:.15,beetle:.15,blue_caterpillar:.1,chomper:.25,snail:.2,rex:.15,baseblu:0,jumper:0,stalker:0},obstacles:{caterpillar:.1,beetle:.1,blue_caterpillar:.1,rex:.15,chomper:.2,snail:.2,baseblu:.15,jumper:0,stalker:0},hunter:{caterpillar:.1,beetle:.1,blue_caterpillar:.05,rex:.15,chomper:.2,snail:.2,baseblu:.1,stalker:.1,jumper:0},bouncing:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.1,jumper:.15,chomper:.15,snail:.2,baseblu:.1,stalker:.15},advanced:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.15,jumper:.15,chomper:.15,snail:.15,baseblu:.1,stalker:.15},advanced_2:{caterpillar:.05,beetle:.05,blue_caterpillar:0,rex:.1,jumper:.2,chomper:.15,snail:.2,baseblu:.1,stalker:.15},expert:{caterpillar:.05,beetle:.05,blue_caterpillar:0,rex:.15,jumper:.15,chomper:.1,snail:.15,baseblu:.15,stalker:.2},beast:{caterpillar:.05,beetle:.05,blue_caterpillar:.05,rex:.1,jumper:.1,chomper:.15,snail:.15,baseblu:.15,stalker:.2}};var re=class{constructor(){this.currentLevel=1;this.isInBonusLevel=!1;this.BEAST_MODE_LEVEL=51;this.MAX_PROGRESSION_LEVEL=50;this.currentLevel=1,this.isInBonusLevel=!1}shouldHaveBonusAfter(a){return a>0&&a%10===0&&a<this.BEAST_MODE_LEVEL}isBonusLevel(){return this.isInBonusLevel}getLevelConfig(a){if(this.isInBonusLevel)return{levelNumber:a,floorCount:5,enemyTypes:[],collectibleTypes:["treasureChest"],worldWidth:24,isEndless:!1,difficultyBudgetPerFloor:0,enemySpawnWeights:{}};let e=a>=this.BEAST_MODE_LEVEL,t=Math.min(a,this.MAX_PROGRESSION_LEVEL),i=I.getSpawnWeights(t);return{levelNumber:a,floorCount:this.calculateFloorCount(a),enemyTypes:this.getEnemyTypes(t),collectibleTypes:this.getCollectibleTypes(t),worldWidth:this.getWorldWidth(t),isEndless:e,difficultyBudgetPerFloor:0,enemySpawnWeights:i}}calculateFloorCount(a){if(a>=this.BEAST_MODE_LEVEL)return-1;if(a<=10)return 10+Math.floor(a/5);if(a<=25){let e=(a-10)/15;return 13+Math.floor(e*5)}else if(a<=40){let e=(a-25)/15;return 19+Math.floor(e*6)}else{let e=(a-40)/10;return 25+Math.floor(e*5)}}getEnemyTypes(a){return["blue","yellow","green","red"]}getEnemyTypesForFloor(a,e){return I.selectEnemiesForFloor(a,e)}getCollectibleTypes(a){return a<=2?["coin","treasureChest"]:a<=3?["coin","blueCoin","treasureChest"]:a<=6?["coin","blueCoin","diamond","freeLife","invincibilityPendant","treasureChest"]:["coin","blueCoin","diamond","freeLife","invincibilityPendant","treasureChest"]}getWorldWidth(a){return a<25?24:a<50?32:40}isLevelComplete(a){let e=this.getLevelConfig(this.currentLevel);return e.isEndless?!1:a>=e.floorCount}nextLevel(){return this.isInBonusLevel?(this.isInBonusLevel=!1,this.currentLevel++):this.shouldHaveBonusAfter(this.currentLevel)?this.isInBonusLevel=!0:this.currentLevel++,this.saveProgress(),this.currentLevel}resetToStart(){this.currentLevel=1,this.isInBonusLevel=!1}getCurrentLevel(){return this.currentLevel}setCurrentLevel(a){this.currentLevel=a,this.saveProgress()}saveProgress(){try{let a=parseInt(localStorage.getItem("treasureQuest_furthestLevel")||"1");this.currentLevel>a&&localStorage.setItem("treasureQuest_furthestLevel",this.currentLevel.toString())}catch(a){console.warn("Could not save progress to localStorage:",a)}}loadProgress(){}getFurthestLevel(){try{return parseInt(localStorage.getItem("treasureQuest_furthestLevel")||"1")}catch{return 1}}getEnemySpawnRates(a){let e={blue:1.2,yellow:.8,green:.5,red:.3},t=Math.min(a,this.MAX_PROGRESSION_LEVEL),i=1+t*.015,s={};return this.getEnemyTypes(t).forEach(o=>{s[o]=e[o]*i}),s}isBeastMode(){return this.currentLevel>=this.BEAST_MODE_LEVEL}getMaxProgressionLevel(){return this.MAX_PROGRESSION_LEVEL}};var ge=class extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s=!1){super(e,t,i-9,"door-sprite");this.promptText=null;this.playerNearby=!1;this.isFirstLevel=s,e.add.existing(this),e.physics.add.existing(this,!0),this.setDisplaySize(100,120);let r=this.body;r.setSize(80,100),r.setOffset(-40,-50),this.setDepth(10)}showPrompt(e){this.playerNearby=!0,this.promptText||(this.promptText=this.scene.add.text(this.x,this.y-70,"Press UP to enter",{fontSize:"16px",color:"#ffff00",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(100))}createInstructionPopup(){let e=this.scene.cameras.main.width/2,t=this.scene.cameras.main.height/2,i=this.scene.add.rectangle(e,t,300,150,2894892,.95).setDepth(200),s=this.scene.add.rectangle(e,t,304,154,16777215).setDepth(199);s.setStrokeStyle(2,16777215),s.setFillStyle(),this.promptText=this.scene.add.text(e,t-20,"Level Complete!",{fontSize:"18px",color:"#44ff44",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201);let r=this.scene.add.text(e,t+15,`Press UP to enter the door
and advance to the next level`,{fontSize:"12px",color:"#ffffff",fontFamily:'"Press Start 2P", system-ui',align:"center"}).setOrigin(.5).setDepth(201);this.promptText.setData("popup",i),this.promptText.setData("border",s),this.promptText.setData("instruction",r)}hidePrompt(){if(this.playerNearby=!1,this.promptText){let e=this.promptText.getData("popup"),t=this.promptText.getData("border"),i=this.promptText.getData("instruction");e&&e.destroy(),t&&t.destroy(),i&&i.destroy(),this.promptText.destroy(),this.promptText=null}}createDebugVisualization(){let e=this.scene.add.graphics();e.fillStyle(16711680,1),e.fillCircle(this.x,this.y,5),e.lineStyle(3,65280,1),e.strokeRect(this.x-40,this.y-50,80,100),e.lineStyle(3,255,1);let t=this.body;e.strokeRect(t.x,t.y,t.width,t.height),e.lineStyle(2,16776960,1);let i=this.y+50;e.lineBetween(this.x-60,i,this.x+60,i),e.lineStyle(2,16746496,1);let s=i;e.lineBetween(this.x-80,s,this.x+80,s);let r={fontSize:"12px",color:"#ffffff",backgroundColor:"#000000"};this.scene.add.text(this.x+50,this.y-30,"DOOR CENTER",r).setDepth(100),this.scene.add.text(this.x+50,this.y-10,`X: ${this.x}, Y: ${this.y}`,r).setDepth(100),this.scene.add.text(this.x+50,this.y+10,`Physics: ${t.x}, ${t.y}`,r).setDepth(100),this.scene.add.text(this.x+50,this.y+30,`Size: ${t.width}x${t.height}`,r).setDepth(100),this.scene.add.text(this.x+50,i,"DOOR BOTTOM",r).setDepth(100),this.scene.add.text(this.x+50,s+15,"PLATFORM SURFACE",r).setDepth(100),e.setDepth(50)}isPlayerNearby(){return this.playerNearby}destroy(){this.hidePrompt(),super.destroy()}};var fe=class{constructor(a){this.loadQueue=[];this.loadedAssets=new Set;this.failedAssets=new Set;this.retryCount=new Map;this.loadingPromises=new Map;this.scene=a}registerAssets(a){this.loadQueue.push(...a)}async loadAllAssets(){let a=this.loadQueue.map(e=>this.loadAsset(e));await Promise.allSettled(a)}async loadAsset(a){if(this.loadingPromises.has(a.key))return this.loadingPromises.get(a.key);if(this.loadedAssets.has(a.key))return!0;if(this.failedAssets.has(a.key))return!1;let e=this.attemptLoad(a);return this.loadingPromises.set(a.key,e),e}async attemptLoad(a){let e=a.retries||3,t=this.retryCount.get(a.key)||0;for(;t<e;)try{return await this.loadSingleAsset(a),this.loadedAssets.add(a.key),this.loadingPromises.delete(a.key),!0}catch{t++,this.retryCount.set(a.key,t),t<e&&await new Promise(s=>setTimeout(s,Math.pow(2,t)*1e3))}return a.fallback&&this.scene.textures.exists(a.fallback)?(this.loadedAssets.add(a.key),this.loadingPromises.delete(a.key),!0):(this.failedAssets.add(a.key),this.loadingPromises.delete(a.key),!1)}loadSingleAsset(a){return new Promise((e,t)=>{if(a.type==="image"&&this.scene.textures.exists(a.key)){console.log(`\u26A1 Asset already loaded: ${a.key}`),e();return}if(a.type==="audio"&&this.scene.cache.audio.exists(a.key)){console.log(`\u26A1 Audio already loaded: ${a.key}`),e();return}let i=()=>{this.scene.load.off("filecomplete",s),this.scene.load.off("loaderror",r),e()},s=o=>{o===a.key&&i()},r=o=>{o.key===a.key&&(this.scene.load.off("filecomplete",s),this.scene.load.off("loaderror",r),t(new Error(`Failed to load ${a.key}: ${o.src}`)))};switch(this.scene.load.on("filecomplete",s),this.scene.load.on("loaderror",r),a.type){case"image":this.scene.load.image(a.key,a.url);break;case"audio":this.scene.load.audio(a.key,a.url);break;case"json":this.scene.load.json(a.key,a.url);break;default:t(new Error(`Unsupported asset type: ${a.type}`));return}this.scene.load.isLoading()||this.scene.load.start()})}isAssetLoaded(a){return this.loadedAssets.has(a)&&this.scene.textures.exists(a)}isAssetFailed(a){return this.failedAssets.has(a)}getSafeTexture(a,e="defaultTexture"){return this.isAssetLoaded(a)?a:(this.scene.textures.exists(e)||this.createEmergencyFallback(e),e)}createEmergencyFallback(a){if(this.scene.textures.exists(a))return;let e=this.scene.add.graphics();e.fillStyle(16711680,1),e.fillRect(0,0,32,32),e.generateTexture(a,32,32),e.destroy()}createCommonFallbacks(){[{key:"defaultEnemy",color:4286945,size:{w:36,h:36}},{key:"defaultPlayer",color:65280,size:{w:48,h:64}},{key:"defaultCoin",color:16766720,size:{w:24,h:24}}].forEach(e=>{if(!this.scene.textures.exists(e.key)){let t=this.scene.add.graphics();t.fillStyle(e.color,1),t.fillRect(0,0,e.size.w,e.size.h),t.generateTexture(e.key,e.size.w,e.size.h),t.destroy()}})}};var ve=class{constructor(a){this.isOpen=!1;this.soundEffectsEnabled=!0;this.musicEnabled=!0;this.soundToggle=null;this.musicToggle=null;this.instructionsOverlay=null;this.scene=a,this.loadSettings(),this.create()}create(){let a=this.scene.cameras.main,e=a.width/2,t=a.height/2;this.container=this.scene.add.container(e,t),this.container.setDepth(5e3),this.container.setScrollFactor(0,0),this.backgroundOverlay=this.scene.add.rectangle(0,0,a.width*2,a.height*2,0,.7),this.menuPanel=this.createMenuPanel();let i=this.scene.add.text(0,-250,"GAME MENU",{fontSize:"18px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",align:"center"});i.setOrigin(.5);let s=this.createButton(0,-180,"VIEW INSTRUCTIONS",()=>this.openInstructionsScene(),4854924);s.setName("instructionsButton");let r=this.createDivider(-130);this.soundToggle=this.createToggleSwitch(`Sound
Effects`,-80,this.soundEffectsEnabled,d=>this.setSoundEffects(d)),this.soundToggle.setName("soundToggle"),this.musicToggle=this.createToggleSwitch("Music",-30,this.musicEnabled,d=>this.setMusic(d)),this.musicToggle.setName("musicToggle");let o=this.createDivider(20),n=this.createBizarreInfo(145),l=this.createDivider(200);this.container.getByName("resumeButton")&&console.error("\u26A0\uFE0F RESUME BUTTON ALREADY EXISTS!");let c=this.createButton(0,240,"RESUME GAME",()=>this.close(),3329330);c.setName("resumeButton"),console.log("\u{1F4CC} Created Resume button at Y=240"),console.log("\u{1F4CD} FINAL Button Positions:",{instructions:-180,soundToggle:-80,musicToggle:-30,wallet:70,bizarreInfo:145,resumeButton:240});let h=[this.backgroundOverlay,this.menuPanel,i,s,r,this.soundToggle,this.musicToggle,o];console.log("\u{1F3AF} PRE-ADD POSITIONS:",{soundToggle:this.soundToggle?this.soundToggle.y:"null",musicToggle:this.musicToggle?this.musicToggle.y:"null",instructionsBtn:s?s.y:"null",resumeBtn:c?c.y:"null"}),h.push(n,l,c),this.container.add(h),console.log("\u{1F3AF} POST-ADD POSITIONS:"),this.container.list.forEach(d=>{d instanceof Phaser.GameObjects.Container&&d.name&&console.log(`  ${d.name}: Y=${d.y}`)}),this.container.sendToBack(this.backgroundOverlay),this.container.setVisible(!1)}createMenuPanel(){let a=this.scene.add.graphics(),e=this.scene.cameras.main.width,t=Math.min(400,e-40),i=Math.min(600,this.scene.cameras.main.height-40),s=-t/2,r=-i/2;return console.log("\u{1F5BC}\uFE0F Panel dimensions:",{width:t,height:i,position:`(${s}, ${r})`}),a.fillStyle(4854924,.95),a.fillRoundedRect(s,r,t,i,15),a.lineStyle(3,16766720),a.strokeRoundedRect(s,r,t,i,15),a}createButton(a,e,t,i,s=4854924){let r=this.scene.add.container(a,e),o=this.scene.cameras.main.width,c=this.scene.add.rectangle(0,0,340,50,s,.8);c.setStrokeStyle(2,16766720);let h=this.scene.add.text(0,0,t,{fontSize:"14px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});return h.setOrigin(.5),c.setDepth(10),h.setDepth(11),r.add([c,h]),c.setInteractive({useHandCursor:!0}),c.input&&this.scene.input.setTopOnly(!1),c.on("pointerdown",d=>{if(t==="RESUME GAME"){let p=c.getBounds(),u=this.container,m=d.x-u.x,y=d.y-u.y,g=e-25,f=e+25;if(!(y>=g&&y<=f&&m>=-160&&m<=160))return}i()}),r}createToggleSwitch(a,e,t,i){let s=this.scene.add.container(0,e),r=this.scene.add.text(-90,0,a,{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",align:"left",lineSpacing:5});r.setOrigin(0,.5);let o=80,n=60,l=30,c=this.scene.add.rectangle(o,0,n,l,0,0);c.setInteractive({useHandCursor:!0});let h=this.scene.add.graphics(),d=y=>{h.clear(),h.fillStyle(y?3329330:16739179,1),h.fillRoundedRect(o-n/2,-l/2,n,l,15),h.lineStyle(2,16766720),h.strokeRoundedRect(o-n/2,-l/2,n,l,15)};d(t);let p=t?o+15:o-15,u=this.scene.add.circle(p,0,13,16777215);u.setStrokeStyle(2,16766720),s.add([r,h,u,c]);let m=t;return c.on("pointerdown",y=>{y&&y.event&&y.event.stopPropagation(),m=!m,this.scene.tweens.add({targets:u,x:m?o+15:o-15,duration:200,ease:"Power2"}),d(m),i(m)}),c.on("pointerover",()=>{h.clear(),h.fillStyle(m?3329330:16739179,.8),h.fillRoundedRect(o-n/2,-l/2,n,l,15),h.lineStyle(3,16766720),h.strokeRoundedRect(o-n/2,-l/2,n,l,15)}),c.on("pointerout",()=>{d(m)}),s.setData("enabled",m),s.setData("updateState",y=>{m=y,u.x=y?o+15:o-15,d(y)}),s}createDivider(a){let e=this.scene.add.graphics();return e.lineStyle(1,16766720,.3),e.moveTo(-150,a),e.lineTo(150,a),e.strokePath(),e}createBizarreInfo(a){let e=this.scene.add.container(0,a),t=this.scene.add.container(0,0),i=340,r=this.scene.add.rectangle(0,0,i,70,16738740,.9);r.setStrokeStyle(2,16716947),r.setInteractive({useHandCursor:!0}),r.setData("expectedY",a),r.setData("buttonType","bizarreSwap");let o=this.scene.add.text(0,-20,"BizarreBeasts ($BB)",{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});o.setOrigin(.5);let n=this.scene.add.text(0,0,"0x0520bf1d3cEE163407aDA79109333aB1599b4004",{fontSize:"7px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700",wordWrap:{width:i-20}});n.setOrigin(.5);let l=this.scene.add.text(0,18,"Click to swap on Uniswap",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFF00"});l.setOrigin(.5),r.on("pointerover",()=>{r.setFillStyle(16716947,.95),r.setScale(1.02)}),r.on("pointerout",()=>{r.setFillStyle(16738740,.9),r.setScale(1)}),t.add([r,o,n,l]);let c=this.scene.add.text(0,50,"Created by @bizarrebeast",{fontSize:"9px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});return c.setOrigin(.5),e.add([t,c]),e}createSDKIndicator(a){let e=this.scene.add.container(0,a),t=this.scene.game.sound.mute,i=this.scene.add.text(0,0,`SDK Global: ${t?"MUTED":"ACTIVE"}`,{fontSize:"11px",fontFamily:'"Press Start 2P", system-ui',color:t?"#FF6B6B":"#AAAAAA"});i.setOrigin(.5);let s=this.scene.add.text(0,20,"(Controlled by platform)",{fontSize:"8px",fontFamily:'"Press Start 2P", system-ui',color:"#777777"});return s.setOrigin(.5),e.add([i,s]),e.setData("updateStatus",()=>{let r=this.scene.game.sound.mute;i.setText(`SDK Global: ${r?"MUTED":"ACTIVE"}`),i.setColor(r?"#FF6B6B":"#AAAAAA")}),e}setSoundEffects(a){if(console.log(`\u{1F50A} Sound effects ${a?"enabled":"disabled"}`),this.soundEffectsEnabled=a,this.scene.registry.set("sfxEnabled",a),this.saveSettings(),this.soundToggle){let e=this.soundToggle.getData("updateState");e&&e(a)}}setMusic(a){if(console.log(`\u{1F3B5} Music ${a?"enabled":"disabled"}`),this.musicEnabled=a,this.scene.registry.set("musicEnabled",a),this.saveSettings(),this.scene.backgroundMusic&&this.scene.backgroundMusic.setVolume(a?.3:0),this.musicToggle){let e=this.musicToggle.getData("updateState");e&&e(a)}}loadSettings(){let a=localStorage.getItem("audioSettings");if(a){let e=JSON.parse(a);this.soundEffectsEnabled=e.soundEffectsEnabled!==!1,this.musicEnabled=e.musicEnabled!==!1}this.scene.registry.set("sfxEnabled",this.soundEffectsEnabled),this.scene.registry.set("musicEnabled",this.musicEnabled)}saveSettings(){let a={soundEffectsEnabled:this.soundEffectsEnabled,musicEnabled:this.musicEnabled};localStorage.setItem("audioSettings",JSON.stringify(a))}open(){if(this.isOpen){console.log("\u26A0\uFE0F Menu already open, ignoring open() call");return}this.isOpen=!0,this.container.setVisible(!0),this.soundEffectsEnabled&&this.scene.sound.play("menu-toggle",{volume:.5}),this.container.list.filter(t=>t instanceof Phaser.GameObjects.Container&&t.getData("updateStatus")).forEach(t=>{let i=t.getData("updateStatus");i&&i()}),this.pauseGame(),this.scene.input.enabled=!0,this.enableNestedInteractivity(this.container);let e=t=>{this.manualHitTest(t)};this.scene.input.off("pointerdown",e),this.scene.input.on("pointerdown",e),this.container.setData("pointerListener",e),this.scene.children.bringToTop(this.container),this.scene.input.setTopOnly(!1),this.container.setAlpha(1)}enableNestedInteractivity(a){a.list.forEach(e=>{e instanceof Phaser.GameObjects.Rectangle?(e.input||e.setInteractive({useHandCursor:!0}),this.scene.input.enable(e)):e instanceof Phaser.GameObjects.Container&&this.enableNestedInteractivity(e)})}addDebugVisualization(){let a=this.container.getByName("debugGraphics");a&&a.destroy();let e=this.scene.add.graphics();e.setName("debugGraphics"),console.log("\u{1F4E6} MENU CONTAINER ELEMENTS:",{containerPos:`(${this.container.x}, ${this.container.y})`,childCount:this.container.list.length});let t=null,i=null;this.container.list.forEach((u,m)=>{if(u instanceof Phaser.GameObjects.Container){let y=u.name||"unnamed",g=u.input?"INTERACTIVE":"not-interactive";console.log(`  [${m}] Container '${y}': Y=${u.y}, X=${u.x} [${g}]`),y==="musicToggle"&&(t=u.y),y==="soundToggle"&&(i=u.y),u.list&&u.list.length>0&&u.list.forEach((f,v)=>{let S=f.input?"INTERACTIVE":"";f instanceof Phaser.GameObjects.Text&&f.text?console.log(`    \u2514\u2500 Text: "${f.text.substring(0,20)}..." at (${f.x}, ${f.y}) ${S}`):f instanceof Phaser.GameObjects.Rectangle&&console.log(`    \u2514\u2500 Rectangle at (${f.x}, ${f.y}) size: ${f.width}x${f.height} ${S}`)})}else if(u instanceof Phaser.GameObjects.Text){let y=u.input?"INTERACTIVE":"";console.log(`  [${m}] Text: "${u.text.substring(0,30)}..." at Y=${u.y} ${y}`)}else if(u instanceof Phaser.GameObjects.Graphics){let y=u.input?"INTERACTIVE":"";console.log(`  [${m}] Graphics/Divider at Y=${u.y} ${y}`)}else if(u instanceof Phaser.GameObjects.Rectangle){let y=u.input?"INTERACTIVE!":"";console.log(`  [${m}] Rectangle at Y=${u.y} size: ${u.width}x${u.height} ${y}`)}}),console.log("\u26A0\uFE0F VISUAL POSITIONS VS HIT ZONES:",{musicToggle:{visual:t,hitZone:"-45 to -15",mismatch:t!==-30},soundToggle:{visual:i,hitZone:"-95 to -65",mismatch:i!==-80}});let s=this.container.getByName("instructionsButton"),r=this.container.getByName("soundToggle"),o=this.container.getByName("musicToggle"),n=this.container.getByName("resumeButton");console.log("\u{1F3AF} FOUND ELEMENTS:",{instructionsBtn:s?`Y=${s.y}`:"NOT FOUND",soundToggle:r?`Y=${r.y}`:"NOT FOUND",musicToggle:o?`Y=${o.y}`:"NOT FOUND",resumeBtn:n?`Y=${n.y}`:"NOT FOUND"});let l=this.scene.registry.get("isDgen1")||window.location.port==="3001",c=this.scene.cameras.main.width<=500?160:170;s&&(e.lineStyle(2,16776960,.8),e.strokeRect(-c,s.y-25,c*2,50)),r&&(e.lineStyle(2,65535,.8),e.strokeRect(50,r.y-15,60,30)),o&&(e.lineStyle(2,16711935,.8),e.strokeRect(50,o.y-15,60,30)),n&&(e.lineStyle(2,65280,.8),e.strokeRect(-c,n.y-25,c*2,50));let h={fontSize:"10px",fontFamily:"monospace",color:"#FFFFFF",backgroundColor:"#000000",padding:{x:2,y:1}};if(s){let u=this.scene.add.text(0,s.y-40,"INSTR HIT",h);u.setOrigin(.5),e.add(u)}if(r){let u=this.scene.add.text(80,r.y-25,"SOUND HIT",h);u.setOrigin(.5),e.add(u)}if(o){let u=this.scene.add.text(80,o.y-25,"MUSIC HIT",h);u.setOrigin(.5),e.add(u)}if(n){let u=this.scene.add.text(0,n.y-40,"RESUME HIT",h);u.setOrigin(.5),e.add(u)}e.lineStyle(2,16711680,1),e.moveTo(-10,0),e.lineTo(10,0),e.moveTo(0,-10),e.lineTo(0,10);let d=this.scene.add.text(15,15,"Container (0,0)",h);d.setOrigin(0),this.container.add([e,d]);let p=this.scene.add.text(10,10,"",{fontSize:"12px",fontFamily:"monospace",color:"#00FF00",backgroundColor:"#000000",padding:{x:5,y:5}});p.setScrollFactor(0),p.setDepth(1e4),p.setName("pointerTracker"),this.scene.input.on("pointermove",u=>{let m=this.scene.cameras.main,y=m.width/2,g=m.height/2,f=Math.round(u.x-y),v=Math.round(u.y-g);p.setText(`Screen: (${Math.round(u.x)}, ${Math.round(u.y)})
Relative: (${f}, ${v})
Container: (${y}, ${g})`)})}manualHitTest(a){let e=this.scene.cameras.main,t=this.scene.registry.get("isDgen1")||window.location.port==="3001",i=e.width,s=i<=500,r=i/2,o=e.height/2,n=a.x,l=a.y,c=n-r,h=l-o;s?console.log("\u{1F3AF} Regular Menu Hit Test:",{pointerScreen:`(${Math.round(n)}, ${Math.round(l)})`,containerCenter:`(${r}, ${o})`,relativePos:`(${Math.round(c)}, ${Math.round(h)})`,cameraSize:`${i}x${e.height}`,cameraScroll:`(${Math.round(e.scrollX)}, ${Math.round(e.scrollY)})`,version:"DGEN1 (720x720)"}):console.log("\u{1F3AF} Manual hit test at:",{pointerX:Math.round(n),pointerY:Math.round(l),containerPos:`(${r}, ${o})`});let d=170;s&&console.log("\u{1F3AE} HIT TEST ZONES:",{instructionsZone:"Y: -205 to -155",soundToggleZone:"Y: -95 to -65, X: 50 to 110",musicToggleZone:"Y: -45 to -15, X: 50 to 110",resumeZone:"Y: 155 to 205",clickedAt:`(${Math.round(c)}, ${Math.round(h)})`});let p=80,u=-80,m=Math.abs(c-p)<30&&Math.abs(h-u)<15;if(s&&m&&console.log("\u{1F50A} Sound Toggle HIT at:",{toggleCenter:`(${p}, ${u})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`}),m){console.log("\u2705 Sound toggle hit!"),this.setSoundEffects(!this.soundEffectsEnabled);return}let y=80,g=-30,f=Math.abs(c-y)<30&&Math.abs(h-g)<15;if(s){let E={xDist:Math.abs(c-y),yDist:Math.abs(h-g),wouldHit:f};Math.abs(h-g)<50&&console.log("\u{1F3B5} Music Toggle Check:",{toggleCenter:`(${y}, ${g})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`,distance:E,hit:f})}if(f){console.log("\u2705 Music toggle hit!"),this.setMusic(!this.musicEnabled);return}let v=0,S=t?240:180,x=Math.abs(c-v)<d&&Math.abs(h-S)<25;if(s&&x&&console.log("\u{1F4CD} Resume Button HIT at:",{btnCenter:`(${v}, ${S})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`}),x){console.log("\u2705 Resume button hit!"),this.close();return}let P=0,C=-180,k=Math.abs(c-P)<d&&Math.abs(h-C)<25;if(s&&k&&console.log("\u{1F4CD} Instructions Button HIT at:",{btnCenter:`(${P}, ${C})`,relativeClick:`(${Math.round(c)}, ${Math.round(h)})`}),k){console.log("\u2705 Instructions button hit!"),this.openInstructionsScene();return}}addDebugVisualization(){let a=this.container.getByName("debugContainer");a&&a.destroy();let e=this.scene.add.container(0,0);e.setName("debugContainer");let t=this.scene.add.graphics(),i=this.container.getByName("resumeButton");if(i){t.lineStyle(4,16711935,1),t.strokeRect(i.x-170,i.y-25,340,50);let u=this.scene.add.text(i.x,i.y-40,`ACTUAL Button Pos: (${i.x}, ${i.y})`,{fontSize:"12px",fontFamily:"Arial",color:"#ff00ff",backgroundColor:"#000000",padding:{x:2,y:2}});u.setOrigin(.5),e.add(u)}t.lineStyle(2,65280,.5),t.strokeRect(-170,125,340,50),t.lineStyle(2,255,.5),t.strokeRect(-170,-165,340,50);let s=this.scene.add.text(0,110,"Created at Y=150",{fontSize:"10px",fontFamily:"Arial",color:"#00ff00"});s.setOrigin(.5);let r=this.scene.add.text(0,-180,"Instructions Zone",{fontSize:"10px",fontFamily:"Arial",color:"#0000ff"});r.setOrigin(.5);let o=this.scene.add.text(-210,-380,"",{fontSize:"10px",fontFamily:"monospace",color:"#ffff00",backgroundColor:"#000000",padding:{x:5,y:5}});o.setName("cursorText");let n=this.scene.add.graphics();n.lineStyle(2,16711680,.8);let l=this.container.x,c=this.container.y;n.strokeRect(0-170,150-25,340,50);let p=this.scene.add.text(0,190,"Manual Hit Test Y=150 (Fixed)",{fontSize:"10px",fontFamily:"Arial",color:"#ff0000"});p.setOrigin(.5),e.add([t,n,s,r,p,o]),this.container.add(e)}updateCursorTracking(a){let e=this.container.getByName("debugContainer");if(!e)return;let t=e.getByName("cursorText");if(!t)return;let i=this.scene.cameras.main,s=this.container.x,r=this.container.y,o=a.x-s,n=a.y-r,l=s+0,c=r+150,h=Math.abs(a.x-l)<170&&Math.abs(a.y-c)<25,d=this.container.getByName("resumeButton"),p="Button not found",u="Rect not found";if(d){let g=d.x,f=d.y;p=`Button container: (${g}, ${f})`;let v=d.list[0];if(v){let S=s+g+v.x,x=r+f+v.y;u=`Rect world: (${Math.round(S)}, ${Math.round(x)})`;let P=a.x>=S-170&&a.x<=S+170&&a.y>=x-25&&a.y<=x+25;u+=P?" HOVERING!":""}}let m=i.scrollY,y=r+150-m;t.setText([`Cursor: (${Math.round(a.x)}, ${Math.round(a.y)})`,`Container: (${Math.round(s)}, ${Math.round(r)})`,`Camera ScrollY: ${Math.round(m)}`,`Button Logic Y: ${r+150} (= 550)`,`Button Visual Y: ${Math.round(y)}`,`Manual Hit: ${h?"YES":"NO"}`,`${p}`,`${u}`])}close(){if(!this.isOpen){console.log("\u26A0\uFE0F Menu already closed, ignoring close() call");return}console.log("\u{1F354} Closing menu overlay"),this.soundEffectsEnabled&&this.scene.sound.play("menu-toggle",{volume:.5}),this.isOpen=!1;let a=this.container.getData("pointerListener");a&&(this.scene.input.off("pointerdown",a),this.container.setData("pointerListener",null)),this.container.setVisible(!1),this.container.setAlpha(1),this.resumeGame()}pauseGame(){this.scene.touchControls&&this.scene.touchControls.disable(),this.scene.physics.pause(),this.scene.anims.pauseAll(),this.scene.registry.set("isPaused",!0),this.scene.input.enabled=!0}resumeGame(){this.scene.physics.resume(),this.scene.anims.resumeAll(),this.scene.time.paused=!1,this.scene.tweens.resumeAll(),this.scene.registry.set("isPaused",!1),this.scene.touchControls&&this.scene.touchControls.enable()}showInstructions(){this.instructionsOverlay||this.createInstructionsOverlay(),this.instructionsOverlay?.setVisible(!0),this.instructionsOverlay?.setAlpha(0),this.scene.tweens.add({targets:this.instructionsOverlay,alpha:1,duration:200})}createInstructionsOverlay(){this.instructionsOverlay=this.scene.add.container(b.canvas.width/2,b.canvas.height/2),this.instructionsOverlay.setDepth(2e3);let a=this.scene.add.rectangle(0,0,b.canvas.width,b.canvas.height,0,.9);a.setInteractive();let e=this.scene.add.graphics();e.fillStyle(32896,.95),e.fillRoundedRect(-300,-250,600,500,15),e.lineStyle(3,2142890),e.strokeRoundedRect(-300,-250,600,500,15);let t=this.scene.add.text(0,-210,"INSTRUCTIONS",{fontSize:"18px",fontFamily:'"Press Start 2P", system-ui',color:"#FFD700"});t.setOrigin(.5);let i=["CONTROLS:","","Move: WASD or Arrow Keys","Jump: Space or E","Climb: Up/Down on ladders","Throw: Q, V, or M","","OBJECTIVE:","","Collect coins and gems","Avoid or defeat enemies","Reach the door to advance","","Press ESC to open this menu"],s=this.scene.add.text(0,-100,i.join(`
`),{fontSize:"12px",fontFamily:'"Press Start 2P", system-ui',color:"#FFFFFF",align:"center",lineSpacing:8});s.setOrigin(.5);let r=this.createButton(0,210,"CLOSE",()=>this.hideInstructions(),16739179);this.instructionsOverlay.add([a,e,t,s,r]),this.instructionsOverlay.setVisible(!1)}hideInstructions(){this.scene.tweens.add({targets:this.instructionsOverlay,alpha:0,duration:200,onComplete:()=>{this.instructionsOverlay?.setVisible(!1)}})}openInstructionsScene(){console.log("\u{1F4D6} Opening instructions scene"),this.container.setVisible(!1),this.scene.scene.sleep("GameScene"),this.scene.scene.launch("InstructionsScene",{returnScene:"GameScene",fromMenu:!0,reopenMenu:!0})}async handleWalletConnect(){}getIsOpen(){return this.isOpen}toggle(){this.isOpen?this.close():this.open()}};var oe=class{constructor(a){this.MAX_CACHED_BACKGROUNDS=10;this.PRELOAD_COUNT=2;this.currentChapter="";this.currentLevel=1;this.beastModePool=[];this.lastBeastModeRotation=0;this.beastModeLoadingProgress=0;this.beastModeFullyLoaded=!1;this.loadingBatches=[];this.scene=a,this.loadedTextures=new Set,this.textureCache=new Map,this.chapters=new Map,this.backgroundUrls=new Map,this.initializeChapters(),this.initializeBackgroundUrls()}initializeChapters(){this.chapters.set("crystal_cavern",{name:"Crystal Cavern",levelRange:[1,10],backgrounds:["crystal-cavern-1","crystal-cavern-2","crystal-cavern-3","crystal-cavern-4","crystal-cavern-5","crystal-cavern-6","crystal-cavern-7","crystal-cavern-8","crystal-cavern-9","crystal-cavern-10"],theme:"underground crystal caves with glowing gems"}),this.chapters.set("volcanic_crystal",{name:"Volcanic Crystal Cavern",levelRange:[11,20],backgrounds:["volcanic-crystal-1","volcanic-crystal-2","volcanic-crystal-3","volcanic-crystal-4","volcanic-crystal-5","volcanic-crystal-6","volcanic-crystal-7","volcanic-crystal-8","volcanic-crystal-9","volcanic-crystal-10"],theme:"lava-infused crystal formations, heat effects"}),this.chapters.set("steampunk",{name:"Steampunk Crystal Cavern",levelRange:[21,30],backgrounds:["steampunk-1","steampunk-2","steampunk-3","steampunk-4","steampunk-5","steampunk-6","steampunk-7","steampunk-8","steampunk-9","steampunk-10"],theme:"industrial machinery, gears, steam pipes"}),this.chapters.set("storm",{name:"Electrified Crystal Cavern",levelRange:[31,40],backgrounds:["electrified-1","electrified-2","electrified-3","electrified-4","electrified-5","electrified-6","electrified-7","electrified-8","electrified-9","electrified-10"],theme:"lightning, clouds, turbulent weather"}),this.chapters.set("galactic",{name:"Galactic Crystal Cavern",levelRange:[41,50],backgrounds:["galactic-1","galactic-2","galactic-3","galactic-4","galactic-5","galactic-6","galactic-7","galactic-8","galactic-9","galactic-10"],theme:"space, stars, nebulae, cosmic themes"}),this.chapters.set("beast_mode",{name:"Beast Mode",levelRange:[51,1/0],backgrounds:["beast-mode-1","beast-mode-2","beast-mode-3","beast-mode-4","beast-mode-5","beast-mode-6","beast-mode-7","beast-mode-8","beast-mode-9","beast-mode-10","beast-mode-11","beast-mode-12","beast-mode-13"],theme:"random pool from all chapters plus exclusive beast backgrounds"}),this.chapters.set("bonus",{name:"Special Bonus",levelRange:[-1,-1],backgrounds:["bonus-1","bonus-2","bonus-3","bonus-4","bonus-5","bonus-6","bonus-7"],theme:"unique backgrounds for bonus levels"})}initializeBackgroundUrls(){this.backgroundUrls.set("volcanic-crystal-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2011-GZe4EOiyQqMVmrL1suPvCfj2H7XRyU.png?h8lo"),this.backgroundUrls.set("volcanic-crystal-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2012-Xpfr4nKJX0JcfLlrjZxaw0UVKr3xRJ.png?VTjY"),this.backgroundUrls.set("volcanic-crystal-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2013-5VWrULlkLRSqGhIPYBKAGOlY7cvDJs.png?spcG"),this.backgroundUrls.set("volcanic-crystal-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2014-1gw8iVsW1NFUtTX9qkrCaOkzceXgZa.png?uJJ4"),this.backgroundUrls.set("volcanic-crystal-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2015-My6wxLCAKkrjp7DnRUhTTNzy4pGzNz.png?wogd"),this.backgroundUrls.set("volcanic-crystal-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2016-HvPApBdJnsvIKOHL12BVv7OOCRvtXl.png?JpAr"),this.backgroundUrls.set("volcanic-crystal-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2017-M4H2arE4cKPFCFnWvPKeO75XQhGeTr.png?aP8G"),this.backgroundUrls.set("volcanic-crystal-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2018-EaBUdUtkhdA9O7UPGhUzbCSufw5Id3.png?7XYw"),this.backgroundUrls.set("volcanic-crystal-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2019-ypt8lxgxyGduFRNsmei09BL2mKGIYH.png?ojyx"),this.backgroundUrls.set("volcanic-crystal-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2020-VoCdHbTIAHWaULUuJAu1kL8TiARBUM.png?CK3z"),this.backgroundUrls.set("steampunk-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2021-DPL9BM5HXEAbpVzWP2BTZAfO33f54v.png?1fKU"),this.backgroundUrls.set("steampunk-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2022-qDjjzq1C2FmwcHMYRZTzpaGej0yGwb.png?5CrH"),this.backgroundUrls.set("steampunk-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2023-lLNjfzk4mhhPURUbkfRTMNdLplNM22.png?uDB5"),this.backgroundUrls.set("steampunk-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2024-Krew0eCXapHP78qdwQrgTp7Pvy9IMQ.png?tp0E"),this.backgroundUrls.set("steampunk-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2025-bROe8HWWQGVwbIcF2TrA4E3jOprfVJ.png?Z70l"),this.backgroundUrls.set("steampunk-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2026-UTEcGMcuwl5X6QRJj3TEmJxuQMtAVB.png?YEJ9"),this.backgroundUrls.set("steampunk-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2027-QsWK3rAAwdnMlTzY0zQlIQlqYIeZoe.png?v371"),this.backgroundUrls.set("steampunk-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2028-qunz3jvjcvUy0scMr4b18HIWuEABkb.png?DG4r"),this.backgroundUrls.set("steampunk-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2029-metaGhO5uoqBktHCQnoqNmrXrancE4.png?XeH2"),this.backgroundUrls.set("steampunk-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2030-qYeBT9cn6x3uAG4WvPeSa3clML1HpD.png?As4y"),this.backgroundUrls.set("electrified-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2031-O06tOHxb8b80yfdepBVLj3wJjNDMju.png?ILXr"),this.backgroundUrls.set("electrified-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2032-1YFN1MhcMfKXh149SshcFyW07KBHCG.png?PXOw"),this.backgroundUrls.set("electrified-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2033-ve4BB0Wu6RoMblkZbGmx2ST3IyfWHn.png?6pEl"),this.backgroundUrls.set("electrified-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2034-9DMyTcBY2QhKKTskDe6bzWXRZsgLlT.png?Hr6t"),this.backgroundUrls.set("electrified-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2035-qNc9FoZH60Awf13ISIvHpDNSNJifFq.png?Dagv"),this.backgroundUrls.set("electrified-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2036-365hGJnOHpzVyTOpa1618kVJMi6UlX.png?DkAI"),this.backgroundUrls.set("electrified-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2037-KOs54KffvnmZRGfkzDmk3GRvpjQ7mg.png?Edo8"),this.backgroundUrls.set("electrified-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2038-oU56rbW3kuE6MYNXgMgvasvWprLYu4.png?f0hH"),this.backgroundUrls.set("electrified-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2039-4xcZEcBBGlY6iMfY9CO5qh6CtjIbDe.png?otb6"),this.backgroundUrls.set("electrified-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2040-Dr5Q2cJ64opY0LX1D8wIyzMhKfcaEY.png?CbYG"),this.backgroundUrls.set("galactic-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2041-ojno2HZouD4Dt2V1Z8lPT8g9TkR4ie.png?zuLt"),this.backgroundUrls.set("galactic-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2042-zErQ0r8sKPMfgFQwVz0s3ZiGFbdWHA.png?Dppy"),this.backgroundUrls.set("galactic-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2043-RNzRiZW56aIS7iwgav4eUdiwLVjXeD.png?twVY"),this.backgroundUrls.set("galactic-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2044-gn593N3qTHsJT0UPP8gegOuTUMo1y5.png?oLhA"),this.backgroundUrls.set("galactic-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2045-eZS62LEmA5ziCPOdP2Q4F03IIqppAj.png?GGbK"),this.backgroundUrls.set("galactic-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2046-FblgXgSZg6UsQw0SjYc2kIiHh0KH2P.png?CjZV"),this.backgroundUrls.set("galactic-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2047-MZmOHh8GVZiGayV8U0klva12TlXzFq.png?0Irb"),this.backgroundUrls.set("galactic-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2048-4AZugPAFLnrLSulJNqKCiApLZwTYu6.png?3oKl"),this.backgroundUrls.set("galactic-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2049-MqGMDTShcuUgAj5bNZJITaKkhOjNhR.png?iYFP"),this.backgroundUrls.set("galactic-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2050-ff9za6km5crBBMDI3SCAAMmFudZq8E.png?s174"),this.backgroundUrls.set("bonus-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%201-sSavRhv3PSULBYqZTyGpCnPdMjhAq2.png?5PEU"),this.backgroundUrls.set("bonus-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%202-w0skJJAvJH9cYfQluphIJQwMFJpgK3.png?q77P"),this.backgroundUrls.set("bonus-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%203-kn73QdXKclD3LrMf3BXOH4B3ujbuxN.png?t9Nv"),this.backgroundUrls.set("bonus-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%204-opRR6rXctR8XkRkQIo5LfITdiyHhzq.png?Yubo"),this.backgroundUrls.set("bonus-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%205-FOtt55z5rVDYStfszLrUJRnnpovVMb.png?RCnr"),this.backgroundUrls.set("bonus-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%206-mAMzjvs6bdoK8SLuFaztJphnDOLA9U.png?j0bG"),this.backgroundUrls.set("bonus-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bonus%207-9aPLVTEEDFoFgelvBQTC9ISErnYBCj.png?Ongz"),this.backgroundUrls.set("beast-mode-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%201-sRb0H9ErQnF9lBm5DuUzqtpwbZkRVS.png?3q8c"),this.backgroundUrls.set("beast-mode-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%202-LUcNgytry1u8MpUxWVGimvuMvTIVAT.png?vxmF"),this.backgroundUrls.set("beast-mode-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%203-goZNWmCpFDdm6dGhQdNO7CkgPLwqME.png?ExJw"),this.backgroundUrls.set("beast-mode-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%204-d2C0xeqQEzBvpaqO7diW0kqqPLOsk6.png?xmRP"),this.backgroundUrls.set("beast-mode-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%205-dCQCUxMIvQGPsWXKVh8hzq3dX8M7TA.png?M3Hi"),this.backgroundUrls.set("beast-mode-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%206-eOFodTEiDxDZUN3E4wIMGwzxUJ8QIK.png?1gGD"),this.backgroundUrls.set("beast-mode-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%207-TmIgs4UZyBWqt2718z94QbOAdLdlcS.png?iWFS"),this.backgroundUrls.set("beast-mode-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%208-vkOQZUrtkY7OX8U7lF5G9QCnRGKYq0.png?26ru"),this.backgroundUrls.set("beast-mode-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%209-3U9nvV48tv4NvvdFgqprbv3HcVgGg1.png?tx2Q"),this.backgroundUrls.set("beast-mode-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2010-9N8a5M5G9wI0OVoSMXBhlHPqaLg2d2.png?mPP6"),this.backgroundUrls.set("beast-mode-11","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2011-ujFZSIcr0VPwhT4smr13EPziNY4kEa.png?Rnqv"),this.backgroundUrls.set("beast-mode-12","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2012-hjyMpMwqW5hKpVPAsFGPaxuD5RaC7B.png?A52X"),this.backgroundUrls.set("beast-mode-13","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%2013-iekgQPJN2LYhyLP6LETjP8hkD2IlnD.png?3eMk")}getChapterForLevel(a,e=!1){return e?"bonus":a>=51?"beast_mode":a>=41?"galactic":a>=31?"storm":a>=21?"steampunk":a>=11?"volcanic_crystal":"crystal_cavern"}getBackgroundForLevel(a,e=!1){let t=this.getChapterForLevel(a,e);if(this.currentLevel=a,t!==this.currentChapter&&(this.currentChapter=t,t==="beast_mode"))return this.getBeastModeBackground(a);let i=this.chapters.get(t);if(!i||i.backgrounds.length===0)return this.getFallbackBackground(a);if(t==="bonus"){let o=(Math.floor(a/10)-1)%i.backgrounds.length;return i.backgrounds[o]}let s=(a-i.levelRange[0])%i.backgrounds.length;return i.backgrounds[s]}getBeastModeBackground(a){a%5===0&&a!==this.lastBeastModeRotation&&(this.lastBeastModeRotation=a,this.rotateBeastModePool()),this.beastModePool.length===0&&this.loadBeastModePool();let e=(a-51)%this.beastModePool.length;return this.beastModePool[e]}loadBeastModePool(){if(this.beastModeFullyLoaded){let a=[];this.chapters.forEach((t,i)=>{i!=="beast_mode"&&a.push(...t.backgrounds)}),this.beastModePool=[...a];let e=this.chapters.get("beast_mode");e&&e.backgrounds.length>0&&this.beastModePool.push(...e.backgrounds)}}prepareBeastModeBatches(){this.loadingBatches=[];let a=["crystal_cavern","volcanic_crystal","steampunk","storm","galactic","bonus"];for(let e of a){let t=this.chapters.get(e);if(t)for(let i=0;i<t.backgrounds.length;i+=10){let s=t.backgrounds.slice(i,Math.min(i+10,t.backgrounds.length));this.loadingBatches.push(s)}}console.log(`\u{1F4E6} Prepared ${this.loadingBatches.length} batches for progressive loading`)}startProgressiveBeastModeLoading(){if(this.loadingBatches.length===0){this.beastModeFullyLoaded=!0,console.log("\u2705 Beast Mode fully loaded!"),this.loadBeastModePool();return}this.progressiveLoadTimer&&this.progressiveLoadTimer.destroy();let a=0;this.progressiveLoadTimer=this.scene.time.addEvent({delay:2e3,repeat:this.loadingBatches.length-1,callback:async()=>{if(a<this.loadingBatches.length){let e=this.loadingBatches[a];console.log(`\u{1F4E5} Loading batch ${a+1}/${this.loadingBatches.length}`),await this.loadBackgroundBatch(e),this.beastModePool.push(...e),this.beastModeLoadingProgress+=e.length,a++,a>=this.loadingBatches.length&&(this.beastModeFullyLoaded=!0,console.log(`\u2705 Beast Mode fully loaded! Total backgrounds: ${this.beastModeLoadingProgress}`),this.loadBeastModePool())}}})}async loadBackgroundBatch(a){let e=[];for(let t of a)if(!this.loadedTextures.has(t)&&!this.scene.textures.exists(t)){let i=this.backgroundUrls.get(t);if(i){let s=new Promise(r=>{this.scene.load.image(t,i),this.scene.load.once("complete",()=>{this.loadedTextures.add(t),r()})});e.push(s)}}e.length>0&&(this.scene.load.start(),await Promise.all(e))}rotateBeastModePool(){for(let a=this.beastModePool.length-1;a>0;a--){let e=Math.floor(Math.random()*(a+1));[this.beastModePool[a],this.beastModePool[e]]=[this.beastModePool[e],this.beastModePool[a]]}}selectRandomSubset(a,e){return[...a].sort(()=>.5-Math.random()).slice(0,e)}async loadChapterBackgrounds(a){if(a==="beast_mode"){console.log("\u{1F9BE} Starting progressive loading for BEAST MODE"),this.beastModeLoadingProgress=0,this.beastModeFullyLoaded=!1;let i=this.chapters.get("beast_mode");i&&(await this.loadBackgroundBatch(i.backgrounds),console.log(`\u2705 Loaded initial ${i.backgrounds.length} Beast Mode exclusives`),this.beastModePool=[...i.backgrounds],this.beastModeLoadingProgress=i.backgrounds.length),this.prepareBeastModeBatches(),this.startProgressiveBeastModeLoading();return}let e=this.chapters.get(a);if(!e)return;console.log(`\u{1F4E5} Loading backgrounds for chapter: ${a}`);let t=[];for(let i of e.backgrounds)if(!this.loadedTextures.has(i))if(this.scene.textures.exists(i))this.loadedTextures.add(i);else{let s=this.backgroundUrls.get(i);if(s){let r=new Promise(o=>{this.scene.load.image(i,s),this.scene.load.once("complete",()=>{this.loadedTextures.add(i),console.log(`\u2705 Loaded background: ${i}`),o()})});t.push(r)}}t.length>0&&(this.scene.load.start(),await Promise.all(t))}unloadChapterBackgrounds(a){let e=this.chapters.get(a);e&&(this.loadedTextures.size<=this.MAX_CACHED_BACKGROUNDS||e.backgrounds.forEach(t=>{this.scene.textures.exists(t)&&t!==this.getBackgroundForLevel(this.currentLevel)&&(this.scene.textures.remove(t),this.loadedTextures.delete(t),this.textureCache.delete(t))}))}preloadNextLevels(a){for(let e=1;e<=this.PRELOAD_COUNT;e++){let t=a+e,i=this.getChapterForLevel(t);if(i!==this.currentChapter){this.loadChapterBackgrounds(i);break}}}disposeUnusedTextures(){let a=this.getBackgroundForLevel(this.currentLevel),e=new Set;for(let t=-1;t<=this.PRELOAD_COUNT;t++){let i=this.currentLevel+t;i>0&&e.add(this.getBackgroundForLevel(i))}this.loadedTextures.forEach(t=>{!e.has(t)&&this.loadedTextures.size>this.MAX_CACHED_BACKGROUNDS&&this.scene.textures.exists(t)&&(this.scene.textures.remove(t),this.loadedTextures.delete(t))})}isChapterTransition(a,e=!1){return e?!1:this.currentChapter==="bonus"?!0:this.getChapterForLevel(a)!==this.currentChapter}getChapterName(a,e=!1){let t=this.getChapterForLevel(a,e);return this.chapters.get(t)?.name||"Unknown"}getBeastModeLoadingProgress(){return{loaded:this.beastModeLoadingProgress,total:70,percentage:Math.round(this.beastModeLoadingProgress/70*100)}}isBeastModeFullyLoaded(){return this.beastModeFullyLoaded}getFallbackBackground(a){return"crystal-cavern-bg"}generateProceduralBackground(a){return this.getFallbackBackground(this.currentLevel)}addBackgroundUrls(a,e){let t=this.chapters.get(a);t&&(t.backgrounds=e)}getCurrentChapterInfo(){let a=this.chapters.get(this.currentChapter);if(!a)return{name:"Unknown",theme:"",progress:0};let e=0;if(this.currentChapter!=="beast_mode"){let[t,i]=a.levelRange;e=(this.currentLevel-t)/(i-t+1)*100}return{name:a.name,theme:a.theme,progress:Math.min(100,Math.max(0,e))}}};var Se=class extends Phaser.Scene{constructor(){super({key:"GameScene"});this.coins=[];this.blueCoins=[];this.diamonds=[];this.freeLifes=[];this.invincibilityPendants=[];this.treasureChests=[];this.crystalBalls=[];this.crystalBallProjectiles=[];this.levelHasCrystalBall=!1;this.cursedOrbs=[];this.cursedTealOrbs=[];this.levelHasCursedOrb=!1;this.levelHasCursedTealOrb=!1;this.isGameOver=!1;this.floorLayouts=[];this.ladderPositions=new Map;this.doorPositions=new Map;this.score=0;this.accumulatedScore=0;this.currentFloor=0;this.lives=3;this.totalCoinsCollected=0;this.totalGemsCollected=0;this.totalBlueGemsCollected=0;this.totalDiamondsCollected=0;this.livesEarned=0;this.COINS_PER_EXTRA_LIFE=150;this.MAX_LIVES=99;this.highestFloorGenerated=5;this.justKilledCat=!1;this.comboCount=0;this.comboTimer=null;this.visibilityRadius=160;this.invincibilityActive=!1;this.invincibilityTimer=null;this.invincibilityTimeRemaining=0;this.invincibilityTimerSparkleTimer=null;this.invincibilityWarningPlayed=!1;this.playerGoldenAura=null;this.playerParticleTrail=[];this.playerSpikeOverlap=null;this.playerSpikeCollider=null;this.gameStats={treasureChestsOpened:0,enemyKills:{caterpillar:0,rollz:0,chomper:0,snail:0,bouncer:0,stalker:0,rex:0,blu:0},totalEnemiesDefeated:0,highestFloor:0,livesLost:0};this.currentBackground="background-treasure-quest-5";this.backgroundLibrary=["background-treasure-quest-5","background-treasure-quest-6","background-treasure-quest-7"];this.backgroundSprite=null;this.backgroundInitialY=0;this.backgroundHeight=0;this.recentTiles=[];this.tileGrid=new Map;this.tileUsageCount=new Array(12).fill(0);this.door=null;this.isLevelStarting=!1;this.isLevelComplete=!1;this.speechBubble=null;this.thoughtBubble=null;this.bubbleTimer=null;this.BUBBLE_DISPLAY_TIME=3e3;this.loadingOverlay=null;this.showLoadingScreen=!1;this.reopenMenuAfterInit=!1}init(e){this.reopenMenuAfterInit=e?.reopenMenu||!1;let t=this.game.registry.get("isDeathRetry")||!1,i=this.game.registry.get("playerLives")||0,s=this.game.registry.get("isReplay")||!1,r=s||t&&i>0;this.showLoadingScreen=!r,console.log(`\u{1F3AC} Loading screen decision: isReplay=${s}, isDeathRetry=${t}, skip=${r}, SHOW=${this.showLoadingScreen}`),this.levelManager=new re,this.backgroundManager=new oe(this),this.cameras.main.setBackgroundColor(3023688);let o=this.registry.get("currentLevel")||1,n=`loading-screen-${o>=51?51:o>=41?41:o>=31?31:o>=21?21:o>=11?11:1}`;if(this.textures.exists(n))console.log(`\u26A1 Using pre-generated loading screen: ${n}`),this.instantLoadingScreen=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,n),this.instantLoadingScreen.setOrigin(.5),this.instantLoadingScreen.setDepth(1e5);else{console.log("\u26A0\uFE0F No pre-generated loading screen, creating text");let l=b.canvas.width/2,c=b.canvas.height/2,h=this.add.text(l,c,"LOADING...",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"});h.setOrigin(.5),h.setDepth(1e4),this.preloadLoadingText=h}console.log("\u{1F3AE} GameScene.init() - Loading screen displayed")}preload(){console.log("\u{1F504} GameScene.preload() started at",performance.now());let e=z.getPreloadedCount();e>0&&console.log(`\u2728 Found ${e} preloaded assets from InstructionsScene`),this.assetPool=new fe(this);let t=[{key:"visibilityOverlay",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO",type:"image",retries:3},{key:"background-treasure-quest-5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%205-pVHhUmXIAvnZT4aFVRFgYvljKibVS0.png?qco1",type:"image",retries:3},{key:"background-treasure-quest-6",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%206-gX1QoTf3UJnMPvbDKVt9hYGDD1AltE.png?LWtY",type:"image",retries:3},{key:"background-treasure-quest-7",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Treasure%20Quest%20BG%207-YeACeKZk8lSEU1IDy5zOU6G79VqYKx.png?TWtQ",type:"image",retries:3},{key:"playerIdleEye1",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%201-p01pa3z9fL9AyLQolMuYyBO3DIqgvB.png?FaaG",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye2",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%202-ngx0e1EF33iY14vRpcSvy8QOUjMKnl.png?lsFE",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBlink",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Idle%20eye%20position%20blinking-fDIX0Bin2Vh42SGyH0DT70fwWARivM.png?QXG7",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye3",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%203-TLisG1UJypI7PhiKszpBcC8Nx8ZyrS.png?6Tg9",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye4",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%204-kvrv3THif8vcKjFB0NPzOeclqapVi6.png?PuWO",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleEye5",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%205-1P13Nmi3xqoC5kWevrWUxutqyXfr99.png?F4D2",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBootyLeft",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/booty%20shaking%20left%20cheek-c4bJ5CnHbeRJc6LN3OSetpPvTNby88.png?zEph",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerIdleBootyRight",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/booty%20shaking%20right%20cheek-7eORz1b8ditvsXDolmHCEUlk7Wmvvd.png?UT5w",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerClimbLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/climbing%20ladder%20left%20foot%20up-Oipv0p2kIPLZcoV2XBC7FMjkKAzxOk.png?6y8P",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerClimbRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/climbing%20ladder%20right%20foot%20up-A7A5enZp5Z0EeXRZE8MVGvLZ9Jx5Ll.png?Hwlb",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerJumpLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/jumping%20left%20foot%20forward-mXUWm73dYQqZMOkl9Wn4MjBnzEdZjX.png?49nU",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerJumpRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/jumping%20right%20foot%20forward-qLrBUCfcOJhpnlFrfX8taL39RPnq4P.png?1QLd",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerRunLeftFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20left%20foot%20forward%20new-aH3WiqHkbYLeW14yketC7EdmowlQ02.png?jLLJ",type:"image",retries:3,fallback:"defaultPlayer"},{key:"playerRunRightFoot",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/Running%20right%20foot%20forward-FGGa0yxLpub6kRyvYj29zhOqx4sVj3.png?VhAX",type:"image",retries:3,fallback:"defaultPlayer"},{key:"blueEnemy",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/enemy%20test%201-DFzrumkmpUN5HOwL25dNAVJzRcVxhv.png?rxbT",type:"image",retries:3,fallback:"defaultEnemy"},{key:"tealLadder",url:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/new%20ladder-ULDbdT9I4h8apxhpJI6WT1PzmaMzLo.png?okOd",type:"image",retries:3}];this.assetPool.registerAssets(t),this.assetPool.createCommonFallbacks(),this.load.image("blueEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/enemy%20test%201-DFzrumkmpUN5HOwL25dNAVJzRcVxhv.png?rxbT"),this.load.image("visibilityOverlay","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/4cc595d8-5f6a-49c0-9b97-9eabd3193403/black%20overlay-aQ9bbCj7ooLaxsRl5pO9PxSt2SsWun.png?0nSO"),this.load.image("custom-dpad","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/dpad-HlSoc5tt8vs8cjbkEROL1GjaGzx8Ko.png?ecZG"),this.load.image("custom-jump-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20button-yS4IpgcdvQerPZjpif3tOLmqIfO7yE.png?pRZm"),this.load.image("custom-action-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/action%20button-0ijEeXV3alwc5ZbDzkD4HaP7PXzsAN.png?1zZP"),this.load.image("test-hud-bg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/test%20gem%20for%20hud-7RamXtpyUYcrX6K6DLnuWOD7ZNssLi.png?1boq"),this.load.image("hud-bg-200","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/gem%20for%20hud-pTsDx0VNBRQzAIh45KCFTFoU0pM1om.png?4RuD"),this.load.image("blueEnemyMouthClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed-HUXqx9HBdotEhJE2LBgzK8Z4kA7e2H.png?AVKZ"),this.load.image("blueEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20closed%20blinking-bJ1xwYkoCZvjd4T9MdXzR45PfaZIcF.png?6LRV"),this.load.image("blueEnemyMouthPartialOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20partially%20open-PrzEwLEPYIPE6pJTgHBWV7SVvKYcSX.png?0RG2"),this.load.image("blueEnemyMouthPartialOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20partially%20open%20blinking-GfMaaIsvJGkTrtx4vIFnh11fvyTc5N.png?d3qY"),this.load.image("blueEnemyMouthOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20open-4hO9JLZDfnWgcQWlvfqiU7SCOXaA0g.png?sh1i"),this.load.image("blueEnemyMouthOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blue%20enemy%20mouth%20open%20blinking-Nl5UA9KyScZCBwu9BrKXR0IdNk3aen.png?B9Tr"),this.load.image("purpleEnemyMouthClosed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20closed%20mouth-l01A99F3sINIeGx2hkb33YVS16xa3k.png?DjP8"),this.load.image("purpleEnemyMouthPartialOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20mid%20mouth-OvzgXzA7k4tlCopnJB6tiD0RqjATsS.png?wV23"),this.load.image("purpleEnemyMouthOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/chomper2%20full%20open%20mouth-H4bWdRYA3801jLzUyCiuevtXxj8Hmu.png?MkMw"),this.load.image("redEnemyMouthClosedEyes1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%201-RKF3p3F7fxdBSfen8UD9UGqIzf8zlv.png?xRpM"),this.load.image("redEnemyMouthClosedEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%202-vLWsEKkj7nPhdADyj947N0FQDi3QUf.png?Z82J"),this.load.image("redEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20closed%20eyes%20blinking-PiVnlocHV8Fra4PC2jrZGZISgIPvsv.png?aQjM"),this.load.image("redEnemyMouthPartialOpenEyes1Wink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20partially%20open%20eyes%201%20with%20one%20blinking-CuKxjBkQYU77bxH1e6KMS5tIdsz17T.png?G49S"),this.load.image("redEnemyMouthPartialOpenEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20partially%20open%20eyes%202-A43kcb28mR0IQbtfIU0KJJqBswRrlD.png?QDz4"),this.load.image("redEnemyMouthWideOpenEyes1Wink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%201%20with%20one%20blinking-bYhh1tBYiobaJsDTFoTkLpbeTJY8vs.png?7MZ2"),this.load.image("redEnemyMouthWideOpenEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%202-eeVDATMEgV6VQ9mPDfyEX1CFJPPr4W.png?RQBw"),this.load.image("redEnemyMouthWideOpenEyes3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/mouth%20wide%20open%20eyes%203-BYXzuHGU9Dd18kQEB6bztT5k8jFhJt.png?IzuG"),this.load.image("greenEnemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20right-Lv7YvIjvADM6LmR0OfFEXE674NoQag.png"),this.load.image("greenEnemyEyeCenter","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20center-vxgpMOLHN5TR5FtXa3BLrddj1H4lzA.png"),this.load.image("greenEnemyEyeLeft","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20eye%20middle-JpsQ7yYaUP00AU4NCh54ULeIW6lLTK.png"),this.load.image("greenEnemyBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/bouncer%20blinking-Syo5f9Tq7RWub8unCEcZbS7iuykZNI.png"),this.load.image("stalkerEnemyEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%201-Xt3Vtu2FiWWLT9l2wfeakBAqVSZet8.png?gS6O"),this.load.image("stalkerEnemyEye2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%202-n2c58R6bdpzzPAVlVRgMZoKmngtTUo.png?nTFi"),this.load.image("stalkerEnemyEye3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%203-K1hEnZ0oXDlCbLGCuJz1GD1YbYATZ6.png?safa"),this.load.image("stalkerEnemyEye4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%204-Y0pnlUUMFdmHY7HxQk2gGe9Nr41glQ.png?cgFm"),this.load.image("stalkerEnemyBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%205%20blinking-CPlBOBjLFGic1DKAwXNjnMpyRwBVgr.png?vYe6"),this.load.image("stalkerEnemyEyeOnly","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/stalker%20enemy%20eye%20only-3BuhEI2UePG6So3jAYE5NPnoQTsnc0.png?6wB1"),this.load.image("playerIdleEye1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%201-aD6V48lNdWK5R1x5CPNs4XLX869cmI.png?0XJy"),this.load.image("playerIdleEye2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%202-oQdxdPT1VWpTLUelgIRXIHXFw5jEuu.png?nGbT"),this.load.image("playerIdleBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Idle%20eye%20position%20blinking-qmZlXgNwk3w2B610GpK1dkndEDFmEg.png?q97J"),this.load.image("playerIdleEye3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%203-TLisG1UJypI7PhiKszpBcC8Nx8ZyrS.png?6Tg9"),this.load.image("playerIdleEye4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%204-kvrv3THif8vcKjFB0NPzOeclqapVi6.png?PuWO"),this.load.image("playerIdleEye5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/idle%20eye%20position%205-1P13Nmi3xqoC5kWevrWUxutqyXfr99.png?F4D2"),this.load.image("playerClimbLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20ladder%20left%20foot%20up-HkXPep0kpt9he1WtndEXsXRVHQBdlq.png?ncVM"),this.load.image("playerClimbRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/climbing%20ladder%20right%20foot%20up-hkc4X4pm3mSs1J3UpRQwRw8GhealC6.png?t8RZ"),this.load.image("playerJumpLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20left%20foot%20forward-DVmoTTdCOBfI9FRTg9vs949sTzKoOB.png?9FM5"),this.load.image("playerJumpRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/jumping%20right%20foot%20forward-3clf2KnwfbN3O6BsrtaeHSTAviNbnF.png?xx8e"),this.load.image("playerRunLeftFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20left%20foot%20forward%20new-aH3WiqHkbYLeW14yketC7EdmowlQ02.png?jLLJ"),this.load.image("playerRunRightFoot","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Running%20right%20foot%20forward%202-aGnWjaFUNnYXwTfNKfSCfCLppOHzDU.png?mXmE"),this.load.image("playerRunBody","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body-bM1vl3T1vsaGXNpy1aSdQTw7y8yJWK.png?laFZ"),this.load.image("playerRunBodyEyes2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%202-RdbQz9dbHYM8AMsZxEE7BLRbMD4rUT.png?AhxN"),this.load.image("playerRunBodyEyes3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%203-L2mDyCxbHwvlp6DEq6gxihPbgctDYV.png?tasV"),this.load.image("playerRunBodyEyes4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%204-ZfdYFT0Njqb5scTp0hVEzTo9Z9b2Cp.png?QE3U"),this.load.image("playerRunBodyEyes5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%205-ukOG4fy50XhZTYC6nSIg466Fi8rS1I.png?Oeos"),this.load.image("playerRunBodyEyes6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%206-Ce3qtFJFdtq95juwg15T9jLnK7kkWb.png?Gg1B"),this.load.image("playerRunBodyEyes7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%207-QPAzARJE1Zzu1uOpV808LTO0Kaeoqo.png?7N69"),this.load.image("playerRunBodyBlink","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/running%20body%20eyes%20blinking-tpJuDG5352O6gg9GHvj0owyZ7Vo4sy.png?eKh3"),this.load.image("playerRunLegsBothDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/both%20feet%20down-Df4cKPxtG04wJmnzY3QzaUeW22F1BN.png?Iekl"),this.load.image("playerRunLegsLeftMid","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/left%20foot%20up%20mid-DpJL6NyL9T7l7vzP8e2jfvpTJwvofR.png?rZfI"),this.load.image("playerRunLegsLeftHigh","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/left%20foot%20up%20high-jcTqik4ucIuoIwjkuG5a8cmOe9vrDu.png?wU6d"),this.load.image("playerRunLegsRightMid","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/right%20foot%20up%20mid-Qr5UwoShdZYlJJsGojNP8offBrp0yV.png?nrOQ"),this.load.image("playerRunLegsRightHigh","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/right%20foot%20up%20high-e5syDsyAyHiLXqTbbeBGoyUIwV8ZTB.png?c7fW"),this.load.image("purple-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/purple%20chest-4wMMVDFuAO3FpYyH7edWzeA3xVENZw.png?IkvS"),this.load.image("teal-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20chest-FpKKXWv5XWlb5H19IHW0G49DAm7Adb.png?Odul"),this.load.image("yellow-chest","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20chest-QMRMmVk9i7S0qkLteaXfhjqQBI351B.png?sE5u"),this.load.image("crystalBallCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("crystalBallProjectile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20collectible-BYMW8D53PB5JZUqKCfjKdI59qi0Yk8.png?rzg5"),this.load.image("crystalBallTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20timer-DXFxS1g5ICpECl1vorurI4vQgShlfI.png?VWVq"),this.load.image("cursedOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb-rHogWhnYUk2xThrTWajfHqMSfxeyfd.png?0wr6"),this.load.image("cursedTealOrbCollectible","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb-wupZvLrfiaRIZZyP4TbIOq5HLiVsXz.png?i2qV"),this.load.image("cursedOrbTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20orb%20timer-5VBMFlHiVp24NkCpIhkDD4dc6fKiHK.png?hHIh"),this.load.image("cursedTealOrbTimer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/cursed%20teal%20orb%20timer-FAoT2eYLkUGfQRCCfS5qwZOkMvFBTg.png?FMZ7"),this.load.image("door-sprite","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20door-SX8un6qHvlx4mzlRYUC77dJ4lpBmOT.png?548U"),this.load.image("door-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/door%20for%20hud-veW9YPgRL7GNNZWIF1VkHhGzn4MgcH.png?x2hT"),this.load.image("crystal-hud-icon","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20hud%20icon-6cCEP7jp90eqI7W9LeBp7v4s3OgCPX.png?nMJm"),this.load.image("talking-bubble","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/go%20bizarre%20talking%20bubble-QlBbag1lDPx9SbnKTlgwwCZ12Fowh2.png?h0Cw"),this.load.image("crystal-cavern-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%201-o5M2rYkM5ffKmdp8pMw6QzmR87KA0k.png?4qbf"),this.load.image("crystal-cavern-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%202-Sdyqtq58gC1XVkllts47M2AzYOTgpX.png?0mX8"),this.load.image("crystal-cavern-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%203-iE9A520YoUrX7GIVwgKojzeC0JuMlg.png?R6UH"),this.load.image("crystal-cavern-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%204-oMun45XW8jHJAX8lWQ3HbOad2TL5gt.png?3ulH"),this.load.image("crystal-cavern-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%205-AQS3zCiGE8QOqamLmdoOJ7SjecHlW8.png?d4aM"),this.load.image("crystal-cavern-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%206-dqO5JRSPRzu4pkpC66pBTL416gw0iV.png?wGuc"),this.load.image("crystal-cavern-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%207-rPVZWuJSGouJJHwzx0PYjHIJ9AWeOG.png?3QAw"),this.load.image("crystal-cavern-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%208-AKdyp1OQa5qT20Wab5aCgnMKwpPEY9.png?ejNY"),this.load.image("crystal-cavern-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%209-s5weyP0mb0UngvFh3FP3FS4s4OuVCo.png?QS83"),this.load.image("crystal-cavern-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%2010-HpLzzcMARGk4bAxftjkS7AcaLC3ljt.png?AETo"),this.load.image("crystal-cavern-bg","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20quest%20background%20compressed-UKsRHy0KcxBQz6FuHbeLvlwcbd3LdS.png?ATB5"),this.load.image("yellowEnemyMouthOpenEyeOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20open%20mouth%20open-lQoAdkobZ4H1EzQlITXFW8pLyuzlpU.png?vG8O"),this.load.image("yellowEnemyMouthOpenBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20closed%20mouth%20open-jvUJJbRjevmC71Cgw86fpsQGJQkwGK.png?yXzx"),this.load.image("yellowEnemyMouthClosedEyeOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20open%20mouth%20closed-6A2FG9PKDMrBHdE76pV9iALE66ogtp.png?L3eK"),this.load.image("yellowEnemyMouthClosedBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar1%20eyes%20closed%20mouth%20closed-Fv7QiPIbIYgPuqmUeGF8Gu234h9Xie.png?nEys"),this.load.image("blueCaterpillarEyesRight","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20right-rgnZpnvBWDB5xqNXCcFANHRKrytkRu.png?wuBQ"),this.load.image("blueCaterpillarEyesLeft","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20left-HsnjWSiRWtlaEQbj1rkVr1tbwQc9ky.png?gCNM"),this.load.image("blueCaterpillarEyesDown","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20down-WvFuBIqZBj1tTCA5FZUSNSRakKAXY3.png?EWfJ"),this.load.image("blueCaterpillarBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/caterpillar3%20eyes%20blinking-JvNYqKH2z9dUyLPOko1QE2GJXwuL36.png?vqim"),this.load.image("gem-big-blue","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem-GzKKZKUsDMh3CXMEIV4OmMl4ksrqqm.png?sill"),this.load.image("gem-pink-round","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20round-E2EKGSTZHnnCdW0QkFmTDRKY7ERfw7.png?izQh"),this.load.image("gem-yellow-emerald","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20emerald-Z65ogfvE2NUX0AtxfwqgUKTooKPL1M.png?NJLZ"),this.load.image("gem-purple-opal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/purple%20opal-vq4CL7MxiGQDenIU0ZvqVQJJbWAvt5.png?GjQL"),this.load.image("gem-teal-triangle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/teal%20triangle-HVpi82a0c01MbkO92zYvH4tIN3CdMw.png?N700"),this.load.image("gem-diamond","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond-LB22Ijoji8erIrMFMvtSwd5Y9rDDwS.png?LlEv"),this.load.image("heart-crystal","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/free%20life%20heart%20crystal-2EJMsIvSQKzdgrqytakBZcDbGf7Jpf.png?E1JG"),this.load.image("invincibility-pendant","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pendant-cJISby3d7EEREasbi0gRZkn2u3rNrG.png?xf9m"),this.load.image("invincibility-timer","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/timer2-X3PMyQUgCU3fz146QaD9mBBy38e8Vw.png?Yy9W"),this.load.image("yellow-ceiling-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/yellow%20spikes%20ceiling%20tile-8vq9W1Y2e1RSpgUfMl9sTp0ZILFHL3.png?mUEb"),this.load.image("pink-floor-spike-tile","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/pink%20spikes%20floor%20tile-ncAVgIHazwYlznCBP4H6LWLiIhN7OF.png?n27v"),this.load.image("baseblue-eyes-center","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20center-BWjYc09iCwYsTuEB3TEsa7GdmDc4Nj.png?NZtQ"),this.load.image("baseblue-eyes-down","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down-Vtp9tuVzlbp29Cn3GqoEVHzSGyZLYX.png?u15t"),this.load.image("baseblue-eyes-down-right","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down%20right-eJGRVL9E1aqNPUimWVa0aoEEHbmMca.png?ObTg"),this.load.image("baseblue-eyes-middle-right","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20middle%20right-ShBskufoh2zXFcfI5AHUCpx6ecnIWi.png?TizP"),this.load.image("baseblue-eyes-up","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20up-lot6W1Y3ns3uhL8Xd59yoSCusiT48e.png?fMIa"),this.load.image("baseblue-eyes-up-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20up%20left-biYISTHmHXS9VFQa63REv8KCGeHMC2.png?Fp2W"),this.load.image("baseblue-eyes-middle-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20middle%20left-o5tw4V3qJ9gmASZ2TjaeUcJpD220CM.png?bL2r"),this.load.image("baseblue-eyes-down-left","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20down%20left-8txJQ9OPVkMTkW0eaWprmvS5igTbqZ.png?hOzV"),this.load.image("baseblue-eyes-blinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/baseblue%20eyes%20blinking-nZFjSjOXa1RAYpXPefApbKEET49sRr.png?96YM"),this.load.image("beetle-mouth-closed","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20closed-6ScuNGGsBgifOGHCCMext3ghafhXlB.png?XErn"),this.load.image("beetle-mouth-open-30","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2030-HXSFqNWDpvxFnv2l35lrddto2TAyCk.png?sdgg"),this.load.image("beetle-mouth-open-70","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beetle%20mouth%20open%2070-gToASj29g9XTDxUDHBKXDOfpYOKudu.png?uZh3"),this.load.image("rexEyesOpen","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20open-xKvtdvPdMIy13IjDLdWArsLxH3bi3m.png"),this.load.image("rexBlinking","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20eyes%20blinking-ix1xWvDmRTfWQT1HB22Z4z0lYCST06.png"),this.load.audio("background-music","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/CRYSTAL%20CAVERN%20-%20Treasure%20Quest%20-%20BizarreBeasts%20-%20MASTER%201-GnktEmoyUQQEEoFTBVrVAhEFyGRwL9.mp3?acKK"),this.load.on("loaderror",i=>{console.error("\u274C Failed to load audio file:",i.key,i.url)}),this.load.on("filecomplete-audio-background-music",()=>{console.log("\u2705 Background music file loaded successfully")}),this.load.on("filecomplete-audio-splash-sound",()=>{console.log("\u2705 Splash sound file loaded successfully")}),this.load.audio("gem-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/regular%20gem%20collect%20sfx-OXLLrrAXWUz21oDTEuQPFb2fxRWxXh.wav?pH1V"),this.load.audio("diamond-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/diamond%20collect%20sfx-V3aWJINX1e3OF5XZJFntg7WjpCup3Y.wav?A9QM"),this.load.audio("big-blue-gem-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/big%20blue%20gem%20collect%20sfx-nYAUNJtHLMfNwACb6CM42eSQVAW6XG.wav?f8N2"),this.load.audio("heart-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20collect%20heart%20sfx-7SPaWI2NI7kkVlgjjKbYXCDQuXI4sG.wav?N1rD"),this.load.audio("cursed-orb-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/collect%20cursed%20orb%20or%20teal%20cursed%20orb-2KpSJv5Zd8lQ4OdgPtmn9YLlS0UqId.wav?ryTu"),this.load.audio("powerup-collect","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/collect%20pendant%20or%20crystal%20ball-rEQiBqrl32yuqNts0U4A3Muol63Fxr.wav?eDiE"),this.load.audio("treasure-chest-open","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/treasure%20chest%20opening%20sfx-qA8VU8UtwVC4fnaW67wfvM2IzTJRep.wav?WLuy"),this.load.audio("jump-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%201%20sfx-Cfx219m2NwhVClkP67iebiwcV0HiF5.wav?GDjY"),this.load.audio("jump-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%202%20sfx-UU3Gj2quONoFPk7SO3OI3koGgiSRGY.wav?4Zrt"),this.load.audio("jump-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20jumping%203%20sfx-8h2X8f0XZJYeVB65fDYk4hth9h1G0O.wav?Wpvy"),this.load.audio("player-land","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20lands%20after%20jump%20sfx-OoLEu6v6m6Oy51qVDCknLhjlMC3Awy.wav?xPtL"),this.load.audio("footstep","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/foot%20step-XZmhUkf7XprYQzm2GbUVYaPZKeW6it.wav?3Vyp"),this.load.audio("crystal-ball-throw","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/throw%20crystal%20ball%20sfx-oZfZHRmRnqebRdw2YrcMLR7LlLCMRp.wav?aKDe"),this.load.audio("crystal-ball-bounce","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20bounce%20sfx-bOZrWB6YiMh6bedqvdLw3YaW63MZxO.wav?ORcs"),this.load.audio("crystal-ball-hit-enemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20ball%20hits%20enemy-Rxq3kA6Q8rLBBb5PhGNdBhTI9AMo8W.wav?8sSG"),this.load.audio("continue-button","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/level%20complete%20continue%20button%20sfx-tKmarJUBWs3rQJhPDsv2IYj5oc8p5j.wav?V3lH"),this.load.audio("door-open","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/door%20open%20sfx-LqGIt2ZSLGjCz0lSbuC6F6yusdC97e.wav?hCxN"),this.load.audio("menu-toggle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/menu%20sound-uBdZpD8zUrdGkuqw7jw0j9339NP2wC.wav?rHPB"),this.load.audio("spike-hit","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20hits%20spikes%20sfx-Pt2SxNCgCXtyIz2jiBS3AYiCvYrp8X.wav?IM9a"),this.load.audio("player-dies-enemy","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/player%20dies%20from%20enemy%20sfx-61hLKPCRlGrkam7zYIUuuWTwHFZXun.wav?d7C2"),this.load.audio("game-over","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/game%20over%20sfx-CcqXjJvB1fNTt9i31KIzjv0KLNN6CF.wav?OQAX"),this.load.audio("squish-caterpillar","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%201%20sfx-Q07M71fpvcarGwZ67kaOsiFBD8hQw9.wav?eCQ1"),this.load.audio("squish-beetle","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Rollz%20squish%20sfx-ENEJDyuGH2imVNsLezuv5w3TzofWsG.wav?caYG"),this.load.audio("squish-chomper","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%202-euwtmXFPsH1NH9XQzixjo6lgeA7Nxd.wav?6rLZ"),this.load.audio("squish-snail","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%203-22EnbLa2GEVZPJCf7zWpqhYHS6V4K2.wav?h9e6"),this.load.audio("squish-jumper","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%201%20sfx-MBkO4SrZ1IVUJ6jqjHWa5L0NURtkJH.wav?qytP"),this.load.audio("squish-stalker","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/enemy%20squish%203-22EnbLa2GEVZPJCf7zWpqhYHS6V4K2.wav?h9e6"),this.load.audio("squish-baseblu","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/blu%20squish%20sound-E5dxYXO43VnhG528IWOuy39JyeqnOf.wav?2NUq"),this.load.audio("squish-rex","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/rex%20squish%20sound-ZUynOxrurJ001uUoNvxJPYAg8dlChO.wav?FwYW"),this.load.image("floor-tile-1","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%201-jbZVv42Z0BQYmH6sJLCOBTJs4op2eT.png?mhnt"),this.load.image("floor-tile-2","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%202-EuITFMsdSDebMUmfcikeKCDLqDupml.png?C2mi"),this.load.image("floor-tile-3","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%203-EBjnmTXXufdUFEuzmfnGnaZX4zdI2C.png?69bT"),this.load.image("floor-tile-4","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%204-ecTwalLp4rzl9hegwIwVMuDBeN1YVJ.png?nxJJ"),this.load.image("floor-tile-5","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%205-mkUa3smxguUC6BG0k4RBp1L7YemLPJ.png?8kU2"),this.load.image("floor-tile-6","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%206-P5Eo0dOoipZmfiQ31gzPPNV178XDQz.png?K1oC"),this.load.image("floor-tile-7","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%207-nTcRVMkcmKM9dgxMMr6Fzs7Enekla1.png?cfe2"),this.load.image("floor-tile-8","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%208-ImcB9SO68kMOGAn6qXP0aioPKPbNxx.png?znlI"),this.load.image("floor-tile-9","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%209-VmOFC6UshXy3GJTAyKE5zi7p1oIyAJ.png?oTOf"),this.load.image("floor-tile-10","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2010-SX5i2rG63ddgysEAxLTRNQvfngiFaS.png?2Bsf"),this.load.image("floor-tile-11","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2011-JwdJf9Mmt0lEbFBGGwurBaYJL3uykp.png?w4JY"),this.load.image("floor-tile-12","https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/Floor%2012-yBmCpaIQiiV7MeRoxI54ACeE3W2f27.png?9jIm"),this.assetPool.loadAllAssets().then(()=>{this.registry.set("assetsReady",!0)}).catch(i=>{console.error("Asset loading failed:",i),this.registry.set("assetsReady",!0)})}init(e){this.reopenMenuAfterInit=e?.reopenMenu||!1;let t=this.game.registry.get("isDeathRetry")||!1,i=this.game.registry.get("playerLives")||0,s=this.game.registry.get("isReplay")||!1,r=s||t&&i>0;this.showLoadingScreen=!r,console.log(`\u{1F3AC} Loading screen decision (2nd init): isReplay=${s}, isDeathRetry=${t}, skip=${r}, SHOW=${this.showLoadingScreen}`),this.cameras.main.setBackgroundColor("#1a0033")}create(){console.log("\u{1F3AE} GameScene.create() started at",performance.now()),console.log("\u{1F4CA} showLoadingScreen flag:",this.showLoadingScreen);let e=this.game.registry.get("platform")||window.platform||window.gamePlatform;if(e&&e.showWalletButton&&e.showWalletButton(),console.log("\u{1F3AF} Scene Dimensions:",{game:{width:this.game.config.width,height:this.game.config.height,resolution:this.game.config.resolution},camera:{width:this.cameras.main.width,height:this.cameras.main.height,x:this.cameras.main.x,y:this.cameras.main.y,scrollX:this.cameras.main.scrollX,scrollY:this.cameras.main.scrollY},physics:{worldBounds:this.physics.world.bounds,gravity:this.physics.world.gravity},scale:{gameSize:this.scale.gameSize,parentSize:this.scale.parentSize,displaySize:this.scale.displaySize,mode:this.scale.scaleMode}}),this.showLoadingScreen){console.log("\u{1F3A8} Creating loading screen elements...");let t=this.cameras.main.width,i=this.cameras.main.height;if(console.log(`\u{1F4D0} Screen dimensions: ${t}x${i}`),this.loadingOverlay=this.add.container(0,0),this.loadingOverlay.setDepth(1e4),console.log("\u{1F4E6} Loading container created"),this.textures.exists("instructionsBg")){console.log("\u{1F3A8} Using instructions background image");let m=this.add.image(t/2,i/2,"instructionsBg"),y=t/m.width,g=i/m.height,f=Math.max(y,g);m.setScale(f),this.loadingOverlay.add(m);let v=this.add.rectangle(t/2,i/2,t,i,0,.5);this.loadingOverlay.add(v),console.log("\u{1F5BC}\uFE0F Instructions background added with overlay")}else{console.log("\u26A0\uFE0F Instructions background not found, using solid color");let m=this.add.rectangle(t/2,i/2,t,i,5046398,1);this.loadingOverlay.add(m),console.log("\u{1F7EA} Purple background added")}let s=this.add.text(t/2,i/2-60,"GOING BIZARRE",{fontFamily:'"Press Start 2P", system-ui',fontSize:"28px",color:"#FF69B4",align:"center"});s.setOrigin(.5),s.setShadow(2,2,"#8B008B",4,!1,!0),this.loadingOverlay.add(s),console.log("\u{1F497} GOING BIZARRE text added");let r=t*.6,o=24,n=t/2,l=i/2+10;console.log(`\u{1F4CA} Progress bar dimensions: ${r}x${o} at (${n}, ${l})`);let c=this.add.rectangle(n,l,r,o,4915330);c.setStrokeStyle(3,16738740),this.loadingOverlay.add(c),console.log("\u{1F4CA} Progress bar background added");let h=this.add.rectangle(n-r/2+2,l,0,o-6,16738740);h.setOrigin(0,.5),this.loadingOverlay.add(h),console.log("\u{1F4CA} Progress bar fill added (starting at 0 width)");let d=this.add.text(t/2,i/2+50,"0%",{fontFamily:'"Press Start 2P", system-ui',fontSize:"16px",color:"#FF69B4",align:"center"});d.setOrigin(.5),this.loadingOverlay.add(d),console.log("\u{1F4AF} Percentage text added");let p=0;console.log("\u23F1\uFE0F Starting progress animation");let u=this.time.addEvent({delay:30,callback:()=>{if(p<100){p=Math.min(p+2,100);let m=Math.floor(p);h.width=(r-6)*(p/100),d.setText(`${m}%`),m%20===0&&m>0&&console.log(`\u{1F4C8} Progress: ${m}%`),p>=100&&(console.log("\u2705 Progress complete, removing overlay in 200ms"),this.time.delayedCall(200,()=>{this.loadingOverlay&&(console.log("\u{1F5D1}\uFE0F Destroying loading overlay"),this.loadingOverlay.destroy(),this.loadingOverlay=null),console.log("\u2B1B Setting black background for game"),this.cameras.main.setBackgroundColor("#000000"),this.checkForChapterSplash()}))}},repeat:-1});console.log("\u{1F4CA} Progress timer started")}else this.cameras.main.setBackgroundColor("#000000"),this.checkForChapterSplash();console.log("\u{1F3A8} Scene initialized")}checkForChapterSplash(){this.game.registry.get("isReplay")&&this.game.registry.set("isReplay",!1);let e=[1,11,21,31,41,51],t=this.game.registry.get("currentLevel")||1;console.log(`\u{1F4CA} Current level: ${t}`);let i=this.game.registry.get("showChapterSplash")===!0,s=this.game.registry.get("chapterSplashLevel")||t;if(i){console.log(`\u{1F3AF} Showing chapter splash after bonus for level ${s}`),this.game.registry.set("showChapterSplash",!1),this.game.registry.remove("chapterSplashLevel");let l=`chapterSplashShown_${s}`;this.game.registry.set(l,!0),this.showChapterSplashScreen(s,()=>{console.log("\u2705 Splash complete after bonus, initializing game"),this.initializeGameState(),this.game.registry.set("levelProgression",!0),this.initializeGameAfterSplash()});return}let r=`chapterSplashShown_${t}`,o=this.game.registry.get(r)===!0,n=this.game.registry.has("playerLives")&&this.game.registry.get("playerLives")>0;if(e.includes(t)&&!o&&!n){console.log(`\u{1F3AC} Chapter splash needed for level ${t} (first time)`),this.game.registry.set(r,!0),this.showChapterSplashScreen(t,()=>{console.log("\u2705 Splash complete, initializing game"),this.initializeGameState(),this.game.registry.set("levelProgression",!0),this.initializeGameAfterSplash()});return}console.log("\u23E9 No splash needed, initializing game immediately"),this.initializeGameState(),this.initializeGameAfterSplash()}getChapterSplashUrl(e){let t=this.registry.get("isDgen1")||window.location.port==="3001";return{1:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/crystal%20caverns%20splash%20page%20dgen1-fOxjnn8s5iQTzCwVP6HTwo2oZnoWlN.png?V8Du",11:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/volcano%20crystal%20caverns%20splash%20page%20dgen1-MoVRItepiBcZZdhmpb1d5ullyQ725t.png?8mEz",21:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/steampunk%20crystal%20caverns%20splash%20page%20dgen1-B4jgMlUeWbOa7kvIZfra56G4UiUFoY.png?lJqO",31:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/electrified%20crystal%20caverns%20splash%20page%20dgen1-RJXfreqjj1XpJaMYUsYJBansc4BTAJ.png?B3oR",41:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/galactic%20crystal%20caverns%20splash%20page%20dgen1-zSJaaqpe1StXM8hf8IoYDYjx4vIsAz.png?Az4J",51:"https://lqy3lriiybxcejon.public.blob.vercel-storage.com/d281be5d-2111-4a73-afb0-19b2a18c80a9/beast%20mode%20crystal%20caverns%20splash%20page%20dgen1-6RPxHcIi1lHMpFEHGCwglRqzwKdNjW.png?Riu8"}[e]||""}showPreloadChapterScreen(){}showChapterSplashScreen(e,t){console.log(`\u{1F5BC}\uFE0F Creating splash screen for level ${e} at`,performance.now()),this.instantLoadingScreen&&(this.instantLoadingScreen.destroy(),this.instantLoadingScreen=void 0),this.preloadChapterText&&(this.preloadChapterText.destroy(),this.preloadChapterText=void 0),this.preloadLoadingText&&(this.preloadLoadingText.destroy(),this.preloadLoadingText=void 0);let i=`chapter-${e}`;if(this.textures.exists(i))this.displayChapterSplash(e,t);else{console.log(`\u{1F4E5} Loading chapter splash on-demand: ${i}`);let s=this.getChapterSplashUrl(e);if(!s){console.warn(`\u26A0\uFE0F No splash URL found for level ${e}`),t();return}this.load.image(i,s),this.load.once("complete",()=>{console.log(`\u2705 Splash loaded: ${i}`),this.displayChapterSplash(e,t)}),this.load.start()}}displayChapterSplash(e,t){let i=`chapter-${e}`,s=this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,i);console.log(`\u{1F4F7} Splash image created: ${i}`);let r=this.cameras.main.width/s.width,o=this.cameras.main.height/s.height,n=Math.max(r,o);s.setScale(n),s.setDepth(10001),s.setScrollFactor(0),s.alpha=1,console.log(`\u{1F4D0} Image scaled: ${n.toFixed(2)}x, showing immediately`),console.log("\u23F1\uFE0F Starting 2 second timer"),this.time.delayedCall(2e3,()=>{console.log("\u23F0 Timer complete, starting fade out");let l=this.add.graphics();l.fillStyle(0,0),l.fillRect(0,0,this.cameras.main.width,this.cameras.main.height),l.setDepth(10002),l.setScrollFactor(0),this.tweens.add({targets:s,alpha:0,duration:500,ease:"Power2"}),this.tweens.add({targets:l,alpha:1,duration:400,ease:"Power2.easeInOut",onComplete:()=>{console.log("\u{1F5D1}\uFE0F Destroying splash elements"),s.destroy(),this.tweens.add({targets:l,alpha:0,duration:300,delay:100,ease:"Power2.easeOut",onComplete:()=>{l.destroy(),t()}})}})})}initializeGameState(){this.levelManager||(this.levelManager=new re);let e=this.game.registry.get("currentLevel")||1;this.levelManager.setCurrentLevel(e),localStorage.removeItem("treasureQuest_currentLevel"),this.isGameOver=!1,this.isLevelComplete=!1,this.currentFloor=0,this.highestFloorGenerated=5;let t=this.game.registry;t.has("lives")&&(console.warn("\u26A0\uFE0F Cleaning up old 'lives' registry key"),t.remove("lives")),t.has("levelProgression")&&t.get("levelProgression")===!0?(this.accumulatedScore=t.get("accumulatedScore")||0,this.score=0,this.lives=t.get("playerLives")||3,(this.lives<0||this.lives>this.MAX_LIVES)&&(console.error(`\u{1F534} Invalid lives count detected: ${this.lives}, resetting to 3`),this.lives=3,t.set("playerLives",this.lives)),this.totalCoinsCollected=t.get("totalCoins"),this.totalGemsCollected=t.get("totalGems")||0,this.totalBlueGemsCollected=t.get("totalBlueGems")||0,this.totalDiamondsCollected=t.get("totalDiamonds")||0,this.livesEarned=t.get("livesEarned")||0,console.log(`\u{1F3AE} Level progression - Lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`)):t.has("playerLives")&&t.get("playerLives")>0?(this.lives=t.get("playerLives"),(this.lives<0||this.lives>this.MAX_LIVES)&&(console.error(`\u{1F534} Invalid lives count detected: ${this.lives}, resetting to 3`),this.lives=3,t.set("playerLives",this.lives)),this.accumulatedScore=t.get("accumulatedScore")||0,this.score=0,this.totalCoinsCollected=t.get("totalCoins"),this.totalGemsCollected=t.get("totalGems")||0,this.totalBlueGemsCollected=t.get("totalBlueGems")||0,this.totalDiamondsCollected=t.get("totalDiamonds")||0,this.livesEarned=t.get("livesEarned")||0,console.log(`\u{1F3AE} Death restart - Lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`)):(this.lives=3,this.score=0,this.accumulatedScore=0,this.totalCoinsCollected=0,this.totalGemsCollected=0,this.totalBlueGemsCollected=0,this.totalDiamondsCollected=0,this.livesEarned=0,console.log(`\u{1F3AE} New game started - Lives: ${this.lives}`),t.set("playerLives",this.lives),t.set("totalCoins",0),t.set("totalGems",0),t.set("totalBlueGems",0),t.set("totalDiamonds",0),t.set("livesEarned",0),t.set("accumulatedScore",0),t.set("currentScore",0),t.set("accumulatedDiamonds",0),[1,11,21,31,41,51].forEach(r=>{t.remove(`chapterSplashShown_${r}`)})),this.gemsCollectedThisLevel=0,this.blueGemsCollectedThisLevel=0,this.diamondsCollectedThisLevel=0,this.accumulatedDiamonds=t.get("accumulatedDiamonds")||0}async initializeGameAfterSplash(){this.backgroundManager=new oe(this);let e=this.levelManager?.getCurrentLevel()||1,t=this.levelManager?.isBonusLevel()||!1,i=this.backgroundManager.getChapterForLevel(e,t);i!=="crystal_cavern"&&await this.backgroundManager.loadChapterBackgrounds(i),this.currentBackground=this.backgroundManager.getBackgroundForLevel(e,t);let s=this.add.image(0,0,this.currentBackground);s.setOrigin(0,0),s.setDepth(-100),s.setScrollFactor(.05);let r=this.cameras.main.width,o=this.cameras.main.height,n=r/s.width,l=o/s.height,c=Math.max(n,l)*1.2;s.setScale(c);let h=(o-s.height*c)/2;s.setPosition((r-s.width*c)/2,h),this.backgroundSprite=s,this.backgroundInitialY=h,this.backgroundHeight=s.height*c,this.input.addPointer(2),this.setupFarcadeEventHandlers(),this.recentTiles=[],this.tileGrid.clear(),this.tileUsageCount=new Array(12).fill(0),this.platforms=this.physics.add.staticGroup(),this.ladders=this.physics.add.staticGroup(),this.spikes=this.physics.add.staticGroup(),this.cats=this.physics.add.group({classType:H,runChildUpdate:!0}),this.stalkerCats=this.physics.add.group({classType:H,runChildUpdate:!0}),this.baseBlus=this.physics.add.group({classType:Q,runChildUpdate:!0}),this.beetles=this.physics.add.group({classType:ee,runChildUpdate:!0}),this.rexEnemies=this.physics.add.group({classType:te,runChildUpdate:!0}),this.coins=[],this.blueCoins=[],this.diamonds=[],this.treasureChests=[],this.crystalBalls=[],this.freeLifs=[],this.invincibilityPendants=[],this.levelHasCrystalBall=!1,this.createTestLevel();let p=3.5*b.game.tileSize,u=b.canvas.height-b.game.tileSize,m=u-29;console.log("\u{1F464} Player Spawn Calculation:",{canvasHeight:b.canvas.height,groundFloorY:u,spawnY:m,spawnX:p}),this.player=new pe(this,100,b.canvas.height+100);let y=this.game.registry,g=y.has("playerLives"),f=y.get("levelProgression");!g||y.get("playerLives")===3||f?(this.player.body.enable=!1,this.startLevelIntro(p,m)):(this.player.setPosition(p,m),this.player.body.enable=!0,this.isLevelStarting=!1,this.changePlayerTexture("playerIdleEye1"),this.showStartBanner(),this.notifyFarcadeGameReady()),this.createCats(),this.createCeilingSpikes(),this.createAllCollectibles(),this.createLevelEndDoor(),this.physics.add.collider(this.player,this.platforms,void 0,this.shouldCollideWithPlatform,this),this.physics.add.collider(this.cats,this.platforms),this.physics.add.collider(this.beetles,this.platforms),this.physics.add.collider(this.rexEnemies,this.platforms),this.physics.add.collider(this.cats,this.spikes,void 0,(U,G)=>G.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.beetles,this.spikes,void 0,(U,G)=>G.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.rexEnemies,this.spikes,void 0,(U,G)=>G.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.stalkerCats,this.platforms),this.physics.add.collider(this.stalkerCats,this.spikes,void 0,(U,G)=>G.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.cats,this.cats,this.handleCatCatCollision,(U,G)=>{let V=U,N=G,Te=V.getCatColor()==="green"||V.getCatColor()==="yellow",we=N.getCatColor()==="green"||N.getCatColor()==="yellow";return!(Te||we)},this),this.physics.add.overlap(this.player,this.cats,this.handlePlayerCatInteraction,void 0,this),this.physics.add.overlap(this.player,this.stalkerCats,this.handlePlayerStalkerCatInteraction,void 0,this),this.physics.add.overlap(this.player,this.beetles,this.handlePlayerBeetleInteraction,void 0,this),this.physics.add.overlap(this.player,this.rexEnemies,this.handlePlayerRexInteraction,void 0,this),this.physics.add.collider(this.baseBlus,this.platforms),this.physics.add.collider(this.baseBlus,this.spikes,void 0,(U,G)=>G.getData("isFloorSpike")===!0,this),this.physics.add.collider(this.player,this.baseBlus,this.handlePlayerBaseBluInteraction,void 0,this),this.playerSpikeOverlap=this.physics.add.overlap(this.player,this.spikes,this.handlePlayerSpikeCollision,void 0,this),this.physics.add.collider(this.player,this.spikes,void 0,(U,G)=>{let V=G,Te=U.body;return V.getData("isFloorSpike")?Te.velocity.y<0:!1},this),this.physics.add.overlap(this.player,this.ladders,this.handleLadderOverlap,void 0,this);let x=b.game.floorWidth*b.game.tileSize;this.physics.world.setBounds(0,-1e4,x,2e4),this.cameras.main.startFollow(this.player,!0,.1,.1),this.game.registry.get("isDgen1")||!1?this.cameras.main.followOffset.set(0,50):this.cameras.main.followOffset.set(0,100),this.createVisibilitySystem();let C=this.cameras.main.width,k=this.add.image(C/2,62,"hud-bg-200");k.setDisplaySize((C-16)*1.6,96*1.6),k.setOrigin(.5,.5),k.setDepth(98),k.setScrollFactor(0);let E=this.add.graphics();E.fillStyle(16777215),E.fillRoundedRect(8,10,C-16,96,12),E.setScrollFactor(0);let O=E.createGeometryMask();k.setMask(O);let M=this.add.graphics();M.lineStyle(2,8069026,1),M.strokeRoundedRect(8,10,C-16,96,12),M.setDepth(99),M.setScrollFactor(0),this.livesIcon=this.add.image(30,35,"heart-crystal"),this.livesIcon.setDisplaySize(16,16),this.livesIcon.setDepth(100),this.livesIcon.setScrollFactor(0),this.livesText=this.add.text(45,35,"x3",{fontSize:"14px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.livesText.setScrollFactor(0),this.comboText=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2,"",{fontSize:"13px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(200).setVisible(!1),this.comboText.setScrollFactor(0);let L=this.add.image(30,58,"crystal-hud-icon");L.setDisplaySize(16,16),L.setDepth(100),L.setScrollFactor(0),this.coinCounterText=this.add.text(45,58,"0/150",{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.coinCounterText.setScrollFactor(0);let T=this.add.image(30,81,"door-hud-icon");T.setDisplaySize(16,16),T.setDepth(100),T.setScrollFactor(0);let A=this.levelManager.getCurrentLevel(),F=this.levelManager.isBonusLevel()?"BONUS":A>=51?`${A}`:`${A}`;this.levelText=this.add.text(45,81,F,{fontSize:"14px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(0,.5).setDepth(100),this.levelText.setScrollFactor(0),this.scoreText=this.add.text(C/2,25,"0",{fontSize:"19px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5,0).setDepth(100),this.scoreText.setScrollFactor(0),this.comboText.setScrollFactor(0);let D=75,X=45,q=X*3,j=C/2-q/2;this.invincibilityTimerImage=this.add.image(j,D,"invincibility-timer"),this.invincibilityTimerImage.setDisplaySize(36,36),this.invincibilityTimerImage.setDepth(101),this.invincibilityTimerImage.setScrollFactor(0),this.invincibilityTimerImage.setVisible(!0),this.invincibilityTimerMask=this.add.graphics(),this.invincibilityTimerMask.setDepth(102),this.invincibilityTimerMask.setScrollFactor(0);let R=this.textures.exists("crystalBallTimer")?"crystalBallTimer":"invincibility-timer";this.crystalBallTimerImage=this.add.image(j+X,D,R),this.crystalBallTimerImage.setDisplaySize(36,36),this.crystalBallTimerImage.setDepth(101),this.crystalBallTimerImage.setScrollFactor(0),this.crystalBallTimerImage.setVisible(!0),this.crystalBallTimerMask=this.add.graphics(),this.crystalBallTimerMask.setDepth(102),this.crystalBallTimerMask.setScrollFactor(0);let xe=this.textures.exists("cursedOrbTimer")?"cursedOrbTimer":"invincibility-timer";this.cursedOrbTimerImage=this.add.image(j+X*2,D,xe),this.cursedOrbTimerImage.setDisplaySize(36,36),this.cursedOrbTimerImage.setDepth(101),this.cursedOrbTimerImage.setScrollFactor(0),this.cursedOrbTimerImage.setVisible(!0),this.cursedOrbTimerMask=this.add.graphics(),this.cursedOrbTimerMask.setDepth(102),this.cursedOrbTimerMask.setScrollFactor(0);let ke=this.textures.exists("cursedTealOrbTimer")?"cursedTealOrbTimer":"invincibility-timer";this.cursedTealOrbTimerImage=this.add.image(j+X*3,D,ke),this.cursedTealOrbTimerImage.setDisplaySize(36,36),this.cursedTealOrbTimerImage.setDepth(101),this.cursedTealOrbTimerImage.setScrollFactor(0),this.cursedTealOrbTimerImage.setVisible(!0),this.cursedTealOrbTimerMask=this.add.graphics(),this.cursedTealOrbTimerMask.setDepth(102),this.cursedTealOrbTimerMask.setScrollFactor(0),this.hamburgerMenuButton=this.add.text(C-30,48,"\u2630",{fontSize:"42px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(1,.5).setDepth(100),this.hamburgerMenuButton.setScrollFactor(0),this.updateLivesDisplay(),this.updateCoinCounterDisplay(),this.updateScoreDisplay(),this.touchControls=new ye(this),this.player.setTouchControls(this.touchControls),this.input.keyboard.enabled=!0,this.touchControls.enable(),b.debug&&(this.input.keyboard.on("keydown-T",()=>{console.log("\u{1F9EA} Switching to TestScene..."),this.scene.start("TestScene")}),this.createDebugGridlines()),!this.registry.get("platform")&&!this.game.registry.get("platform")&&(window.platform?(this.game.registry.set("platform",window.platform),console.log("\u{1F3AE} Platform copied from window to registry")):console.warn("\u26A0\uFE0F Platform not found anywhere when creating menu")),this.menuOverlay=new ve(this),this.reopenMenuAfterInit&&this.time.delayedCall(100,()=>{this.menuOverlay.open(),this.reopenMenuAfterInit=!1});let W=25,ne=this.hamburgerMenuButton.getBounds();this.hamburgerMenuButton.setInteractive(new Phaser.Geom.Rectangle(-W,-W,ne.width+W*2,ne.height+W*2),Phaser.Geom.Rectangle.Contains),this.hamburgerMenuButton.input.hitArea.setPosition(-W/2,-W/2),this.hamburgerMenuButton.off("pointerdown"),this.hamburgerMenuButton.on("pointerdown",()=>{this.playSoundEffect("menu-toggle",.4),this.menuOverlay.toggle()}),this.hamburgerMenuButton.on("pointerover",()=>{this.hamburgerMenuButton.setScale(1.1),this.hamburgerMenuButton.setColor("#b8e60a")}),this.hamburgerMenuButton.on("pointerout",()=>{this.hamburgerMenuButton.setScale(1),this.hamburgerMenuButton.setColor("#9acf07")});let ce=this.input.keyboard?.addKey("ESC");if(ce&&ce.on("down",()=>{this.menuOverlay.toggle()}),this.initializeBubbleSystem(),this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).isEndless&&this.showEndlessModePopup(),this.game.registry.get("backgroundMusicPlaying"))this.backgroundMusic=this.game.registry.get("backgroundMusicInstance");else{let U=this.registry.get("musicEnabled")!==!1;this.sound.context&&this.sound.context.state==="suspended"?(console.log("\u{1F50A} GameScene: Audio context suspended, attempting to resume..."),this.sound.context.resume().then(()=>{console.log("\u2705 GameScene: Audio context resumed, starting music"),this.startBackgroundMusic(U)}).catch(G=>{console.error("\u274C GameScene: Failed to resume audio context:",G),this.startBackgroundMusic(U)})):(console.log("\u{1F50A} GameScene: Audio context state:",this.sound.context?.state||"unknown"),this.startBackgroundMusic(U))}this.levelManager?.getCurrentLevel()>=51&&this.showBeastModeLoadingIndicator()}startBackgroundMusic(e){try{if(!this.cache.audio.exists("background-music")){console.error("\u274C Background music not loaded in cache!");return}this.backgroundMusic=this.sound.add("background-music",{loop:!0,volume:e?.3:0});let t=this.backgroundMusic.play();t&&typeof t.catch=="function"&&t.catch(i=>{console.error("\u274C Background music play() failed:",i)}),console.log("\u{1F3B5} GameScene: Background music started - actually playing:",this.backgroundMusic.isPlaying),setTimeout(()=>{console.log("\u{1F3B5} Music status after 100ms - playing:",this.backgroundMusic.isPlaying,"paused:",this.backgroundMusic.isPaused)},100),this.game.registry.set("backgroundMusicPlaying",!0),this.game.registry.set("backgroundMusicInstance",this.backgroundMusic)}catch(t){console.error("\u274C GameScene: Failed to play background music:",t)}}generateTileTextures(){let e=b.game.tileSize;for(let t=0;t<15;t++){let i=`platform-tile-${t}`;if(this.textures.exists(i))continue;let s=this.add.graphics();s.fillStyle(6965898,1),s.fillRect(0,0,e,e);let o=Math.random();if(o<.4?(s.fillStyle(9071274,.6),s.fillRect(Math.random()*12,Math.random()*12,8+Math.random()*8,8+Math.random()*8)):o<.6&&(s.fillStyle(11168410,.5),s.fillRect(Math.random()*12,Math.random()*12,6+Math.random()*10,6+Math.random()*10)),t<7){let n=[16738740,9662683,4251856,16766720,64154],l=n[t%n.length];s.lineStyle(2,l,.6);for(let c=0;c<3;c++){let h=6+c*8;s.lineBetween(2,h,e-2,h+Math.random()*4-2)}}if(t>=3&&t<=10){let n=[16716947,9662683,4251856,16766720,64154],l=n[t%n.length];s.fillStyle(l,.8);let c=3+t%4;for(let h=0;h<c;h++){let d=4+Math.random()*(e-8),p=4+Math.random()*(e-8),u=1.5+Math.random()*.5;s.fillCircle(d,p,u),s.fillStyle(16777215,.9),s.fillCircle(d-.5,p-.5,.5),s.fillStyle(l,.8)}}if(t>=5&&t<=12){let n=[4251856,16738740,9662683,16766720],l=n[t%n.length],c=1+t%2;for(let h=0;h<c;h++){let d=6+Math.random()*(e-12),p=6+Math.random()*(e-12);s.fillStyle(l,.7);for(let u=0;u<4;u++){let m=(Math.random()-.5)*6,y=(Math.random()-.5)*6,g=.8+Math.random()*.7;s.fillCircle(d+m,p+y,g)}s.fillStyle(l,.9),s.fillCircle(d,p,1.2),s.fillStyle(16777215,.8),s.fillCircle(d-.3,p-.3,.4)}}if(t>=8){let n=[12216520,10233776,6765239,4251856,16738740],l=n[t%n.length],c=(Math.random()-.5)*(e-12);s.fillStyle(l,.7),s.fillRect(e/2-4+c,0,8,e),s.fillStyle(l,.9),s.fillRect(e/2-3+c,2,2,e-4),s.fillRect(e/2+1+c,2,2,e-4),s.fillStyle(16777215,.8),s.fillRect(e/2-2+c,4,1,e-8),s.fillRect(e/2+2+c,4,1,e-8)}if(t%2===0){let n=t%3,l=[9662683,4251856,16738740];s.fillStyle(l[n],.8);let c=5+Math.random()*(e-10),h=5+Math.random()*(e-10);for(let d=0;d<4;d++){let p=c+Math.random()*10-5,u=h+Math.random()*10-5,m=2+Math.random()*3;s.fillCircle(p,u,m),s.fillStyle(16777215,.9),s.fillCircle(p-m/2,u-m/2,m/3),s.fillStyle(l[n],.8)}}if(t%2===1&&t>7){let n=[4251856,16766720,16738740,9662683,64154],l=n[t%n.length],c=1+t%2;for(let h=0;h<c;h++){let d=8+Math.random()*(e-16),p=8+Math.random()*(e-16),u=2+Math.random()*2;s.fillStyle(l,.8),s.fillRect(d-u/2,p-u/4,u,u/2),s.fillRect(d-u/3,p-u/2,u*.66,u),s.fillStyle(l,.95),s.fillCircle(d,p,u*.3),s.fillStyle(16777215,.9),s.fillCircle(d-u*.2,p-u*.2,u*.2)}}if(t%3===0){s.lineStyle(1,2762018,.5);let n=Math.random()*e;s.lineBetween(n,0,n+(Math.random()-.5)*12,e)}s.generateTexture(i,e,e),s.destroy()}}createMiningThemeBackground(){let t=b.game.floorWidth*b.game.tileSize+1e3,i=b.canvas.height*10,s=-500,r=-5e3,o=this.add.graphics();for(let n=r;n<i;n+=20){let l=Math.max(0,Math.min(1,(n-r)/(i-r))),c=Math.floor(26*(1-l)+42*l),h=Math.floor(10*(1-l)+26*l),d=Math.floor(42*(1-l)+74*l),p=c<<16|h<<8|d;o.fillStyle(p,1),o.fillRect(s,n,t,20)}for(let n=-15;n<30;n++){let l=n*400+100;o.fillStyle(6332671,.15),o.fillRect(s,l,t,8);let c=Math.floor(t/120);for(let h=0;h<=c;h++){let d=s+t/c*h+(Math.random()-.5)*40,p=[16739251,7058431,11796331,16757611,11758591],u=p[Math.floor(Math.random()*p.length)];o.fillStyle(u,.2),o.fillTriangle(d,l,d-6,l+30,d+6,l+30),o.fillStyle(16777215,.15),o.fillTriangle(d,l,d-2,l+10,d+2,l+10)}}for(let n=0;n<Math.floor(t/150);n++){let l=s+Math.random()*t,c=r+Math.random()*(i-r),h=[16728193,4244735,6942894,16755520,12216520],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.2);let p=100+Math.random()*150,u=Math.random()*Math.PI/3-Math.PI/6;for(let m=0;m<p;m+=8){let y=l+Math.cos(u)*m,g=c+Math.sin(u)*m;o.fillCircle(y,g,3+Math.random()*4),Math.random()>.7&&(o.fillStyle(16777215,.3),o.fillCircle(y+Math.random()*4-2,g+Math.random()*4-2,1),o.fillStyle(d,.2))}}for(let n=0;n<Math.floor(t/100);n++){let l=s+Math.random()*t,c=r+Math.random()*(i-r),h=Math.random();if(h<.3){let d=[16717636,15277667,10233776,6765239,4149685,2201331,48340,38536,5025616,9159498,13491257,16771899,16761095,16750592,16733986],p=d[Math.floor(Math.random()*d.length)];o.fillStyle(p,.25),o.fillCircle(l,c,8+Math.random()*6),o.fillStyle(16777215,.3),o.fillCircle(l-2,c-2,2)}else h<.6?(o.fillStyle(12216520,.2),o.fillCircle(l,c,6+Math.random()*4),o.fillStyle(16777215,.25),o.fillCircle(l-1,c-1,1.5)):(o.fillStyle(5025616,.2),o.fillCircle(l,c,4+Math.random()*3),o.fillStyle(16777215,.3),o.fillCircle(l-1,c-1,1))}for(let n=0;n<Math.floor(t/200);n++){let l=s+Math.random()*t,c=r+Math.random()*(i-r),h=[4251856,16738740,10025880,16753920],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.1),o.fillRect(l-20,c-5,40+Math.random()*30,10+Math.random()*8),o.fillStyle(d,.3),o.fillRect(l-10,c-2,20,4)}for(let n=0;n<Math.floor(t/60);n++){let l=s+Math.random()*t,c=r+Math.random()*(i-r),h=[4251856,16716947,9662683,65407,16766720],d=h[Math.floor(Math.random()*h.length)];o.fillStyle(d,.08),o.fillCircle(l,c,15),o.fillStyle(d,.15),o.fillCircle(l,c,8),o.fillStyle(d,.3),o.fillCircle(l,c,4),o.fillStyle(16777215,.4),o.fillCircle(l,c,2)}o.lineStyle(3,4251856,.3);for(let n=r+100;n<i;n+=400){let l=n+Math.random()*100,c=Math.floor(t/100);for(let h=0;h<c;h++){let d=s+t/c*h,p=s+t/c*(h+1),u=Math.sin(h*.5)*20;o.lineStyle(2,4251856,.15),o.lineBetween(d,l+u,p,l+Math.sin((h+1)*.5)*20),Math.random()>.7&&(o.fillStyle(16777215,.2),o.fillCircle(d+Math.random()*(p-d),l+u,1))}}for(let n=0;n<Math.floor(t/80);n++){let l=s+Math.random()*t,c=r+Math.random()*(i-r),h=40+Math.random()*60,d=[10233776,6765239,4149685,48340,5025616],p=d[Math.floor(Math.random()*d.length)];o.fillStyle(5917290,.15),o.fillCircle(l,c,h),o.fillStyle(p,.2),o.fillCircle(l,c,h*.7),o.fillStyle(p,.35),o.fillCircle(l,c,h*.3),o.fillStyle(16777215,.3),o.fillCircle(l-h*.2,c-h*.2,h*.15)}o.setDepth(-10),o.setScrollFactor(.5)}createTestLevel(){let e=b.game.tileSize,t=b.game.floorWidth,i=b.game.floorSpacing||e*5,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),r=s.isEndless?20:s.floorCount,o=s.isEndless?Math.max(r,Math.floor(b.canvas.height/i)):r,n=[],l=[];for(let h=0;h<o;h++){let d=b.canvas.height-e/2-h*i;if(h===0){for(let p=0;p<t;p++){let u=p*e+e/2;this.createPlatformTile(u,d,p===0,p===t-1)}n[h]=-1,l[h]={gapStart:-1,gapSize:0}}else if(!this.levelManager.isBonusLevel()&&Math.random()>.3){let u=Math.floor(Math.random()*(t-5))+2,m=Math.floor(Math.random()*2)+2;l[h]={gapStart:u,gapSize:m};for(let k=0;k<t;k++)(k<u||k>=u+m)&&this.createPlatformTile(k*e+e/2,d,k===0,k===t-1);this.levelManager.isBonusLevel()||this.createSpikesInGap(u,m,d,e);let y=u>3?Math.floor(Math.random()*(u-1))+1:-1,g=u+m<t-2?Math.floor(Math.random()*(t-u-m-2))+u+m+1:-1,f=t/3,v=h>1?n[h-1]:-1,S=Math.floor(Math.random()*3);if(v!==-1){let k=Math.floor(v/f),E=[0,1,2].filter(O=>O!==k);S=E[Math.floor(Math.random()*E.length)]}let x=Math.floor(S*f),P=Math.floor((S+1)*f),C=[];y!==-1&&y>=x&&y<P&&C.push(y),g!==-1&&g>=x&&g<P&&C.push(g),n[h]=C.length>0?C[Math.floor(Math.random()*C.length)]:g!==-1?g:y}else{l[h]={gapStart:-1,gapSize:0};for(let v=0;v<t;v++)this.createPlatformTile(v*e+e/2,d);let u=t/3,m=h>1?n[h-1]:-1,y=Math.floor(Math.random()*3);if(m!==-1){let v=Math.floor(m/u),S=[0,1,2].filter(x=>x!==v);y=S[Math.floor(Math.random()*S.length)]}let g=Math.max(2,Math.floor(y*u)),f=Math.min(t-2,Math.floor((y+1)*u));n[h]=Math.floor(Math.random()*(f-g))+g}}this.floorLayouts=l;let c=s.isEndless?-1:s.floorCount-1;for(let h=0;h<o-1;h++){if(!s.isEndless&&h+1>c)continue;let d=b.canvas.height-e-h*i,p=b.canvas.height-e-(h+1)*i,u=l[h],m=l[h+1],y=[];for(let g=1;g<t-1;g++){let f=this.hasPlatformAt(u,g),v=this.hasPlatformAt(m,g),S=this.hasDoorAt(g,h),x=this.hasDoorAt(g,h+1);f&&v&&!S&&!x&&y.push(g)}if(y.length>0){let g=[];if(h===0)if(y.length>=2){let f=y[Math.floor(Math.random()*y.length)];this.createContinuousLadder(f*e,d,p),g.push(f);let v=6,S=y.filter(x=>Math.abs(x-f)>=v);if(S.length>0){let x=S[Math.floor(Math.random()*S.length)];this.createContinuousLadder(x*e,d,p),g.push(x)}else{let x=0,P=-1;for(let C of y){let k=Math.abs(C-f);k>x&&C!==f&&(x=k,P=C)}P!==-1&&x>=3&&(this.createContinuousLadder(P*e,d,p),g.push(P))}}else{let f=y[0];this.createContinuousLadder(f*e,d,p),g.push(f)}else{let f=this.ladderPositions.get(h-1)||[],v=y.filter(P=>!f.some(C=>Math.abs(P-C)<3)),S=v.length>0?v:y,x=S[Math.floor(Math.random()*S.length)];this.createContinuousLadder(x*e,d,p),g.push(x)}this.storeLadderPositions(h,g)}}}storeLadderPositions(e,t){this.ladderPositions.set(e,t)}hasPlatformAt(e,t){return e.gapStart===-1?!0:t<e.gapStart||t>=e.gapStart+e.gapSize}selectSmartTileVariant(e,t){let i=b.game.tileSize,s=Math.floor(e/i),r=Math.floor(t/i),o=`${s},${r}`;if(this.tileGrid.has(o))return this.tileGrid.get(o);let n=[],l=[],c=[`${s-1},${r}`,`${s+1},${r}`,`${s},${r-1}`,`${s},${r+1}`,`${s-1},${r-1}`,`${s+1},${r-1}`,`${s-1},${r+1}`,`${s+1},${r+1}`];c.forEach(g=>{if(this.tileGrid.has(g)){let f=this.tileGrid.get(g);n.push(f.variant),l.push(f.flipX)}});let h=[[0,4,8],[1,5,9],[2,3,6,7,10,11]],d=g=>{for(let f of h)if(f.includes(g))return f;return null},p=[];for(let g=0;g<12;g++)for(let f of[!1,!0]){let v=100;c.slice(0,4).forEach(k=>{if(this.tileGrid.has(k)){let E=this.tileGrid.get(k);E.variant===g&&E.flipX===f?v-=80:E.variant===g&&(v-=40);let O=d(g),M=d(E.variant);O&&M&&O===M&&(v-=60)}}),c.slice(4).forEach(k=>{if(this.tileGrid.has(k)){let E=this.tileGrid.get(k);E.variant===g&&E.flipX===f?v-=30:E.variant===g&&(v-=15);let O=d(g),M=d(E.variant);O&&M&&O===M&&(v-=25)}});let P=Math.max(...this.tileUsageCount)||1,C=Math.max(0,P-this.tileUsageCount[g])*5;v+=C,this.recentTiles.includes(g)||(v+=20),v+=Math.random()*10,p.push({variant:g,flipX:f,score:v})}p.sort((g,f)=>f.score-g.score);let u=p.slice(0,Math.max(6,Math.floor(p.length*.25))),m=u[Math.floor(Math.random()*u.length)],y={variant:m.variant,flipX:m.flipX};return this.tileGrid.set(o,y),this.recentTiles.push(m.variant),this.tileUsageCount[m.variant]++,this.recentTiles.length>8&&this.recentTiles.shift(),y}createPlatformTile(e,t,i=!1,s=!1){let r=b.game.tileSize,o=this.selectSmartTileVariant(e,t),n=`floor-tile-${o.variant+1}`,l=this.add.sprite(e,t,n);l.setDisplaySize(32,32),l.setDepth(1),l.setFlipX(o.flipX);let c=this.add.sprite(e+3,t+3,n);c.setDisplaySize(32,32),c.setDepth(0),c.setTint(0),c.setAlpha(.3),c.setFlipX(o.flipX);let h=this.add.rectangle(e,t,r,r,0,0);h.setDepth(0),this.physics.add.existing(h,!0),this.platforms.add(h)}createContinuousLadder(e,t,i){let s=b.game.tileSize,r=t>=b.canvas.height-s*2,o=r?0:s*.25,n=s*.1,l=t-i+o+n,c=(t+o+i-n)/2;(this.game.registry.get("isDgen1")||!1)&&console.log("\u{1FA9C} Ladder created:",{x:Math.round(e),bottomY:Math.round(t),topY:Math.round(i),ladderY:Math.round(c),ladderHeight:Math.round(l),isGroundFloor:r,canvasHeight:b.canvas.height});let d=this.add.rectangle(e+s/2,c,s*.8,l,16777215,0);if(d.setDepth(10),this.ladders.add(d),this.textures.exists("tealLadder")){let p=e+s/2,u=t-i+s*.5,m=(t+i)/2+1,y=this.add.image(p+1,m,"tealLadder");y.setDisplaySize(y.width*(u/y.height),u),y.setDepth(11)}else{let p=this.add.graphics(),u=e+s/2,m=t-i+s*.5,y=(t+i)/2+1,g=y-m/2,f=y+m/2;p.fillStyle(4251856,1),p.fillRect(u-2,g,4,m),p.fillRect(u-13,g+4,26,4),p.fillRect(u-13,f-8,26,4);let v=Math.floor(m/32);for(let S=1;S<v;S++){let x=g+S*(m/(v+1));p.fillRect(u-13,x,26,3)}p.setDepth(11)}}createSpikesInGap(e,t,i,s){for(let r=e;r<e+t;r++){let o=r*s+s/2,n=i;this.createSpikeSprite(o,n,s)}}createSpikeSprite(e,t,i){let s=t+i/2-1+1,r=this.add.image(e+3,s+3,"pink-floor-spike-tile");r.setDisplaySize(i,i),r.setOrigin(.5,1),r.setDepth(11),r.setTint(0),r.setAlpha(.3);let o=this.add.image(e,s,"pink-floor-spike-tile");o.setDisplaySize(i,i),o.setOrigin(.5,1),o.setDepth(12);let n=i,l=t,c=this.add.rectangle(e,l,i*.9,n,0,0);c.setVisible(!1),c.setData("isFloorSpike",!0),c.setData("visualSpikeHeight",i),c.setData("visualSpikeBaseY",s),this.spikes.add(c)}createCeilingSpikes(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5,i=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(this.levelManager.isBonusLevel())return;let s=1;for(let r=s;r<this.floorLayouts.length-1;r++){let o=this.floorLayouts[r];if(Math.random()>.8)continue;let n=b.canvas.height-e/2-(r+1)*t+e,l=[],c=this.getLadderPositionsForFloor(r);for(let d=2;d<b.game.floorWidth-2;d++){if(o.gapStart!==-1&&d>=o.gapStart-2&&d<o.gapStart+o.gapSize+2)continue;let p=!1;for(let u of c)if(Math.abs(d-u)<2){p=!0;break}if(!p){if(r===this.floorLayouts.length-2){let u=Math.floor(b.game.floorWidth/2);if(Math.abs(d-u)<2)continue}l.push(d)}}let h=Math.floor(Math.random()*3)+1;for(let d=0;d<Math.min(h,l.length/3)&&l.length!==0;d++){let p=Math.floor(Math.random()*l.length),u=l[p],m=Math.floor(Math.random()*3)+1;for(let y=0;y<m;y++){let g=u+y;if(g>=b.game.floorWidth-2)break;let f=!1;for(let S of c)if(Math.abs(g-S)<2){f=!0;break}if(f)continue;let v=l.indexOf(g);v>-1&&l.splice(v,1),this.createCeilingSpikeGraphics(g*e+e/2,n,e)}}}}createCeilingSpikeGraphics(e,t,i){let s=i*.5+6,r=t-i/2+1,o=this.add.image(e,r,"yellow-ceiling-spike-tile");o.setDisplaySize(i,i),o.setOrigin(.5,0),o.setDepth(12);let n=this.add.rectangle(e,r+s/2,24,s,0,0);n.setVisible(!1),n.setData("isCeilingSpike",!0),n.setData("sprite",o),n.setData("x",e),n.setData("y",r),this.physics.add.existing(n,!0),this.spikes.add(n)}getLadderPositionsForFloor(e){let t=[],i=b.game.tileSize,s=b.game.floorSpacing||i*5;return this.ladders.children.entries.forEach(r=>{let o=r,n=o.y+o.height/2,l=Math.floor((b.canvas.height-n)/s);if(l===e||l===e-1||l===e+1){let c=Math.floor(o.x/i);t.push(c)}}),t}createCats(){if(this.levelManager.isBonusLevel())return;let e=b.game.tileSize,t=b.game.floorSpacing||e*5,i=b.game.floorWidth,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),r=s.isEndless?999:s.floorCount-1,o=s.isEndless?Math.min(20,this.floorLayouts.length-1):r-1,n=0;for(let l=2;l<=o&&l<this.floorLayouts.length;l++){let c=this.floorLayouts[l],p=b.canvas.height-e/2-l*t-e/2-15,u=I.selectEnemiesForFloor(this.levelManager.getCurrentLevel(),l);if(u.length===0)continue;let m=this.levelManager.getCurrentLevel(),y=this.calculateEnemyZones(i,m),g=this.ladderPositions.get(l)||[],f=[],v=[...y].sort(()=>Math.random()-.5),S=0,x=new Set;for(let P=0;P<u.length&&P<v.length;P++){let C=u[P],k=v[P],E,O,M;if(I.isBaseBluType(C)){if(u.filter(A=>I.isBaseBluType(A)).length===1){let A=Math.random()<.5;E=e*(A?1:i-1)}else E=e*(S===0?1:i-1),S++;O=e*.5,M=e*(i-.5)}else if(I.isStalkerType(C)){let T=k,A=g.some(F=>F>=k.start&&F<k.end),Y=f.some(F=>F>=k.start&&F<k.end);if(A||Y){let F=v.filter((D,X)=>{if(X<=P)return!1;let q=g.some(R=>R>=D.start&&R<D.end),j=f.some(R=>R>=D.start&&R<D.end);return!q&&!j});F.length>0&&(T=F[0])}E=e*(T.center+(Math.random()-.5)),O=e*.5,M=e*(i-.5)}else E=e*(k.center+(Math.random()-.5)*2),O=e*.5,M=e*(i-.5);let L=I.getSpeedMultiplier(this.levelManager.getCurrentLevel());if(I.isBaseBluType(C)){let T=new Q(this,E,p);T.setPlatformBounds(O,M);let A=e*(i/2);E<A?T.setInitialDirection(1):T.setInitialDirection(-1),typeof T.setSpeedMultiplier=="function"&&T.setSpeedMultiplier(L),this.baseBlus.add(T),n++}else if(I.isBeetleType(C)){let T=new ee(this,E,p,O,M);typeof T.setSpeedMultiplier=="function"&&T.setSpeedMultiplier(L),this.beetles.add(T),n++}else if(I.isRexType(C)){let T=new te(this,E,p,O,M);typeof T.setSpeedMultiplier=="function"&&T.setSpeedMultiplier(L),this.rexEnemies.add(T),n++}else if(I.isStalkerType(C)){let T=new H(this,E,p,e*.5,e*(i-.5),"red",!0);T.setPlayerReference(this.player),this.setSmartEnemyDirection(T,E,i*e,P,u.length),typeof T.setSpeedMultiplier=="function"&&T.setSpeedMultiplier(L),this.stalkerCats.add(T),n++}else{let T=I.getColorForEnemyType(C);C==="chomper"&&Math.random()<.5&&(T="purple");let A=new H(this,E,p,O,M,T);this.setSmartEnemyDirection(A,E,i*e,P,u.length),typeof A.setSpeedMultiplier=="function"&&A.setSpeedMultiplier(L),this.cats.add(A),n++}}}}getZoneSizeForLevel(e){return e<=10?6:e<=30?5:(e<=50,4)}calculateEnemyZones(e,t){let i=this.getZoneSizeForLevel(t),s=Math.floor(e/i),r=[];for(let o=0;o<s;o++)r.push({start:o*i,end:(o+1)*i,center:o*i+i/2});return r}calculateEnemyPositions(e,t,i,s){let r=[],n=i-3,l=Math.floor(this.currentFloorY/(s*5)),c=this.ladderPositions.get(l)||[];switch(t){case"spread":let d=Math.max(2.5,n/e);for(let v=0;v<e;v++){let S=1.5+d*(v+.5),x=Math.min(.5,(d-2.5)/2),P=(Math.random()-.5)*x,C=Math.max(1.5,Math.min(i-1.5,S+P)),k=6,E=Math.max(k,d*1.2),O=1.5+d*(v+.5),M=Math.max(.5,O-E/2),L=Math.min(i-.5,O+E/2);for(let T of c)T>=M&&T<=L&&(T-M<L-T?M=Math.min(L-k,T+2):L=Math.max(M+k,T-2));r.push({x:C,leftBound:M,rightBound:L})}break;case"cluster":let p=i/2,u=Math.min(2,n/4);for(let v=0;v<e;v++){let S=Math.PI*2*v/e,x=Math.random()*u,P=Math.max(1.5,Math.min(i-1.5,p+Math.cos(S)*x)),C=6,k=Math.max(.5,p-Math.max(u+2,C/2)),E=Math.min(i-.5,p+Math.max(u+2,C/2));for(let O of c)O>=k&&O<=E&&(O-k<E-O?k=Math.min(E-C,O+2):E=Math.max(k+C,O-2));r.push({x:P,leftBound:k,rightBound:E})}break;case"edges":let m=Math.ceil(e/2),y=Math.floor(e/2);for(let v=0;v<m;v++){let x=1.5+v*.8+Math.random()*1.5,P=.5,C=Math.min(i/2+1,i-.5),k=6;C-P<k&&(C=Math.min(P+k,i-.5));for(let E of c)E>=P&&E<=C&&(C=Math.max(P+k,E-2));r.push({x,leftBound:P,rightBound:C})}for(let v=0;v<y;v++){let S=v*.8,x=i-1.5-S-Math.random()*1.5,P=Math.max(i/2-1,.5),C=i-.5,k=6;C-P<k&&(P=Math.max(C-k,.5));for(let E of c)E>=P&&E<=C&&(P=Math.min(C-k,E+2));r.push({x,leftBound:P,rightBound:C})}break;case"random":default:let g=[],f=2.5;for(let v=0;v<e;v++){let S,x=0,P=20;do if(S=1.5+Math.random()*n,x++,x>=P){S=1.5+n/(e+1)*(v+1);break}while(g.some(T=>Math.abs(T-S)<f));g.push(S);let C=6,k=3.5,E=Math.random()*2,O=Math.max(C/2,k+E),M=Math.max(.5,S-O),L=Math.min(i-.5,S+O);if(L-M<C){let T=(M+L)/2;M=Math.max(.5,T-C/2),L=Math.min(i-.5,T+C/2)}for(let T=0;T<v;T++){let A=r[T],Y=g[T];S<Y&&L>A.leftBound?L=Math.min(L,A.leftBound-.5):S>Y&&M<A.rightBound&&(M=Math.max(M,A.rightBound+.5))}for(let T of c)T>=M&&T<=L&&(T-M<L-T?M=Math.min(L-6,T+2):L=Math.max(M+6,T-2));r.push({x:S,leftBound:M,rightBound:L})}break}return r}setSmartEnemyDirection(e,t,i,s,r){let o=i/2,n=Math.abs(t-o),l=t<i*.25||t>i*.75,c;r===1?c=.5:r===2?c=t<o?.7:.3:l?c=t<o?.75:.25:c=s%2===0?.3:.7,c+=(Math.random()-.5)*.3,c=Math.max(.1,Math.min(.9,c)),Math.random()<c&&typeof e.reverseDirection=="function"&&e.reverseDirection()}createTemporaryFloorGrid(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5,i=b.canvas.width,s=this.add.graphics();s.lineStyle(2,65280,.7),s.setDepth(100);for(let r=0;r<this.floorLayouts.length;r++){let n=b.canvas.height-e/2-r*t-e/2;s.moveTo(0,n),s.lineTo(i,n),this.add.text(10,n-20,`Floor ${r} (Top:${Math.round(n)})`,{fontSize:"12px",color:"#00ff00",backgroundColor:"#000000aa",padding:{x:4,y:2}}).setDepth(101)}s.strokePath()}createStalkerCats(){let e=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(!e.enemyTypes.includes("red"))return;let t=b.game.tileSize,i=b.game.floorSpacing||t*5,s=b.game.floorWidth,r=e.isEndless?999:e.floorCount-1,o=e.isEndless?Math.min(25,this.floorLayouts.length-1):r-1;for(let n=2;n<=o&&n<this.floorLayouts.length;n++){let l=this.floorLayouts[n],d=b.canvas.height-t/2-n*i-t/2-15,p=n<20?1:2,u=Math.random()<.6?Math.floor(Math.random()*p)+1:0;if(u===0)continue;let m=[];if(l.gapStart===-1)for(let y=2;y<s-2;y++)m.push(y);else{for(let y=2;y<l.gapStart-1;y++)m.push(y);for(let y=l.gapStart+l.gapSize+1;y<s-2;y++)m.push(y)}for(let y=0;y<Math.min(u,m.length);y++){let g=Math.floor(Math.random()*m.length),f=m[g],v=f*t+t/2;m.splice(g,1);let S=t*.5,x=t*(s-.5);l.gapStart!==-1&&(f<l.gapStart?x=t*(l.gapStart-.5):S=t*(l.gapStart+l.gapSize+.5));let P=new H(this,v,d,S,x,"red",!0);P.setPlayerReference(this.player),this.stalkerCats.add(P)}}}handleCatCatCollision(e,t){let i=e,s=t,r=10;i.x<s.x?(i.setX(i.x-r),s.setX(s.x+r)):(s.setX(s.x-r),i.setX(i.x+r)),i.reverseDirection(),s.reverseDirection()}createAllCollectibles(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).collectibleTypes;if(this.levelManager.isBonusLevel()){this.createBonusLevelChests();return}for(let r=0;r<this.floorLayouts.length;r++){let o=this.floorLayouts[r],l=b.canvas.height-e/2-r*t-e-8,c=[];for(let y=1;y<b.game.floorWidth-1;y++)this.hasPlatformAt(o,y)&&!this.hasLadderAt(y,r)&&!this.hasDoorAt(y,r)&&c.push(y);if(c.length===0)continue;let h=[];if(s.includes("coin")&&r>0){let y=Math.floor(Math.random()*3)+2;this.placeCollectiblesOfType(c,y,"coin",l,r,h)}s.includes("blueCoin")&&r>0&&Math.random()<.2&&this.placeCollectiblesOfType(c,1,"blueCoin",l,r,h),s.includes("diamond")&&r>1&&Math.random()<.08&&this.placeCollectiblesOfType(c,1,"diamond",l,r,h),s.includes("freeLife")&&r>2&&Math.random()<.03&&this.placeCollectiblesOfType(c,1,"freeLife",l,r,h);let d=Math.random();if(s.includes("invincibilityPendant")&&!(r===0)&&d<.03&&this.placeCollectiblesOfType(c,1,"invincibilityPendant",l,r,h),s.includes("treasureChest")&&r>=3){let y=this.levelManager.getCurrentLevel();this.shouldSpawnChestOnFloor(y,r)&&this.placeCollectiblesOfType(c,1,"treasureChest",l,r,h)}let m=this.levelManager.getCurrentLevel();m>=3&&!this.levelHasCrystalBall&&r>=2&&Math.random()<.3&&(console.log("\u{1F52E} TRYING to spawn Crystal Ball - Level:",m,"Floor:",r,"HasCrystalBall:",this.levelHasCrystalBall),this.placeCollectiblesOfType(c,1,"crystalBall",l,r,h),this.levelHasCrystalBall=!0,console.log("\u{1F52E} Crystal Ball spawn attempted, levelHasCrystalBall now:",this.levelHasCrystalBall)),m>=11&&!this.levelHasCursedOrb&&r>=2&&Math.random()<.2&&(this.placeCollectiblesOfType(c,1,"cursedOrb",l,r,h),this.levelHasCursedOrb=!0),m>=21&&!this.levelHasCursedTealOrb&&r>=2&&Math.random()<.15&&(this.placeCollectiblesOfType(c,1,"cursedTealOrb",l,r,h),this.levelHasCursedTealOrb=!0)}}placeCollectiblesOfType(e,t,i,s,r,o){let n=b.game.tileSize,l=i==="treasureChest"?e.filter(c=>this.isSafeForTreasureChest(c,r)):e.filter(c=>!this.hasLadderAt(c,r)&&!this.hasDoorAt(c,r));for(let c=0;c<Math.min(t,l.length);c++){let h=0,d=-1;for(;h<20&&d===-1;){let u=Math.floor(Math.random()*l.length),m=l[u];if(!this.isPositionOccupiedWithVariety(m,i,o)){d=m,o.push({x:d,type:i});for(let y=l.length-1;y>=0;y--)Math.abs(l[y]-d)<2&&l.splice(y,1)}h++}if(d===-1)break;let p=d*n+n/2;switch(i){case"coin":let u=new $(this,p,s);this.coins.push(u),this.physics.add.overlap(this.player,u.sprite,()=>this.handleCoinCollection(u),void 0,this);break;case"blueCoin":let m=new J(this,p,s);this.blueCoins.push(m),this.physics.add.overlap(this.player,m.sprite,()=>this.handleBlueCoinCollection(m),void 0,this);break;case"diamond":let y=new _(this,p,s);this.diamonds.push(y),this.physics.add.overlap(this.player,y.sprite,()=>this.handleDiamondCollection(y),void 0,this);break;case"freeLife":let g=new Z(this,p,s);this.freeLifes.push(g),this.physics.add.overlap(this.player,g.sprite,()=>this.handleFreeLifeCollection(g),void 0,this);break;case"invincibilityPendant":let f=new ie(this,p,s);this.invincibilityPendants.push(f),this.physics.add.overlap(this.player,f.sprite,()=>{this.handleInvincibilityPendantCollection(f)},void 0,this);break;case"treasureChest":let v=new se(this,p,s);this.treasureChests.push(v);break;case"crystalBall":console.log("\u{1F52E} SPAWNING Crystal Ball at",p,s,"floor:",r);let S=new be(this,p,s);this.crystalBalls.push(S),console.log("\u{1F52E} Crystal Ball created, total crystal balls:",this.crystalBalls.length),this.physics.add.overlap(this.player,S.sprite,()=>this.handleCrystalBallCollection(S),void 0,this);break;case"cursedOrb":let x=new ae(this,p,s,"cursed");this.cursedOrbs.push(x),this.physics.add.overlap(this.player,x.sprite,()=>this.handleCursedOrbCollection(x),void 0,this);break;case"cursedTealOrb":let P=new ae(this,p,s,"cursedTeal");this.cursedTealOrbs.push(P),this.physics.add.overlap(this.player,P.sprite,()=>this.handleCursedTealOrbCollection(P),void 0,this);break}}}hasLadderAt(e,t){return(this.ladderPositions.get(t)||[]).includes(e)}hasDoorAt(e,t){let i=this.doorPositions.get(t);return i===void 0?!1:Math.abs(e-i)<=2}createBonusLevelChests(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5,i=[2,3];for(let s=0;s<i.length;s++){let r=i[s];if(r>=this.floorLayouts.length)continue;let o=this.floorLayouts[r],l=b.canvas.height-e/2-r*t-e-8,c=[];for(let u=1;u<b.game.floorWidth-1;u++)this.hasPlatformAt(o,u)&&!this.hasLadderAt(u,r)&&!this.hasDoorAt(u,r)&&c.push(u);if(c.length===0)continue;let h=Math.floor(Math.random()*c.length),d=c[h]*e+e/2,p=new se(this,d,l);this.treasureChests.push(p)}this.createBonusLevelCollectibles(),this.createBonusLevelFreeLife()}createBonusLevelCollectibles(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5;for(let i=1;i<this.floorLayouts.length-1;i++){let s=this.floorLayouts[i],o=b.canvas.height-e/2-i*t-e-8,n=[];for(let u=1;u<b.game.floorWidth-1;u++)this.hasPlatformAt(s,u)&&!this.hasLadderAt(u,i)&&!this.hasDoorAt(u,i)&&n.push(u);if(n.length===0)continue;let l=[...n].sort(()=>Math.random()-.5),c=0;if(l.length>0){let u=Math.min(Math.floor(l.length/3),l.length-1),m=l[u]*e+e/2,y=new _(this,m,o);this.diamonds.push(y),this.time.delayedCall(100,()=>{this.physics.add.overlap(this.player,y.sprite,()=>this.handleDiamondCollection(y),void 0,this)}),l.splice(u,1)}let h=Math.max(1,Math.floor(l.length/6));for(let u=0;u<5&&u<l.length;u++){let m=Math.min(u*h,l.length-1),y=l[m]*e+e/2,g=new J(this,y,o);this.blueCoins.push(g),this.physics.add.overlap(this.player,g.sprite,()=>this.handleBlueCoinCollection(g),void 0,this),l.splice(m,1)}let d=0,p=2;for(let u=0;u<l.length;u++)if(d===0||u>=d+p){let m=l[u]*e+e/2,y=new $(this,m,o);this.coins.push(y),this.physics.add.overlap(this.player,y.sprite,()=>this.handleCoinCollection(y),void 0,this),d=u}}}createBonusLevelFreeLife(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5,i=3;if(i<this.floorLayouts.length){let s=this.floorLayouts[i],o=b.canvas.height-e/2-i*t-e-8,n=[];for(let l=1;l<b.game.floorWidth-1;l++)this.hasPlatformAt(s,l)&&!this.hasLadderAt(l,i)&&!this.hasDoorAt(l,i)&&n.push(l);if(n.length>0){let l=Math.min(2,n.length-1),c=n[l]*e+e/2,h=new Z(this,c,o);this.freeLifes.push(h),this.time.delayedCall(100,()=>{this.physics.add.overlap(this.player,h.sprite,()=>{this.handleFreeLifeCollection(h)},void 0,this)})}}}createLevel10TestingCollectibles(){let e=b.game.tileSize,t=b.game.floorSpacing||e*5,i=[];for(let s=1;s<this.floorLayouts.length-1;s++)i.push(s);for(let s of i){if(s>=this.floorLayouts.length)continue;let r=this.floorLayouts[s],n=b.canvas.height-e/2-s*t-e-8,l=[];for(let h=1;h<b.game.floorWidth-1;h++)this.hasPlatformAt(r,h)&&!this.hasLadderAt(h,s)&&!this.hasDoorAt(h,s)&&l.push(h);if(l.length===0)continue;let c=Math.min(3,l.length);for(let h=0;h<c;h++){let d=Math.floor(Math.random()*l.length),u=l.splice(d,1)[0]*e+e/2,m=new ie(this,u,n);this.invincibilityPendants.push(m),this.physics.add.overlap(this.player,m.sprite,()=>this.handleInvincibilityPendantCollection(m),void 0,this)}}}shouldSpawnChestOnFloor(e,t){if(e<=4){let i=this.levelManager.getLevelConfig(e),s=Math.floor(i.floorCount/2);return t===s||t===s+1&&Math.random()<.5}else if(e<=6){let i=this.levelManager.getLevelConfig(e),s=Math.floor(i.floorCount/3),r=Math.floor(i.floorCount*2/3);return t===s||t===r}else return t%3===0||Math.random()<.35}isSafeForTreasureChest(e,t){let i=b.game.floorWidth,s=b.game.tileSize,o=Math.ceil((60+16)/s);if(e<o||e>=i-o)return!1;let n=this.floorLayouts[t];if(n&&n.gapStart!==-1){let p=n.gapStart+n.gapSize;if(e>=n.gapStart-o&&e<=p+o-1)return!1}let l=this.ladderPositions.get(t)||[],c=this.ladderPositions.get(t-1)||[],h=[...l,...c];for(let p of h)if(Math.abs(e-p)<=o)return!1;let d=this.doorPositions.get(t);return!(d!==void 0&&Math.abs(e-d)<=o+1)}isPositionOccupied(e,t,i){if(this.hasLadderAt(e,t))return!0;let s=this.doorPositions.get(t);if(s!==void 0&&Math.abs(e-s)<4)return!0;let r=this.ladderPositions.get(t)||[];for(let o of r)if(Math.abs(e-o)<2)return!0;return i.some(o=>Math.abs(o-e)<2)}isPositionOccupiedWithVariety(e,t,i){return i.some(o=>Math.abs(o.x-e)<2)?!0:i.some(o=>o.type===t&&Math.abs(o.x-e)<3)}handleCoinCollection(e){if(this.isLevelStarting||e.isCollected())return;this.score+=b.scoring.coinCollect,this.playSoundEffect("gem-collect",.5),this.totalCoinsCollected++,this.totalGemsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalGems",this.totalGemsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,b.scoring.coinCollect),this.triggerFarcadeHapticFeedback(),e.collect();let t=this.coins.indexOf(e);t>-1&&this.coins.splice(t,1)}handleBlueCoinCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=500;this.score+=t,this.playSoundEffect("big-blue-gem-collect",.5),this.totalCoinsCollected+=5,this.totalBlueGemsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalBlueGems",this.totalBlueGemsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),this.triggerFarcadeHapticFeedback(),e.collect();let i=this.blueCoins.indexOf(e);i>-1&&this.blueCoins.splice(i,1)}handleDiamondCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=1e3;this.score+=t,this.playSoundEffect("diamond-collect",.5),this.totalCoinsCollected+=10,this.totalDiamondsCollected++,this.game.registry.set("totalCoins",this.totalCoinsCollected),this.game.registry.set("totalDiamonds",this.totalDiamondsCollected),this.checkForExtraLife(),this.updateScoreDisplay(),this.updateCoinCounterDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),this.triggerFarcadeHapticFeedback(),e.collect();let i=this.diamonds.indexOf(e);i>-1&&this.diamonds.splice(i,1)}handleFreeLifeCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=2e3;this.score+=t,this.playSoundEffect("heart-collect",.5),this.lives<this.MAX_LIVES&&(this.lives++,this.game.registry.set("playerLives",this.lives),console.log(`\u{1F49A} Free life collected! Lives: ${this.lives}`),this.showExtraLifePopup("Heart Crystal!")),this.updateScoreDisplay(),this.updateLivesDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),e.collect();let i=this.freeLifes.indexOf(e);i>-1&&this.freeLifes.splice(i,1)}handleInvincibilityPendantCollection(e){if(this.isLevelStarting||e.isCollected())return;let t=300;this.score+=t,this.playSoundEffect("powerup-collect",.5),this.activateInvincibility(),this.updateScoreDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-20,t),e.collect();let i=this.invincibilityPendants.indexOf(e);i>-1&&this.invincibilityPendants.splice(i,1)}handleCrystalBallCollection(e){if(console.log("\u{1F52E} CRYSTAL BALL COLLISION DETECTED!"),this.isLevelStarting){console.log("\u274C Cannot collect - level is starting");return}if(e.isCollected()){console.log("\u274C Cannot collect - already collected");return}console.log("\u{1F52E} COLLECTING Crystal Ball - activating power-up!"),this.playSoundEffect("powerup-collect",.5),this.player.activateCrystalBall(),e.collect();let t=this.crystalBalls.indexOf(e);t>-1&&(this.crystalBalls.splice(t,1),console.log("\u{1F52E} Crystal Ball removed from array, remaining:",this.crystalBalls.length)),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}handleCursedOrbCollection(e){if(console.log("\u{1F480} CURSED ORB COLLISION DETECTED!"),this.isLevelStarting){console.log("\u274C Cannot collect - level is starting");return}if(e.isCollected()){console.log("\u274C Cannot collect - already collected");return}this.playSoundEffect("cursed-orb-collect",.5),this.player.activateCursedOrb(),e.collect();let t=this.cursedOrbs.indexOf(e);t>-1&&this.cursedOrbs.splice(t,1),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}handleCursedTealOrbCollection(e){if(console.log("\u{1F300} CURSED TEAL ORB COLLISION DETECTED!"),this.isLevelStarting){console.log("\u274C Cannot collect - level is starting");return}if(e.isCollected()){console.log("\u274C Cannot collect - already collected");return}this.playSoundEffect("cursed-orb-collect",.5),this.player.activateCursedTealOrb(),e.collect();let t=this.cursedTealOrbs.indexOf(e);t>-1&&this.cursedTealOrbs.splice(t,1),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}activateDarknessEffect(){console.log("\u{1F480} Activating darkness effect!"),this.darknessOverlay?this.darknessOverlay.setVisible(!0):(this.darknessOverlay=this.add.image(b.canvas.width/2,b.canvas.height/2-50,"visibilityOverlay"),this.darknessOverlay.setScrollFactor(0),this.darknessOverlay.setDepth(150),this.darknessOverlay.setOrigin(.5,.5)),this.darknessOverlay.setAlpha(0),this.tweens.add({targets:this.darknessOverlay,alpha:1,duration:500,ease:"Power2.easeIn"})}deactivateDarknessEffect(){console.log("\u{1F480} Deactivating darkness effect!"),this.darknessOverlay&&this.tweens.add({targets:this.darknessOverlay,alpha:0,duration:500,ease:"Power2.easeOut",onComplete:()=>{this.darknessOverlay&&this.darknessOverlay.setVisible(!1)}})}createCrystalBallProjectile(e,t,i,s=0){console.log("Creating crystal ball projectile at",e,t,"direction:",i,"player velocity:",s),this.playSoundEffect("crystal-ball-throw",.5);let r=new me(this,e,t,i,s);this.crystalBallProjectiles.push(r),this.physics.add.overlap(r,this.cats,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(r,this.beetles,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(r,this.stalkerCats,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.overlap(r,this.baseBlus,(o,n)=>this.handleProjectileEnemyCollision(o,n),void 0,this),this.physics.add.collider(r,this.platforms),this.physics.add.collider(r,this.spikes),console.log("Crystal ball projectile created, total projectiles:",this.crystalBallProjectiles.length)}updateCrystalBallProjectiles(e,t){for(let i=this.crystalBallProjectiles.length-1;i>=0;i--){let s=this.crystalBallProjectiles[i];!s||!s.scene?this.crystalBallProjectiles.splice(i,1):s.update(e,t)}}handleProjectileEnemyCollision(e,t){console.log("\u{1F4A5} Crystal Ball projectile hit enemy!"),this.playSoundEffect("crystal-ball-hit-enemy",.5),t&&t.body&&(t.body.enable=!1,this.createCrystalBallDefeatEffect(t.x,t.y),this.tweens.add({targets:t,scaleX:0,scaleY:0,alpha:0,duration:300,ease:"Power2.easeOut",onComplete:()=>{t.defeat?t.defeat():t.destroy&&t.destroy()}}));let i=t.getPointValue?t.getPointValue():100;this.score+=i,this.updateScoreDisplay(),this.showPointPopup(t.x,t.y-20,i),console.log("\u{1F4A5} Enemy defeated by crystal ball, awarded",i,"points"),e.hitEnemy();let s=this.crystalBallProjectiles.indexOf(e);s>-1&&(this.crystalBallProjectiles.splice(s,1),console.log("\u{1F4A5} Projectile removed, remaining:",this.crystalBallProjectiles.length)),window.FarcadeSDK?.singlePlayer?.actions?.hapticFeedback&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}updateCrystalBallTimer(e,t){if(this.crystalBallTimerImage.setVisible(!0),console.log("Crystal ball timer update:",e,"ms remaining"),e>0){let i=e/t;if(this.crystalBallTimerMask.x=this.crystalBallTimerImage.x,this.crystalBallTimerMask.y=this.crystalBallTimerImage.y,this.crystalBallTimerMask.clear(),this.crystalBallTimerMask.fillStyle(4509863,.6),this.crystalBallTimerMask.beginPath(),this.crystalBallTimerMask.moveTo(0,0),this.crystalBallTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-i),!1),this.crystalBallTimerMask.lineTo(0,0),this.crystalBallTimerMask.closePath(),this.crystalBallTimerMask.fillPath(),e<=2e3){let s=Math.sin(Date.now()/100)*.5+.5;this.crystalBallTimerImage.setAlpha(.5+s*.5),console.log("Crystal ball timer WARNING - flashing")}else this.crystalBallTimerImage.setAlpha(1)}else this.crystalBallTimerMask.clear(),this.crystalBallTimerImage.setAlpha(1),console.log("Crystal ball timer - power-up expired, hiding timer")}updateCursedOrbTimer(e,t){if(e>0){this.cursedOrbTimerImage.setVisible(!0);let i=e/t;if(this.cursedOrbTimerMask.x=this.cursedOrbTimerImage.x,this.cursedOrbTimerMask.y=this.cursedOrbTimerImage.y,this.cursedOrbTimerMask.clear(),this.cursedOrbTimerMask.fillStyle(5768769,.7),this.cursedOrbTimerMask.beginPath(),this.cursedOrbTimerMask.moveTo(0,0),this.cursedOrbTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-i),!1),this.cursedOrbTimerMask.lineTo(0,0),this.cursedOrbTimerMask.closePath(),this.cursedOrbTimerMask.fillPath(),e<=2e3){let s=Math.sin(Date.now()/100)*.5+.5;this.cursedOrbTimerImage.setAlpha(.5+s*.5)}else this.cursedOrbTimerImage.setAlpha(1)}else this.cursedOrbTimerMask.clear(),this.cursedOrbTimerImage.setAlpha(1)}updateCursedTealOrbTimer(e,t){if(e>0){this.cursedTealOrbTimerImage.setVisible(!0);let i=e/t;if(this.cursedTealOrbTimerMask.x=this.cursedTealOrbTimerImage.x,this.cursedTealOrbTimerMask.y=this.cursedTealOrbTimerImage.y,this.cursedTealOrbTimerMask.clear(),this.cursedTealOrbTimerMask.fillStyle(4827036,.7),this.cursedTealOrbTimerMask.beginPath(),this.cursedTealOrbTimerMask.moveTo(0,0),this.cursedTealOrbTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-i),!1),this.cursedTealOrbTimerMask.lineTo(0,0),this.cursedTealOrbTimerMask.closePath(),this.cursedTealOrbTimerMask.fillPath(),e<=2e3){let s=Math.sin(Date.now()/100)*.5+.5;this.cursedTealOrbTimerImage.setAlpha(.5+s*.5)}else this.cursedTealOrbTimerImage.setAlpha(1)}else this.cursedTealOrbTimerMask.clear(),this.cursedTealOrbTimerImage.setAlpha(1)}activateInvincibility(){this.invincibilityTimer&&this.invincibilityTimer.destroy(),this.invincibilityActive=!0,this.invincibilityTimeRemaining=10,this.invincibilityWarningPlayed=!1,this.player.setSpeedMultiplier(1.5),this.invincibilityTimer=this.time.addEvent({delay:100,callback:()=>this.updateInvincibilityTimer(),loop:!0}),this.addPlayerGoldenAura(),this.startTimerSparkles(),this.enableSpikeWalking()}updateInvincibilityTimer(){if(this.invincibilityTimeRemaining-=.1,!this.invincibilityWarningPlayed&&this.invincibilityTimeRemaining<=2&&this.invincibilityTimeRemaining>0&&(this.invincibilityWarningPlayed=!0,console.log("\u23F0 Timer warning for invincibility")),this.invincibilityTimeRemaining<=0)this.invincibilityActive=!1,this.invincibilityTimeRemaining=0,this.invincibilityTimer&&(this.invincibilityTimer.destroy(),this.invincibilityTimer=null),this.invincibilityTimerMask.clear(),this.stopTimerSparkles(),this.removePlayerGoldenAura(),this.player.setSpeedMultiplier(1),this.disableSpikeWalking();else if(this.updateInvincibilityMask(),this.invincibilityTimeRemaining<=3){let e=Math.sin(this.invincibilityTimeRemaining*10)*.2+.8;this.invincibilityTimerImage.setAlpha(e)}}updateInvincibilityMask(){this.invincibilityTimerMask.x=this.invincibilityTimerImage.x,this.invincibilityTimerMask.y=this.invincibilityTimerImage.y;let e=this.invincibilityTimeRemaining/10;this.invincibilityTimerMask.clear(),this.invincibilityTimerMask.fillStyle(16766720,.6),this.invincibilityTimerMask.beginPath(),this.invincibilityTimerMask.moveTo(0,0),this.invincibilityTimerMask.arc(0,0,18,-Math.PI/2,-Math.PI/2+2*Math.PI*(1-e),!1),this.invincibilityTimerMask.lineTo(0,0),this.invincibilityTimerMask.closePath(),this.invincibilityTimerMask.fillPath()}addPlayerGoldenAura(){this.playerGoldenAura||!this.player||(this.playerGoldenAura=this.add.circle(this.player.x,this.player.y,25,16766720),this.playerGoldenAura.setAlpha(.3),this.playerGoldenAura.setDepth(this.player.depth-1),this.tweens.add({targets:this.playerGoldenAura,scaleX:1.4,scaleY:1.4,alpha:.1,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createPlayerParticleTrail())}removePlayerGoldenAura(){this.playerGoldenAura&&(this.playerGoldenAura.destroy(),this.playerGoldenAura=null),this.playerParticleTrail.forEach(e=>e.destroy()),this.playerParticleTrail=[]}startTimerSparkles(){this.invincibilityTimerSparkleTimer&&this.invincibilityTimerSparkleTimer.destroy(),this.invincibilityTimerSparkleTimer=this.time.addEvent({delay:300+Math.random()*200,callback:()=>this.createTimerSparkle(),loop:!0})}stopTimerSparkles(){this.invincibilityTimerSparkleTimer&&(this.invincibilityTimerSparkleTimer.destroy(),this.invincibilityTimerSparkleTimer=null)}createTimerSparkle(){if(!this.invincibilityTimerImage||!this.invincibilityActive)return;let e=this.invincibilityTimerImage.x,t=this.invincibilityTimerImage.y,i=e+(Math.random()-.5)*50,s=t+(Math.random()-.5)*50,r=this.add.graphics();r.fillStyle(16766720,.9),r.beginPath();for(let n=0;n<8;n++){let l=n/8*Math.PI*2,c=n%2===0?3:1.5,h=Math.cos(l)*c,d=Math.sin(l)*c;n===0?r.moveTo(h,d):r.lineTo(h,d)}r.closePath(),r.fillPath();let o=this.add.container(i,s);o.add(r),o.setDepth(103),o.setScrollFactor(0),this.tweens.add({targets:o,scaleX:2,scaleY:2,alpha:0,rotation:Math.PI,duration:600,ease:"Power2",onComplete:()=>{o.destroy()}})}createPlayerParticleTrail(){for(let e=0;e<8;e++){let t=this.add.graphics();t.setDepth(this.player.depth+1),t.fillStyle(16766720,.8),t.fillCircle(0,0,2),this.playerParticleTrail.push(t),this.animateParticle(t,e)}}animateParticle(e,t){if(!this.player||!this.invincibilityActive){e.destroy();return}let i=Math.PI*2/8*t+this.time.now*.003,s=20+Math.sin(this.time.now*.005+t)*5;e.setPosition(this.player.x+Math.cos(i)*s,this.player.y+Math.sin(i)*s),this.invincibilityActive&&this.time.delayedCall(50,()=>this.animateParticle(e,t))}enableSpikeWalking(){this.playerSpikeOverlap&&(this.playerSpikeOverlap.active=!1),this.playerSpikeCollider=this.physics.add.collider(this.player,this.spikes,void 0,(e,t)=>t.getData("isFloorSpike"),this)}disableSpikeWalking(){this.playerSpikeCollider&&(this.physics.world.removeCollider(this.playerSpikeCollider),this.playerSpikeCollider=null),this.playerSpikeOverlap&&(this.playerSpikeOverlap.active=!0)}shouldCollideWithPlatform(){return!this.player.getIsClimbing()}handlePlayerCatInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t,r=i.body,o=s.body,n=r.velocity.y>0,l=r.bottom<=o.top+5;n&&l?(this.justKilledCat=!0,this.handleCatKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.justKilledCat||this.handlePlayerDamage(i,s)}handlePlayerBaseBluInteraction(e,t){if(this.isGameOver)return;let i=e,s=t,r=i.body,o=s.body;if(this.invincibilityActive&&s.canBeKilledByInvinciblePlayer()){let c=s.handleInvinciblePlayerKill();this.score+=c,this.updateScoreDisplay(),this.showPointPopup(s.x,s.y-20,c),this.gameStats.enemyKills.blu++,this.gameStats.totalEnemiesDefeated++,this.playSoundEffect("squish-baseblu",.5),r.setVelocityY(b.game.jumpVelocity*.5),this.baseBlus.remove(s);return}let n=r.velocity.y>0,l=r.bottom<=o.top+10;if(n&&l)s.handlePlayerBounce(),s.startStun(),r.setVelocityY(b.game.jumpVelocity*.7);else{s.startStun();let c=r.x<o.x?-1:1;r.setVelocityX(c*100)}}handlePlayerBeetleInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t,r=i.body,o=s.body,n=r.velocity.y>0,l=r.y+r.height/2,d=o.y+o.height/2-l>5||r.bottom<=o.top+12;if(n&&d){this.justKilledCat=!0,this.handleBeetleKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1});return}this.invincibilityActive?(this.justKilledCat=!0,this.handleBeetleKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.handlePlayerDamage(i,s)}handlePlayerStalkerCatInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t;if(!s.canDamagePlayer())return;let r=i.body,o=s.body,n=r.velocity.y>0,l=r.bottom<=o.top+5;n&&l?(this.justKilledCat=!0,this.handleStalkerCatKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.justKilledCat||this.handlePlayerDamage(i,s)}handlePlayerSpikeCollision(e,t){if(this.isGameOver||this.invincibilityActive)return;let i=e,s=i.body,r=t;if(r.getData("isCeilingSpike")){if(s.velocity.y<-50){let n=r.getData("graphics");n&&this.tweens.add({targets:n,x:n.x+2,duration:50,yoyo:!0,repeat:3,onComplete:()=>{n.x=r.getData("x")-b.game.tileSize/2}}),this.handlePlayerDamage(i)}}else if(r.getData("isFloorSpike")){let l=r.getData("visualSpikeHeight"),c=r.getData("visualSpikeBaseY");s.velocity.y>50&&this.handlePlayerDamage(i)}else s.velocity.y>50&&this.handlePlayerDamage(i)}handleCatKill(e,t){if(t.isSquished)return;let i=t.getCatColor();if(e.getIsClimbing()){let h;switch(i){case"yellow":h="caterpillar";break;case"blue_caterpillar":h="blue_caterpillar";break;case"blue":h="chomper";break;case"purple":h="chomper";break;case"red":h="snail";break;case"green":h="jumper";break;default:h="chomper";break}let d=I.getPointValue(h);this.score+=d,this.updateScoreDisplay(),e.setVelocityY(b.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,d);return}let s;switch(i){case"yellow":s="caterpillar";break;case"blue_caterpillar":s="blue_caterpillar";break;case"blue":s="chomper";break;case"red":s="snail";break;case"green":s="jumper";break;default:s="chomper";break}let r=I.getPointValue(s),o=Math.max(1,this.comboCount),n=r*o;this.score+=n,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(b.game.jumpVelocity*.7);let l=this.getEnemyTypeName(t);l!=="unknown"&&l in this.gameStats.enemyKills?(this.gameStats.enemyKills[l]++,this.gameStats.totalEnemiesDefeated++,console.log(`\u2705 Kill tracked: ${l} | Total ${l}: ${this.gameStats.enemyKills[l]} | Total enemies: ${this.gameStats.totalEnemiesDefeated}`)):console.error(`\u274C Kill NOT tracked! Enemy type: ${l}`);let c="squish-chomper";switch(i){case"yellow":c="squish-caterpillar";break;case"blue_caterpillar":c="squish-baseblu";break;case"blue":case"purple":c="squish-chomper";break;case"red":c="squish-snail";break;case"green":c="squish-jumper";break}this.playSoundEffect(c,.5),t.squish(),this.showPointPopup(t.x,t.y-20,n)}handleBeetleKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){let o=I.getPointValue("beetle");this.score+=o,this.updateScoreDisplay(),e.setVelocityY(b.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,o);return}let i=I.getPointValue("beetle"),s=Math.max(1,this.comboCount),r=i*s;this.score+=r,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(b.game.jumpVelocity*.7),this.gameStats.enemyKills.rollz++,this.gameStats.totalEnemiesDefeated++,this.playSoundEffect("squish-beetle",.5),t.squish(),this.showPointPopup(t.x,t.y-20,r)}handlePlayerRexInteraction(e,t){if(this.isGameOver||this.justKilledCat)return;let i=e,s=t,r=i.body,o=s.body,n=r.velocity.y>0,c=o.top-r.bottom>5||r.bottom<=o.top+12;if(n&&c){this.justKilledCat=!0,this.handleRexKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1});return}this.invincibilityActive?(this.justKilledCat=!0,this.handleRexKill(i,s),this.time.delayedCall(100,()=>{this.justKilledCat=!1})):this.handlePlayerDamage(i,s)}handleRexKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){this.score+=500,this.updateScoreDisplay(),e.setVelocityY(b.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,500);return}let i=500,s=Math.max(1,this.comboCount),r=i*s;this.score+=r,this.updateScoreDisplay(),this.comboCount++,this.comboText&&(this.comboCount>1?(this.comboText.setText(`COMBO x${this.comboCount}`),this.comboText.setVisible(!0)):this.comboText.setVisible(!1)),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(this.COMBO_WINDOW,()=>{this.comboCount=0,this.comboText&&this.comboText.setVisible(!1)}),e.setVelocityY(b.game.jumpVelocity*.7),this.gameStats.enemyKills.rex++,this.gameStats.totalEnemiesDefeated++,this.playSoundEffect("squish-rex",.5),t.squish(),this.showPointPopup(t.x,t.y-20,r)}handleInvincibilityEnemyKill(e,t){if(t.isSquished)return;let i=200;if(t.constructor.name==="Beetle")i=75;else if(t.constructor.name==="Cat"){let o=t.getCatColor(),n;switch(o){case"yellow":n="caterpillar";break;case"blue_caterpillar":n="blue_caterpillar";break;case"blue":n="chomper";break;case"red":n=t.isStalker?"stalker":"snail";break;case"green":n="jumper";break;default:n="chomper";break}i=I.getPointValue(n)}let s=i*3;this.score+=s,this.updateScoreDisplay(),e.setVelocityY(b.game.jumpVelocity*.5);let r="squish-chomper";if(t.constructor.name==="Beetle")r="squish-beetle";else if(t.constructor.name==="Cat")switch(t.getCatColor()){case"yellow":r="squish-caterpillar";break;case"blue_caterpillar":r="squish-baseblu";break;case"blue":r="squish-chomper";break;case"red":r=t.isStalker?"squish-stalker":"squish-snail";break;case"green":r="squish-jumper";break}this.playSoundEffect(r,.5),t.squish(),this.showInvincibilityPointPopup(t.x,t.y-20,s)}handleStalkerCatKill(e,t){if(t.isSquished)return;if(e.getIsClimbing()){this.score+=200,this.updateScoreDisplay(),e.setVelocityY(b.game.jumpVelocity*.7),t.squish(),this.showPointPopup(t.x,t.y-20,200);return}let i=200,s=Math.max(1,this.comboCount),r=i*s;this.score+=r,this.updateScoreDisplay(),this.comboCount++,this.updateComboDisplay(),this.comboTimer&&this.comboTimer.destroy(),this.comboTimer=this.time.delayedCall(1e3,()=>{this.resetCombo()}),e.setVelocityY(b.game.jumpVelocity*.7),this.playSoundEffect("squish-stalker",.5),t.squish(),this.showPointPopup(t.x,t.y-20,r)}updateScoreDisplay(){let e=this.accumulatedScore+this.score;this.scoreText.setText(`${e}`)}updateComboDisplay(){this.comboCount>1&&(this.comboText.setText(`COMBO x${this.comboCount}!`),this.comboText.setVisible(!0),this.tweens.add({targets:this.comboText,scaleX:1.2,scaleY:1.2,duration:100,ease:"Power2",yoyo:!0}))}resetCombo(){this.comboCount=0,this.comboText.setVisible(!1),this.comboTimer&&(this.comboTimer.destroy(),this.comboTimer=null)}createDebugGridlines(){let e=this.add.graphics();e.lineStyle(1,65280,.3),e.setDepth(9999),e.setScrollFactor(1);let t=b.game.tileSize,i=b.canvas.height,s=b.game.floorSpacing||t*5,r=i-t;e.lineStyle(2,16711680,.5),e.beginPath(),e.moveTo(-1e3,r),e.lineTo(2e3,r),e.stroke();let o=this.add.text(10,r-20,`Ground Floor (Y=${r})`,{fontSize:"12px",color:"#ff0000",backgroundColor:"#000000"});o.setDepth(1e4),o.setScrollFactor(1);for(let n=1;n<=10;n++){let l=r-n*s;e.lineStyle(1,65535,.4),e.beginPath(),e.moveTo(-1e3,l),e.lineTo(2e3,l),e.stroke();let c=this.add.text(10,l-15,`Floor ${n} (Y=${l})`,{fontSize:"10px",color:"#00ffff",backgroundColor:"#000000"});c.setDepth(1e4),c.setScrollFactor(1)}e.lineStyle(1,65280,.2);for(let n=0;n<2e3;n+=t)e.beginPath(),e.moveTo(-1e3,n),e.lineTo(2e3,n),e.stroke();for(let n=-t;n>-2e3;n-=t)e.beginPath(),e.moveTo(-1e3,n),e.lineTo(2e3,n),e.stroke();console.log("\u{1F4CF} Debug Gridlines Created:",{groundFloor:r,floorSpacing:s,tileSize:t,canvasHeight:i,floor1Y:r-s,floor2Y:r-2*s,floor3Y:r-3*s})}createVisibilitySystem(){this.visibilityMask=this.add.image(0,0,"visibilityOverlay"),this.visibilityMask.setDepth(98),this.visibilityMask.setOrigin(.5,.5)}updateVisibilitySystem(){if(!this.visibilityMask)return;let t=this.levelManager.getCurrentLevel()%10===9;this.visibilityMask.setVisible(t);let i=this.player.x,s=this.player.y,r=i,o=s-192;this.visibilityMask.setPosition(r,o)}showPointPopup(e,t,i){let s=this.add.text(e,t,`+${i}`,{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(150);this.tweens.add({targets:s,alpha:0,duration:1200,ease:"Power1.easeOut",onComplete:()=>{s.destroy()}})}createCrystalBallDefeatEffect(e,t){for(let i=0;i<6;i++){let s=this.add.graphics();s.fillStyle(4509863,1),s.fillCircle(0,0,2);let r=i/6*Math.PI*2;s.x=e,s.y=t,s.setDepth(25);let o=15+Math.random()*10;this.tweens.add({targets:s,x:e+Math.cos(r)*o,y:t+Math.sin(r)*o,alpha:0,duration:400,ease:"Power2.easeOut",onComplete:()=>s.destroy()})}}createPortalSuckAnimation(e,t,i){let s=this.add.graphics();s.setDepth(25);let r=3,o=[];for(let l=0;l<r;l++){let c=this.add.graphics();c.setDepth(24+l),o.push(c);let h=l*120*Math.PI/180;c.lineStyle(2,10053375,.8),this.tweens.add({targets:c,rotation:h+Math.PI*4,scaleX:{from:2,to:0},scaleY:{from:2,to:0},alpha:{from:.8,to:0},duration:800,ease:"Power2.easeIn",onUpdate:()=>{c.clear(),c.lineStyle(3,10053375,c.alpha);let d=[],p=3,u=15*c.scaleX;c.x=e,c.y=t;for(let m=0;m<p*Math.PI*2;m+=.1){let y=m/(p*Math.PI*2)*u,g=Math.cos(m+c.rotation)*y,f=Math.sin(m+c.rotation)*y;d.push({x:g,y:f})}if(d.length>1){c.beginPath(),c.moveTo(d[0].x,d[0].y);for(let m=1;m<d.length;m++)c.lineTo(d[m].x,d[m].y);c.strokePath()}},onComplete:()=>{c.destroy()}})}let n=this.add.graphics();n.setDepth(26),n.fillStyle(4509863,.6),n.fillCircle(e,t,5),this.tweens.add({targets:n,scaleX:{from:0,to:3,duration:400},scaleY:{from:0,to:3,duration:400},yoyo:!0,ease:"Power2.easeInOut",onComplete:()=>{n.destroy(),s.destroy(),i&&i()}})}showInvincibilityPointPopup(e,t,i){let s=this.add.text(e,t,`+${i}`,{fontSize:"18px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(150);this.tweens.add({targets:s,alpha:0,y:t-30,scaleX:1.5,scaleY:1.5,duration:1500,ease:"Power2.easeOut",onComplete:()=>{s.destroy()}})}handlePlayerDamage(e,t){if(this.isGameOver)return;if(this.invincibilityActive){t&&t.squish&&this.handleInvincibilityEnemyKill(e,t);return}this.playSoundEffect("player-dies-enemy",.5),this.resetCombo(),e.getCrystalBallActive&&e.getCrystalBallActive()&&(console.log("\u{1F52E} Player died - shutting off Crystal Ball power-up"),e.stopCrystalBallParticles&&e.stopCrystalBallParticles(),this.updateCrystalBallTimer(0,2e4));let i=this.lives;this.lives--,this.gameStats.livesLost++,this.game.registry.set("playerLives",this.lives),this.updateLivesDisplay(),console.log(`\u{1F494} Player died! Lives: ${i} -> ${this.lives}`),this.triggerFarcadeHapticFeedback(),e.setVelocity(0,0),e.setTint(16711680),e.body.enable=!1,this.lives>0?this.showLostLifePopup():(this.isGameOver=!0,this.showGameOverScreen())}handleLadderOverlap(e,t){let i=e;if(i.checkLadderProximity(t)&&(i.getIsClimbing()||i.startClimbing(t)),i.getIsClimbing()){let s=t,r=s.y-s.height/2,o=s.y+s.height/2;(i.y<r-32||i.y>o+8)&&i.exitClimbing()}}updateTreasureChestInteraction(){for(let e=this.treasureChests.length-1;e>=0;e--){let t=this.treasureChests[e];if(!t.canInteract())continue;if(Phaser.Math.Distance.Between(this.player.x,this.player.y,t.sprite.x,t.sprite.y)<32&&this.player.body.blocked.down){this.openTreasureChest(t);break}}}updateDoorPrompt(){if(!this.door||!this.player||!this.player.body)return;let t=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).floorCount-1,s=this.player.body.blocked?.down||!1,o=Phaser.Math.Distance.Between(this.player.x,this.player.y,this.door.x,this.door.y)<80,n=this.currentFloor===t;o&&n&&s?(this.door.showPrompt(this.player),(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP).isDown||this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown||this.touchControls?.upPressed)&&!this.isLevelComplete&&this.completeLevel()):this.door.hidePrompt()}openTreasureChest(e){if(this.isLevelStarting)return;let t=e.open();this.playSoundEffect("treasure-chest-open",.5),this.gameStats.treasureChestsOpened++,this.score+=2500,this.updateScoreDisplay(),this.showPointPopup(e.sprite.x,e.sprite.y-30,2500),this.triggerFarcadeHapticFeedback(),this.spawnTreasureChestContents(e.sprite.x,e.sprite.y,t),this.tweens.add({targets:e.sprite,alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{let i=this.treasureChests.indexOf(e);i>-1&&this.treasureChests.splice(i,1),e.destroy()}})}spawnTreasureChestContents(e,t,i){let s=[{x:e-60,y:t},{x:e+60,y:t},{x:e-45,y:t},{x:e+45,y:t},{x:e-30,y:t},{x:e+30,y:t},{x:e-15,y:t},{x:e+15,y:t},{x:e,y:t-30},{x:e,y:t+15}],r=0;for(let o=0;o<i.coins&&!(r>=s.length);o++){let n=s[r++],l=new $(this,n.x,n.y);this.coins.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleCoinCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.3,scaleY:1.3,duration:300,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<i.blueCoins&&!(r>=s.length);o++){let n=s[r++],l=new J(this,n.x,n.y);this.blueCoins.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleBlueCoinCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.4,scaleY:1.4,duration:400,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<i.diamonds&&!(r>=s.length);o++){let n=s[r++],l=new _(this,n.x,n.y);this.diamonds.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleDiamondCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.5,scaleY:1.5,duration:500,ease:"Back.easeOut",yoyo:!0})}for(let o=0;o<i.freeLifs&&!(r>=s.length);o++){let n=s[r++],l=new Z(this,n.x,n.y);this.freeLifes.push(l),this.physics.add.overlap(this.player,l.sprite,()=>this.handleFreeLifeCollection(l),void 0,this),this.tweens.add({targets:l.sprite,scaleX:1.5,scaleY:1.5,duration:500,ease:"Back.easeOut",yoyo:!0})}}playSoundEffect(e,t=.5){if(this.registry.get("sfxEnabled")!==!1)if(this.sound.context&&this.sound.context.state==="suspended")console.log("\u{1F507} Audio context suspended, trying to resume for sound:",e),this.sound.context.resume().then(()=>{try{this.sound.play(e,{volume:t})}catch(s){console.warn("\u26A0\uFE0F Failed to play sound effect:",e,s)}}).catch(s=>{console.error("\u274C Failed to resume audio context for sound:",e,s)});else try{this.sound.play(e,{volume:t})}catch(s){console.warn("\u26A0\uFE0F Failed to play sound effect:",e,s)}}update(e,t){if(this.isGameOver||!this.touchControls||!this.player||!this.player.body||!this.cats||!this.stalkerCats||!this.baseBlus||!this.beetles||!this.ladders)return;this.updateBackgroundPosition(),this.touchControls.update(),this.updateTreasureChestInteraction(),this.updateDoorPrompt(),this.player.update(e,t),this.updateCrystalBallProjectiles(e,t),this.playerGoldenAura&&this.invincibilityActive&&this.playerGoldenAura.setPosition(this.player.x,this.player.y),this.updateVisibilitySystem(),this.cats&&this.cats.children&&(this.cats.children.entries.forEach(l=>{l.update(this.time.now,this.game.loop.delta)}),this.checkAndReplaceStuckChompers()),this.stalkerCats&&this.stalkerCats.children&&this.stalkerCats.children.entries.forEach(l=>{l.update(this.time.now,this.game.loop.delta)}),this.baseBlus&&this.baseBlus.children&&this.baseBlus.children.entries.forEach(l=>{l.update(this.time.now,this.game.loop.delta)}),this.beetles&&this.beetles.children&&this.beetles.children.entries.forEach(l=>{l.update(e,t)}),this.rexEnemies&&this.rexEnemies.children&&this.rexEnemies.children.entries.forEach(l=>{l.update(e,t)});let i=!1;this.ladders&&this.ladders.children&&this.ladders.children.entries.forEach(l=>{this.physics.world.overlap(this.player,l)&&(i=!0)}),i||this.player.clearNearbyLadder(),this.player.getIsClimbing()&&!i&&this.player.exitClimbing();let s=b.game.tileSize,r=b.game.floorSpacing||s*5,o=Math.max(0,Math.floor((b.canvas.height-this.player.y-s/2)/r));o!==this.currentFloor&&(this.currentFloor=o,this.gameStats.highestFloor=Math.max(this.gameStats.highestFloor,o)),this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).isEndless&&this.currentFloor>=this.highestFloorGenerated-3&&this.generateNextFloors()}generateNextFloors(){let e=b.game.tileSize,t=b.game.floorWidth,i=b.game.floorSpacing||e*5,s=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()),r=s.isEndless?999:s.floorCount,o;s.isEndless?o=5:o=Math.min(5,Math.max(0,s.floorCount-1-this.highestFloorGenerated));for(let n=0;n<o;n++){let l=this.highestFloorGenerated+n+1,c=b.canvas.height-e/2-l*i,h=Math.random()>.3,d;if(h){let f=Math.floor(Math.random()*(t-5))+2,v=Math.floor(Math.random()*2)+2;d={gapStart:f,gapSize:v};for(let S=0;S<t;S++)(S<f||S>=f+v)&&this.createPlatformTile(S*e+e/2,c);this.levelManager.isBonusLevel()||this.createSpikesInGap(f,v,c,e)}else{d={gapStart:-1,gapSize:0};for(let f=0;f<t;f++)this.createPlatformTile(f*e+e/2,c)}this.floorLayouts[l]=d;let p=!s.isEndless&&l>=s.floorCount-1;if(l>0&&this.floorLayouts[l-1]&&!p){let f=this.floorLayouts[l-1],v=[];for(let S=1;S<t-1;S++)this.hasPlatformAt(f,S)&&this.hasPlatformAt(d,S)&&v.push(S);if(v.length>0){let S=v[Math.floor(Math.random()*v.length)],x=-(l-1)*i+b.canvas.height-e,P=-l*i+b.canvas.height-e;this.createContinuousLadder(S*e,x,P),this.storeLadderPositions(l-1,[S])}}let u=c-e-8,m=[];for(let f=1;f<t-1;f++)this.hasPlatformAt(d,f)&&m.push(f);if(m.length>0){let f=s.collectibleTypes,v=[];if(f.includes("coin")&&l>0){let S=Math.floor(Math.random()*3)+2;this.placeCollectiblesOfType(m,S,"coin",u,l,v)}if(f.includes("blueCoin")&&l>0&&Math.random()<.2&&this.placeCollectiblesOfType(m,1,"blueCoin",u,l,v),f.includes("diamond")&&l>1&&Math.random()<.08&&this.placeCollectiblesOfType(m,1,"diamond",u,l,v),f.includes("treasureChest")&&l>=3){let S=this.levelManager.getCurrentLevel();this.shouldSpawnChestOnFloor(S,l)&&this.placeCollectiblesOfType(m,1,"treasureChest",u,l,v)}}let y=s.enemyTypes,g=[];if(y.includes("blue")&&g.push("blue"),y.includes("yellow")&&g.push("yellow"),y.includes("green")&&g.push("green"),y.includes("red")&&g.push("red"),g.length>0&&l>1&&Math.random()>.5){let f=g[Math.floor(Math.random()*g.length)];if(d.gapStart===-1){let S=c-e/2-15,x=new H(this,t/2*e,S,e*1.5,e*(t-1.5),f);this.cats.add(x),enemiesCreated++}else if(d.gapStart>3){let S=c-e/2-15,x=new H(this,d.gapStart/2*e,S,e*.5,e*(d.gapStart-.5),f);x.getCatColor()==="green"&&(x.platformBounds={left:e*.5,right:e*(d.gapStart-.5)}),this.cats.add(x),enemiesCreated++}}}this.highestFloorGenerated+=o}waitForAssetsAndStartIntro(e,t){let i=()=>{let s=this.registry.get("assetsReady"),r=this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot"),o=this.textures.exists("playerRunLeftFoot")&&this.textures.exists("playerRunRightFoot");s&&r&&o?this.startLevelIntro(e,t):this.time.delayedCall(100,i)};i()}startLevelIntro(e,t){this.isLevelStarting=!0;let i=b.game.tileSize,s=i/2,r=b.canvas.height-i/2,o=b.canvas.height-i,n=o;console.log("\u{1F3AC} Level Intro Start:",{targetX:e,targetY:t,originalTargetY:t,canvasHeight:b.canvas.height,groundFloorY:o,platformTop:n,floorY:r,playerPhysicsHeight:30,playerShouldEndAt:n-15}),t=n-29,console.log("\u{1F3AF} Adjusted Target:",{originalTargetY:arguments[1],adjustedTargetY:t,platformTop:n,willStandAt:t+15});let l=b.canvas.height+80,c=150,h=n-5,d=h+c/2,p=c,u=h;if(console.log("\u{1F3A8} Intro Ladder Visual Alignment:",{visualTopEdge:d-p/2,visualBottomEdge:d+p/2,visualCenter:d,visualHeight:p,groundFloorY:n,shiftedUp:5}),console.log("\u{1FA9C} Intro Ladder Setup:",{ladderTop:Math.round(u),ladderBottom:Math.round(l),visualHeight:Math.round(p),visualCenterY:Math.round(d),targetY:Math.round(t),platformTop:n,matchesGameplay:!0}),b.debug){let g=this.add.circle(e,t,5,16711680,.8);g.setDepth(1e4);let f=this.add.rectangle(360,n,720,2,65280,.8);f.setDepth(1e4);let v=this.add.circle(s,u,4,255,.8),S=this.add.circle(s,l,4,255,.8);v.setDepth(10001),S.setDepth(10001),this.add.text(e+10,t-5,`Target: ${Math.round(t)}`,{fontSize:"10px",color:"#ff0000",backgroundColor:"#000000"}).setDepth(10002),this.time.delayedCall(5e3,()=>{g.destroy(),f.destroy(),v.destroy(),S.destroy()})}let m;if(this.textures.exists("tealLadder"))m=this.add.image(s,d,"tealLadder"),m.setDisplaySize(m.width*(p/m.height),p),m.setDepth(5),console.log("\u{1F5BC}\uFE0F Ladder Sprite Positioned:",{x:s,y:d,displayHeight:p,topEdge:d-p/2});else{m=this.add.graphics();let g=d-p/2,f=d+p/2;m.fillStyle(4251856,1),m.fillRect(s-2,g,4,p),m.fillRect(s-13,g+4,26,4),m.fillRect(s-13,f-4,26,4);let v=Math.floor(p/32);for(let S=1;S<v;S++){let x=g+S*(p/(v+1));m.fillRect(s-13,x,26,3)}m.setDepth(5)}let y=b.canvas.height+60;this.player.x=s,this.player.y=y,this.player.body&&(this.player.body.enable=!1,console.log("\u26A0\uFE0F Physics disabled for intro animation")),console.log("\u{1F3AD} Player Intro Position:",{playerStartY:y,ladderBottom:l,ladderTop:u,visualHeight:p,targetY:t,willClimbTo:t,physicsEnabled:this.player.body?.enable||!1}),this.textures.exists("playerClimbLeftFoot")?this.player.setTexture("playerClimbLeftFoot"):this.player.setTexture("playerIdleEye1"),this.player.setDisplaySize(48,64),this.animatePlayerClimbing(s,t,()=>{console.log("\u{1F3AF} Starting bounce animation at Y:",Math.round(this.player.y)),this.animatePlayerBouncing(e,t,()=>{console.log("\u2705 Intro animation complete! Player at:",{x:Math.round(this.player.x),y:Math.round(this.player.y),targetY:Math.round(t),aboutToEnablePhysics:!0}),this.player.setPosition(e,t),this.player.body.reset(e,t),this.player.body.enable=!0,this.isLevelStarting=!1,console.log("\u26A1 Physics re-enabled! Player now at:",{x:Math.round(this.player.x),y:Math.round(this.player.y),bodyY:Math.round(this.player.body.y),bodyBottom:Math.round(this.player.body.bottom),bodyOffset:{x:this.player.body.offset.x,y:this.player.body.offset.y},velocity:this.player.body.velocity,gravity:this.physics.world.gravity,shouldBeStandingAt:n}),this.game.registry.set("levelProgression",!1),this.notifyFarcadeGameReady(),this.tweens.add({targets:m,alpha:0,duration:500,onComplete:()=>{m.destroy()}}),this.showStartBanner()})})}animatePlayerClimbing(e,t,i){console.log("\u{1F9D7} Climbing Animation Start:",{currentY:Math.round(this.player.y),targetY:Math.round(t),distanceToClimb:Math.round(this.player.y-t)}),this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot")||console.warn("\u26A0\uFE0F Climb sprites not loaded! Using fallback animation");let r=0,o=80,l=this.time.addEvent({delay:120,callback:()=>{this.textures.exists("playerClimbLeftFoot")&&this.textures.exists("playerClimbRightFoot")&&(r%2===0?this.player.setTexture("playerClimbLeftFoot"):this.player.setTexture("playerClimbRightFoot"),this.player.setDisplaySize(48,64)),r++},loop:!0});this.tweens.add({targets:this.player,y:t,duration:2e3,ease:"Linear",onUpdate:c=>{},onComplete:()=>{l.destroy(),i()}})}animatePlayerBouncing(e,t,i){console.log("\u{1F3C0} Bounce Animation Start:",{currentPos:{x:Math.round(this.player.x),y:Math.round(this.player.y)},targetPos:{x:Math.round(e),y:Math.round(t)}}),this.player.setFlipX(!1);let s=this.textures.exists("playerJumpRightFoot")?"playerJumpRightFoot":"playerIdleEye1";this.player.setTexture(s),this.tweens.add({targets:this.player,x:e,duration:800,ease:"Power2.easeOut",onComplete:()=>{this.changePlayerTexture("playerIdleEye1"),this.time.delayedCall(300,()=>{this.player.onBubbleTrigger&&this.player.onBubbleTrigger()}),i()}}),this.tweens.add({targets:this.player,y:t-25,duration:200,ease:"Power2.easeOut",yoyo:!0,repeat:1,onComplete:()=>{this.player.y=t}})}showStartBanner(){let e=this.levelManager.getCurrentLevel(),t=this.levelManager.getLevelConfig(e),i=e%10===9,s=this.levelManager.isBonusLevel(),r=s?"BONUS LEVEL!":t.isEndless?"ENDLESS MODE!":`LEVEL ${e}`,o=this.add.text(b.canvas.width/2,b.canvas.height/2-(i&&!s?120:100),r,{fontSize:"28px",color:s?"#00ff00":"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0),n=null;i&&!t.isEndless&&!s&&(n=this.add.text(b.canvas.width/2,b.canvas.height/2-85,"DARK MODE!",{fontSize:"18px",color:"#9932cc",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0));let l=this.add.text(b.canvas.width/2,b.canvas.height/2-50,"GO!",{fontSize:"36px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0).setAlpha(0);this.time.delayedCall(500,()=>{this.tweens.add({targets:l,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{o.destroy(),l.destroy(),n&&n.destroy()}})})}showEndlessModePopup(){let e=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,350,200,2894892,.95).setDepth(250).setScrollFactor(0),t=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,354,204,16777215).setDepth(249).setScrollFactor(0);t.setStrokeStyle(3,16777215),t.setFillStyle();let i=this.add.text(b.canvas.width/2,b.canvas.height/2-50,"ENDLESS MODE UNLOCKED!",{fontSize:"24px",color:"#ff44ff",fontFamily:"Arial Black",fontStyle:"bold",align:"center"}).setOrigin(.5).setDepth(251).setScrollFactor(0),s=this.add.text(b.canvas.width/2,b.canvas.height/2+10,`No more levels!
Climb as high as you can!
Difficulty has plateaued.`,{fontSize:"16px",color:"#ffffff",fontFamily:"Arial",align:"center"}).setOrigin(.5).setDepth(251).setScrollFactor(0);this.time.delayedCall(3e3,()=>{e.destroy(),t.destroy(),i.destroy(),s.destroy()})}createLevelEndDoor(){let e=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel());if(!e.isEndless&&e.floorCount>0){let t=b.game.tileSize,i=b.game.floorSpacing||t*5,s=e.floorCount-1,r=b.canvas.height-t/2-s*i,o=this.findSafeDoorPosition(s),l=r-t/2-50,c=this.levelManager.getCurrentLevel()===1;this.door=new ge(this,o,l,c),this.storeDoorPosition(s,Math.floor(o/t)),this.physics.add.overlap(this.player,this.door,this.handleDoorOverlap,void 0,this)}}findSafeDoorPosition(e){let t=b.game.tileSize,i=b.game.floorWidth,s=this.floorLayouts[e],r=3,o=this.ladderPositions.get(e)||[],n=[];for(let c=2;c<i-2-r;c++){let h=!0;for(let d=0;d<r;d++)if(!this.hasPlatformAt(s,c+d)){h=!1;break}if(h){for(let d of o)if(Math.abs(c-d)<4){h=!1;break}}h&&n.push(c)}let l;if(n.length>0){let c=Math.floor(i/2);l=n.reduce((h,d)=>Math.abs(d-c)<Math.abs(h-c)?d:h)}else l=Math.floor(i/2)-Math.floor(r/2);return(l+r/2)*t}storeDoorPosition(e,t){this.doorPositions||(this.doorPositions=new Map),this.doorPositions.set(e,t)}handleDoorOverlap(e,t){let i=t,s=e,o=this.levelManager.getLevelConfig(this.levelManager.getCurrentLevel()).floorCount-1,l=s.body.blocked.down;this.currentFloor===o&&l?(i.showPrompt(s),(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP).isDown||this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown||this.touchControls?.upPressed)&&!this.isLevelComplete&&this.completeLevel()):i.hidePrompt()}completeLevel(){this.isLevelComplete||(this.isLevelComplete=!0,this.playSoundEffect("door-open",.5),this.player.body.enable=!1,this.showLevelCompleteScreen())}showLevelCompleteScreen(){let e=this.levelManager.getCurrentLevel();this.triggerFarcadeHapticFeedback();let t=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,b.canvas.width,b.canvas.height,0,.7).setDepth(299).setScrollFactor(0),i=this.add.graphics();i.fillStyle(4854924,1),i.lineStyle(2,8069026,1),i.fillRoundedRect(b.canvas.width/2-175,b.canvas.height/2-140,350,280,12),i.strokeRoundedRect(b.canvas.width/2-175,b.canvas.height/2-140,350,280,12),i.setDepth(300).setScrollFactor(0);let s=this.add.text(b.canvas.width/2,b.canvas.height/2-95,`LEVEL ${e}
COMPLETE!`,{fontSize:"22px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),r=this.add.text(b.canvas.width/2,b.canvas.height/2-10,`Score: ${this.accumulatedScore+this.score}
Floors Climbed: ${this.currentFloor}`,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),o=this.levelManager.shouldHaveBonusAfter(e),n=this.levelManager.isBonusLevel(),l="";if(o&&!n)l="Next: BONUS LEVEL!";else if(n)l=`Next: Level ${e+1}`;else{let p=e+1;l=this.levelManager.getLevelConfig(p).isEndless?"Next: BEAST MODE!":`Next: Level ${p}`}let c=this.add.text(b.canvas.width/2,b.canvas.height/2+50,l,{fontSize:"12px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0),h=this.add.rectangle(b.canvas.width/2,b.canvas.height/2+100,150,40,2142890).setDepth(301).setScrollFactor(0);h.setInteractive({useHandCursor:!0}),h.setStrokeStyle(2,1608322);let d=this.add.text(b.canvas.width/2,b.canvas.height/2+100,"CONTINUE",{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(302).setScrollFactor(0);h.on("pointerdown",()=>{this.playSoundEffect("continue-button",.5);let p=this.game.registry;p.set("levelProgression",!0);let u=this.accumulatedScore+this.score;p.set("accumulatedScore",u),p.set("totalCoins",this.totalCoinsCollected),p.set("totalGems",this.totalGemsCollected),p.set("totalBlueGems",this.totalBlueGemsCollected),p.set("totalDiamonds",this.totalDiamondsCollected),p.set("livesEarned",this.livesEarned),p.set("accumulatedCoins",this.totalCoinsCollected),p.set("accumulatedGems",this.totalGemsCollected),p.set("accumulatedBlueGems",this.totalBlueGemsCollected),p.set("accumulatedDiamonds",this.totalDiamondsCollected);let m=this.levelManager.isBonusLevel(),y=this.levelManager.getCurrentLevel(),g=!m&&this.levelManager.shouldHaveBonusAfter(y),f=this.levelManager.nextLevel(),v=this.levelManager.isBonusLevel();if(console.log(`\u{1F4CA} Level transition: ${y} -> ${f} (Bonus: ${v})`),console.log(`\u{1F49A} Current lives: ${this.lives}, Gems: ${this.totalCoinsCollected}`),p.set("currentLevel",f),this.backgroundManager.isChapterTransition(f,v)){let S=this.backgroundManager.getChapterForLevel(f,v);this.backgroundManager.loadChapterBackgrounds(S).then(()=>{let x=this.backgroundManager.getChapterForLevel(f-1,!1);this.backgroundManager.unloadChapterBackgrounds(x)})}f===51?this.showBeastModeNotification(()=>{p.set("isReplay",!0),this.scene.restart()}):m&&!v&&f>1?(console.log("\u{1F4CD} Transitioning from bonus to chapter, showing splash for level",f),p.set("showChapterSplash",!0),p.set("chapterSplashLevel",f),p.set("isReplay",!0),this.scene.restart()):(p.set("isReplay",!0),this.scene.restart())})}showChapterTransition(e,t){let i=this.backgroundManager.getChapterName(e),s=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,b.canvas.width,b.canvas.height,0,.7).setDepth(299).setScrollFactor(0),r=this.add.graphics();r.fillStyle(4854924,1),r.lineStyle(2,8069026,1),r.fillRoundedRect(b.canvas.width/2-150,b.canvas.height/2-60,300,120,12),r.strokeRoundedRect(b.canvas.width/2-150,b.canvas.height/2-60,300,120,12),r.setDepth(300).setScrollFactor(0);let o=this.add.text(b.canvas.width/2,b.canvas.height/2-20,"ENTERING",{fontSize:"14px",color:"#FFD700",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(301).setScrollFactor(0),n=this.add.text(b.canvas.width/2,b.canvas.height/2+10,i.toUpperCase(),{fontSize:"16px",color:"#9ACF07",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(301).setScrollFactor(0);s.setAlpha(0),r.setAlpha(0),o.setAlpha(0),n.setAlpha(0),this.tweens.add({targets:[s,r,o,n],alpha:1,duration:500,onComplete:()=>{this.time.delayedCall(1500,()=>{this.tweens.add({targets:[s,r,o,n],alpha:0,duration:500,onComplete:()=>{s.destroy(),r.destroy(),o.destroy(),n.destroy(),t()}})})}})}showBeastModeNotification(e){let t=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,b.canvas.width,b.canvas.height,0,.8).setDepth(299).setScrollFactor(0),i=this.add.graphics();i.fillStyle(4854924,1),i.lineStyle(2,8069026,1),i.fillRoundedRect(b.canvas.width/2-200,b.canvas.height/2-100,400,200,12),i.strokeRoundedRect(b.canvas.width/2-200,b.canvas.height/2-100,400,200,12),i.setDepth(300).setScrollFactor(0);let s=this.add.text(b.canvas.width/2,b.canvas.height/2-40,"BEAST MODE",{fontSize:"24px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(301).setScrollFactor(0),r=this.add.text(b.canvas.width/2,b.canvas.height/2,"ACTIVATED",{fontSize:"16px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(301).setScrollFactor(0),o=this.add.text(b.canvas.width/2,b.canvas.height/2+30,"Infinite floors at maximum difficulty!",{fontSize:"10px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0},align:"center"}).setOrigin(.5).setDepth(301).setScrollFactor(0);this.triggerFarcadeHapticFeedback(),this.tweens.add({targets:s,scaleX:1.1,scaleY:1.1,duration:500,yoyo:!0,repeat:-1,ease:"Power2"}),this.time.delayedCall(3e3,()=>{t.destroy(),i.destroy(),s.destroy(),r.destroy(),o.destroy(),e()})}updateCoinCounterDisplay(){let e=this.totalCoinsCollected%this.COINS_PER_EXTRA_LIFE;this.coinCounterText.setText(`${e}/${this.COINS_PER_EXTRA_LIFE}`)}updateLivesDisplay(){let e=this.lives,t=e>0?`x${e}`:"GAME OVER";this.livesText.setText(t),this.livesIcon&&this.livesIcon.setVisible(e>0)}showBeastModeLoadingIndicator(){this.beastModeLoadingText=this.add.text(this.cameras.main.width/2,100,"BEAST MODE: LOADING CHAOS... 0%",{fontSize:"16px",color:"#ff00ff",fontFamily:'"Press Start 2P", system-ui',stroke:"#000000",strokeThickness:3}),this.beastModeLoadingText.setOrigin(.5),this.beastModeLoadingText.setScrollFactor(0),this.beastModeLoadingText.setDepth(200),this.beastModeLoadingTimer=this.time.addEvent({delay:500,repeat:-1,callback:()=>{if(this.backgroundManager&&this.beastModeLoadingText){let e=this.backgroundManager.getBeastModeLoadingProgress();this.backgroundManager.isBeastModeFullyLoaded()?(this.beastModeLoadingText.setText("BEAST MODE: FULLY LOADED!"),this.beastModeLoadingText.setColor("#00ff00"),this.time.delayedCall(2e3,()=>{this.beastModeLoadingText&&(this.beastModeLoadingText.destroy(),this.beastModeLoadingText=void 0),this.beastModeLoadingTimer&&(this.beastModeLoadingTimer.destroy(),this.beastModeLoadingTimer=void 0)})):this.beastModeLoadingText.setText(`BEAST MODE: LOADING CHAOS... ${e.percentage}%`)}}})}checkForExtraLife(){let e=Math.floor(this.totalCoinsCollected/this.COINS_PER_EXTRA_LIFE);if(e>this.livesEarned){let t=e-this.livesEarned;console.log(`\u{1F48E} Checking extra lives: ${t} new lives to award (${this.totalCoinsCollected} gems / ${this.COINS_PER_EXTRA_LIFE})`);for(let i=0;i<t;i++)if(this.lives<this.MAX_LIVES){let s=this.lives;this.lives++,this.livesEarned++,this.game.registry.set("playerLives",this.lives),this.game.registry.set("livesEarned",this.livesEarned),this.updateLivesDisplay(),console.log(`\u{1F49A} Extra life earned from gems! Lives: ${s} -> ${this.lives}`),this.playSoundEffect("heart-collect",.5),this.showExtraLifePopup("150 Gems!")}else this.livesEarned++,this.game.registry.set("livesEarned",this.livesEarned),console.log(`\u{1F49B} Extra life earned but at max (${this.MAX_LIVES})`)}}showExtraLifePopup(e=""){let t=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-50,"EXTRA LIFE!",{fontSize:"20px",color:"#00ff00",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:0,stroke:!1,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0),i=null;e&&(i=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-20,e,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:0,stroke:!1,fill:!0}}).setOrigin(.5).setDepth(300).setScrollFactor(0));let s=i?[t,i]:[t];this.tweens.add({targets:s,y:"-=30",alpha:0,duration:2e3,ease:"Power2.easeOut",onComplete:()=>{t.destroy(),i&&i.destroy()}})}showLostLifePopup(){this.physics.pause(),this.touchControls.disable(),this.input.keyboard.enabled=!1;let e=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,b.canvas.width,b.canvas.height,0,.7).setDepth(199).setScrollFactor(0),t=280,i=180,s=this.cameras.main.width/2,r=this.cameras.main.height/2,o=this.add.graphics();o.fillStyle(4854924,1),o.lineStyle(2,8069026,1),o.fillRoundedRect(s-t/2,r-i/2,t,i,12),o.strokeRoundedRect(s-t/2,r-i/2,t,i,12),o.setDepth(200).setScrollFactor(0);let n=this.add.text(s,r-45,"LIFE LOST!",{fontSize:"22px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),l=this.add.text(s,r-10,`Lives Remaining: ${this.lives}`,{fontSize:"14px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),c=this.add.rectangle(s,r+40,140,35,2142890).setDepth(201).setScrollFactor(0);c.setInteractive({useHandCursor:!0}),c.setStrokeStyle(2,1608322);let h=this.add.text(s,r+40,"CONTINUE",{fontSize:"12px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(202).setScrollFactor(0);c.on("pointerdown",()=>{this.playSoundEffect("continue-button",.5),this.game.registry.set("isDeathRetry",!0),this.scene.restart()}),c.on("pointerover",()=>{c.setFillStyle(6750054)}),c.on("pointerout",()=>{c.setFillStyle(4521796)})}showGameOverScreen(){this.playSoundEffect("game-over",.5),this.physics.pause(),this.touchControls.disable(),this.input.keyboard.enabled=!1;let e=this.accumulatedScore+this.score,t=this.add.rectangle(b.canvas.width/2,b.canvas.height/2,b.canvas.width,b.canvas.height,0,.7).setDepth(199).setScrollFactor(0),i=380,s=470,r=this.cameras.main.width/2,o=this.cameras.main.height/2,n=this.add.graphics();n.fillStyle(4854924,1),n.lineStyle(2,8069026,1),n.fillRoundedRect(r-i/2,o-s/2,i,s,12),n.strokeRoundedRect(r-i/2,o-s/2,i,s,12),n.setDepth(200).setScrollFactor(0);let l=this.add.text(r,o-190,"GAME OVER!",{fontSize:"24px",color:"#ff69b4",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),c=this.add.text(r,o-155,`Score: ${this.accumulatedScore+this.score}`,{fontSize:"16px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(201).setScrollFactor(0),h=this.add.text(r,o-125,"\u{1F4CA} PERFORMANCE STATS",{fontSize:"12px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),d=this.add.text(r,o-100,`Floors Climbed: ${this.gameStats.highestFloor}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),p=this.add.text(r,o-80,`Level Reached: ${this.levelManager.getCurrentLevel()}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),u=this.add.text(r,o-60,`Gems Collected: ${this.totalGemsCollected+this.totalBlueGemsCollected+this.totalDiamondsCollected}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),m=this.add.text(r,o-40,`Treasure Chests: ${this.gameStats.treasureChestsOpened}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),y=this.add.text(r,o-10,"\u2694\uFE0F ENEMIES DEFEATED",{fontSize:"12px",color:"#ffd700",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),g=o+15,f=this.add.text(r,g,`Caterpillar: ${this.gameStats.enemyKills.caterpillar}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),v=this.add.text(r,g+18,`Rollz: ${this.gameStats.enemyKills.rollz}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),S=this.add.text(r,g+36,`Chomper: ${this.gameStats.enemyKills.chomper}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),x=this.add.text(r,g+54,`Snail: ${this.gameStats.enemyKills.snail}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),P=this.add.text(r,g+72,`Bouncer: ${this.gameStats.enemyKills.bouncer}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),C=this.add.text(r,g+90,`Stalker: ${this.gameStats.enemyKills.stalker}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),k=this.add.text(r,g+108,`Rex: ${this.gameStats.enemyKills.rex}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),E=this.add.text(r,g+126,`Blu: ${this.gameStats.enemyKills.blu}`,{fontSize:"10px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui'}).setOrigin(.5).setDepth(201).setScrollFactor(0),O=this.add.text(r,g+148,`Total Enemies: ${this.gameStats.totalEnemiesDefeated}`,{fontSize:"11px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold"}).setOrigin(.5).setDepth(201).setScrollFactor(0),M=this.add.rectangle(r,o+195,150,40,2142890).setDepth(201).setScrollFactor(0);M.setInteractive({useHandCursor:!0}),M.setStrokeStyle(2,1608322);let L=this.add.text(r,o+195,"CONTINUE",{fontSize:"14px",color:"#9acf07",fontFamily:'"Press Start 2P", system-ui',fontStyle:"bold",stroke:"#4a148c",strokeThickness:1,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:3,fill:!0}}).setOrigin(.5).setDepth(202).setScrollFactor(0);M.on("pointerdown",()=>{console.log("\u{1F504} Continue button clicked!");let T=this.game.registry.get("platform");T&&T.gameOver(e),console.log("[PlayFun] Score reported, restarting game..."),this.restartGame()}),M.on("pointerover",()=>{M.setFillStyle(2475971),L.setScale(1.1)}),M.on("pointerout",()=>{M.setFillStyle(2142890),L.setScale(1)}),this.input.keyboard.on("keydown-R",()=>{let T=this.game.registry.get("platform");T&&T.gameOver(e),this.restartGame()})}changePlayerTexture(e){this.textures.exists(e)&&(this.player.setTexture(e),this.player.setDisplaySize(48,64))}initializeBubbleSystem(){this.createPlaceholderBubbles(),this.player.setBubbleTriggerCallback(()=>{this.showRandomBubble()}),this.player.setMovementStartCallback(()=>{this.hideBubble()})}createDebugGrid(){this.children.list.forEach(l=>{l.getData&&l.getData("debugGrid")&&l.destroy()});let e=this.add.graphics();e.setDepth(200),e.setScrollFactor(1),e.setData("debugGrid",!0);let t=this.player.x,i=this.player.y,s=20,r=200;e.lineStyle(1,16711680,.5);for(let l=t-r;l<=t+r;l+=s)e.lineBetween(l,i-r,l,i+r);for(let l=i-r;l<=i+r;l+=s)e.lineBetween(t-r,l,t+r,l);e.lineStyle(2,65280,.8),e.lineBetween(t,i-r,t,i+r),e.lineBetween(t-r,i,t+r,i);let o=40;for(let l=t-r;l<=t+r;l+=o)for(let c=i-r;c<=i+r;c+=o){let h=l-t,d=c-i;this.add.text(l,c,`${h},${d}`,{fontSize:"8px",color:"#ffffff",backgroundColor:"rgba(0,0,0,0.7)",padding:{x:1,y:1}}).setOrigin(.5).setDepth(201).setScrollFactor(1).setData("debugGrid",!0)}let n=this.add.circle(t,i,3,16711680);n.setDepth(202).setScrollFactor(1),n.setData("debugGrid",!0),this.time.delayedCall(1e4,()=>{this.children.list.forEach(l=>{l.getData&&l.getData("debugGrid")&&l.destroy()})})}createPlaceholderBubbles(){}showRandomBubble(){this.speechBubble||this.thoughtBubble||this.showSpeechBubble()}showSpeechBubble(){let e=this.add.image(0,0,"talking-bubble");e.setDepth(150),e.setScrollFactor(1),e.x=this.player.x+20+e.width*.5,e.y=this.player.y+20-e.height*.5,this.speechBubble=e,this.player.notifyBubbleActive(!0),this.bubbleTimer=this.time.delayedCall(this.BUBBLE_DISPLAY_TIME,()=>{this.hideBubble()})}showThoughtBubble(){let e=this.add.image(0,0,"thoughtBubblePlaceholder");e.setDepth(150),e.setScrollFactor(1);let t=-105*(Math.PI/180),i=45,s=(Math.random()-.5)*8,r=(Math.random()-.5)*8;e.x=this.player.x+Math.cos(t)*i+s,e.y=this.player.y+Math.sin(t)*i+r,this.thoughtBubble=e,this.player.notifyBubbleActive(!0),this.bubbleTimer=this.time.delayedCall(this.BUBBLE_DISPLAY_TIME,()=>{this.hideBubble()})}hideBubble(){this.speechBubble&&(this.speechBubble.destroy(),this.speechBubble=null),this.thoughtBubble&&(this.thoughtBubble.destroy(),this.thoughtBubble=null),this.bubbleTimer&&(this.bubbleTimer.destroy(),this.bubbleTimer=null),this.player.notifyBubbleActive(!1)}updateBackgroundPosition(){if(!this.backgroundSprite)return;let t=this.cameras.main.scrollY*.05,i=this.backgroundInitialY-t,s=b.canvas.height,r=this.backgroundHeight,o=0,n=s-r;r>s?(i=Math.min(o,i),i=Math.max(n,i)):i=o,this.backgroundSprite.setY(i)}getEnemyTypeName(e){if(e.constructor.name==="Cat"){let t=e.getCatColor?e.getCatColor():e.catColor||e.color||e.getData?.("color"),i=e.getIsStalker?e.getIsStalker():e.isStalker||e.getData?.("isStalker");switch(console.log(`\u{1F3AF} Enemy type detection - Color: ${t}, Stalker: ${i}`),t){case"yellow":return"caterpillar";case"blue_caterpillar":return"caterpillar";case"blue":return"chomper";case"purple":return"chomper";case"red":return i?"stalker":"snail";case"green":return"bouncer";default:return console.warn("\u274C Unknown enemy color:",t),"unknown"}}else{if(e.constructor.name==="Beetle")return"rollz";if(e.constructor.name==="Rex")return"rex";if(e.constructor.name==="BaseBlu")return"blu"}return"unknown"}notifyFarcadeGameReady(){try{typeof window<"u"&&window.FarcadeSDK&&window.FarcadeSDK.singlePlayer.actions.ready()}catch{}}notifyFarcadeGameOver(e){try{typeof window<"u"&&window.FarcadeSDK&&window.FarcadeSDK.singlePlayer.actions.gameOver({score:e})}catch{}}triggerFarcadeHapticFeedback(){try{typeof window<"u"&&window.FarcadeSDK&&window.FarcadeSDK.singlePlayer.actions.hapticFeedback()}catch{}}setupFarcadeEventHandlers(){try{if(typeof window<"u"&&window.FarcadeSDK){let e=window.FarcadeSDK;e.singlePlayer.events.on("play_again",()=>{this.restartGame()}),e.singlePlayer.events.on("toggle_mute",()=>{})}}catch{}}restartGame(){this.game.registry.set("isDeathRetry",!1),this.game.registry.set("isLevelProgression",!1),this.game.registry.set("currentLevel",1),this.game.registry.set("playerLives",3),this.game.registry.set("totalCoins",0),this.game.registry.set("livesEarned",0),this.game.registry.set("accumulatedScore",0),this.scene.restart()}checkAndReplaceStuckChompers(){this.cats&&this.cats.children.entries.forEach(e=>{if(e instanceof H){let t=e,i=t.getData("stuckRecoveryCount")||0;if(t.getCatColor()==="blue"&&i>=3){console.warn("Replacing chronically stuck Chomper with Snail at position",t.x,t.y);let s=t.x,r=t.y,o=t.platformBounds;t.destroy();let n=new H(this,s,r,o.left,o.right,"red",!1);this.cats.add(n),console.log("Successfully replaced stuck Chomper with Snail")}}})}shutdown(){this.backgroundSprite=null,this.backgroundInitialY=0,this.backgroundHeight=0}};var le=null;async function Ee(B){try{typeof window<"u"&&window.OpenGameSDK?(le=new window.OpenGameSDK({gameId:B,ui:{usePointsWidget:!0}}),await le.init(),console.log("[PlayFun] SDK initialized")):console.warn("[PlayFun] OpenGameSDK not found on window")}catch(a){console.warn("[PlayFun] SDK init failed:",a)}}function Be(B){if(le)try{le.addPoints(B),le.savePoints(),console.log("[PlayFun] Score reported:",B)}catch(a){console.warn("[PlayFun] Score report failed:",a)}else console.log("[PlayFun] SDK not available, score not reported:",B)}var Pe=class{ready(){console.log("[PlayFun] Game ready")}gameOver(a){console.log(`[PlayFun] Game Over - Score: ${a}`),Be(a)}haptic(a){if("vibrate"in navigator){let e=a==="heavy"?100:50;navigator.vibrate(e)}}mute(){window.game&&(window.game.sound.mute=!0)}unmute(){window.game&&(window.game.sound.mute=!1)}async saveScore(a){this.gameOver(a)}async getHighScore(){return 0}async connectWallet(){return null}async disconnectWallet(){}showWalletButton(){}hideWalletButton(){}async showWalletAccount(){}};function Me(){return console.log("[PlayFun] Using Play.fun platform"),new Pe}var Le=[he,de,ue,Se],Ae={type:Phaser.WEBGL,width:w.canvas.width,height:w.canvas.height,scale:{mode:Phaser.Scale.FIT,parent:document.body,autoCenter:Phaser.Scale.CENTER_BOTH,width:w.canvas.width,height:w.canvas.height},backgroundColor:"#2e2348",scene:Le,physics:{default:"arcade",arcade:{gravity:{y:w.game.gravity},debug:!1}},audio:{disableWebAudio:!1,noAudio:!1},fps:{target:60},pixelArt:!0,antialias:!1,render:{pixelArt:!0,roundPixels:!0}};async function Ie(){await document.fonts.ready;try{await document.fonts.load('400 16px "Press Start 2P"')}catch{}await new Promise(B=>setTimeout(B,50))}async function De(){await Ie();let B=new Phaser.Game(Ae);window.game=B;let a=Me();B.registry.set("platform",a),B.registry.set("isPlayFun",!0),window.platform=a,window.gamePlatform=a,B.registry.set("isReplay",!1),console.log("[PlayFun] Treasure Quest initialized",{canvas:`${w.canvas.width}x${w.canvas.height}`,viewport:`${window.innerWidth}x${window.innerHeight}`,platform:"play.fun"}),B.events.once("ready",()=>{a.ready(),Ee("PLAYFUN_GAME_ID_PLACEHOLDER");let e=B.canvas,t=!1,i=()=>{B.sound.context&&(B.sound.context.state==="suspended"?B.sound.context.resume().then(()=>{console.log("[PlayFun] Audio context resumed"),t=!0}).catch(s=>{console.warn("[PlayFun] Could not resume audio:",s)}):B.sound.context.state==="running"&&!t&&(t=!0))};e.addEventListener("click",i,{passive:!0}),e.addEventListener("touchstart",i,{passive:!1}),document.addEventListener("keydown",i,{passive:!0}),document.addEventListener("visibilitychange",()=>{document.hidden||i()})})}De().catch(B=>console.error("[PlayFun] Failed to initialize:",B));})();
</script></body></html>